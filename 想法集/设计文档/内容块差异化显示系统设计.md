# MClite å†…å®¹å—å·®å¼‚åŒ–æ˜¾ç¤ºç³»ç»Ÿè®¾è®¡æ–‡æ¡£

> æœ¬æ–‡æ¡£æè¿°MCliteé¡¹ç›®ä¸­AIå›å¤å†…å®¹çš„æ ¼å¼åŒ–æ˜¾ç¤ºç³»ç»Ÿï¼Œå‚è€ƒå½’å¢ŸPlusçš„"æ ¼å¼å¼ºè°ƒ"è®¾è®¡ç†å¿µã€‚

## ç›®å½•

- [ä¸€ã€ç³»ç»Ÿæ¦‚è¿°](#ä¸€ç³»ç»Ÿæ¦‚è¿°)
- [äºŒã€æ ¼å¼è§„èŒƒ](#äºŒæ ¼å¼è§„èŒƒ)
- [ä¸‰ã€æ¶æ„è®¾è®¡](#ä¸‰æ¶æ„è®¾è®¡)
- [å››ã€ä½¿ç”¨æŒ‡å—](#å››ä½¿ç”¨æŒ‡å—)
- [äº”ã€æ ·å¼å®šåˆ¶](#äº”æ ·å¼å®šåˆ¶)
- [å…­ã€APIå‚è€ƒ](#å…­apiå‚è€ƒ)

---

## ä¸€ã€ç³»ç»Ÿæ¦‚è¿°

### 1.1 è®¾è®¡èƒŒæ™¯

åœ¨è§’è‰²æ‰®æ¼”å’Œäº’åŠ¨å™äº‹åœºæ™¯ä¸­ï¼ŒAIç”Ÿæˆçš„æ–‡æœ¬å†…å®¹é€šå¸¸åŒ…å«å¤šç§ç±»å‹ï¼šå¯¹è¯ã€å¿ƒç†æ´»åŠ¨ã€ç¯å¢ƒæå†™ã€ç³»ç»Ÿæç¤ºç­‰ã€‚ä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒå’Œé˜…è¯»æ²‰æµ¸æ„Ÿï¼Œéœ€è¦å¯¹ä¸åŒç±»å‹çš„å†…å®¹è¿›è¡Œå·®å¼‚åŒ–çš„è§†è§‰å‘ˆç°ã€‚

### 1.2 è®¾è®¡ç›®æ ‡

- **æ²‰æµ¸æ„Ÿæå‡**ï¼šé€šè¿‡è§†è§‰å·®å¼‚åŒ–ï¼Œè®©ç”¨æˆ·æ›´å®¹æ˜“åŒºåˆ†ä¸åŒç±»å‹çš„å†…å®¹
- **æ ¼å¼ç»Ÿä¸€**ï¼šç¦æ­¢ä½¿ç”¨ä¸­è‹±æ–‡å¼•å·ï¼Œç»Ÿä¸€ä½¿ç”¨ç‰¹å®šç¬¦å·åŒ…è£¹å†…å®¹
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒè‡ªå®šä¹‰ä¸»é¢˜å’Œæ ·å¼
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé«˜æ•ˆçš„è§£æç®—æ³•ï¼Œæ”¯æŒæµå¼ä¼ è¾“åœºæ™¯

### 1.3 å‚è€ƒæ¥æº

æœ¬ç³»ç»Ÿå‚è€ƒå½’å¢ŸPlusçš„æ ¼å¼å¼ºè°ƒè®¾è®¡ï¼š

| æ ¼å¼ | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| `ã€Œã€` | è§’è‰²è¯­è¨€/å¯¹è¯ | `ã€Œæˆ‘çœŸçš„å¥½å–œæ¬¢ä½ â€¦â€¦ã€` |
| `*...*` | è§’è‰²å¿ƒç†æå†™ | `*å¿ƒç†æå†™*` |
| `ã€ã€‘` | æ™¯ç‰©æå†™ | `ã€æ™¯ç‰©æå†™ã€‘` |
| `ã€ã€...ã€‘ã€‘` | ç³»ç»Ÿæç¤º/å¼ºè°ƒ | `ã€ã€ç³»ç»Ÿæç¤ºã€‘ã€‘` |

---

## äºŒã€æ ¼å¼è§„èŒƒ

### 2.1 å¯¹è¯æ ¼å¼ - `ã€Œã€`

ç”¨äºåŒ…è£¹è§’è‰²çš„è¯­è¨€å¯¹è¯ã€‚

**è§„åˆ™ï¼š**

- ä½¿ç”¨å…¨è§’æ–¹å¤´æ‹¬å· `ã€Œ` å’Œ `ã€` åŒ…è£¹
- ç¦æ­¢ä½¿ç”¨ä¸­è‹±æ–‡å¼•å· `""` `''`
- æ”¯æŒåµŒå¥—ï¼ˆå†…å±‚ä½¿ç”¨ `ã€ã€`ï¼‰

**ç¤ºä¾‹ï¼š**

```
ã€Œæˆ‘çœŸçš„å¥½å–œæ¬¢ä½ å–œæ¬¢ä½ å–œæ¬¢ä½ â€¦â€¦ã€
ã€Œä½ è¯´ä»€ä¹ˆï¼Ÿã€å¥¹æ„£äº†ä¸€ä¸‹ï¼Œã€Œæˆ‘æ²¡å¬æ¸…ã€‚ã€
```

**è§†è§‰æ•ˆæœï¼š**

- æ·±è“è‰²æ–‡å­—
- æ·¡è“è‰²èƒŒæ™¯
- å·¦ä¾§3pxå®çº¿è¾¹æ¡†
- å¼•å·è£…é¥°

### 2.2 å¿ƒç†æå†™æ ¼å¼ - `*...*`

ç”¨äºè¡¨è¾¾è§’è‰²çš„å†…å¿ƒæ´»åŠ¨å’Œæƒ³æ³•ã€‚

**è§„åˆ™ï¼š**

- ä½¿ç”¨å•ä¸ªæ˜Ÿå· `*` åŒ…è£¹
- é¿å…ä¸MarkdownåŠ ç²—ï¼ˆ`**`ï¼‰å†²çª
- å†…å®¹ä¸èƒ½ä¸ºç©º

**ç¤ºä¾‹ï¼š**

```
*è¿™ä¸ªäººå¥½å¥‡æ€ªâ€¦â€¦æˆ‘è¦å°å¿ƒä¸€ç‚¹ã€‚*
å¥¹çœ‹ç€çª—å¤–ï¼Œ*ä¸çŸ¥é“ä»–ç°åœ¨åœ¨åšä»€ä¹ˆå‘¢â€¦â€¦*
```

**è§†è§‰æ•ˆæœï¼š**

- ç´«è‰²æ–œä½“æ–‡å­—
- æ·¡ç´«è‰²èƒŒæ™¯
- åº•éƒ¨æ³¢æµªè£…é¥°
- æ€è€ƒæ³¡æ³¡åŠ¨ç”»

### 2.3 æ™¯ç‰©æå†™æ ¼å¼ - `ã€ã€‘`

ç”¨äºç¯å¢ƒã€åœºæ™¯ã€æ°›å›´çš„æå†™ã€‚

**è§„åˆ™ï¼š**

- ä½¿ç”¨å…¨è§’æ–¹æ‹¬å· `ã€` å’Œ `ã€‘` åŒ…è£¹
- é€šå¸¸ä½œä¸ºç‹¬ç«‹æ®µè½å‡ºç°
- ä¸è¦ä¸ç³»ç»Ÿæç¤ºæ ¼å¼ `ã€ã€ã€‘ã€‘` æ··æ·†

**ç¤ºä¾‹ï¼š**

```
ã€å¤•é˜³è¥¿ä¸‹ï¼Œé‡‘è‰²çš„å…‰èŠ’æ´’æ»¡äº†æ•´ä¸ªæˆ¿é—´ã€‚çª—å¤–çš„æ¢§æ¡æ ‘å¶åœ¨å¾®é£ä¸­è½»è½»æ‘‡æ›³ã€‚ã€‘
ã€æ·±å¤œçš„åŠå…¬å®¤é‡Œåªå‰©ä¸‹å‡ ç›å°ç¯è¿˜äº®ç€ï¼Œé”®ç›˜æ•²å‡»å£°æ­¤èµ·å½¼ä¼ã€‚ã€‘
```

**è§†è§‰æ•ˆæœï¼š**

- ç»¿è‰²æ–‡å­—
- æ·¡ç»¿è‰²èƒŒæ™¯
- è™šçº¿è¾¹æ¡†
- è£…é¥°æ€§è§’è½
- é¦–è¡Œç¼©è¿›

### 2.4 ç³»ç»Ÿæç¤ºæ ¼å¼ - `ã€ã€...ã€‘ã€‘`

ç”¨äºæ˜¾ç¤ºç³»ç»Ÿçº§åˆ«çš„æç¤ºã€è­¦å‘Šæˆ–å¼ºè°ƒå†…å®¹ã€‚

**è§„åˆ™ï¼š**

- ä½¿ç”¨åŒå±‚æ–¹æ‹¬å· `ã€ã€` å’Œ `ã€‘ã€‘` åŒ…è£¹
- ä¼˜å…ˆçº§æœ€é«˜ï¼Œå…ˆäºå•å±‚æ–¹æ‹¬å·è§£æ
- é€šå¸¸å±…ä¸­æ˜¾ç¤º

**ç¤ºä¾‹ï¼š**

```
ã€ã€è­¦å‘Šï¼šæ•æ„Ÿå†…å®¹ï¼Œè¯·è°¨æ…é˜…è¯»ã€‘ã€‘
ã€ã€ç³»ç»Ÿï¼šæ¸¸æˆå­˜æ¡£å·²ä¿å­˜ã€‘ã€‘
ã€ã€æç¤ºï¼šæŒ‰ ESC é”®å¯ä»¥æ‰“å¼€èœå•ã€‘ã€‘
```

**è§†è§‰æ•ˆæœï¼š**

- çº¢è‰²åŠ ç²—æ–‡å­—
- æ·¡çº¢è‰²èƒŒæ™¯
- 2pxå®çº¿è¾¹æ¡†
- é¡¶éƒ¨è­¦ç¤ºæ¡çº¹
- å›¾æ ‡è„‰å†²åŠ¨ç”»

---

## ä¸‰ã€æ¶æ„è®¾è®¡

### 3.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AIå›å¤æ–‡æœ¬è¾“å…¥                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ContentBlockParserService                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. æŸ¥æ‰¾æ‰€æœ‰æ ¼å¼åŒ¹é…ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰                    â”‚   â”‚
â”‚  â”‚  2. è§£å†³é‡å é—®é¢˜ï¼ˆé«˜ä¼˜å…ˆçº§ä¼˜å…ˆï¼‰                       â”‚   â”‚
â”‚  â”‚  3. æ„å»ºå†…å®¹å—åˆ—è¡¨ï¼ˆå«æ™®é€šæ–‡æœ¬ï¼‰                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ParseResult                               â”‚
â”‚  {                                                          â”‚
â”‚    blocks: ContentBlock[],    // è§£æåçš„å†…å®¹å—æ•°ç»„         â”‚
â”‚    originalText: string,      // åŸå§‹æ–‡æœ¬                   â”‚
â”‚    success: boolean,          // è§£ææ˜¯å¦æˆåŠŸ               â”‚
â”‚    statistics: {...}          // ç»Ÿè®¡ä¿¡æ¯                   â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ContentBlockRenderer.vue                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ éå†æ¸²æŸ“æ¯ä¸ªå†…å®¹å—                                 â”‚   â”‚
â”‚  â”‚  â€¢ åº”ç”¨å¯¹åº”ç±»å‹çš„æ ·å¼                                 â”‚   â”‚
â”‚  â”‚  â€¢ æ”¯æŒä¸»é¢˜åˆ‡æ¢ï¼ˆäº®è‰²/æš—è‰²ï¼‰                          â”‚   â”‚
â”‚  â”‚  â€¢ å‘é€äº¤äº’äº‹ä»¶                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢æ˜¾ç¤º                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ–‡ä»¶ç»“æ„

```
src/MClite/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ contentBlock.ts          # ç±»å‹å®šä¹‰
â”œâ”€â”€ services/
â”‚   â””â”€â”€ ContentBlockParserService.ts  # è§£ææœåŠ¡
â”œâ”€â”€ components/
â”‚   â””â”€â”€ common/
â”‚       â””â”€â”€ ContentBlockRenderer.vue  # æ¸²æŸ“ç»„ä»¶
â””â”€â”€ styles/
    â””â”€â”€ content-blocks.scss      # ä¸“ç”¨æ ·å¼
```

### 3.3 æ ¸å¿ƒç±»å‹å®šä¹‰

```typescript
// å†…å®¹å—ç±»å‹æšä¸¾
enum ContentBlockType {
  TEXT = 'text',        // æ™®é€šæ–‡æœ¬
  DIALOGUE = 'dialogue', // å¯¹è¯ ã€Œã€
  THOUGHT = 'thought',   // å¿ƒç† *...*
  SCENERY = 'scenery',   // æ™¯ç‰© ã€ã€‘
  SYSTEM = 'system',     // ç³»ç»Ÿ ã€ã€ã€‘ã€‘
}

// å†…å®¹å—æ¥å£
interface ContentBlock {
  id: string;               // å”¯ä¸€æ ‡è¯†
  type: ContentBlockType;   // å—ç±»å‹
  rawContent: string;       // åŸå§‹å†…å®¹ï¼ˆå«ç¬¦å·ï¼‰
  displayContent: string;   // æ˜¾ç¤ºå†…å®¹ï¼ˆä¸å«ç¬¦å·ï¼‰
  startIndex: number;       // èµ·å§‹ä½ç½®
  endIndex: number;         // ç»“æŸä½ç½®
}

// æ ¼å¼ç¬¦å·å®šä¹‰
interface FormatMarker {
  type: ContentBlockType;   // æ ¼å¼ç±»å‹
  start: string;            // å¼€å§‹ç¬¦å·
  end: string;              // ç»“æŸç¬¦å·
  regex: RegExp;            // æ­£åˆ™è¡¨è¾¾å¼
  priority: number;         // ä¼˜å…ˆçº§
}
```

### 3.4 è§£æç®—æ³•

è§£æé‡‡ç”¨**ä¼˜å…ˆçº§åŒ¹é… + é‡å æ¶ˆè§£**ç­–ç•¥ï¼š

1. **æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…**ï¼šéå†æ‰€æœ‰æ ¼å¼ç¬¦å·çš„æ­£åˆ™è¡¨è¾¾å¼
2. **ä¼˜å…ˆçº§æ’åº**ï¼šç³»ç»Ÿæç¤º(100) > æ™¯ç‰©(80) > å¯¹è¯(60) > å¿ƒç†(40)
3. **é‡å æ¶ˆè§£**ï¼šé«˜ä¼˜å…ˆçº§åŒ¹é…ä¼˜å…ˆä¿ç•™ï¼Œæ’é™¤ä¸å…¶é‡å çš„ä½ä¼˜å…ˆçº§åŒ¹é…
4. **å¡«å……æ–‡æœ¬**ï¼šæœªåŒ¹é…çš„éƒ¨åˆ†ä½œä¸ºæ™®é€šæ–‡æœ¬å—

```typescript
// ä¼˜å…ˆçº§é…ç½®
const FORMAT_MARKERS = [
  { type: SYSTEM,   priority: 100, regex: /ã€ã€([\s\S]*?)ã€‘ã€‘/g },
  { type: SCENERY,  priority: 80,  regex: /(?<!ã€)ã€(?!ã€)([\s\S]*?)(?<!ã€‘)ã€‘(?!ã€‘)/g },
  { type: DIALOGUE, priority: 60,  regex: /ã€Œ([\s\S]*?)ã€/g },
  { type: THOUGHT,  priority: 40,  regex: /\*(?!\*)([^*]+)\*(?!\*)/g },
];
```

---

## å››ã€ä½¿ç”¨æŒ‡å—

### 4.1 åŸºç¡€ç”¨æ³•

```vue
<template>
  <ContentBlockRenderer
    :content="aiResponse"
    :is-streaming="isStreaming"
  />
</template>

<script setup>
import ContentBlockRenderer from '@/components/common/ContentBlockRenderer.vue';

const aiResponse = ref('ã€Œä½ å¥½å•Šï¼ã€å¥¹å¾®ç¬‘ç€è¯´é“ã€‚*çœŸæ˜¯ä¸ªæœ‰è¶£çš„äººå‘¢â€¦â€¦*');
const isStreaming = ref(false);
</script>
```

### 4.2 é…ç½®é€‰é¡¹

```vue
<template>
  <ContentBlockRenderer
    :content="content"
    :config="{
      enabled: true,        // å¯ç”¨è§£æ
      showIcons: true,      // æ˜¾ç¤ºå›¾æ ‡
      enableAnimations: true // å¯ç”¨åŠ¨ç”»
    }"
    :theme="'auto'"         // 'light' | 'dark' | 'auto'
    @block-click="handleClick"
    @block-hover="handleHover"
    @parsed="handleParsed"
  />
</template>
```

### 4.3 ç›´æ¥ä½¿ç”¨è§£ææœåŠ¡

```typescript
import { contentBlockParserService } from '@/services/ContentBlockParserService';

// è§£ææ–‡æœ¬
const result = contentBlockParserService.parse(text);
console.log(result.blocks);       // ContentBlock[]
console.log(result.statistics);   // ç»Ÿè®¡ä¿¡æ¯

// æ£€æŸ¥æ˜¯å¦åŒ…å«æ ¼å¼åŒ–å†…å®¹
const hasFormatted = contentBlockParserService.hasFormattedContent(text);

// æå–ç‰¹å®šç±»å‹çš„å†…å®¹
const dialogues = contentBlockParserService.extractByType(text, ContentBlockType.DIALOGUE);

// ç§»é™¤æ‰€æœ‰æ ¼å¼ç¬¦å·
const plainText = contentBlockParserService.stripFormatting(text);

// éªŒè¯æ ¼å¼
const validation = contentBlockParserService.validateFormat(text);
```

### 4.4 åœ¨MainContentç»„ä»¶ä¸­é›†æˆ

```vue
<!-- MainContent.vue -->
<template>
  <div class="game-text">
    <ContentBlockRenderer
      :content="props.currentContent"
      :is-streaming="props.isStreaming"
      :theme="currentTheme"
      @block-click="handleBlockClick"
    />
  </div>
</template>

<script setup>
import ContentBlockRenderer from '../common/ContentBlockRenderer.vue';

const handleBlockClick = (event) => {
  console.log('ç‚¹å‡»äº†å†…å®¹å—:', event.block.type, event.block.displayContent);
};
</script>
```

---

## äº”ã€æ ·å¼å®šåˆ¶

### 5.1 CSSå˜é‡

æ‰€æœ‰æ ·å¼éƒ½é€šè¿‡CSSå˜é‡å®šä¹‰ï¼Œæ”¯æŒä¸»é¢˜åˆ‡æ¢ï¼š

```scss
:root {
  // å¯¹è¯æ ·å¼
  --cb-dialogue-color: #1a5fb4;
  --cb-dialogue-bg: rgba(26, 95, 180, 0.05);
  --cb-dialogue-border: rgba(26, 95, 180, 0.2);
  
  // å¿ƒç†æå†™æ ·å¼
  --cb-thought-color: #8b5cf6;
  --cb-thought-bg: rgba(139, 92, 246, 0.05);
  
  // æ™¯ç‰©æå†™æ ·å¼
  --cb-scenery-color: #059669;
  --cb-scenery-bg: rgba(5, 150, 105, 0.05);
  
  // ç³»ç»Ÿæç¤ºæ ·å¼
  --cb-system-color: #dc2626;
  --cb-system-bg: rgba(220, 38, 38, 0.08);
}
```

### 5.2 æ·±è‰²ä¸»é¢˜

æ·±è‰²ä¸»é¢˜ä¼šè‡ªåŠ¨åº”ç”¨ä¸åŒçš„é…è‰²ï¼š

```scss
:root.dark-theme {
  --cb-dialogue-color: #60a5fa;
  --cb-thought-color: #a78bfa;
  --cb-scenery-color: #34d399;
  --cb-system-color: #f87171;
}
```

### 5.3 è‡ªå®šä¹‰ä¸»é¢˜

é€šè¿‡propsä¼ å…¥è‡ªå®šä¹‰ä¸»é¢˜ï¼š

```typescript
const customTheme: ContentBlockTheme = {
  name: 'custom',
  styles: {
    [ContentBlockType.DIALOGUE]: {
      textColor: '#ff6b6b',
      backgroundColor: 'rgba(255, 107, 107, 0.1)',
      borderColor: '#ff6b6b',
      borderWidth: '0 0 0 4px',
      icon: 'ğŸ—£ï¸',
    },
    // ... å…¶ä»–ç±»å‹
  },
};
```

---

## å…­ã€APIå‚è€ƒ

### 6.1 ContentBlockParserService

| æ–¹æ³• | æè¿° | è¿”å›å€¼ |
|------|------|--------|
| `parse(text)` | è§£ææ–‡æœ¬ä¸ºå†…å®¹å— | `ParseResult` |
| `hasFormattedContent(text)` | æ£€æŸ¥æ˜¯å¦åŒ…å«æ ¼å¼ | `boolean` |
| `getContentTypes(text)` | è·å–æ‰€æœ‰æ ¼å¼ç±»å‹ | `ContentBlockType[]` |
| `extractByType(text, type)` | æå–æŒ‡å®šç±»å‹å†…å®¹ | `string[]` |
| `stripFormatting(text)` | ç§»é™¤æ‰€æœ‰æ ¼å¼ç¬¦å· | `string` |
| `validateFormat(text)` | éªŒè¯æ ¼å¼æ­£ç¡®æ€§ | `{ valid, errors }` |
| `toHtml(result)` | è½¬æ¢ä¸ºHTMLå­—ç¬¦ä¸² | `string` |
| `updateConfig(config)` | æ›´æ–°é…ç½® | `void` |
| `resetConfig()` | é‡ç½®ä¸ºé»˜è®¤é…ç½® | `void` |

### 6.2 ContentBlockRenderer Props

| Prop | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|------|------|--------|------|
| `content` | `string` | `''` | è¦æ¸²æŸ“çš„å†…å®¹ |
| `isStreaming` | `boolean` | `false` | æ˜¯å¦æ­£åœ¨æµå¼ä¼ è¾“ |
| `config` | `Partial<RendererConfig>` | `{}` | æ¸²æŸ“å™¨é…ç½® |
| `theme` | `'light' \| 'dark' \| 'auto'` | `'auto'` | ä¸»é¢˜æ¨¡å¼ |

### 6.3 ContentBlockRenderer Events

| äº‹ä»¶ | å‚æ•° | æè¿° |
|------|------|------|
| `block-click` | `ContentBlockEvent` | å†…å®¹å—è¢«ç‚¹å‡» |
| `block-hover` | `ContentBlockEvent` | å†…å®¹å—è¢«æ‚¬åœ |
| `parsed` | `ParseResult` | è§£æå®Œæˆ |

### 6.4 ContentBlockEvent

```typescript
interface ContentBlockEvent {
  type: 'click' | 'hover' | 'copy';
  block: ContentBlock;
  nativeEvent: Event;
}
```

---

## æ€»ç»“

å†…å®¹å—å·®å¼‚åŒ–æ˜¾ç¤ºç³»ç»Ÿä¸ºMCliteæä¾›äº†ä¸€å¥—å®Œæ•´çš„AIå›å¤å†…å®¹æ ¼å¼åŒ–è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æ˜ç¡®çš„æ ¼å¼è§„èŒƒã€é«˜æ•ˆçš„è§£æç®—æ³•å’Œçµæ´»çš„æ ·å¼å®šåˆ¶ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡ç”¨æˆ·çš„é˜…è¯»ä½“éªŒå’Œæ²‰æµ¸æ„Ÿã€‚

**æ ¸å¿ƒæ–‡ä»¶ï¼š**

| æ–‡ä»¶ | æè¿° |
|------|------|
| [`types/contentBlock.ts`](../../types/contentBlock.ts) | ç±»å‹å®šä¹‰ |
| [`services/ContentBlockParserService.ts`](../../services/ContentBlockParserService.ts) | è§£ææœåŠ¡ |
| [`components/common/ContentBlockRenderer.vue`](../../components/common/ContentBlockRenderer.vue) | æ¸²æŸ“ç»„ä»¶ |
| [`styles/content-blocks.scss`](../../styles/content-blocks.scss) | ä¸“ç”¨æ ·å¼ |

---

*æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š2024-12-17*
*é€‚ç”¨ç‰ˆæœ¬ï¼šMClite v1.0*
