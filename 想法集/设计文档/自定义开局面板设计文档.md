# MClite 自定义开局面板设计文档

## 一、概述

### 1.1 功能定位

自定义开局面板是一个**提示词生成器**，允许玩家在游戏开始前自定义世界设定，然后将这些设定转化为结构化提示词发送给AI，由AI生成对应的游戏初始内容和变量。

### 1.2 显示条件

- 仅在 `currentContent`（即 `aiCurrentContent`）为空时显示
- 新开聊天或清空内容后自动显示
- 一旦AI生成了内容，面板自动隐藏，显示正常的游戏内容区

### 1.3 显示位置

- 位于主内容区（MainContent组件内）
- 替代空白状态的占位内容

---

## 二、面板结构设计

### 2.1 整体布局

```
┌─────────────────────────────────────────────────────────────┐
│  🎮 自定义开局                                    [快速开始] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📍 场景设定                                          │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ 场景类型: [下拉] 办公室/学校/医院/军队/自定义...      │   │
│  │ 场景名称: [输入] _______________________________     │   │
│  │ 场景描述: [文本域] _____________________________     │   │
│  │           _____________________________________     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 🌍 世界观设定                                        │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ [文本域] 描述这个世界的背景、规则、特色...           │   │
│  │ _________________________________________________   │   │
│  │ _________________________________________________   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 👤 玩家设定                                          │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ 姓名: [输入] ____________  年龄: [数字] ____        │   │
│  │ 身份/职位: [输入] _______________________________   │   │
│  │ 所属部门: [输入] ________________________________   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📋 规章制度定义 (必填 - 关系到人事系统功能)          │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │                                                     │   │
│  │ ▼ 花名册字段定义 (必填)                             │   │
│  │   说明：定义人员档案需要记录哪些信息                │   │
│  │   [文本域] 例如：姓名、性别、年龄、部门、职位、     │   │
│  │            身高、体重、特长、评级、备注...          │   │
│  │                                                     │   │
│  │ ▼ 服装规定 (可选)                                   │   │
│  │   说明：定义场景中的着装要求和规范                  │   │
│  │   [文本域] 例如：工作日着正装，女性需穿高跟鞋...    │   │
│  │                                                     │   │
│  │ ▼ 其他规章制度 (可选)                               │   │
│  │   说明：其他需要AI遵守的规则                        │   │
│  │   [文本域] 例如：考勤制度、行为规范、奖惩制度...    │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📝 补充说明 (可选)                                   │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ [文本域] 其他想要告诉AI的内容...                    │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│              [🎲 随机填充]        [🚀 开始游戏]             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 各区块说明

#### 场景设定（必填）

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 场景类型 | 下拉选择 | ✅ | 预设选项：办公室、学校、医院、军队、自定义 |
| 场景名称 | 文本输入 | ✅ | 如：第七处、XX高中、市中心医院 |
| 场景描述 | 多行文本 | ❌ | 对场景的详细描述 |

#### 世界观设定（可选）

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 世界观 | 多行文本 | ❌ | 描述世界背景、特殊规则、时代背景等 |

#### 玩家设定（必填）

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 姓名 | 文本输入 | ✅ | 玩家角色姓名，默认使用 `<user>` |
| 年龄 | 数字输入 | ❌ | 玩家角色年龄 |
| 身份/职位 | 文本输入 | ✅ | 如：科员、学生、护士 |
| 所属部门 | 文本输入 | ❌ | 如：行动一科、高二三班 |

#### 规章制度定义（部分必填）

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 花名册字段定义 | 多行文本 | ✅ | **必填**，定义人员档案需要记录的字段 |
| 服装规定 | 多行文本 | ❌ | 定义着装要求 |
| 其他规章制度 | 多行文本 | ❌ | 其他规则 |

#### 补充说明（可选）

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 补充说明 | 多行文本 | ❌ | 其他想要告诉AI的内容 |

---

## 三、变量结构设计

### 3.1 新增变量节点

在 `MC` 下新增 `世界设定` 节点，用于记录开局时的基础设定信息：

```json
{
  "MC": {
    "世界设定": {
      "$meta": { "extensible": true },
      "场景类型": "办公室",
      "场景名称": "第七处",
      "场景描述": "国家特别事务管理局第七执行处...",
      "世界观": "现代都市背景，特殊机构设定..."
    },
    "系统": { ... },
    "玩家": { ... },
    "文档": { ... },
    "花名册": { ... },
    "申请记录": { ... }
  }
}
```

> **注意**：花名册字段定义、服装规定、其他规章制度等内容**不存储在世界设定中**，而是由AI根据提示词直接生成到 `MC.文档` 中的实际规章制度文档里。这样避免了数据重复存储。

### 3.2 变量路径说明

| 路径 | 说明 |
|------|------|
| `MC.世界设定.场景类型` | 场景类型（办公室/学校/医院等） |
| `MC.世界设定.场景名称` | 场景名称 |
| `MC.世界设定.场景描述` | 场景详细描述 |
| `MC.世界设定.世界观` | 世界观设定 |

---

## 四、提示词生成逻辑

### 4.1 生成流程

```
用户填写表单 → 验证必填项 → 生成结构化提示词 → 发送给AI → AI处理并返回
```

### 4.2 提示词模板

```markdown
请根据以下设定开始一个新游戏，并初始化所有相关变量：

## 场景设定
- 场景类型：{场景类型}
- 场景名称：{场景名称}
- 场景描述：{场景描述}

## 世界观
{世界观}

## 玩家信息
- 姓名：{玩家姓名}
- 年龄：{玩家年龄}
- 身份/职位：{玩家职位}
- 所属部门：{玩家部门}

## 规章制度要求

### 花名册字段定义（重要）
请根据以下要求创建人事档案管理规定，定义花名册的字段结构：
{花名册字段要求}

### 服装规定
{服装规定}

### 其他规章制度
{其他规章}

## 补充说明
{补充说明}

---

请完成以下任务：
1. 根据场景设定，生成开局场景描述
2. 初始化 MC.系统 变量（当前时间、当前地点）
3. 初始化 MC.玩家 变量
4. 初始化 MC.世界设定 变量（保存上述设定）
5. 创建 MC.文档 中的规章制度文档，包含：
   - 人事档案管理规定（包含 $rosterMeta 和 $fieldDef）
   - 其他相关规章制度
6. 根据场景创建 2-3 个初始NPC角色到花名册中

请使用 <UpdateVariable> 标签输出所有变量更新。
```

### 4.3 AI响应处理

AI返回后，系统会：

1. 解析 `<UpdateVariable>` 标签中的命令
2. 执行变量更新
3. 显示AI生成的开局场景描述
4. 自动隐藏开局面板，显示正常游戏界面

---

## 五、预设模板

### 5.1 场景类型预设

当用户选择场景类型时，自动填充推荐的字段定义：

#### 办公室场景

```
花名册字段：员工编号、姓名、性别、年龄、部门、职位、职级、入职年限、身高、体重、三围、面容评分、性格特征、综合评级、备注
服装规定：工作日着正装，女性员工需穿高跟鞋，裙装长度不得超过膝上10cm
```

#### 学校场景

```
花名册字段：学号、姓名、性别、年龄、班级、职务、身高、体重、三围、成绩排名、性格特征、特长、备注
服装规定：在校期间须穿着校服，体育课穿运动服
```

#### 医院场景

```
花名册字段：工号、姓名、性别、年龄、科室、职称、身高、体重、三围、专业技能、性格特征、备注
服装规定：工作时间穿着白大褂或护士服
```

#### 军队场景

```
花名册字段：军号、姓名、性别、年龄、部队、军衔、身高、体重、三围、体能评级、专业技能、性格特征、备注
服装规定：在营区内穿着军装
```

### 5.2 快速开始

提供"快速开始"按钮，使用默认的办公室场景设定直接开始游戏。

---

## 六、技术实现

### 6.1 新增文件

| 文件路径 | 说明 |
|----------|------|
| `src/MClite/components/game/GameStartPanel.vue` | 开局面板组件 |
| `src/MClite/types/gameStart.ts` | 开局相关类型定义 |
| `src/MClite/stores/gameStartStore.ts` | 开局状态管理（可选） |

### 6.2 修改文件

| 文件路径 | 修改内容 |
|----------|----------|
| `src/MClite/components/game/MainContent.vue` | 添加条件渲染，空内容时显示开局面板 |
| `src/MClite/types/game.ts` | 添加世界设定相关类型 |

### 6.3 组件结构

```vue
<!-- GameStartPanel.vue 结构示意 -->
<template>
  <div class="game-start-panel">
    <header class="panel-header">
      <h2>🎮 自定义开局</h2>
      <button @click="quickStart">快速开始</button>
    </header>
    
    <div class="panel-body">
      <!-- 场景设定 -->
      <section class="setting-section">
        <h3>📍 场景设定</h3>
        <select v-model="form.sceneType">...</select>
        <input v-model="form.sceneName" />
        <textarea v-model="form.sceneDescription" />
      </section>
      
      <!-- 世界观设定 -->
      <section class="setting-section">
        <h3>🌍 世界观设定</h3>
        <textarea v-model="form.worldView" />
      </section>
      
      <!-- 玩家设定 -->
      <section class="setting-section">
        <h3>👤 玩家设定</h3>
        <input v-model="form.playerName" />
        <input v-model="form.playerAge" type="number" />
        <input v-model="form.playerPosition" />
        <input v-model="form.playerDepartment" />
      </section>
      
      <!-- 规章制度定义 -->
      <section class="setting-section">
        <h3>📋 规章制度定义</h3>
        <div class="subsection">
          <h4>▼ 花名册字段定义 (必填)</h4>
          <textarea v-model="form.rosterFields" required />
        </div>
        <div class="subsection">
          <h4>▼ 服装规定 (可选)</h4>
          <textarea v-model="form.dressCode" />
        </div>
        <div class="subsection">
          <h4>▼ 其他规章制度 (可选)</h4>
          <textarea v-model="form.otherRules" />
        </div>
      </section>
      
      <!-- 补充说明 -->
      <section class="setting-section">
        <h3>📝 补充说明</h3>
        <textarea v-model="form.additionalNotes" />
      </section>
    </div>
    
    <footer class="panel-footer">
      <button @click="randomFill">🎲 随机填充</button>
      <button @click="startGame" :disabled="!isValid">🚀 开始游戏</button>
    </footer>
  </div>
</template>
```

---

## 七、交互流程

### 7.1 正常流程

```
1. 用户打开新聊天 / 清空内容
2. 系统检测到 currentContent 为空
3. 显示自定义开局面板
4. 用户填写表单（或选择快速开始）
5. 用户点击"开始游戏"
6. 系统验证必填项
7. 系统生成提示词
8. 系统发送提示词给AI
9. AI返回开局内容和变量更新
10. 系统解析并执行变量更新
11. 系统显示AI生成的内容
12. 开局面板自动隐藏
```

### 7.2 快速开始流程

```
1. 用户点击"快速开始"
2. 系统使用默认办公室场景设定
3. 直接跳到步骤7继续
```

### 7.3 随机填充流程

```
1. 用户点击"随机填充"
2. 系统随机选择场景类型
3. 系统填充对应的预设内容
4. 用户可以继续修改
```

---

## 八、注意事项

### 8.1 必填项验证

- 场景类型、场景名称、玩家姓名、玩家职位、花名册字段定义 为必填项
- 提交前需验证这些字段不为空

### 8.2 花名册字段定义的重要性

- 这是**最关键**的必填项
- 直接影响人事系统面板（花名册）能否正常使用
- AI会根据这个定义创建 `MC.文档.人事档案管理规定` 中的 `$fieldDef`

### 8.3 与现有系统的兼容

- 生成的变量结构需要与现有的 Schema-Driven 系统兼容
- AI生成的规章制度需要包含正确的 `$rosterMeta`、`$groupDef`、`$fieldDef` 结构

---

## 九、后续扩展

### 9.1 设定保存/加载

- 允许玩家保存自己喜欢的开局设定
- 下次可以直接加载使用

### 9.2 更多预设模板

- 根据用户反馈添加更多场景类型预设

### 9.3 高级选项

- 可折叠的高级选项区域
- 更细粒度的规章制度定义
