<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>MCæˆ¿å­</title><script type="module">import{createPinia as e,defineStore as t,storeToRefs as a}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';var n={502(e,t){t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a}}},o={};const l=Vue,s={class:'top-bar'},r={class:'top-bar-left'},c={class:'player-card'},i={class:'player-info'},u={class:'player-name'},d={class:'player-role'},m={class:'top-bar-center'},v={class:'datetime-group'},p={class:'date-item'},f={class:'item-value'},g={class:'time-item'},h={class:'location-item'},y={class:'item-value location-text'},V={class:'top-bar-right'},N=['title'],E={class:'action-buttons'},b=['title'],k={class:'btn-icon'},C=['title'],S={class:'btn-icon'},w=(0,l.defineComponent)({__name:'TopBar',props:{connectionStatus:{default:'connected'},isFullscreen:{type:Boolean,default:!1},isDarkTheme:{type:Boolean,default:!1},gameDate:{default:''},gamePeriod:{default:''},gameLocation:{default:''},playerName:{default:''},playerPosition:{default:''},playerDepartment:{default:''}},emits:['toggle-fullscreen','toggle-theme'],setup(e){const t=e,a=(0,l.computed)(()=>{switch(t.connectionStatus){case'connected':return'åœ¨çº¿';case'connecting':return'è¿æ¥ä¸­...';case'disconnected':return'ç¦»çº¿';default:return'æœªçŸ¥'}}),n=(0,l.computed)(()=>t.playerName||'æœªç™»å½•'),o=(0,l.computed)(()=>t.playerPosition&&t.playerDepartment?`${t.playerDepartment}Â·${t.playerPosition}`:t.playerPosition?t.playerPosition:t.playerDepartment?t.playerDepartment:'ç­‰å¾…åˆ†é…'),w=(0,l.computed)(()=>t.gameDate||'ç­‰å¾…æ•°æ®...'),I=(0,l.computed)(()=>t.gamePeriod||'--:--'),B=(0,l.computed)(()=>t.gameLocation||'æœªçŸ¥åœ°ç‚¹'),A=(0,l.computed)(()=>{const e=(t.gamePeriod||'').match(/^(\d{1,2}):(\d{2})$/);if(!e)return'period-default';const a=parseInt(e[1],10);return a>=6&&a<12?'period-morning':a>=12&&a<14?'period-noon':a>=14&&a<18?'period-afternoon':a>=18&&a<21?'period-evening':'period-night'});return(t,D)=>((0,l.openBlock)(),(0,l.createElementBlock)('header',s,[(0,l.createCommentVNode)(' å·¦ä¾§ï¼šç©å®¶ä¿¡æ¯ '),(0,l.createElementVNode)('div',r,[(0,l.createCommentVNode)(' ç©å®¶ä¿¡æ¯å¡ç‰‡ '),(0,l.createElementVNode)('div',c,[D[2]||(D[2]=(0,l.createElementVNode)('div',{class:'player-avatar'},[(0,l.createElementVNode)('span',{class:'avatar-icon'},'ğŸ‘¤')],-1)),(0,l.createElementVNode)('div',i,[(0,l.createElementVNode)('span',u,(0,l.toDisplayString)(n.value),1),(0,l.createElementVNode)('span',d,(0,l.toDisplayString)(o.value),1)])])]),(0,l.createCommentVNode)(' ä¸­é—´ï¼šæ¸¸æˆçŠ¶æ€ï¼ˆæ—¥æœŸæ—¶é—´ + åœ°ç‚¹ï¼‰ '),(0,l.createElementVNode)('div',m,[(0,l.createCommentVNode)(' æ—¥æœŸæ—¶é—´ç»„åˆæ˜¾ç¤º '),(0,l.createElementVNode)('div',v,[(0,l.createElementVNode)('div',p,[D[3]||(D[3]=(0,l.createElementVNode)('span',{class:'item-icon'},'ğŸ“…',-1)),(0,l.createElementVNode)('span',f,(0,l.toDisplayString)(w.value),1)]),(0,l.createElementVNode)('div',g,[(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['period-badge',A.value])},(0,l.toDisplayString)(I.value),3)])]),(0,l.createCommentVNode)(' åœ°ç‚¹æ˜¾ç¤º '),(0,l.createElementVNode)('div',h,[D[4]||(D[4]=(0,l.createElementVNode)('span',{class:'item-icon'},'ğŸ“',-1)),(0,l.createElementVNode)('span',y,(0,l.toDisplayString)(B.value),1)])]),(0,l.createCommentVNode)(' å³ä¾§ï¼šçŠ¶æ€æŒ‡ç¤º + åŠŸèƒ½æŒ‰é’® '),(0,l.createElementVNode)('div',V,[(0,l.createCommentVNode)(' è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['connection-indicator',e.connectionStatus]),title:a.value},[...D[5]||(D[5]=[(0,l.createElementVNode)('span',{class:'status-dot'},null,-1)])],10,N),(0,l.createCommentVNode)(' åŠŸèƒ½æŒ‰é’®ç»„ '),(0,l.createElementVNode)('div',E,[(0,l.createElementVNode)('button',{class:'action-btn',title:e.isDarkTheme?'åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼':'åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼',onClick:D[0]||(D[0]=e=>t.$emit('toggle-theme'))},[(0,l.createElementVNode)('span',k,(0,l.toDisplayString)(e.isDarkTheme?'â˜€ï¸':'ğŸŒ™'),1)],8,b),(0,l.createElementVNode)('button',{class:'action-btn',title:e.isFullscreen?'é€€å‡ºå…¨å±':'å…¨å±æ˜¾ç¤º',onClick:D[1]||(D[1]=e=>t.$emit('toggle-fullscreen'))},[(0,l.createElementVNode)('span',S,(0,l.toDisplayString)(e.isFullscreen?'â¬œ':'â›¶'),1)],8,C)])])]))}});var I=function e(t){var a=o[t];if(void 0!==a)return a.exports;var l=o[t]={exports:{}};return n[t](l,l.exports,e),l.exports}(502);const B=(0,I.A)(w,[['__scopeId','data-v-255ae3ac']]),A=['innerHTML'],D={key:0,class:'streaming-cursor'},M=(0,l.defineComponent)({__name:'ContentBlockRenderer',props:{content:{default:''},isStreaming:{type:Boolean,default:!1},theme:{default:'auto'}},setup(e,{expose:t}){const a=e,n=(0,l.computed)(()=>'dark'===a.theme||'light'!==a.theme&&('undefined'!=typeof document&&(document.documentElement.classList.contains('dark-theme')||document.body.classList.contains('dark-theme')||window.matchMedia?.('(prefers-color-scheme: dark)').matches))),o=(0,l.computed)(()=>{if(!a.content)return'';let e=function(e){const t={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'};return e.replace(/[&<>"]/g,e=>t[e]||e)}(a.content);return e=e.replace(/\n/g,'<br>'),e=e.replace(/ã€ã€([^ã€ã€‘]*)ã€‘ã€‘/g,(e,t)=>`<span class="block-system">ã€ã€${t}ã€‘ã€‘</span>`),e=e.replace(/ã€([^ã€ã€‘]+)ã€‘/g,(e,t)=>`<span class="block-scenery">ã€${t}ã€‘</span>`),e=e.replace(/ã€Œ([^ã€Œã€]+)ã€/g,(e,t)=>`<span class="block-dialogue">ã€Œ${t}ã€</span>`),e=e.replace(/\*([^*]+)\*/g,(e,t)=>`<span class="block-thought">*${t}*</span>`),e});return t({isDarkTheme:n}),(t,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['content-renderer',{'content-renderer--dark':n.value}])},[(0,l.createElementVNode)('span',{class:'content-text',innerHTML:o.value},null,8,A),e.isStreaming?((0,l.openBlock)(),(0,l.createElementBlock)('span',D,'â–Œ')):(0,l.createCommentVNode)('v-if',!0)],2))}}),x=(0,I.A)(M,[['__scopeId','data-v-17b96b08']]),T={class:'header-left'},R={key:0,class:'changes-count'},O={class:'header-right'},F={class:'toggle-icon'},L={key:0,class:'panel-content'},P={key:0,class:'no-changes'},j={class:'changes-list'},U={class:'change-path'},W={class:'path-icon'},H=['title'],G={class:'change-values'},J=['title'],q=['title'],K={key:0,class:'change-comment'},Y={class:'comment-text'},X={key:2,class:'panel-footer'},Z=(0,l.defineComponent)({__name:'VariableChangesPanel',props:{changes:{default:()=>[]},defaultExpanded:{type:Boolean,default:!1}},emits:['clear','copy'],setup(e,{expose:t,emit:a}){const n=e,o=a,s=(0,l.ref)(n.defaultExpanded),r=()=>{s.value=!s.value},c=e=>void 0!==e.oldValue&&null!==e.oldValue,i=e=>{if(!c(e))return'change-new';const t=typeof e.oldValue,a=typeof e.newValue;if('number'===t&&'number'===a){if(e.newValue>e.oldValue)return'change-increase';if(e.newValue<e.oldValue)return'change-decrease'}return'change-modify'},u=e=>{if(!c(e))return'âœ¨';const t=typeof e.oldValue,a=typeof e.newValue;if('number'===t&&'number'===a){if(e.newValue>e.oldValue)return'ğŸ“ˆ';if(e.newValue<e.oldValue)return'ğŸ“‰'}return'âœï¸'},d=e=>{if(e.length<=30)return e;const t=e.split('.');return t.length<=2?e.substring(0,27)+'...':`${t[0]}...${t.slice(-2).join('.')}`},m=e=>{if(null===e)return'null';if(void 0===e)return'undefined';const t=typeof e;if('string'===t){const t=20;return e.length>t?`"${e.substring(0,t)}..."`:`"${e}"`}if('number'===t)return String(e);if('boolean'===t)return e?'true':'false';if(Array.isArray(e))return`[${e.length}é¡¹]`;if('object'===t){return`{${Object.keys(e).length}é”®}`}return String(e)},v=e=>{if(null===e)return'null';if(void 0===e)return'undefined';try{return JSON.stringify(e,null,2)}catch{return String(e)}},p=()=>{o('clear')},f=()=>{const e=n.changes.map(e=>{let t=`${e.path}: `;return c(e)&&(t+=`${v(e.oldValue)} â†’ `),t+=v(e.newValue),e.comment&&(t+=` // ${e.comment}`),t}).join('\n');o('copy',e),navigator.clipboard&&navigator.clipboard.writeText(e).then(()=>{console.log('[VariableChangesPanel] å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')}).catch(e=>{console.error('[VariableChangesPanel] å¤åˆ¶å¤±è´¥:',e)})};return t({expand:()=>{s.value=!0},collapse:()=>{s.value=!1},toggle:r}),(t,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['variable-changes-panel',{expanded:s.value,collapsed:!s.value}])},[(0,l.createCommentVNode)(' é¢æ¿å¤´éƒ¨ - å§‹ç»ˆå¯è§ '),(0,l.createElementVNode)('div',{class:'panel-header',onClick:r},[(0,l.createElementVNode)('div',T,[a[0]||(a[0]=(0,l.createElementVNode)('span',{class:'header-icon'},'ğŸ“Š',-1)),a[1]||(a[1]=(0,l.createElementVNode)('span',{class:'header-title'},'å˜é‡å˜åŒ–',-1)),e.changes.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('span',R,(0,l.toDisplayString)(e.changes.length),1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',O,[(0,l.createElementVNode)('span',F,(0,l.toDisplayString)(s.value?'â–¼':'â–¶'),1)])]),(0,l.createCommentVNode)(' é¢æ¿å†…å®¹ - å±•å¼€æ—¶æ˜¾ç¤º '),(0,l.createVNode)(l.Transition,{name:'expand'},{default:(0,l.withCtx)(()=>[s.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',L,[(0,l.createCommentVNode)(' æ— å˜åŒ–æç¤º '),0===e.changes.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',P,[...a[2]||(a[2]=[(0,l.createElementVNode)('span',{class:'empty-icon'},'ğŸ“­',-1),(0,l.createElementVNode)('span',{class:'empty-text'},'æœ¬æ¬¡å›å¤æ— å˜é‡æ›´æ–°',-1)])])):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' å˜é‡å˜åŒ–åˆ—è¡¨ '),(0,l.createElementVNode)('div',j,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.changes,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t,class:(0,l.normalizeClass)(['change-item',i(e)])},[(0,l.createCommentVNode)(' å˜é‡è·¯å¾„ '),(0,l.createElementVNode)('div',U,[(0,l.createElementVNode)('span',W,(0,l.toDisplayString)(u(e)),1),(0,l.createElementVNode)('span',{class:'path-text',title:e.path},(0,l.toDisplayString)(d(e.path)),9,H)]),(0,l.createCommentVNode)(' å€¼å˜åŒ– '),(0,l.createElementVNode)('div',G,[(0,l.createCommentVNode)(' æ—§å€¼ï¼ˆå¦‚æœæœ‰ï¼‰ '),c(e)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:0},[(0,l.createElementVNode)('span',{class:'old-value',title:v(e.oldValue)},(0,l.toDisplayString)(m(e.oldValue)),9,J),a[3]||(a[3]=(0,l.createElementVNode)('span',{class:'arrow'},'â†’',-1))],64)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' æ–°å€¼ '),(0,l.createElementVNode)('span',{class:'new-value',title:v(e.newValue)},(0,l.toDisplayString)(m(e.newValue)),9,q)]),(0,l.createCommentVNode)(' æ³¨é‡Šï¼ˆå¦‚æœæœ‰ï¼‰ '),e.comment?((0,l.openBlock)(),(0,l.createElementBlock)('div',K,[a[4]||(a[4]=(0,l.createElementVNode)('span',{class:'comment-icon'},'ğŸ’¬',-1)),(0,l.createElementVNode)('span',Y,(0,l.toDisplayString)(e.comment),1)])):(0,l.createCommentVNode)('v-if',!0)],2))),128))])],2112)),(0,l.createCommentVNode)(' åº•éƒ¨æ“ä½œæ  '),e.changes.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',X,[(0,l.createElementVNode)('button',{class:'btn-clear',onClick:(0,l.withModifiers)(p,['stop']),title:'æ¸…ç©ºå˜åŒ–è®°å½•'},[...a[5]||(a[5]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ—‘ï¸',-1),(0,l.createTextVNode)(' æ¸…ç©º ',-1)])]),(0,l.createElementVNode)('button',{class:'btn-copy',onClick:(0,l.withModifiers)(f,['stop']),title:'å¤åˆ¶å˜åŒ–è®°å½•'},[...a[6]||(a[6]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ“‹',-1),(0,l.createTextVNode)(' å¤åˆ¶ ',-1)])])])):(0,l.createCommentVNode)('v-if',!0)])):(0,l.createCommentVNode)('v-if',!0)]),_:1})],2))}}),Q=(0,I.A)(Z,[['__scopeId','data-v-2e3cf9d4']]),ee={office:{type:'office',label:'åŠå…¬å®¤',icon:'ğŸ¢',defaultName:'ç¬¬ä¸ƒå¤„',defaultDescription:'å›½å®¶ç‰¹åˆ«äº‹åŠ¡ç®¡ç†å±€ç¬¬ä¸ƒæ‰§è¡Œå¤„ï¼Œè´Ÿè´£å¤„ç†å„ç±»ç‰¹æ®Šäº‹åŠ¡ã€‚',defaultRosterFields:'å‘˜å·¥ç¼–å·ã€å§“åã€æ€§åˆ«ã€å¹´é¾„ã€éƒ¨é—¨ã€èŒä½ã€èŒçº§ã€å…¥èŒå¹´é™ã€èº«é«˜ã€ä½“é‡ã€ä¸‰å›´ã€é¢å®¹è¯„åˆ†ã€æ€§æ ¼ç‰¹å¾ã€ç»¼åˆè¯„çº§ã€å¤‡æ³¨',defaultDressCode:'å·¥ä½œæ—¥ç€æ­£è£…ï¼Œå¥³æ€§å‘˜å·¥éœ€ç©¿é«˜è·Ÿé‹ï¼Œè£™è£…é•¿åº¦ä¸å¾—è¶…è¿‡è†ä¸Š10cm',defaultOtherRules:'æ¯æ—¥9:00æ‰“å¡ä¸Šç­ï¼Œ18:00ä¸‹ç­ã€‚è¿Ÿåˆ°æ—©é€€æŒ‰è§„å®šå¤„ç†ã€‚'},school:{type:'school',label:'å­¦æ ¡',icon:'ğŸ«',defaultName:'å¸‚ç«‹ç¬¬ä¸€é«˜ä¸­',defaultDescription:'ä¸€æ‰€æ™®é€šçš„å¸‚ç«‹é«˜ä¸­ï¼Œå­¦é£ä¼˜è‰¯ï¼Œç¯å¢ƒä¼˜ç¾ã€‚',defaultRosterFields:'å­¦å·ã€å§“åã€æ€§åˆ«ã€å¹´é¾„ã€ç­çº§ã€èŒåŠ¡ã€èº«é«˜ã€ä½“é‡ã€ä¸‰å›´ã€æˆç»©æ’åã€æ€§æ ¼ç‰¹å¾ã€ç‰¹é•¿ã€å¤‡æ³¨',defaultDressCode:'åœ¨æ ¡æœŸé—´é¡»ç©¿ç€æ ¡æœï¼Œä½“è‚²è¯¾ç©¿è¿åŠ¨æœ',defaultOtherRules:'æ¯æ—¥7:30æ—©è‡ªä¹ ï¼Œ17:00æ”¾å­¦ã€‚ç¦æ­¢æºå¸¦æ‰‹æœºè¿›å…¥æ•™å®¤ã€‚'},hospital:{type:'hospital',label:'åŒ»é™¢',icon:'ğŸ¥',defaultName:'å¸‚ä¸­å¿ƒåŒ»é™¢',defaultDescription:'ä¸€æ‰€ä¸‰çº§ç”²ç­‰ç»¼åˆåŒ»é™¢ï¼Œæ‹¥æœ‰å…ˆè¿›çš„åŒ»ç–—è®¾å¤‡å’Œä¼˜ç§€çš„åŒ»æŠ¤å›¢é˜Ÿã€‚',defaultRosterFields:'å·¥å·ã€å§“åã€æ€§åˆ«ã€å¹´é¾„ã€ç§‘å®¤ã€èŒç§°ã€èº«é«˜ã€ä½“é‡ã€ä¸‰å›´ã€ä¸“ä¸šæŠ€èƒ½ã€æ€§æ ¼ç‰¹å¾ã€å¤‡æ³¨',defaultDressCode:'å·¥ä½œæ—¶é—´ç©¿ç€ç™½å¤§è¤‚æˆ–æŠ¤å£«æœ',defaultOtherRules:'å®è¡Œä¸‰ç­å€’åˆ¶åº¦ï¼Œä¸¥æ ¼éµå®ˆåŒ»ç–—è§„èŒƒå’ŒèŒä¸šé“å¾·ã€‚'},military:{type:'military',label:'å†›é˜Ÿ',icon:'ğŸ–ï¸',defaultName:'æŸéƒ¨é˜Ÿé©»åœ°',defaultDescription:'ä¸€å¤„å†›äº‹é©»åœ°ï¼Œçºªå¾‹ä¸¥æ˜ï¼Œæˆ˜æ–—åŠ›å¼ºã€‚',defaultRosterFields:'å†›å·ã€å§“åã€æ€§åˆ«ã€å¹´é¾„ã€éƒ¨é˜Ÿã€å†›è¡”ã€èº«é«˜ã€ä½“é‡ã€ä¸‰å›´ã€ä½“èƒ½è¯„çº§ã€ä¸“ä¸šæŠ€èƒ½ã€æ€§æ ¼ç‰¹å¾ã€å¤‡æ³¨',defaultDressCode:'åœ¨è¥åŒºå†…ç©¿ç€å†›è£…ï¼Œè®­ç»ƒæ—¶ç©¿ä½œè®­æœ',defaultOtherRules:'æ¯æ—¥6:00èµ·åºŠï¼Œ22:00ç†„ç¯ã€‚ä¸¥æ ¼éµå®ˆå†›è§„å†›çºªã€‚'},custom:{type:'custom',label:'è‡ªå®šä¹‰',icon:'âœ¨',defaultName:'',defaultDescription:'',defaultRosterFields:'',defaultDressCode:'',defaultOtherRules:''}},te={sceneType:'office',sceneName:ee.office.defaultName,sceneDescription:ee.office.defaultDescription,worldView:'',playerName:'',playerAge:null,playerPosition:'',playerDepartment:'',rosterFields:ee.office.defaultRosterFields,mainDocument:'',dressCode:ee.office.defaultDressCode,applicationForms:'',otherRules:ee.office.defaultOtherRules,additionalNotes:''},ae={sceneType:'office',sceneName:'ç¬¬ä¸ƒå¤„',sceneDescription:'å›½å®¶ç‰¹åˆ«äº‹åŠ¡ç®¡ç†å±€ç¬¬ä¸ƒæ‰§è¡Œå¤„ï¼Œæ˜¯ä¸€ä¸ªç¥ç§˜çš„æ”¿åºœéƒ¨é—¨ï¼Œè´Ÿè´£å¤„ç†å„ç±»ç‰¹æ®Šäº‹åŠ¡ã€‚',worldView:'ç°ä»£éƒ½å¸‚èƒŒæ™¯ï¼Œå­˜åœ¨ä¸€äº›ä¸ä¸ºäººçŸ¥çš„ç‰¹æ®Šäº‹åŠ¡éœ€è¦ä¸“é—¨æœºæ„å¤„ç†ã€‚',playerName:'',playerAge:25,playerPosition:'ç§‘å‘˜',playerDepartment:'è¡ŒåŠ¨ä¸€ç§‘',rosterFields:ee.office.defaultRosterFields,mainDocument:'',dressCode:ee.office.defaultDressCode,applicationForms:'',otherRules:ee.office.defaultOtherRules,additionalNotes:''};function ne(e){const t=[];return e.sceneType||t.push({field:'sceneType',message:'è¯·é€‰æ‹©åœºæ™¯ç±»å‹'}),e.sceneName?.trim()||t.push({field:'sceneName',message:'è¯·è¾“å…¥åœºæ™¯åç§°'}),e.playerPosition?.trim()||t.push({field:'playerPosition',message:'è¯·è¾“å…¥ç©å®¶èº«ä»½/èŒä½'}),e.rosterFields?.trim()||t.push({field:'rosterFields',message:'è¯·å®šä¹‰èŠ±åå†Œå­—æ®µï¼ˆè¿™æ˜¯äººäº‹ç³»ç»Ÿçš„æ ¸å¿ƒï¼‰'}),{isValid:0===t.length,errors:t}}function oe(e){const t=e.playerName?.trim()||'<user>',a=[];return a.push('è¯·æ ¹æ®ä»¥ä¸‹è®¾å®šå¼€å§‹æ¸¸æˆï¼Œåˆå§‹åŒ–æ‰€æœ‰å˜é‡ï¼š'),a.push(''),a.push('## åœºæ™¯è®¾å®š'),a.push(`- åœºæ™¯ç±»å‹ï¼š${ee[e.sceneType]?.label||e.sceneType}`),a.push(`- åœºæ™¯åç§°ï¼š${e.sceneName}`),e.sceneDescription?.trim()&&a.push(`- åœºæ™¯æè¿°ï¼š${e.sceneDescription}`),e.worldView?.trim()&&a.push(`- ä¸–ç•Œè§‚ï¼š${e.worldView}`),a.push(''),a.push('## ç©å®¶ä¿¡æ¯'),a.push(`- å§“åï¼š${t}`),e.playerAge&&a.push(`- å¹´é¾„ï¼š${e.playerAge}`),a.push(`- èŒä½ï¼š${e.playerPosition}`),e.playerDepartment?.trim()&&a.push(`- éƒ¨é—¨ï¼š${e.playerDepartment}`),a.push(''),a.push('## è§„ç« åˆ¶åº¦è¦æ±‚'),a.push(''),a.push('å¼€å±€éœ€ç”Ÿæˆä»¥ä¸‹è§„ç« åˆ¶åº¦æ–‡æ¡£ï¼ˆå­˜å‚¨åœ¨`MC.æ–‡æ¡£`ä¸­ï¼‰ï¼Œé‡‡ç”¨æ­£å¼å…¬æ–‡æ ¼å¼æ’°å†™ï¼š'),a.push(''),a.push('### 1. äººäº‹æ¡£æ¡ˆç®¡ç†è§„å®š'),a.push(''),a.push('**å¿…é¡»åŒ…å«`$rosterMeta`å…ƒæ•°æ®**ï¼š'),a.push('```json'),a.push('"$rosterMeta": {'),a.push('  "rosterId": "èŠ±åå†Œ",'),a.push('  "targetPath": "MC.èŠ±åå†Œ",'),a.push('  "primaryKey": "id",'),a.push('  "displayField": "name",'),a.push('  "groupByField": "department"'),a.push('}'),a.push('```'),a.push(''),a.push('**èŠ±åå†Œå­—æ®µå®šä¹‰**ï¼ˆå„ç« èŠ‚ä½¿ç”¨`$groupDef`åˆ†ç»„ï¼Œæ¡æ¬¾ä½¿ç”¨`$fieldDef`å®šä¹‰å­—æ®µï¼‰ï¼š'),a.push(e.rosterFields),a.push(''),e.dressCode?.trim()&&(a.push('**ç€è£…ç›¸å…³è§„å®šè¦ç‚¹**ï¼š'),a.push(e.dressCode),a.push('')),a.push('### 2. ä¸»è§„ç« åˆ¶åº¦ï¼ˆå‘˜å·¥å®ˆåˆ™/æ ¡è§„ç­‰ï¼‰'),a.push(''),e.mainDocument?.trim()&&(a.push('**è¦ç‚¹**ï¼š'+e.mainDocument),a.push('')),a.push('çº¯æ–‡æœ¬è§„ç« åˆ¶åº¦ï¼ŒåŒ…å«æ€»åˆ™ã€å·¥ä½œè§„èŒƒã€è¡Œä¸ºå‡†åˆ™ç­‰ã€‚'),a.push(''),a.push('### 3. ç”³è¯·è¡¨ç®¡ç†åŠæ³•'),a.push(''),a.push('**å¿…é¡»åŒ…å«`$formMeta`å…ƒæ•°æ®**ï¼š'),a.push('```json'),a.push('"$formMeta": {'),a.push('  "formId": "è¡¨å•ID",'),a.push('  "formName": "è¡¨å•åç§°",'),a.push('  "targetPath": "MC.ç”³è¯·è®°å½•.ç±»åˆ«å",'),a.push('  "workflow": [{ "step": 1, "name": "æ­¥éª¤å", "handler": "å¤„ç†äºº" }]'),a.push('}'),a.push('```'),a.push(''),a.push('**å„æ¡æ¬¾ä½¿ç”¨`$fieldDef`å®šä¹‰è¡¨å•å­—æ®µ**ï¼ˆå«`belongsTo`ã€`fieldId`ã€`formPosition`ã€`inputType`ç­‰å±æ€§ï¼‰'),a.push(''),e.applicationForms?.trim()?a.push('**éœ€è¦çš„ç”³è¯·è¡¨ç±»å‹**ï¼š'+e.applicationForms):a.push('è‡³å°‘åŒ…å«ï¼šç‰©èµ„ç”³è¯·è¡¨ã€ä¸ªäººéœ€æ±‚ç”³è¯·è¡¨'),a.push(''),e.otherRules?.trim()&&(a.push('### 4. å…¶ä»–è§„åˆ™'),a.push(e.otherRules),a.push('')),e.additionalNotes?.trim()&&(a.push('## è¡¥å……è¯´æ˜'),a.push(e.additionalNotes),a.push('')),a.push('---'),a.push(''),a.push('## å˜é‡åˆå§‹åŒ–è¦æ±‚'),a.push(''),a.push('ä½¿ç”¨`<UpdateVariable>`æ ‡ç­¾è¾“å‡ºï¼Œéµå¾ªä»¥ä¸‹ç»“æ„ï¼š'),a.push(''),a.push('**1. MC.ç³»ç»Ÿ**ï¼š`{ "å½“å‰åœ°ç‚¹": "xxx", "å½“å‰æ—¶é—´": { "æ—¥æœŸ": "YYYYå¹´MæœˆDæ—¥", "æ—¶é—´": "HH:MM" } }`'),a.push(''),a.push('**2. MC.ç©å®¶**ï¼š`{ "å§“å": "xxx", "å¹´é¾„": æ•°å­—, "èŒä½": "xxx", "éƒ¨é—¨": "xxx" }`'),a.push(''),a.push('**3. MC.ä¸–ç•Œè®¾å®š**ï¼šä¿å­˜åœºæ™¯ç±»å‹ã€åç§°ã€æè¿°ã€ä¸–ç•Œè§‚'),a.push(''),a.push('**4. MC.æ–‡æ¡£**ï¼šè§„ç« åˆ¶åº¦æ–‡æ¡£ï¼Œç»“æ„ä¸º`sections`â†’ç« èŠ‚â†’`children`â†’æ¡æ¬¾'),a.push('  - æ¯ä¸ª`sections`å’Œ`children`éœ€åŒ…å«`"$meta": { "extensible": true }`'),a.push('  - äººäº‹æ¡£æ¡ˆè§„å®šéœ€åŒ…å«`$rosterMeta`ã€`$groupDef`ã€`$fieldDef`'),a.push('  - ç”³è¯·ç®¡ç†åŠæ³•éœ€åŒ…å«`$formMeta`ã€`$fieldDef`'),a.push(''),a.push('**5. MC.èŠ±åå†Œ**ï¼ˆv3æ‰å¹³ç»“æ„ï¼‰ï¼š'),a.push('  - æ¡ç›®ç›´æ¥åœ¨èŠ±åå†Œä¸‹ï¼Œæ— entrieså±‚'),a.push('  - ä½¿ç”¨`$schemaRef: "MC.æ–‡æ¡£.äººäº‹æ¡£æ¡ˆç®¡ç†è§„å®š"`å¼•ç”¨Schema'),a.push('  - é”®åæ ¼å¼`NoXXX`ï¼ˆç¦æ­¢åŒ…å«ç‚¹å·ï¼‰'),a.push('  - æ¯ä¸ªæ¡ç›®éœ€åŒ…å«`"$meta": { "extensible": true }`'),a.push('  - åˆ›å»º2-3ä¸ªåˆå§‹NPC'),a.push(''),a.push('**6. MC.ç”³è¯·è®°å½•**ï¼š'),a.push('  - æŒ‰è¡¨å•ç±»å‹åˆ†ç±»ï¼š`MC.ç”³è¯·è®°å½•.ç‰©èµ„ç”³è¯·`ã€`MC.ç”³è¯·è®°å½•.ä¸ªäººéœ€æ±‚`ç­‰'),a.push('  - ä½¿ç”¨`$formRef`å¼•ç”¨è¡¨å•å®šä¹‰'),a.push('  - è®°å½•ä»¥æ‘˜è¦æ–‡æœ¬å­˜å‚¨ï¼š`ã€è¡¨å•åã€‘ç”³è¯·äººï¼šxxx | å­—æ®µï¼šå€¼ | çŠ¶æ€ï¼šxxx`'),a.push(''),a.push('---'),a.push(''),a.push('è¯·ç”Ÿæˆå¼€å±€åœºæ™¯æè¿°ï¼Œå¹¶è¾“å‡ºå®Œæ•´çš„å˜é‡åˆå§‹åŒ–å‘½ä»¤ã€‚'),{text:a.join('\n'),formData:{...e},generatedAt:new Date}}const le='mclite_game_start_presets';const se=[{id:'builtin_office_default',name:'åŠå…¬å®¤ - æ ‡å‡†é…ç½®',description:'ç¬¬ä¸ƒå¤„æ ‡å‡†å¼€å±€é…ç½®ï¼Œé€‚åˆåŠå…¬å®¤åœºæ™¯',formData:ae,createdAt:'2024-01-01T00:00:00.000Z',updatedAt:'2024-01-01T00:00:00.000Z',isBuiltin:!0},{id:'builtin_school_default',name:'å­¦æ ¡ - æ ‡å‡†é…ç½®',description:'é«˜ä¸­æ ¡å›­æ ‡å‡†å¼€å±€é…ç½®',formData:{...te,sceneType:'school',sceneName:ee.school.defaultName,sceneDescription:ee.school.defaultDescription,playerPosition:'å­¦ç”Ÿ',playerDepartment:'é«˜äºŒ(1)ç­',playerAge:17,rosterFields:ee.school.defaultRosterFields,dressCode:ee.school.defaultDressCode,otherRules:ee.school.defaultOtherRules},createdAt:'2024-01-01T00:00:00.000Z',updatedAt:'2024-01-01T00:00:00.000Z',isBuiltin:!0},{id:'builtin_hospital_default',name:'åŒ»é™¢ - æ ‡å‡†é…ç½®',description:'åŒ»é™¢åœºæ™¯æ ‡å‡†å¼€å±€é…ç½®',formData:{...te,sceneType:'hospital',sceneName:ee.hospital.defaultName,sceneDescription:ee.hospital.defaultDescription,playerPosition:'å®ä¹ åŒ»ç”Ÿ',playerDepartment:'å†…ç§‘',playerAge:24,rosterFields:ee.hospital.defaultRosterFields,dressCode:ee.hospital.defaultDressCode,otherRules:ee.hospital.defaultOtherRules},createdAt:'2024-01-01T00:00:00.000Z',updatedAt:'2024-01-01T00:00:00.000Z',isBuiltin:!0}];class re{static instance=null;cachedData=null;constructor(){}static getInstance(){return re.instance||(re.instance=new re),re.instance}loadFromStorage(){if(this.cachedData)return this.cachedData;try{const e=localStorage.getItem(le);if(e){const t=JSON.parse(e);return 1!==t.version?(console.log('[PresetService] æ£€æµ‹åˆ°æ—§ç‰ˆæœ¬æ•°æ®ï¼Œè¿›è¡Œè¿ç§»...'),this.migrateData(t)):(this.cachedData=t,t)}}catch(e){console.error('[PresetService] åŠ è½½é¢„è®¾æ•°æ®å¤±è´¥:',e)}const e={version:1,presets:[],lastUsedPresetId:void 0};return this.cachedData=e,e}saveToStorage(e){try{return localStorage.setItem(le,JSON.stringify(e)),this.cachedData=e,console.log('[PresetService] é¢„è®¾æ•°æ®å·²ä¿å­˜'),!0}catch(e){return console.error('[PresetService] ä¿å­˜é¢„è®¾æ•°æ®å¤±è´¥:',e),!1}}migrateData(e){const t={version:1,presets:e.presets||[],lastUsedPresetId:e.lastUsedPresetId};return this.saveToStorage(t),t}getAllPresets(){const e=this.loadFromStorage();return[...se,...e.presets]}getUserPresets(){return this.loadFromStorage().presets}getBuiltinPresets(){return se}getPresetById(e){return this.getAllPresets().find(t=>t.id===e)||null}savePreset(e,t,a){try{const n=this.loadFromStorage(),o=function(e,t,a){const n=(new Date).toISOString();return{id:`preset_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,name:e,description:a,formData:{...t},createdAt:n,updatedAt:n,isBuiltin:!1}}(e,t,a);return n.presets.push(o),n.lastUsedPresetId=o.id,this.saveToStorage(n)?(console.log('[PresetService] é¢„è®¾å·²ä¿å­˜:',o.name),o):null}catch(e){return console.error('[PresetService] ä¿å­˜é¢„è®¾å¤±è´¥:',e),null}}updatePreset(e,t){try{const a=this.loadFromStorage(),n=a.presets.findIndex(t=>t.id===e);if(-1===n)return se.some(t=>t.id===e)?(console.warn('[PresetService] æ— æ³•ä¿®æ”¹å†…ç½®é¢„è®¾'),!1):(console.warn('[PresetService] é¢„è®¾ä¸å­˜åœ¨:',e),!1);const o=a.presets[n];return void 0!==t.name&&(o.name=t.name),void 0!==t.description&&(o.description=t.description),void 0!==t.formData&&(o.formData={...t.formData}),o.updatedAt=(new Date).toISOString(),this.saveToStorage(a)}catch(e){return console.error('[PresetService] æ›´æ–°é¢„è®¾å¤±è´¥:',e),!1}}deletePreset(e){try{if(se.some(t=>t.id===e))return console.warn('[PresetService] æ— æ³•åˆ é™¤å†…ç½®é¢„è®¾'),!1;const t=this.loadFromStorage(),a=t.presets.findIndex(t=>t.id===e);return-1===a?(console.warn('[PresetService] é¢„è®¾ä¸å­˜åœ¨:',e),!1):(t.presets.splice(a,1),t.lastUsedPresetId===e&&(t.lastUsedPresetId=void 0),this.saveToStorage(t))}catch(e){return console.error('[PresetService] åˆ é™¤é¢„è®¾å¤±è´¥:',e),!1}}duplicatePreset(e,t){const a=this.getPresetById(e);if(!a)return console.warn('[PresetService] è¦å¤åˆ¶çš„é¢„è®¾ä¸å­˜åœ¨:',e),null;const n=t||`${a.name} (å‰¯æœ¬)`;return this.savePreset(n,a.formData,a.description)}setLastUsedPreset(e){const t=this.loadFromStorage();t.lastUsedPresetId=e,this.saveToStorage(t)}getLastUsedPresetId(){return this.loadFromStorage().lastUsedPresetId}getLastUsedPreset(){const e=this.getLastUsedPresetId();return e?this.getPresetById(e):null}exportPresets(e){if(e){const t=this.getPresetById(e);if(!t)throw new Error('é¢„è®¾ä¸å­˜åœ¨');return JSON.stringify(t,null,2)}const t=this.getUserPresets();return JSON.stringify(t,null,2)}importPresets(e){try{const t=JSON.parse(e);let a=0;const n=Array.isArray(t)?t:[t];for(const e of n){if(!this.validatePresetData(e)){console.warn('[PresetService] è·³è¿‡æ— æ•ˆé¢„è®¾:',e);continue}this.savePreset(e.name,e.formData,e.description)&&a++}return console.log(`[PresetService] æˆåŠŸå¯¼å…¥ ${a} ä¸ªé¢„è®¾`),a}catch(e){throw console.error('[PresetService] å¯¼å…¥é¢„è®¾å¤±è´¥:',e),new Error('å¯¼å…¥å¤±è´¥ï¼šæ— æ•ˆçš„ JSON æ ¼å¼')}}validatePresetData(e){if(!e||'object'!=typeof e)return!1;const t=e;if('string'!=typeof t.name||!t.name.trim())return!1;if(!t.formData||'object'!=typeof t.formData)return!1;const a=t.formData;return'string'==typeof a.sceneType&&'string'==typeof a.sceneName}clearAllUserPresets(){try{const e={version:1,presets:[],lastUsedPresetId:void 0};return this.saveToStorage(e)}catch(e){return console.error('[PresetService] æ¸…é™¤é¢„è®¾å¤±è´¥:',e),!1}}getPresetStats(){const e=this.getUserPresets();return{total:se.length+e.length,builtin:se.length,user:e.length}}refreshCache(){this.cachedData=null,this.loadFromStorage()}}const ce=re.getInstance(),ie={class:'game-start-panel'},ue={class:'panel-header'},de={class:'header-actions'},me={class:'preset-count'},ve={class:'panel-body'},pe={class:'form-progress'},fe={class:'progress-bar'},ge={class:'progress-text'},he={class:'section-content'},ye={class:'form-row'},Ve={class:'form-group'},Ne={class:'scene-type-selector'},Ee=['onClick'],be={class:'scene-icon'},ke={class:'scene-label'},Ce={key:0,class:'check-icon'},Se={class:'form-row'},we={class:'form-group'},Ie={key:0,class:'error-text'},Be={class:'form-row'},Ae={class:'form-group'},De={class:'char-count'},Me={class:'section-content'},xe={class:'form-row'},Te={class:'form-group'},$e={class:'char-count'},_e={class:'section-content'},Re={class:'form-row form-row-2col'},Oe={class:'form-group'},Fe={class:'form-group'},Le={class:'form-row form-row-2col'},Pe={class:'form-group'},je={key:0,class:'error-text'},Ue={class:'form-group'},ze={class:'section-content rules-content'},We={class:'rules-card roster-fields-card'},He={class:'card-header'},Ge={class:'field-count'},Je={class:'card-body'},qe={class:'preset-fields'},Ke={class:'preset-tags'},Ye=['onClick'],Xe={key:0,class:'empty-hint'},Ze={class:'tag-text'},Qe=['onClick'],et={class:'add-field-row'},tt=['disabled'],at={key:0,class:'error-text'},nt={class:'rules-card main-document-card'},ot={class:'card-header'},lt={class:'field-count'},st={class:'card-body'},rt={class:'rule-number'},ct=['value','onInput'],it=['onClick'],ut={class:'rules-card dress-code-card'},dt={class:'card-header'},mt={class:'field-count'},vt={class:'card-body'},pt={class:'rule-number'},ft=['value','onInput'],gt=['onClick'],ht={class:'rules-card application-form-card'},yt={class:'card-header'},Vt={class:'field-count'},Nt={class:'card-body'},Et={class:'rule-number'},bt=['value','onInput'],kt=['onClick'],Ct={class:'rules-card other-rules-card'},St={class:'card-header'},wt={class:'field-count'},It={class:'card-body'},Bt={class:'rule-number'},At=['value','onInput'],Dt=['onClick'],Mt={class:'section-content'},xt={class:'form-row'},Tt={class:'form-group'},$t={class:'char-count'},_t={class:'panel-footer'},Rt={class:'footer-left'},Ot=['disabled'],Ft=['disabled'],Lt=['disabled'],Pt={class:'footer-right'},jt=['disabled'],Ut=['disabled'],zt={key:0,class:'btn-loading'},Wt={key:0,class:'validation-errors'},Ht={class:'error-header'},Gt={class:'error-list'},Jt={class:'prompt-preview-modal'},qt={class:'modal-body'},Kt={class:'prompt-content-wrapper'},Yt={class:'prompt-stats'},Xt={class:'stat-item'},Zt={class:'stat-item'},Qt={class:'preset-panel-modal'},ea={class:'modal-body'},ta={class:'preset-list'},aa={class:'preset-group'},na={class:'group-header'},oa={class:'group-count'},la={class:'group-items'},sa=['onClick'],ra={class:'preset-item-icon'},ca={class:'preset-item-content'},ia={class:'preset-item-name'},ua={key:0,class:'preset-item-desc'},da={class:'preset-group'},ma={class:'group-header'},va={class:'group-count'},pa={key:0,class:'group-empty'},fa={key:1,class:'group-items'},ga=['onClick'],ha=['onClick'],ya={class:'preset-item-name'},Va={key:0,class:'preset-item-desc'},Na={class:'preset-item-meta'},Ea={class:'meta-date'},ba={class:'preset-item-actions'},ka=['onClick'],Ca=['onClick'],Sa={class:'modal-footer'},wa={class:'save-preset-modal'},Ia={class:'modal-body'},Ba={class:'form-group'},Aa={class:'form-group'},Da={key:0,class:'error-message'},Ma={class:'modal-footer'},xa=['disabled'],Ta=['disabled'],$a={key:0,class:'btn-loading'},_a=(0,l.defineComponent)({__name:'GameStartPanel',emits:['start','cancel'],setup(e,{emit:t}){const a=t,n=(0,l.reactive)({...te}),o=(0,l.ref)(!1),s=(0,l.ref)(!1),r=(0,l.ref)([]),c=((0,l.reactive)({roster:!0,dress:!1,other:!1}),(0,l.ref)(!1)),i=(0,l.ref)(''),u=(0,l.ref)(!1),d=(0,l.ref)(!1),m=(0,l.ref)(''),v=(0,l.ref)(''),p=(0,l.ref)([]),f=(0,l.ref)(null),g=(0,l.ref)(!1),h=(0,l.ref)(null),y=(0,l.ref)(!1),V=(0,l.ref)(null);let N=0;const E=()=>`item_${Date.now()}_${++N}`,b=(0,l.ref)([]),k=(0,l.ref)(''),C=(0,l.ref)([]),S=(0,l.ref)([]),w=(0,l.ref)([]),I=(0,l.ref)([]),B=['å§“å','æ€§åˆ«','å¹´é¾„','éƒ¨é—¨','èŒä½','èŒçº§','èº«é«˜','ä½“é‡','ä¸‰å›´','é¢å®¹è¯„åˆ†','æ€§æ ¼ç‰¹å¾','å…¥èŒå¹´é™','å­¦å†','ç‰¹é•¿','ç»¼åˆè¯„çº§','å¤‡æ³¨'],A=(0,l.computed)(()=>Object.values(ee)),D=(0,l.computed)(()=>ne(n).isValid),M=(0,l.computed)(()=>{const e=[{value:n.sceneType,weight:10},{value:n.sceneName,weight:15},{value:n.sceneDescription,weight:5},{value:n.worldView,weight:5},{value:n.playerName,weight:5},{value:n.playerAge,weight:5},{value:n.playerPosition,weight:10},{value:n.playerDepartment,weight:5},{value:b.value.length>0,weight:10},{value:C.value.filter(e=>e.content.trim()).length>0,weight:10},{value:S.value.filter(e=>e.content.trim()).length>0,weight:10},{value:w.value.filter(e=>e.content.trim()).length>0,weight:10}];let t=0,a=0;return e.forEach(e=>{t+=e.weight,e.value&&(a+=e.weight)}),Math.round(a/t*100)}),x=(0,l.computed)(()=>B.filter(e=>!b.value.includes(e))),T=e=>{if(!s.value)return null;const t=r.value.find(t=>t.field===e);return t?.message||null},R=()=>{const e=k.value.trim();e&&!b.value.includes(e)&&(b.value.push(e),k.value='',G())},O=()=>{C.value.push({id:E(),content:''})},F=()=>{G()},L=()=>{S.value.push({id:E(),content:''})},P=()=>{G()},j=()=>{w.value.push({id:E(),content:''})},U=()=>{G()},W=()=>{I.value.push({id:E(),content:''})},H=()=>{G()},G=()=>{n.rosterFields=b.value.join('ã€'),n.mainDocument=C.value.filter(e=>e.content.trim()).map(e=>e.content).join('ï¼›'),n.dressCode=S.value.filter(e=>e.content.trim()).map(e=>e.content).join('ï¼›'),n.applicationForms=w.value.filter(e=>e.content.trim()).map(e=>e.content).join('ï¼›'),n.otherRules=I.value.filter(e=>e.content.trim()).map(e=>e.content).join('ï¼›')},J=()=>{n.rosterFields&&(b.value=n.rosterFields.split(/[,ï¼Œã€]/).map(e=>e.trim()).filter(e=>e)),n.mainDocument&&(C.value=n.mainDocument.split(/[ã€‚ï¼›;]/).map(e=>e.trim()).filter(e=>e).map(e=>({id:E(),content:e}))),n.dressCode&&(S.value=n.dressCode.split(/[ã€‚ï¼›;]/).map(e=>e.trim()).filter(e=>e).map(e=>({id:E(),content:e}))),n.applicationForms&&(w.value=n.applicationForms.split(/[ã€‚ï¼›;]/).map(e=>e.trim()).filter(e=>e).map(e=>({id:E(),content:e}))),n.otherRules&&(I.value=n.otherRules.split(/[ã€‚ï¼›;]/).map(e=>e.trim()).filter(e=>e).map(e=>({id:E(),content:e})))};J();const q=()=>{p.value=ce.getAllPresets();const e=ce.getLastUsedPresetId();e&&(f.value=e)},K=()=>{q(),u.value=!0},Y=()=>{u.value=!1,h.value=null},X=()=>{const e=ee[n.sceneType]?.label||'è‡ªå®šä¹‰',t=(new Date).toLocaleString('zh-CN',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});m.value=`${e} - ${n.sceneName||'æœªå‘½å'} (${t})`,v.value='',d.value=!0},Z=()=>{d.value=!1,m.value='',v.value='',h.value=null},Q=async()=>{if(m.value.trim()){g.value=!0,h.value=null;try{G();const e=ce.savePreset(m.value.trim(),n,v.value.trim()||void 0);e?(q(),f.value=e.id,Z(),'undefined'!=typeof toastr&&toastr.success(`é¢„è®¾"${e.name}"å·²ä¿å­˜`,'ä¿å­˜æˆåŠŸ',{timeOut:2e3})):h.value='ä¿å­˜é¢„è®¾å¤±è´¥ï¼Œè¯·é‡è¯•'}catch(e){console.error('[GameStartPanel] ä¿å­˜é¢„è®¾å¤±è´¥:',e),h.value=e instanceof Error?e.message:'ä¿å­˜å¤±è´¥'}finally{g.value=!1}}else h.value='è¯·è¾“å…¥é¢„è®¾åç§°'},ae=e=>{Object.assign(n,e.formData),J(),ce.setLastUsedPreset(e.id),f.value=e.id,Y(),'undefined'!=typeof toastr&&toastr.info(`å·²åŠ è½½é¢„è®¾"${e.name}"`,'åŠ è½½æˆåŠŸ',{timeOut:2e3})},le=()=>{if(!V.value)return;const e=ce.getPresetById(V.value);ce.deletePreset(V.value)?(q(),f.value===V.value&&(f.value=null),'undefined'!=typeof toastr&&e&&toastr.success(`é¢„è®¾"${e.name}"å·²åˆ é™¤`,'åˆ é™¤æˆåŠŸ',{timeOut:2e3})):'undefined'!=typeof toastr&&toastr.error('åˆ é™¤é¢„è®¾å¤±è´¥','é”™è¯¯',{timeOut:3e3}),y.value=!1,V.value=null},se=()=>{y.value=!1,V.value=null},re=e=>ee[e.formData.sceneType]?.icon||'âœ¨',_a=e=>{try{return new Date(e).toLocaleString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'})}catch{return e}};(0,l.onMounted)(()=>{q()});const Ra=()=>{const e=function(e){const t=['office','school','hospital','military'],a=t[Math.floor(Math.random()*t.length)],n=ee[a],o=18+Math.floor(30*Math.random()),l={office:['ç§‘å‘˜','ä¸»ä»»ç§‘å‘˜','å‰¯ç§‘é•¿','ç§‘é•¿','å¤„é•¿åŠ©ç†'],school:['å­¦ç”Ÿ','ç­é•¿','å­¦ä¹ å§”å‘˜','ä½“è‚²å§”å‘˜','æ–‡è‰ºå§”å‘˜'],hospital:['å®ä¹ åŒ»ç”Ÿ','ä½é™¢åŒ»å¸ˆ','ä¸»æ²»åŒ»å¸ˆ','æŠ¤å£«','æŠ¤å£«é•¿'],military:['åˆ—å…µ','ä¸‹å£«','ä¸­å£«','ä¸Šå£«','å°‘å°‰'],custom:['æˆå‘˜']}[a],s=l[Math.floor(Math.random()*l.length)],r={office:['è¡ŒåŠ¨ä¸€ç§‘','è¡ŒåŠ¨äºŒç§‘','åå‹¤éƒ¨','äººäº‹éƒ¨','è´¢åŠ¡éƒ¨'],school:['é«˜ä¸€(1)ç­','é«˜äºŒ(2)ç­','é«˜ä¸‰(3)ç­','å­¦ç”Ÿä¼š'],hospital:['å†…ç§‘','å¤–ç§‘','å¦‡äº§ç§‘','å„¿ç§‘','æ€¥è¯Šç§‘'],military:['ä¸€è¿','äºŒè¿','ä¸‰è¿','é€šä¿¡è¿','ä¾¦å¯Ÿè¿'],custom:['é»˜è®¤éƒ¨é—¨']}[a],c=r[Math.floor(Math.random()*r.length)];return{sceneType:a,sceneName:n.defaultName,sceneDescription:n.defaultDescription,worldView:e?.worldView||'',playerName:e?.playerName||'',playerAge:o,playerPosition:s,playerDepartment:c,rosterFields:n.defaultRosterFields,mainDocument:'',dressCode:n.defaultDressCode,applicationForms:'',otherRules:n.defaultOtherRules,additionalNotes:e?.additionalNotes||''}}({playerName:n.playerName,worldView:n.worldView,additionalNotes:n.additionalNotes});Object.assign(n,e),J(),s.value=!1,'undefined'!=typeof toastr&&toastr.info('å·²éšæœºå¡«å……è¡¨å•','éšæœºå¡«å……',{timeOut:2e3})},Oa=()=>{Object.assign(n,te),b.value=[],C.value=[],S.value=[],w.value=[],I.value=[],J(),s.value=!1,r.value=[],'undefined'!=typeof toastr&&toastr.info('è¡¨å•å·²é‡ç½®','é‡ç½®',{timeOut:2e3})},Fa=()=>{const e=ne(n);if(r.value=e.errors,!e.isValid)return s.value=!0,void('undefined'!=typeof toastr&&toastr.warning('è¯·å®Œå–„å¿…å¡«é¡¹','è¡¨å•éªŒè¯',{timeOut:3e3}));const t=oe(n);i.value=t.text,c.value=!0},La=()=>{c.value=!1},Pa=async()=>{c.value=!1,o.value=!0;try{console.log('[GameStartPanel] ç¡®è®¤å¼€å±€æç¤ºè¯ï¼Œé•¿åº¦:',i.value.length),a('start',i.value)}catch(e){console.error('[GameStartPanel] å¼€å§‹æ¸¸æˆå¤±è´¥:',e),'undefined'!=typeof toastr&&toastr.error('å¼€å§‹æ¸¸æˆå¤±è´¥ï¼Œè¯·é‡è¯•','é”™è¯¯',{timeOut:3e3})}finally{o.value=!1}},ja=async()=>{await Ua()},Ua=async()=>{const e=ne(n);if(r.value=e.errors,!e.isValid)return s.value=!0,void('undefined'!=typeof toastr&&toastr.warning('è¯·å®Œå–„å¿…å¡«é¡¹','è¡¨å•éªŒè¯',{timeOut:3e3}));o.value=!0,s.value=!1;try{const e=oe(n);console.log('[GameStartPanel] ç”Ÿæˆå¼€å±€æç¤ºè¯:',e.text.substring(0,200)+'...'),a('start',e.text)}catch(e){console.error('[GameStartPanel] å¼€å§‹æ¸¸æˆå¤±è´¥:',e),'undefined'!=typeof toastr&&toastr.error('å¼€å§‹æ¸¸æˆå¤±è´¥ï¼Œè¯·é‡è¯•','é”™è¯¯',{timeOut:3e3})}finally{o.value=!1}};return(0,l.watch)(n,()=>{if(s.value){const e=ne(n);r.value=e.errors}},{deep:!0}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',ie,[(0,l.createCommentVNode)(' é¢æ¿å¤´éƒ¨ - ä¼˜åŒ–è®¾è®¡ '),(0,l.createElementVNode)('header',ue,[t[16]||(t[16]=(0,l.createStaticVNode)('<div class="header-content" data-v-6f814e5e><div class="header-icon-wrapper" data-v-6f814e5e><span class="header-icon" data-v-6f814e5e>ğŸ®</span></div><div class="header-text" data-v-6f814e5e><h2 class="header-title" data-v-6f814e5e>è‡ªå®šä¹‰å¼€å±€</h2><p class="header-subtitle" data-v-6f814e5e>é…ç½®ä½ çš„æ¸¸æˆä¸–ç•Œ</p></div></div>',1)),(0,l.createCommentVNode)(' é¢„è®¾å¿«æ·æ“ä½œ '),(0,l.createElementVNode)('div',de,[(0,l.createElementVNode)('button',{class:'preset-btn',title:'ç®¡ç†é¢„è®¾',onClick:K},[t[14]||(t[14]=(0,l.createElementVNode)('span',{class:'preset-icon'},'ğŸ“',-1)),t[15]||(t[15]=(0,l.createElementVNode)('span',{class:'preset-text'},'é¢„è®¾',-1)),(0,l.createElementVNode)('span',me,(0,l.toDisplayString)(p.value.length),1)])])]),(0,l.createCommentVNode)(' é¢æ¿ä¸»ä½“ - è¡¨å•åŒºåŸŸ '),(0,l.createElementVNode)('div',ve,[(0,l.createCommentVNode)(' è¿›åº¦æŒ‡ç¤ºå™¨ '),(0,l.createElementVNode)('div',pe,[(0,l.createElementVNode)('div',fe,[(0,l.createElementVNode)('div',{class:'progress-fill',style:(0,l.normalizeStyle)({width:M.value+'%'})},null,4)]),(0,l.createElementVNode)('span',ge,'å·²å¡«å†™ '+(0,l.toDisplayString)(M.value)+'%',1)]),(0,l.createCommentVNode)(' åœºæ™¯è®¾å®šåŒºå— '),(0,l.createElementVNode)('section',{class:(0,l.normalizeClass)(['setting-section',{'has-content':n.sceneName}])},[t[20]||(t[20]=(0,l.createStaticVNode)('<div class="section-header" data-v-6f814e5e><div class="section-header-left" data-v-6f814e5e><span class="section-icon" data-v-6f814e5e>ğŸ“</span><h3 class="section-title" data-v-6f814e5e>åœºæ™¯è®¾å®š</h3></div><span class="required-badge" data-v-6f814e5e>å¿…å¡«</span></div>',1)),(0,l.createElementVNode)('div',he,[(0,l.createElementVNode)('div',ye,[(0,l.createElementVNode)('div',Ve,[t[17]||(t[17]=(0,l.createElementVNode)('label',{class:'form-label'},[(0,l.createTextVNode)(' åœºæ™¯ç±»å‹ '),(0,l.createElementVNode)('span',{class:'required-mark'},'*')],-1)),(0,l.createElementVNode)('div',Ne,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(A.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:e.type,class:(0,l.normalizeClass)(['scene-type-btn',{active:n.sceneType===e.type}]),onClick:t=>(e=>{n.sceneType=e;const t=ee[e];t&&'custom'!==e&&(n.sceneName=t.defaultName,n.sceneDescription=t.defaultDescription,t.defaultRosterFields&&(b.value=t.defaultRosterFields.split(/[,ï¼Œã€]/).map(e=>e.trim()).filter(e=>e)),C.value=[],t.defaultDressCode?S.value=t.defaultDressCode.split(/[ã€‚ï¼›;]/).map(e=>e.trim()).filter(e=>e).map(e=>({id:E(),content:e})):S.value=[],w.value=[],t.defaultOtherRules?I.value=t.defaultOtherRules.split(/[ã€‚ï¼›;]/).map(e=>e.trim()).filter(e=>e).map(e=>({id:E(),content:e})):I.value=[],G())})(e.type)},[(0,l.createElementVNode)('span',be,(0,l.toDisplayString)(e.icon),1),(0,l.createElementVNode)('span',ke,(0,l.toDisplayString)(e.label),1),n.sceneType===e.type?((0,l.openBlock)(),(0,l.createElementBlock)('span',Ce,'âœ“')):(0,l.createCommentVNode)('v-if',!0)],10,Ee))),128))])])]),(0,l.createElementVNode)('div',Se,[(0,l.createElementVNode)('div',we,[t[18]||(t[18]=(0,l.createElementVNode)('label',{class:'form-label'},[(0,l.createTextVNode)(' åœºæ™¯åç§° '),(0,l.createElementVNode)('span',{class:'required-mark'},'*')],-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>n.sceneName=e),type:'text',class:(0,l.normalizeClass)(['form-input',{'has-error':T('sceneName'),'has-value':n.sceneName}]),placeholder:'ä¾‹å¦‚ï¼šç¬¬ä¸ƒå¤„ã€XXé«˜ä¸­ã€å¸‚ä¸­å¿ƒåŒ»é™¢'},null,2),[[l.vModelText,n.sceneName]]),T('sceneName')?((0,l.openBlock)(),(0,l.createElementBlock)('span',Ie,(0,l.toDisplayString)(T('sceneName')),1)):(0,l.createCommentVNode)('v-if',!0)])]),(0,l.createElementVNode)('div',Be,[(0,l.createElementVNode)('div',Ae,[t[19]||(t[19]=(0,l.createElementVNode)('label',{class:'form-label'},[(0,l.createTextVNode)(' åœºæ™¯æè¿° '),(0,l.createElementVNode)('span',{class:'optional-mark'},'å¯é€‰')],-1)),(0,l.withDirectives)((0,l.createElementVNode)('textarea',{'onUpdate:modelValue':t[1]||(t[1]=e=>n.sceneDescription=e),class:(0,l.normalizeClass)(['form-textarea',{'has-value':n.sceneDescription}]),rows:'3',placeholder:'å¯¹åœºæ™¯çš„è¯¦ç»†æè¿°ï¼ˆå¯é€‰ï¼‰'},null,2),[[l.vModelText,n.sceneDescription]]),(0,l.createElementVNode)('span',De,(0,l.toDisplayString)(n.sceneDescription?.length||0)+' å­—',1)])])])],2),(0,l.createCommentVNode)(' ä¸–ç•Œè§‚è®¾å®šåŒºå— '),(0,l.createElementVNode)('section',{class:(0,l.normalizeClass)(['setting-section',{'has-content':n.worldView}])},[t[22]||(t[22]=(0,l.createStaticVNode)('<div class="section-header" data-v-6f814e5e><div class="section-header-left" data-v-6f814e5e><span class="section-icon" data-v-6f814e5e>ğŸŒ</span><h3 class="section-title" data-v-6f814e5e>ä¸–ç•Œè§‚è®¾å®š</h3></div><span class="optional-badge" data-v-6f814e5e>å¯é€‰</span></div>',1)),(0,l.createElementVNode)('div',Me,[(0,l.createElementVNode)('div',xe,[(0,l.createElementVNode)('div',Te,[t[21]||(t[21]=(0,l.createElementVNode)('label',{class:'form-label'},'ä¸–ç•Œè§‚',-1)),(0,l.withDirectives)((0,l.createElementVNode)('textarea',{'onUpdate:modelValue':t[2]||(t[2]=e=>n.worldView=e),class:(0,l.normalizeClass)(['form-textarea',{'has-value':n.worldView}]),rows:'3',placeholder:'æè¿°è¿™ä¸ªä¸–ç•Œçš„èƒŒæ™¯ã€è§„åˆ™ã€ç‰¹è‰²...'},null,2),[[l.vModelText,n.worldView]]),(0,l.createElementVNode)('span',$e,(0,l.toDisplayString)(n.worldView?.length||0)+' å­—',1)])])])],2),(0,l.createCommentVNode)(' ç©å®¶è®¾å®šåŒºå— '),(0,l.createElementVNode)('section',{class:(0,l.normalizeClass)(['setting-section',{'has-content':n.playerPosition}])},[t[28]||(t[28]=(0,l.createStaticVNode)('<div class="section-header" data-v-6f814e5e><div class="section-header-left" data-v-6f814e5e><span class="section-icon" data-v-6f814e5e>ğŸ‘¤</span><h3 class="section-title" data-v-6f814e5e>ç©å®¶è®¾å®š</h3></div><span class="required-badge" data-v-6f814e5e>éƒ¨åˆ†å¿…å¡«</span></div>',1)),(0,l.createElementVNode)('div',_e,[(0,l.createElementVNode)('div',Re,[(0,l.createElementVNode)('div',Oe,[t[23]||(t[23]=(0,l.createElementVNode)('label',{class:'form-label'},[(0,l.createTextVNode)(' å§“å '),(0,l.createElementVNode)('span',{class:'optional-mark'},'å¯é€‰')],-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>n.playerName=e),type:'text',class:(0,l.normalizeClass)(['form-input',{'has-value':n.playerName}]),placeholder:'ç•™ç©ºåˆ™ä½¿ç”¨ <user>'},null,2),[[l.vModelText,n.playerName]]),t[24]||(t[24]=(0,l.createElementVNode)('span',{class:'help-text'},'ğŸ’¡ ç•™ç©ºå°†ä½¿ç”¨é…’é¦†ç”¨æˆ·å',-1))]),(0,l.createElementVNode)('div',Fe,[t[25]||(t[25]=(0,l.createElementVNode)('label',{class:'form-label'},[(0,l.createTextVNode)(' å¹´é¾„ '),(0,l.createElementVNode)('span',{class:'optional-mark'},'å¯é€‰')],-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[4]||(t[4]=e=>n.playerAge=e),type:'number',class:(0,l.normalizeClass)(['form-input',{'has-value':n.playerAge}]),placeholder:'18',min:'1',max:'999'},null,2),[[l.vModelText,n.playerAge,void 0,{number:!0}]])])]),(0,l.createElementVNode)('div',Le,[(0,l.createElementVNode)('div',Pe,[t[26]||(t[26]=(0,l.createElementVNode)('label',{class:'form-label'},[(0,l.createTextVNode)(' èº«ä»½/èŒä½ '),(0,l.createElementVNode)('span',{class:'required-mark'},'*')],-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>n.playerPosition=e),type:'text',class:(0,l.normalizeClass)(['form-input',{'has-error':T('playerPosition'),'has-value':n.playerPosition}]),placeholder:'ä¾‹å¦‚ï¼šç§‘å‘˜ã€å­¦ç”Ÿã€æŠ¤å£«'},null,2),[[l.vModelText,n.playerPosition]]),T('playerPosition')?((0,l.openBlock)(),(0,l.createElementBlock)('span',je,(0,l.toDisplayString)(T('playerPosition')),1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',Ue,[t[27]||(t[27]=(0,l.createElementVNode)('label',{class:'form-label'},[(0,l.createTextVNode)(' æ‰€å±éƒ¨é—¨ '),(0,l.createElementVNode)('span',{class:'optional-mark'},'å¯é€‰')],-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[6]||(t[6]=e=>n.playerDepartment=e),type:'text',class:(0,l.normalizeClass)(['form-input',{'has-value':n.playerDepartment}]),placeholder:'ä¾‹å¦‚ï¼šè¡ŒåŠ¨ä¸€ç§‘ã€é«˜äºŒä¸‰ç­'},null,2),[[l.vModelText,n.playerDepartment]])])])])],2),(0,l.createCommentVNode)(' è§„ç« åˆ¶åº¦å®šä¹‰åŒºå— '),(0,l.createElementVNode)('section',{class:(0,l.normalizeClass)(['setting-section rules-section',{'has-content':b.value.length>0}])},[t[49]||(t[49]=(0,l.createStaticVNode)('<div class="section-header" data-v-6f814e5e><div class="section-header-left" data-v-6f814e5e><span class="section-icon" data-v-6f814e5e>ğŸ“‹</span><h3 class="section-title" data-v-6f814e5e>è§„ç« åˆ¶åº¦å®šä¹‰</h3></div><span class="required-badge" data-v-6f814e5e>å…³é”®</span></div>',1)),(0,l.createElementVNode)('div',ze,[(0,l.createCommentVNode)(' èŠ±åå†Œå­—æ®µå®šä¹‰ - æ¡ç›®å¼UI '),(0,l.createElementVNode)('div',We,[(0,l.createElementVNode)('div',He,[t[29]||(t[29]=(0,l.createElementVNode)('div',{class:'card-title'},[(0,l.createElementVNode)('span',{class:'card-icon'},'ğŸ“Š'),(0,l.createElementVNode)('span',null,'èŠ±åå†Œå­—æ®µå®šä¹‰'),(0,l.createElementVNode)('span',{class:'required-mark'},'*å¿…å¡«')],-1)),(0,l.createElementVNode)('span',Ge,(0,l.toDisplayString)(b.value.length)+' ä¸ªå­—æ®µ',1)]),(0,l.createElementVNode)('div',Je,[t[33]||(t[33]=(0,l.createElementVNode)('p',{class:'card-desc'},[(0,l.createElementVNode)('span',{class:'desc-icon'},'ğŸ’¡'),(0,l.createTextVNode)(' å®šä¹‰äººå‘˜æ¡£æ¡ˆéœ€è¦è®°å½•å“ªäº›ä¿¡æ¯ï¼Œç‚¹å‡»é¢„è®¾å­—æ®µå¿«é€Ÿæ·»åŠ ï¼Œæˆ–æ‰‹åŠ¨è¾“å…¥ ')],-1)),(0,l.createCommentVNode)(' é¢„è®¾å­—æ®µå¿«é€Ÿæ·»åŠ  '),(0,l.createElementVNode)('div',qe,[t[31]||(t[31]=(0,l.createElementVNode)('span',{class:'preset-label'},'å¸¸ç”¨å­—æ®µï¼š',-1)),(0,l.createElementVNode)('div',Ke,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(x.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:e,class:'preset-tag',onClick:t=>(e=>{b.value.includes(e)||(b.value.push(e),G())})(e)},[t[30]||(t[30]=(0,l.createElementVNode)('span',{class:'tag-icon'},'+',-1)),(0,l.createTextVNode)(' '+(0,l.toDisplayString)(e),1)],8,Ye))),128))])]),(0,l.createCommentVNode)(' å·²é€‰å­—æ®µå±•ç¤º '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['selected-fields',{'has-fields':b.value.length>0}])},[0===b.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('span',Xe,' ç‚¹å‡»ä¸Šæ–¹å­—æ®µæ·»åŠ ï¼Œæˆ–åœ¨ä¸‹æ–¹è¾“å…¥è‡ªå®šä¹‰å­—æ®µ ')):(0,l.createCommentVNode)('v-if',!0),(0,l.createVNode)(l.TransitionGroup,{name:'tag',tag:'div',class:'field-tags'},{default:(0,l.withCtx)(()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(b.value,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e,class:'field-tag',style:(0,l.normalizeStyle)({'--tag-index':t})},[(0,l.createElementVNode)('span',Ze,(0,l.toDisplayString)(e),1),(0,l.createElementVNode)('button',{class:'tag-remove',title:'ç§»é™¤',onClick:e=>(e=>{b.value.splice(e,1),G()})(t)},'âœ•',8,Qe)],4))),128))]),_:1})],2),(0,l.createCommentVNode)(' æ‰‹åŠ¨æ·»åŠ å­—æ®µ '),(0,l.createElementVNode)('div',et,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[7]||(t[7]=e=>k.value=e),type:'text',class:'add-field-input',placeholder:'è¾“å…¥è‡ªå®šä¹‰å­—æ®µåç§°ï¼ŒæŒ‰å›è½¦æ·»åŠ ',onKeyup:(0,l.withKeys)(R,['enter'])},null,544),[[l.vModelText,k.value]]),(0,l.createElementVNode)('button',{class:'add-field-btn',disabled:!k.value.trim(),onClick:R},[...t[32]||(t[32]=[(0,l.createElementVNode)('span',null,'æ·»åŠ ',-1)])],8,tt)]),T('rosterFields')?((0,l.openBlock)(),(0,l.createElementBlock)('span',at,(0,l.toDisplayString)(T('rosterFields')),1)):(0,l.createCommentVNode)('v-if',!0)])]),(0,l.createCommentVNode)(' æ–‡æ¡£ä¸€ï¼šä¸»è§„ç« åˆ¶åº¦ï¼ˆå‘˜å·¥å®ˆåˆ™/æ ¡è§„ç­‰ï¼‰ '),(0,l.createElementVNode)('div',nt,[(0,l.createElementVNode)('div',ot,[t[34]||(t[34]=(0,l.createElementVNode)('div',{class:'card-title'},[(0,l.createElementVNode)('span',{class:'card-icon'},'ğŸ“œ'),(0,l.createElementVNode)('span',null,'ä¸»è§„ç« åˆ¶åº¦'),(0,l.createElementVNode)('span',{class:'required-mark'},'*å¿…å¡«')],-1)),(0,l.createElementVNode)('span',lt,(0,l.toDisplayString)(C.value.length)+' æ¡è§„å®š',1)]),(0,l.createElementVNode)('div',st,[t[36]||(t[36]=(0,l.createElementVNode)('p',{class:'card-desc'},[(0,l.createElementVNode)('span',{class:'desc-icon'},'ğŸ“‹'),(0,l.createTextVNode)(' å®šä¹‰åœºæ™¯çš„æ€»è§ˆæ€§è§„ç« åˆ¶åº¦ï¼ˆå¦‚å‘˜å·¥å®ˆåˆ™ã€æ ¡è§„ç­‰ï¼‰ï¼ŒåŒ…å«ç»„ç»‡æ¶æ„ã€å·¥ä½œè§„èŒƒã€ç”³è¯·æµç¨‹ç­‰æ ¸å¿ƒå†…å®¹ ')],-1)),t[37]||(t[37]=(0,l.createElementVNode)('p',{class:'card-hint'},[(0,l.createTextVNode)('ğŸ’¡ '),(0,l.createElementVNode)('strong',null,'ç©å®¶å¯ç•™ç©º'),(0,l.createTextVNode)('ï¼ŒAIä¼šæ ¹æ®åœºæ™¯ç±»å‹è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„è§„ç« åˆ¶åº¦æ–‡æ¡£')],-1)),(0,l.createCommentVNode)(' å·²æ·»åŠ çš„è§„å®š '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['rule-items',{'has-items':C.value.length>0}])},[(0,l.createVNode)(l.TransitionGroup,{name:'rule',tag:'div',class:'rule-list'},{default:(0,l.withCtx)(()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(C.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:'rule-item'},[(0,l.createElementVNode)('span',rt,(0,l.toDisplayString)(C.value.indexOf(e)+1),1),(0,l.createElementVNode)('input',{value:e.content,type:'text',class:'rule-input',placeholder:'è¾“å…¥è§„ç« åˆ¶åº¦æ¡ç›®ï¼ˆå¦‚ï¼šç¬¬ä¸€ç«  æ€»åˆ™ã€è€ƒå‹¤åˆ¶åº¦ã€å¥–æƒ©è§„å®šç­‰ï¼‰...',onInput:t=>((e,t)=>{const a=C.value.find(t=>t.id===e);a&&(a.content=t)})(e.id,t.target.value),onBlur:F},null,40,ct),(0,l.createElementVNode)('button',{class:'rule-remove',title:'åˆ é™¤',onClick:t=>(e=>{const t=C.value.findIndex(t=>t.id===e);-1!==t&&(C.value.splice(t,1),G())})(e.id)},'âœ•',8,it)]))),128))]),_:1})],2),(0,l.createCommentVNode)(' æ·»åŠ æ–°è§„å®š '),(0,l.createElementVNode)('button',{class:'add-rule-btn',onClick:O},[...t[35]||(t[35]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'+',-1),(0,l.createElementVNode)('span',null,'æ·»åŠ è§„ç« æ¡ç›®',-1)])])])]),(0,l.createCommentVNode)(' æ–‡æ¡£äºŒï¼šäººå‘˜ç€è£…åŠä¿¡æ¯ç™»è®°è§„å®š '),(0,l.createElementVNode)('div',ut,[(0,l.createElementVNode)('div',dt,[t[38]||(t[38]=(0,l.createElementVNode)('div',{class:'card-title'},[(0,l.createElementVNode)('span',{class:'card-icon'},'ğŸ‘”'),(0,l.createElementVNode)('span',null,'ç€è£…åŠäººå‘˜ä¿¡æ¯è§„å®š'),(0,l.createElementVNode)('span',{class:'required-mark'},'*å¿…å¡«')],-1)),(0,l.createElementVNode)('span',mt,(0,l.toDisplayString)(S.value.length)+' æ¡è§„å®š',1)]),(0,l.createElementVNode)('div',vt,[t[40]||(t[40]=(0,l.createElementVNode)('p',{class:'card-desc'},[(0,l.createElementVNode)('span',{class:'desc-icon'},'ğŸ‘—'),(0,l.createTextVNode)(' å®šä¹‰äººå‘˜ç€è£…è¦æ±‚å’Œä¸ªäººä¿¡æ¯ç™»è®°è§„èŒƒ ')],-1)),t[41]||(t[41]=(0,l.createElementVNode)('p',{class:'card-hint'},[(0,l.createTextVNode)('ğŸ’¡ '),(0,l.createElementVNode)('strong',null,'ç©å®¶å¯ç•™ç©º'),(0,l.createTextVNode)('ï¼ŒAIä¼šæ ¹æ®åœºæ™¯ç”Ÿæˆè¯¦ç»†çš„ç€è£…è§„èŒƒå’Œäººå‘˜æ¡£æ¡ˆç™»è®°è¦æ±‚')],-1)),(0,l.createCommentVNode)(' å·²æ·»åŠ çš„è§„å®š '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['rule-items',{'has-items':S.value.length>0}])},[(0,l.createVNode)(l.TransitionGroup,{name:'rule',tag:'div',class:'rule-list'},{default:(0,l.withCtx)(()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(S.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:'rule-item'},[(0,l.createElementVNode)('span',pt,(0,l.toDisplayString)(S.value.indexOf(e)+1),1),(0,l.createElementVNode)('input',{value:e.content,type:'text',class:'rule-input',placeholder:'è¾“å…¥ç€è£…æˆ–äººå‘˜ä¿¡æ¯è§„å®š...',onInput:t=>((e,t)=>{const a=S.value.find(t=>t.id===e);a&&(a.content=t)})(e.id,t.target.value),onBlur:P},null,40,ft),(0,l.createElementVNode)('button',{class:'rule-remove',title:'åˆ é™¤',onClick:t=>(e=>{const t=S.value.findIndex(t=>t.id===e);-1!==t&&(S.value.splice(t,1),G())})(e.id)},'âœ•',8,gt)]))),128))]),_:1})],2),(0,l.createCommentVNode)(' æ·»åŠ æ–°è§„å®š '),(0,l.createElementVNode)('button',{class:'add-rule-btn',onClick:L},[...t[39]||(t[39]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'+',-1),(0,l.createElementVNode)('span',null,'æ·»åŠ ç€è£…è§„å®š',-1)])])])]),(0,l.createCommentVNode)(' æ–‡æ¡£ä¸‰ï¼šç”³è¯·è¡¨æ¨¡æ¿ '),(0,l.createElementVNode)('div',ht,[(0,l.createElementVNode)('div',yt,[t[42]||(t[42]=(0,l.createElementVNode)('div',{class:'card-title'},[(0,l.createElementVNode)('span',{class:'card-icon'},'ğŸ“'),(0,l.createElementVNode)('span',null,'ç”³è¯·è¡¨æ¨¡æ¿'),(0,l.createElementVNode)('span',{class:'required-mark'},'*å¿…å¡«')],-1)),(0,l.createElementVNode)('span',Vt,(0,l.toDisplayString)(w.value.length)+' ä¸ªè¡¨å•',1)]),(0,l.createElementVNode)('div',Nt,[t[44]||(t[44]=(0,l.createElementVNode)('p',{class:'card-desc'},[(0,l.createElementVNode)('span',{class:'desc-icon'},'ğŸ“„'),(0,l.createTextVNode)(' å®šä¹‰åœºæ™¯ä¸­å¯ä½¿ç”¨çš„å„ç±»ç”³è¯·è¡¨æ¨¡æ¿ï¼ˆå¦‚è¯·å‡ç”³è¯·ã€ç‰©èµ„ç”³è¯·ã€ç‰¹æ®Šäº‹é¡¹ç”³è¯·ç­‰ï¼‰ ')],-1)),t[45]||(t[45]=(0,l.createElementVNode)('p',{class:'card-hint'},[(0,l.createTextVNode)('ğŸ’¡ '),(0,l.createElementVNode)('strong',null,'ç©å®¶å¯ç•™ç©º'),(0,l.createTextVNode)('ï¼ŒAIä¼šç”Ÿæˆç¬¦åˆåœºæ™¯çš„åŸºæœ¬ç”³è¯·è¡¨æ¨¡æ¿')],-1)),(0,l.createCommentVNode)(' å·²æ·»åŠ çš„è¡¨å• '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['rule-items',{'has-items':w.value.length>0}])},[(0,l.createVNode)(l.TransitionGroup,{name:'rule',tag:'div',class:'rule-list'},{default:(0,l.withCtx)(()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(w.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:'rule-item'},[(0,l.createElementVNode)('span',Et,(0,l.toDisplayString)(w.value.indexOf(e)+1),1),(0,l.createElementVNode)('input',{value:e.content,type:'text',class:'rule-input',placeholder:'è¾“å…¥ç”³è¯·è¡¨åç§°æˆ–è¯´æ˜ï¼ˆå¦‚ï¼šè¯·å‡ç”³è¯·è¡¨ã€ç‰©èµ„é¢†ç”¨ç”³è¯·ç­‰ï¼‰...',onInput:t=>((e,t)=>{const a=w.value.find(t=>t.id===e);a&&(a.content=t)})(e.id,t.target.value),onBlur:U},null,40,bt),(0,l.createElementVNode)('button',{class:'rule-remove',title:'åˆ é™¤',onClick:t=>(e=>{const t=w.value.findIndex(t=>t.id===e);-1!==t&&(w.value.splice(t,1),G())})(e.id)},'âœ•',8,kt)]))),128))]),_:1})],2),(0,l.createCommentVNode)(' æ·»åŠ æ–°è¡¨å• '),(0,l.createElementVNode)('button',{class:'add-rule-btn',onClick:j},[...t[43]||(t[43]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'+',-1),(0,l.createElementVNode)('span',null,'æ·»åŠ ç”³è¯·è¡¨',-1)])])])]),(0,l.createCommentVNode)(' å…¶ä»–è‡ªå®šä¹‰è§„åˆ™ï¼ˆå¯é€‰æ‰©å±•ï¼‰ '),(0,l.createElementVNode)('div',Ct,[(0,l.createElementVNode)('div',St,[t[46]||(t[46]=(0,l.createElementVNode)('div',{class:'card-title'},[(0,l.createElementVNode)('span',{class:'card-icon'},'ğŸ“–'),(0,l.createElementVNode)('span',null,'å…¶ä»–è‡ªå®šä¹‰è§„åˆ™'),(0,l.createElementVNode)('span',{class:'optional-mark'},'å¯é€‰')],-1)),(0,l.createElementVNode)('span',wt,(0,l.toDisplayString)(I.value.length)+' æ¡è§„åˆ™',1)]),(0,l.createElementVNode)('div',It,[t[48]||(t[48]=(0,l.createElementVNode)('p',{class:'card-desc'},[(0,l.createElementVNode)('span',{class:'desc-icon'},'âœ¨'),(0,l.createTextVNode)(' å¯è‡ªç”±æ·»åŠ å…¶ä»–éœ€è¦AIéµå®ˆçš„è§„åˆ™æˆ–æ‰©å±•è®¾å®š ')],-1)),(0,l.createCommentVNode)(' å·²æ·»åŠ çš„è§„åˆ™ '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['rule-items',{'has-items':I.value.length>0}])},[(0,l.createVNode)(l.TransitionGroup,{name:'rule',tag:'div',class:'rule-list'},{default:(0,l.withCtx)(()=>[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(I.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:'rule-item'},[(0,l.createElementVNode)('span',Bt,(0,l.toDisplayString)(I.value.indexOf(e)+1),1),(0,l.createElementVNode)('input',{value:e.content,type:'text',class:'rule-input',placeholder:'è¾“å…¥è‡ªå®šä¹‰è§„åˆ™...',onInput:t=>((e,t)=>{const a=I.value.find(t=>t.id===e);a&&(a.content=t)})(e.id,t.target.value),onBlur:H},null,40,At),(0,l.createElementVNode)('button',{class:'rule-remove',title:'åˆ é™¤',onClick:t=>(e=>{const t=I.value.findIndex(t=>t.id===e);-1!==t&&(I.value.splice(t,1),G())})(e.id)},'âœ•',8,Dt)]))),128))]),_:1})],2),(0,l.createCommentVNode)(' æ·»åŠ æ–°è§„åˆ™ '),(0,l.createElementVNode)('button',{class:'add-rule-btn',onClick:W},[...t[47]||(t[47]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'+',-1),(0,l.createElementVNode)('span',null,'æ·»åŠ è‡ªå®šä¹‰è§„åˆ™',-1)])])])])])],2),(0,l.createCommentVNode)(' è¡¥å……è¯´æ˜åŒºå— '),(0,l.createElementVNode)('section',{class:(0,l.normalizeClass)(['setting-section',{'has-content':n.additionalNotes}])},[t[50]||(t[50]=(0,l.createStaticVNode)('<div class="section-header" data-v-6f814e5e><div class="section-header-left" data-v-6f814e5e><span class="section-icon" data-v-6f814e5e>ğŸ“</span><h3 class="section-title" data-v-6f814e5e>è¡¥å……è¯´æ˜</h3></div><span class="optional-badge" data-v-6f814e5e>å¯é€‰</span></div>',1)),(0,l.createElementVNode)('div',Mt,[(0,l.createElementVNode)('div',xt,[(0,l.createElementVNode)('div',Tt,[(0,l.withDirectives)((0,l.createElementVNode)('textarea',{'onUpdate:modelValue':t[8]||(t[8]=e=>n.additionalNotes=e),class:(0,l.normalizeClass)(['form-textarea',{'has-value':n.additionalNotes}]),rows:'2',placeholder:'å…¶ä»–æƒ³è¦å‘Šè¯‰AIçš„å†…å®¹...'},null,2),[[l.vModelText,n.additionalNotes]]),(0,l.createElementVNode)('span',$t,(0,l.toDisplayString)(n.additionalNotes?.length||0)+' å­—',1)])])])],2)]),(0,l.createCommentVNode)(' é¢æ¿åº•éƒ¨ - æ“ä½œæŒ‰é’® '),(0,l.createElementVNode)('footer',_t,[(0,l.createElementVNode)('div',Rt,[(0,l.createElementVNode)('button',{class:'btn btn-secondary',disabled:o.value,onClick:Ra},[...t[51]||(t[51]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ²',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'éšæœºå¡«å……',-1)])],8,Ot),(0,l.createElementVNode)('button',{class:'btn btn-secondary',disabled:o.value,onClick:Oa},[...t[52]||(t[52]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ”„',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'é‡ç½®',-1)])],8,Ft),(0,l.createElementVNode)('button',{class:'btn btn-success',disabled:o.value,onClick:X},[...t[53]||(t[53]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ’¾',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'ä¿å­˜é¢„è®¾',-1)])],8,Lt)]),(0,l.createElementVNode)('div',Pt,[(0,l.createElementVNode)('button',{class:'btn btn-outline-primary',disabled:o.value||!D.value,onClick:Fa},[...t[54]||(t[54]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ‘ï¸',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'é¢„è§ˆæç¤ºè¯',-1)])],8,jt),(0,l.createElementVNode)('button',{class:'btn btn-primary',disabled:o.value||!D.value,onClick:ja},[o.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',zt,[...t[55]||(t[55]=[(0,l.createElementVNode)('span',{class:'loading-dot'},null,-1),(0,l.createElementVNode)('span',{class:'loading-dot'},null,-1),(0,l.createElementVNode)('span',{class:'loading-dot'},null,-1)])])):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[t[56]||(t[56]=(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸš€',-1)),t[57]||(t[57]=(0,l.createElementVNode)('span',{class:'btn-text'},'å¼€å§‹æ¸¸æˆ',-1))],64))],8,Ut)])]),(0,l.createCommentVNode)(' éªŒè¯é”™è¯¯æç¤º '),(0,l.createVNode)(l.Transition,{name:'slide-up'},{default:(0,l.withCtx)(()=>[r.value.length>0&&s.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',Wt,[(0,l.createElementVNode)('div',Ht,[t[58]||(t[58]=(0,l.createElementVNode)('span',{class:'error-icon'},'âš ï¸',-1)),t[59]||(t[59]=(0,l.createElementVNode)('span',null,'è¯·å®Œå–„ä»¥ä¸‹å¿…å¡«é¡¹ï¼š',-1)),(0,l.createElementVNode)('button',{class:'error-close',onClick:t[9]||(t[9]=e=>s.value=!1)},'âœ•')]),(0,l.createElementVNode)('ul',Gt,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(r.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('li',{key:e.field},(0,l.toDisplayString)(e.message),1))),128))])])):(0,l.createCommentVNode)('v-if',!0)]),_:1}),(0,l.createCommentVNode)(' æç¤ºè¯é¢„è§ˆæ¨¡æ€æ¡† '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[(0,l.createVNode)(l.Transition,{name:'modal'},{default:(0,l.withCtx)(()=>[c.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'prompt-preview-overlay',onClick:(0,l.withModifiers)(La,['self'])},[(0,l.createElementVNode)('div',Jt,[(0,l.createElementVNode)('div',{class:'modal-header'},[t[60]||(t[60]=(0,l.createElementVNode)('div',{class:'modal-title'},[(0,l.createElementVNode)('span',{class:'modal-icon'},'ğŸ“‹'),(0,l.createElementVNode)('h3',null,'æç¤ºè¯é¢„è§ˆ')],-1)),(0,l.createElementVNode)('button',{class:'modal-close',onClick:La},'âœ•')]),(0,l.createElementVNode)('div',qt,[t[63]||(t[63]=(0,l.createElementVNode)('div',{class:'prompt-info'},[(0,l.createElementVNode)('span',{class:'info-icon'},'ğŸ’¡'),(0,l.createElementVNode)('span',{class:'info-text'},'ä»¥ä¸‹æ˜¯å°†å‘é€ç»™AIçš„å¼€å±€æç¤ºè¯ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤é¢„è§ˆå’Œç¼–è¾‘')],-1)),(0,l.createElementVNode)('div',Kt,[(0,l.withDirectives)((0,l.createElementVNode)('textarea',{'onUpdate:modelValue':t[10]||(t[10]=e=>i.value=e),class:'prompt-textarea',rows:'20'},null,512),[[l.vModelText,i.value]])]),(0,l.createElementVNode)('div',Yt,[(0,l.createElementVNode)('span',Xt,[t[61]||(t[61]=(0,l.createElementVNode)('span',{class:'stat-icon'},'ğŸ“',-1)),(0,l.createTextVNode)(' å­—æ•°ï¼š'+(0,l.toDisplayString)(i.value?.length||0),1)]),(0,l.createElementVNode)('span',Zt,[t[62]||(t[62]=(0,l.createElementVNode)('span',{class:'stat-icon'},'ğŸ“„',-1)),(0,l.createTextVNode)(' è¡Œæ•°ï¼š'+(0,l.toDisplayString)((i.value?.split('\n')||[]).length),1)])])]),(0,l.createElementVNode)('div',{class:'modal-footer'},[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:La},[...t[64]||(t[64]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'âœ•',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'å–æ¶ˆ',-1)])]),(0,l.createElementVNode)('button',{class:'btn btn-primary',onClick:Pa},[...t[65]||(t[65]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸš€',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'ç¡®è®¤å¹¶å¼€å§‹',-1)])])])])])):(0,l.createCommentVNode)('v-if',!0)]),_:1}),(0,l.createCommentVNode)(' é¢„è®¾ç®¡ç†æ¨¡æ€æ¡† '),(0,l.createVNode)(l.Transition,{name:'modal'},{default:(0,l.withCtx)(()=>[u.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'preset-panel-overlay',onClick:(0,l.withModifiers)(Y,['self'])},[(0,l.createElementVNode)('div',Qt,[(0,l.createElementVNode)('div',{class:'modal-header'},[t[66]||(t[66]=(0,l.createElementVNode)('div',{class:'modal-title'},[(0,l.createElementVNode)('span',{class:'modal-icon'},'ğŸ“'),(0,l.createElementVNode)('h3',null,'é¢„è®¾ç®¡ç†')],-1)),(0,l.createElementVNode)('button',{class:'modal-close',onClick:Y},'âœ•')]),(0,l.createElementVNode)('div',ea,[t[73]||(t[73]=(0,l.createElementVNode)('div',{class:'preset-info'},[(0,l.createElementVNode)('span',{class:'info-icon'},'ğŸ’¡'),(0,l.createElementVNode)('span',{class:'info-text'},'é€‰æ‹©ä¸€ä¸ªé¢„è®¾å¿«é€Ÿå¡«å……è¡¨å•ï¼Œæˆ–ä¿å­˜å½“å‰é…ç½®ä¸ºæ–°é¢„è®¾')],-1)),(0,l.createCommentVNode)(' é¢„è®¾åˆ—è¡¨ '),(0,l.createElementVNode)('div',ta,[(0,l.createCommentVNode)(' å†…ç½®é¢„è®¾åˆ†ç»„ '),(0,l.createElementVNode)('div',aa,[(0,l.createElementVNode)('div',na,[t[67]||(t[67]=(0,l.createElementVNode)('span',{class:'group-icon'},'â­',-1)),t[68]||(t[68]=(0,l.createElementVNode)('span',{class:'group-title'},'å†…ç½®é¢„è®¾',-1)),(0,l.createElementVNode)('span',oa,(0,l.toDisplayString)(p.value.filter(e=>e.isBuiltin).length),1)]),(0,l.createElementVNode)('div',la,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(p.value.filter(e=>e.isBuiltin),e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['preset-item',{active:f.value===e.id}]),onClick:t=>ae(e)},[(0,l.createElementVNode)('div',ra,(0,l.toDisplayString)(re(e)),1),(0,l.createElementVNode)('div',ca,[(0,l.createElementVNode)('div',ia,(0,l.toDisplayString)(e.name),1),e.description?((0,l.openBlock)(),(0,l.createElementBlock)('div',ua,(0,l.toDisplayString)(e.description),1)):(0,l.createCommentVNode)('v-if',!0)]),t[69]||(t[69]=(0,l.createElementVNode)('div',{class:'preset-item-badge builtin'},'å†…ç½®',-1))],10,sa))),128))])]),(0,l.createCommentVNode)(' ç”¨æˆ·é¢„è®¾åˆ†ç»„ '),(0,l.createElementVNode)('div',da,[(0,l.createElementVNode)('div',ma,[t[70]||(t[70]=(0,l.createElementVNode)('span',{class:'group-icon'},'ğŸ‘¤',-1)),t[71]||(t[71]=(0,l.createElementVNode)('span',{class:'group-title'},'æˆ‘çš„é¢„è®¾',-1)),(0,l.createElementVNode)('span',va,(0,l.toDisplayString)(p.value.filter(e=>!e.isBuiltin).length),1)]),0===p.value.filter(e=>!e.isBuiltin).length?((0,l.openBlock)(),(0,l.createElementBlock)('div',pa,[...t[72]||(t[72]=[(0,l.createElementVNode)('span',{class:'empty-icon'},'ğŸ“',-1),(0,l.createElementVNode)('span',{class:'empty-text'},'æš‚æ— è‡ªå®šä¹‰é¢„è®¾ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä¿å­˜å½“å‰é…ç½®',-1)])])):((0,l.openBlock)(),(0,l.createElementBlock)('div',fa,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(p.value.filter(e=>!e.isBuiltin),e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['preset-item',{active:f.value===e.id}])},[(0,l.createElementVNode)('div',{class:'preset-item-icon',onClick:t=>ae(e)},(0,l.toDisplayString)(re(e)),9,ga),(0,l.createElementVNode)('div',{class:'preset-item-content',onClick:t=>ae(e)},[(0,l.createElementVNode)('div',ya,(0,l.toDisplayString)(e.name),1),e.description?((0,l.openBlock)(),(0,l.createElementBlock)('div',Va,(0,l.toDisplayString)(e.description),1)):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('div',Na,[(0,l.createElementVNode)('span',Ea,(0,l.toDisplayString)(_a(e.updatedAt)),1)])],8,ha),(0,l.createElementVNode)('div',ba,[(0,l.createElementVNode)('button',{class:'action-btn',title:'å¤åˆ¶',onClick:(0,l.withModifiers)(t=>(e=>{const t=ce.duplicatePreset(e);t&&(q(),'undefined'!=typeof toastr&&toastr.success(`å·²åˆ›å»ºé¢„è®¾å‰¯æœ¬"${t.name}"`,'å¤åˆ¶æˆåŠŸ',{timeOut:2e3}))})(e.id),['stop'])},'ğŸ“‹',8,ka),(0,l.createElementVNode)('button',{class:'action-btn danger',title:'åˆ é™¤',onClick:(0,l.withModifiers)(t=>{return a=e.id,V.value=a,void(y.value=!0);var a},['stop'])},' ğŸ—‘ï¸ ',8,Ca)])],2))),128))]))])])]),(0,l.createElementVNode)('div',Sa,[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:Y},[...t[74]||(t[74]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'âœ•',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'å…³é—­',-1)])]),(0,l.createElementVNode)('button',{class:'btn btn-success',onClick:t[11]||(t[11]=e=>{Y(),X()})},[...t[75]||(t[75]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ’¾',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'ä¿å­˜å½“å‰ä¸ºé¢„è®¾',-1)])])])])])):(0,l.createCommentVNode)('v-if',!0)]),_:1}),(0,l.createCommentVNode)(' ä¿å­˜é¢„è®¾å¯¹è¯æ¡† '),(0,l.createVNode)(l.Transition,{name:'modal'},{default:(0,l.withCtx)(()=>[d.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'save-preset-overlay',onClick:(0,l.withModifiers)(Z,['self'])},[(0,l.createElementVNode)('div',wa,[(0,l.createElementVNode)('div',{class:'modal-header'},[t[76]||(t[76]=(0,l.createElementVNode)('div',{class:'modal-title'},[(0,l.createElementVNode)('span',{class:'modal-icon'},'ğŸ’¾'),(0,l.createElementVNode)('h3',null,'ä¿å­˜é¢„è®¾')],-1)),(0,l.createElementVNode)('button',{class:'modal-close',onClick:Z},'âœ•')]),(0,l.createElementVNode)('div',Ia,[(0,l.createElementVNode)('div',Ba,[t[77]||(t[77]=(0,l.createElementVNode)('label',{class:'form-label'},[(0,l.createTextVNode)(' é¢„è®¾åç§° '),(0,l.createElementVNode)('span',{class:'required-mark'},'*')],-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[12]||(t[12]=e=>m.value=e),type:'text',class:(0,l.normalizeClass)(['form-input',{'has-error':h.value&&!m.value.trim()}]),placeholder:'è¾“å…¥é¢„è®¾åç§°',onKeyup:(0,l.withKeys)(Q,['enter'])},null,34),[[l.vModelText,m.value]])]),(0,l.createElementVNode)('div',Aa,[t[78]||(t[78]=(0,l.createElementVNode)('label',{class:'form-label'},[(0,l.createTextVNode)(' é¢„è®¾æè¿° '),(0,l.createElementVNode)('span',{class:'optional-mark'},'å¯é€‰')],-1)),(0,l.withDirectives)((0,l.createElementVNode)('textarea',{'onUpdate:modelValue':t[13]||(t[13]=e=>v.value=e),class:'form-textarea',rows:'2',placeholder:'ç®€è¦æè¿°è¿™ä¸ªé¢„è®¾çš„ç”¨é€”...'},null,512),[[l.vModelText,v.value]])]),h.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',Da,[t[79]||(t[79]=(0,l.createElementVNode)('span',{class:'error-icon'},'âš ï¸',-1)),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(h.value),1)])):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',Ma,[(0,l.createElementVNode)('button',{class:'btn btn-secondary',disabled:g.value,onClick:Z},[...t[80]||(t[80]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'âœ•',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'å–æ¶ˆ',-1)])],8,xa),(0,l.createElementVNode)('button',{class:'btn btn-primary',disabled:g.value||!m.value.trim(),onClick:Q},[g.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',$a,[...t[81]||(t[81]=[(0,l.createElementVNode)('span',{class:'loading-dot'},null,-1),(0,l.createElementVNode)('span',{class:'loading-dot'},null,-1),(0,l.createElementVNode)('span',{class:'loading-dot'},null,-1)])])):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[t[82]||(t[82]=(0,l.createElementVNode)('span',{class:'btn-icon'},'âœ“',-1)),t[83]||(t[83]=(0,l.createElementVNode)('span',{class:'btn-text'},'ä¿å­˜',-1))],64))],8,Ta)])])])):(0,l.createCommentVNode)('v-if',!0)]),_:1}),(0,l.createCommentVNode)(' åˆ é™¤ç¡®è®¤å¯¹è¯æ¡† '),(0,l.createVNode)(l.Transition,{name:'modal'},{default:(0,l.withCtx)(()=>[y.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'delete-confirm-overlay',onClick:(0,l.withModifiers)(se,['self'])},[(0,l.createElementVNode)('div',{class:'delete-confirm-modal'},[t[86]||(t[86]=(0,l.createElementVNode)('div',{class:'modal-header danger'},[(0,l.createElementVNode)('div',{class:'modal-title'},[(0,l.createElementVNode)('span',{class:'modal-icon'},'âš ï¸'),(0,l.createElementVNode)('h3',null,'ç¡®è®¤åˆ é™¤')])],-1)),t[87]||(t[87]=(0,l.createElementVNode)('div',{class:'modal-body'},[(0,l.createElementVNode)('p',{class:'confirm-text'},'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¢„è®¾å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚')],-1)),(0,l.createElementVNode)('div',{class:'modal-footer'},[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:se},[...t[84]||(t[84]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'âœ•',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'å–æ¶ˆ',-1)])]),(0,l.createElementVNode)('button',{class:'btn btn-danger',onClick:le},[...t[85]||(t[85]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ—‘ï¸',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'åˆ é™¤',-1)])])])])])):(0,l.createCommentVNode)('v-if',!0)]),_:1})]))]))}}),Ra=(0,I.A)(_a,[['__scopeId','data-v-6f814e5e']]),Oa={class:'main-content'},Fa={class:'game-text-container'},La={key:0,class:'processing-state'},Pa={class:'content-header'},ja={class:'content-meta'},Ua={key:0,class:'meta-item'},za={key:1,class:'meta-item streaming-badge'},Wa={class:'game-text'},Ha=(0,l.defineComponent)({__name:'MainContent',props:{currentContent:{default:''},isProcessing:{type:Boolean,default:!1},isStreaming:{type:Boolean,default:!1},variableChanges:{default:()=>[]},lastUpdateTime:{default:''}},emits:['game-start'],setup(e,{expose:t,emit:a}){const n=e,o=a,s=(0,l.ref)(null),r=(0,l.ref)(null),c=(0,l.computed)(()=>n.variableChanges.length>0),i=(0,l.computed)(()=>!n.isProcessing&&!n.isStreaming&&(!n.currentContent||''===n.currentContent.trim())),u={enabled:!0,showIcons:!0,enableAnimations:!0},d=e=>{console.log('[MainContent] å†…å®¹å—è¢«ç‚¹å‡»:',e.block.type,e.block.displayContent.substring(0,50))},m=e=>{e.success&&console.log('[MainContent] å†…å®¹è§£æå®Œæˆ:',{æ€»å—æ•°:e.statistics.totalBlocks,å„ç±»å‹:e.statistics.blockCounts,è€—æ—¶:e.statistics.parseTime.toFixed(2)+'ms'})},v=()=>{(0,l.nextTick)(()=>{s.value&&(s.value.scrollTop=s.value.scrollHeight)})},p=()=>{console.log('[MainContent] æ¸…ç©ºå˜é‡å˜åŒ–è®°å½•')},f=e=>{console.log('[MainContent] å¤åˆ¶å˜é‡å˜åŒ–è®°å½•:',e.substring(0,100))},g=e=>{console.log('[MainContent] å¼€å§‹æ¸¸æˆï¼Œæç¤ºè¯é•¿åº¦:',e.length),o('game-start',e)},h=()=>{console.log('[MainContent] å–æ¶ˆå¼€å±€')};return(0,l.watch)(()=>n.currentContent,()=>{v()}),t({scrollToBottom:v,expandChangesPanel:()=>r.value?.expand(),collapseChangesPanel:()=>r.value?.collapse()}),(t,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('main',Oa,[(0,l.createCommentVNode)(' è‡ªå®šä¹‰å¼€å±€é¢æ¿ - å½“å†…å®¹ä¸ºç©ºæ—¶æ˜¾ç¤º '),i.value?((0,l.openBlock)(),(0,l.createBlock)(Ra,{key:0,onStart:g,onCancel:h})):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' æ¸¸æˆæ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸ - æœ‰å†…å®¹æ—¶æ˜¾ç¤º '),(0,l.createElementVNode)('div',Fa,[(0,l.createCommentVNode)(' AIæ­£åœ¨æ€è€ƒçŠ¶æ€ '),e.isProcessing&&!e.isStreaming?((0,l.openBlock)(),(0,l.createElementBlock)('div',La,[...a[0]||(a[0]=[(0,l.createStaticVNode)('<div class="thinking-panel" data-v-37c016ce><div class="thinking-animation" data-v-37c016ce><span class="thinking-dot" data-v-37c016ce></span><span class="thinking-dot" data-v-37c016ce></span><span class="thinking-dot" data-v-37c016ce></span></div><p class="thinking-text" data-v-37c016ce>AIæ­£åœ¨æ€è€ƒ...</p></div>',1)])])):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' ä¸»å†…å®¹æ˜¾ç¤º '),(0,l.createElementVNode)('div',{ref_key:'contentRef',ref:s,class:'content-display'},[(0,l.createCommentVNode)(' å†…å®¹å¤´éƒ¨ '),(0,l.createElementVNode)('div',Pa,[(0,l.createElementVNode)('div',ja,[e.lastUpdateTime?((0,l.openBlock)(),(0,l.createElementBlock)('span',Ua,[a[1]||(a[1]=(0,l.createElementVNode)('span',{class:'meta-icon'},'ğŸ•',-1)),(0,l.createTextVNode)(' '+(0,l.toDisplayString)(e.lastUpdateTime),1)])):(0,l.createCommentVNode)('v-if',!0),e.isStreaming?((0,l.openBlock)(),(0,l.createElementBlock)('span',za,[...a[2]||(a[2]=[(0,l.createElementVNode)('span',{class:'streaming-dot'},null,-1),(0,l.createTextVNode)(' æ­£åœ¨ç”Ÿæˆ... ',-1)])])):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' ç‰ˆæœ¬å¾½ç«  '),a[3]||(a[3]=(0,l.createElementVNode)('div',{class:'version-badge',title:'MClite v0.7.4'},[(0,l.createElementVNode)('span',{class:'version-tag'},'MClite v0.7.4')],-1))]),(0,l.createCommentVNode)(' ä¸»æ–‡æœ¬å†…å®¹ - ä½¿ç”¨å†…å®¹å—å·®å¼‚åŒ–æ¸²æŸ“ç»„ä»¶ '),(0,l.createElementVNode)('div',Wa,[(0,l.createVNode)(x,{content:e.currentContent,'is-streaming':e.isStreaming,config:u,theme:'auto',onBlockClick:d,onParsed:m},null,8,['content','is-streaming'])]),(0,l.createCommentVNode)(' å˜é‡å˜åŒ–é¢æ¿ï¼ˆå¢å¼ºç‰ˆï¼‰ '),(0,l.createVNode)(Q,{ref_key:'variableChangesPanelRef',ref:r,changes:e.variableChanges,'default-expanded':c.value,onClear:p,onCopy:f},null,8,['changes','default-expanded'])],512)],2112))])],2112))]))}}),Ga=(0,I.A)(Ha,[['__scopeId','data-v-37c016ce']]),Ja={maxItems:50,storageKey:'mclite_input_history',autoSave:!0,deduplicate:!0};const qa=(0,l.reactive)({visible:!1,title:'ç¡®è®¤',message:'',confirmText:'ç¡®è®¤',cancelText:'å–æ¶ˆ',type:'info',icon:'â“',showCancel:!0,isProcessing:!1});let Ka=null,Ya=null;const Xa={info:'â„¹ï¸',warning:'âš ï¸',danger:'ğŸ—‘ï¸',success:'âœ…'},Za=e=>new Promise(t=>{const a='string'==typeof e?{message:e}:e;qa.title=a.title||'ç¡®è®¤',qa.message=a.message,qa.confirmText=a.confirmText||'ç¡®è®¤',qa.cancelText=a.cancelText||'å–æ¶ˆ',qa.type=a.type||'info',qa.icon=a.icon||Xa[a.type||'info']||'â“',qa.showCancel=!1!==a.showCancel,qa.isProcessing=!1,qa.visible=!0,Ka=t,Ya=a.beforeConfirm||null}),Qa=async()=>{if(!qa.isProcessing){if(Ya){qa.isProcessing=!0;try{if(!await Ya())return void(qa.isProcessing=!1)}catch(e){return console.error('[ConfirmDialog] beforeConfirm error:',e),void(qa.isProcessing=!1)}}qa.visible=!1,qa.isProcessing=!1,Ka&&(Ka(!0),Ka=null),Ya=null}},en=()=>{qa.isProcessing||(qa.visible=!1,Ka&&(Ka(!1),Ka=null),Ya=null)},tn=(e,t='å±é™©æ“ä½œ')=>Za({title:t,message:e,type:'danger',confirmText:'ç¡®è®¤åˆ é™¤',cancelText:'å–æ¶ˆ',icon:'ğŸ—‘ï¸'}),an=(e,t='è­¦å‘Š')=>Za({title:t,message:e,type:'warning',confirmText:'ç»§ç»­',cancelText:'å–æ¶ˆ',icon:'âš ï¸'}),nn=(e,t='æç¤º')=>Za({title:t,message:e,type:'info',confirmText:'çŸ¥é“äº†',showCancel:!1,icon:'â„¹ï¸'});function on(){return{state:(0,l.readonly)(qa),confirm:Za,confirmDanger:tn,confirmWarning:an,confirmInfo:nn,handleConfirm:Qa,handleCancel:en}}const ln={class:'bottom-bar'},sn={key:0,class:'history-panel'},rn={class:'history-header'},cn={class:'history-count'},un={class:'history-actions'},dn={class:'history-search'},mn={class:'history-list'},vn=['onClick'],pn={class:'history-content'},fn={class:'history-time'},gn=['onClick'],hn={key:0,class:'history-empty'},yn={class:'input-area'},Vn=['title'],Nn=['placeholder','disabled'],En=['disabled','title'],bn={key:0,class:'loading-icon'},kn={key:1,class:'send-icon'},Cn={key:0,class:'navigation-hint'},Sn={class:'hint-text'},wn={key:1,class:'error-message'},In={class:'error-text'},Bn=(0,l.defineComponent)({__name:'BottomBar',props:{placeholder:{default:'è¾“å…¥ä½ æƒ³è¯´çš„è¯æˆ–æƒ³åšçš„äº‹...'},isLoading:{type:Boolean,default:!1},error:{default:null}},emits:['send','clearError'],setup(e,{expose:t,emit:a}){const n=e,o=a,{historyList:s,currentIndex:r,historyCount:c,hasHistory:i,isNavigating:u,addToHistory:d,navigateBack:m,navigateForward:v,resetNavigation:p,removeHistoryAt:f,clearHistory:g,searchHistory:h}=function(e={}){const t={...Ja,...e},a=(0,l.ref)([]),n=(0,l.ref)(-1),o=(0,l.ref)(''),s=(0,l.ref)(!1),r=(0,l.computed)(()=>a.value.length),c=(0,l.computed)(()=>a.value.length>0),i=(0,l.computed)(()=>n.value>=0),u=(0,l.computed)(()=>n.value<a.value.length-1),d=(0,l.computed)(()=>n.value>=0),m=(0,l.computed)(()=>n.value>=0&&n.value<a.value.length?a.value[n.value]:null),v=(0,l.computed)(()=>a.value.map(e=>e.content)),p=()=>{try{const e=localStorage.getItem(t.storageKey);if(e){const t=JSON.parse(e);Array.isArray(t)&&(a.value=t.map(e=>'string'==typeof e?{content:e,timestamp:Date.now()}:e),console.log('[useInputHistory] å·²åŠ è½½å†å²è®°å½•ï¼Œå…±',a.value.length,'æ¡'))}}catch(e){console.error('[useInputHistory] åŠ è½½å†å²è®°å½•å¤±è´¥:',e),a.value=[]}s.value=!0},f=()=>{try{localStorage.setItem(t.storageKey,JSON.stringify(a.value)),console.log('[useInputHistory] å†å²è®°å½•å·²ä¿å­˜')}catch(e){console.error('[useInputHistory] ä¿å­˜å†å²è®°å½•å¤±è´¥:',e)}},g=e=>c.value?(-1===n.value&&(o.value=e),n.value<a.value.length-1?(n.value++,a.value[n.value].content):null):null,h=()=>n.value<0?null:(n.value--,n.value>=0?a.value[n.value].content:o.value),y=()=>{n.value=-1,o.value=''},V=e=>e>=0&&e<a.value.length&&(a.value.splice(e,1),n.value>=e&&n.value>0&&n.value--,t.autoSave&&f(),!0);return(0,l.onMounted)(()=>{p()}),{historyList:a,currentIndex:n,tempInput:o,isInitialized:s,historyCount:r,hasHistory:c,isNavigating:i,canGoBack:u,canGoForward:d,currentHistoryItem:m,historyContents:v,addToHistory:e=>{if(!e||!e.trim())return;const n=e.trim();if(t.deduplicate){const e=a.value.findIndex(e=>e.content===n);e>=0&&a.value.splice(e,1)}a.value.unshift({content:n,timestamp:Date.now()}),a.value.length>t.maxItems&&(a.value=a.value.slice(0,t.maxItems)),y(),t.autoSave&&f(),console.log('[useInputHistory] æ–°è®°å½•å·²æ·»åŠ :',n.slice(0,50)+'...')},navigateBack:g,navigateForward:h,startNavigation:e=>{-1===n.value&&(o.value=e)},resetNavigation:y,handleKeyboardNavigation:(e,t)=>{if('ArrowUp'===e.key&&(!t.trim()||i.value)){const a=g(t);if(null!==a)return e.preventDefault(),a}if('ArrowDown'===e.key&&i.value){const t=h();if(null!==t)return e.preventDefault(),t}if('Escape'===e.key&&i.value){const t=o.value;return y(),e.preventDefault(),t}return null},getHistoryAt:e=>e>=0&&e<a.value.length?a.value[e]:null,removeHistoryAt:V,removeHistoryByContent:e=>{const t=a.value.findIndex(t=>t.content===e);return t>=0&&V(t)},clearHistory:()=>{a.value=[],y(),t.autoSave&&f(),console.log('[useInputHistory] å†å²è®°å½•å·²æ¸…ç©º')},searchHistory:e=>{if(!e||!e.trim())return a.value;const t=e.toLowerCase();return a.value.filter(e=>e.content.toLowerCase().includes(t))},loadFromStorage:p,saveToStorage:f,exportHistory:()=>JSON.stringify(a.value,null,2),importHistory:(e,n=!1)=>{try{const o=JSON.parse(e);if(!Array.isArray(o))throw new Error('æ— æ•ˆçš„å†å²è®°å½•æ ¼å¼');const l=o.map(e=>'string'==typeof e?{content:e,timestamp:Date.now()}:e);return n?(l.forEach(e=>{a.value.some(t=>t.content===e.content)||a.value.push(e)}),a.value.sort((e,t)=>t.timestamp-e.timestamp),a.value.length>t.maxItems&&(a.value=a.value.slice(0,t.maxItems))):a.value=l.slice(0,t.maxItems),t.autoSave&&f(),console.log('[useInputHistory] å†å²è®°å½•å·²å¯¼å…¥'),!0}catch(e){return console.error('[useInputHistory] å¯¼å…¥å†å²è®°å½•å¤±è´¥:',e),!1}},config:t}}(),y=(0,l.ref)(''),V=(0,l.ref)(null),N=(0,l.ref)(!1),E=(0,l.ref)(''),b=(0,l.computed)(()=>y.value.trim().length>0&&!n.isLoading),k=(0,l.computed)(()=>n.isLoading?'AIæ­£åœ¨æ€è€ƒä¸­ï¼Œè¯·ç¨å€™...':u.value?'ä½¿ç”¨ â†‘â†“ å¯¼èˆªå†å²ï¼ŒEsc å–æ¶ˆ':n.placeholder),C=(0,l.computed)(()=>E.value.trim()?h(E.value):s.value),S=()=>{if(!b.value)return;const e=y.value.trim();d(e),o('send',e),y.value='',N.value=!1,(0,l.nextTick)(()=>{V.value&&(V.value.style.height='auto')})},w=e=>{if('Enter'===e.key&&!e.shiftKey)return e.preventDefault(),void S();if('ArrowUp'===e.key&&I()){const t=m(y.value);null!==t&&(e.preventDefault(),y.value=t,(0,l.nextTick)(()=>{V.value&&(V.value.selectionStart=V.value.selectionEnd=y.value.length)}))}if('ArrowDown'===e.key&&u.value&&B()){const t=v();null!==t&&(e.preventDefault(),y.value=t,(0,l.nextTick)(()=>{V.value&&(V.value.selectionStart=V.value.selectionEnd=y.value.length)}))}'Escape'===e.key&&(u.value?(A(),e.preventDefault()):N.value&&(N.value=!1,e.preventDefault()))},I=()=>{if(!V.value)return!0;const e=V.value.selectionStart||0;return!y.value.substring(0,e).includes('\n')},B=()=>{if(!V.value)return!0;const e=V.value.selectionStart||0;return!y.value.substring(e).includes('\n')},A=()=>{p(),y.value=''},D=()=>{if(!V.value)return;V.value.style.height='auto';const e=V.value.scrollHeight;V.value.style.height=Math.min(e,120)+'px'},M=()=>{V.value?.focus()},x=()=>{N.value=!N.value,N.value&&(E.value='')},T=async()=>{await tn('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ','æ¸…ç©ºå†å²')&&(g(),E.value='')},R=e=>{const t=new Date(e),a=new Date,n=a.getTime()-e;return n<6e4?'åˆšåˆš':n<36e5?`${Math.floor(n/6e4)}åˆ†é’Ÿå‰`:n<864e5?`${Math.floor(n/36e5)}å°æ—¶å‰`:t.getFullYear()===a.getFullYear()?`${t.getMonth()+1}/${t.getDate()} ${t.getHours()}:${String(t.getMinutes()).padStart(2,'0')}`:`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`};return t({focus:M,clear:()=>{y.value='',p(),V.value&&(V.value.style.height='auto')},addToHistory:d,clearHistory:g}),(0,l.onMounted)(()=>{M()}),(0,l.watch)(y,(e,t)=>{if(u.value&&e!==t){const t=s.value[r.value];t&&e!==t.content&&p()}}),(t,a)=>((0,l.openBlock)(),(0,l.createElementBlock)('footer',ln,[(0,l.createCommentVNode)(' å†å²è®°å½•é¢æ¿ '),(0,l.createVNode)(l.Transition,{name:'slide-up'},{default:(0,l.withCtx)(()=>[N.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',sn,[(0,l.createElementVNode)('div',rn,[a[4]||(a[4]=(0,l.createElementVNode)('span',{class:'history-title'},'ğŸ“œ å†å²è¾“å…¥è®°å½•',-1)),(0,l.createElementVNode)('span',cn,(0,l.toDisplayString)((0,l.unref)(c))+' æ¡',1),(0,l.createElementVNode)('div',un,[(0,l.unref)(i)?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'history-clear-btn',title:'æ¸…ç©ºå†å²',onClick:T},'ğŸ—‘ï¸')):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('button',{class:'history-close-btn',title:'å…³é—­',onClick:a[0]||(a[0]=e=>N.value=!1)},'âœ•')])]),(0,l.createCommentVNode)(' æœç´¢æ¡† '),(0,l.createElementVNode)('div',dn,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':a[1]||(a[1]=e=>E.value=e),type:'text',class:'history-search-input',placeholder:'æœç´¢å†å²è®°å½•...'},null,512),[[l.vModelText,E.value]])]),(0,l.createCommentVNode)(' å†å²è®°å½•åˆ—è¡¨ '),(0,l.createElementVNode)('div',mn,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(C.value,(e,t)=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.timestamp,class:(0,l.normalizeClass)(['history-item',{'is-active':t===(0,l.unref)(r)}]),onClick:t=>{return a=e.content,y.value=a,N.value=!1,p(),M(),void(0,l.nextTick)(()=>{D()});var a}},[(0,l.createElementVNode)('span',pn,(0,l.toDisplayString)((a=e.content,n=80,a.length<=n?a:a.substring(0,n)+'...')),1),(0,l.createElementVNode)('span',fn,(0,l.toDisplayString)(R(e.timestamp)),1),(0,l.createElementVNode)('button',{class:'history-delete-btn',title:'åˆ é™¤',onClick:(0,l.withModifiers)(e=>(e=>{f(e)})(t),['stop'])},'âœ•',8,gn)],10,vn);var a,n}),128)),0===C.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',hn,(0,l.toDisplayString)(E.value?'æœªæ‰¾åˆ°åŒ¹é…çš„è®°å½•':'æš‚æ— å†å²è®°å½•'),1)):(0,l.createCommentVNode)('v-if',!0)])])):(0,l.createCommentVNode)('v-if',!0)]),_:1}),(0,l.createCommentVNode)(' è¾“å…¥åŒºåŸŸ '),(0,l.createElementVNode)('div',yn,[(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['input-container',{'is-loading':e.isLoading,'has-error':!!e.error}])},[(0,l.createCommentVNode)(' å†å²è®°å½•æŒ‰é’® '),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['history-toggle-btn',{'has-history':(0,l.unref)(i),'is-active':N.value}]),title:(0,l.unref)(i)?`å†å²è®°å½• (${(0,l.unref)(c)})`:'æš‚æ— å†å²è®°å½•',onClick:x},[...a[5]||(a[5]=[(0,l.createElementVNode)('span',{class:'history-icon'},'ğŸ“œ',-1)])],10,Vn),(0,l.withDirectives)((0,l.createElementVNode)('textarea',{ref_key:'inputRef',ref:V,'onUpdate:modelValue':a[2]||(a[2]=e=>y.value=e),class:'message-input',placeholder:k.value,disabled:e.isLoading,rows:'1',onKeydown:w,onInput:D},null,40,Nn),[[l.vModelText,y.value]]),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['send-btn',{'is-loading':e.isLoading}]),disabled:!b.value,title:e.isLoading?'æ­£åœ¨ç”Ÿæˆ...':'å‘é€æ¶ˆæ¯ (Enter)',onClick:S},[e.isLoading?((0,l.openBlock)(),(0,l.createElementBlock)('span',bn,'â³')):((0,l.openBlock)(),(0,l.createElementBlock)('span',kn,'ğŸ“¤'))],10,En)],2),(0,l.createCommentVNode)(' å†å²å¯¼èˆªæç¤º '),(0,l.unref)(u)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Cn,[a[6]||(a[6]=(0,l.createElementVNode)('span',{class:'hint-icon'},'â¬†ï¸â¬‡ï¸',-1)),(0,l.createElementVNode)('span',Sn,(0,l.toDisplayString)((0,l.unref)(r)+1)+'/'+(0,l.toDisplayString)((0,l.unref)(c)),1),(0,l.createElementVNode)('button',{class:'hint-cancel',title:'å–æ¶ˆ (Esc)',onClick:A},'âœ•')])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' é”™è¯¯æç¤º '),e.error?((0,l.openBlock)(),(0,l.createElementBlock)('div',wn,[a[7]||(a[7]=(0,l.createElementVNode)('span',{class:'error-icon'},'âš ï¸',-1)),(0,l.createElementVNode)('span',In,(0,l.toDisplayString)(e.error),1),(0,l.createElementVNode)('button',{class:'error-dismiss',onClick:a[3]||(a[3]=e=>t.$emit('clearError'))},'âœ•')])):(0,l.createCommentVNode)('v-if',!0)])]))}}),An=(0,I.A)(Bn,[['__scopeId','data-v-1712b424']]);function Dn(){try{if('undefined'!=typeof window&&window.Mvu)return window.Mvu}catch{}return null}const Mn={isMvuAvailable(){const e=Dn();return!(!e||'function'!=typeof e.getMvuData)},getMvuData(e){try{const t=Dn();return t&&t.getMvuData(e||{type:'message',message_id:'latest'})||null}catch(e){return console.error('[MvuService] è·å–MVUæ•°æ®å¤±è´¥:',e),null}},getVariable(e,t){try{const a=Dn();if(!a)return t?.default_value;const n=this.getMvuData(t);return n?a.getMvuVariable(n,e,{category:'stat',default_value:t?.default_value}):t?.default_value}catch(e){return console.error('[MvuService] è·å–å˜é‡å¤±è´¥:',e),t?.default_value}},async setVariable(e,t,a){try{const n=Dn();if(!n)return console.error('[MvuService] è®¾ç½®å˜é‡å¤±è´¥: Mvu å¯¹è±¡ä¸å¯ç”¨'),!1;const o=this.getMvuData(a);if(!o)return console.error('[MvuService] è®¾ç½®å˜é‡å¤±è´¥: æ— æ³•è·å– MvuData'),!1;o.stat_data||(console.warn('[MvuService] stat_data ä¸ºç©ºï¼Œåˆå§‹åŒ–ä¸ºç©ºå¯¹è±¡'),o.stat_data={}),o.display_data||(o.display_data={}),console.log('[MvuService] å°è¯•è®¾ç½®å˜é‡:',{path:e,valueType:typeof t,valuePreview:'object'==typeof t?JSON.stringify(t).substring(0,100)+'...':t,stat_data_keys:Object.keys(o.stat_data||{})});let l=!1;try{l=await n.setMvuVariable(o,e,t,{reason:a?.reason,is_recursive:!0})}catch(e){console.warn('[MvuService] MVUåŸç”ŸAPIè°ƒç”¨å¼‚å¸¸:',e),l=!1}if(!l){console.log('[MvuService] MVUåŸç”ŸAPIå¤±è´¥ï¼Œå°è¯•ç›´æ¥è®¾ç½® stat_data...');try{o.stat_data||(console.warn('[MvuService] stat_data åœ¨ API è°ƒç”¨åå˜ä¸ºç©ºï¼Œé‡æ–°åˆå§‹åŒ–'),o.stat_data={});const n=e.split('.');if(n.length>1){let e=o.stat_data;for(let t=0;t<n.length-1;t++){const a=n[t];if(void 0===e[a]||null===e[a])console.log(`[MvuService] åˆ›å»ºä¸­é—´è·¯å¾„: ${n.slice(0,t+1).join('.')}`),e[a]={};else if('object'!=typeof e[a])return console.warn(`[MvuService] è·¯å¾„ "${n.slice(0,t+1).join('.')}" ä¸æ˜¯å¯¹è±¡ï¼Œæ— æ³•ç»§ç»­`),!1;e=e[a]}}this.setNestedValue(o.stat_data,e,t),o.display_data||(o.display_data={});const s=a?.reason?`æ–°å»º (${a.reason})`:'æ–°å»º';try{this.setNestedValue(o.display_data,e,s)}catch(e){console.warn('[MvuService] è®¾ç½® display_data å¤±è´¥:',e)}l=!0,console.log('[MvuService] ç›´æ¥è®¾ç½® stat_data æˆåŠŸ')}catch(e){console.error('[MvuService] ç›´æ¥è®¾ç½® stat_data å¤±è´¥:',e),l=!1}}if(l)try{await n.replaceMvuData(o,a||{type:'message',message_id:'latest'}),console.log('[MvuService] æ•°æ®å·²æ›¿æ¢ä¿å­˜')}catch(e){return console.error('[MvuService] æ›¿æ¢æ•°æ®å¤±è´¥:',e),!1}else console.error('[MvuService] å˜é‡è®¾ç½®å¤±è´¥');return l}catch(e){return console.error('[MvuService] è®¾ç½®å˜é‡å¤±è´¥:',e),!1}},setNestedValue(e,t,a){if(null==e)throw new Error(`[setNestedValue] ç›®æ ‡å¯¹è±¡ä¸º ${e}ï¼Œæ— æ³•è®¾ç½®è·¯å¾„ "${t}"`);if('object'!=typeof e)throw new Error(`[setNestedValue] ç›®æ ‡å¯¹è±¡ä¸æ˜¯å¯¹è±¡ç±»å‹ï¼Œæ— æ³•è®¾ç½®è·¯å¾„ "${t}"`);const n=t.split('.');let o=e;for(let e=0;e<n.length-1;e++){const t=n[e];if(null==o||'object'!=typeof o)throw new Error(`[setNestedValue] è·¯å¾„ "${n.slice(0,e).join('.')}" å¤„çš„å€¼ä¸æ˜¯å¯¹è±¡ï¼Œæ— æ³•ç»§ç»­è®¾ç½®`);t in o&&'object'==typeof o[t]&&null!==o[t]||(o[t]={}),o=o[t]}o[n[n.length-1]]=a},async setVariables(e,t){try{const a=Dn();if(!a)return!1;const n=this.getMvuData(t);if(!n)return!1;for(const[o,l]of Object.entries(e))await a.setMvuVariable(n,o,l,{reason:t?.reason,is_recursive:!1});return await a.replaceMvuData(n,t||{type:'message',message_id:'latest'}),!0}catch(e){return console.error('[MvuService] æ‰¹é‡è®¾ç½®å˜é‡å¤±è´¥:',e),!1}},getAllVariableKeys(e){try{const t=this.getMvuData(e);return t?Object.keys(t.stat_data||{}):[]}catch{return[]}},getEvents(){const e=Dn();return e?.events||null}},xn=t('mvu',()=>{const e=(0,l.shallowRef)(null),t=(0,l.ref)(!1),a=(0,l.ref)(!1),n=(0,l.ref)(null),o=(0,l.ref)({type:'message',message_id:'latest'}),s=(0,l.ref)([]),r=(0,l.ref)([]),c=(0,l.ref)(!1),i=(0,l.ref)(!1),u=t=>{if(console.log('[MvuStore] å˜é‡æ›´æ–°å¼€å§‹'),t)try{e.value=JSON.parse(JSON.stringify(t))}catch(a){e.value=t}},d=(e,t,a,n)=>{console.log(`[MvuStore] å˜é‡æ›´æ–°: ${t}`,{oldValue:a,newValue:n}),s.value.forEach(e=>{if(t===e.path||t.startsWith(e.path+'.'))try{e.callback(a,n)}catch(t){console.error(`[MvuStore] å˜é‡ç›‘å¬å™¨å›è°ƒå¤±è´¥ (${e.path}):`,t)}})},m=['MC'],v=(e,t)=>t.split('.').reduce((e,t)=>e&&'object'==typeof e?e[t]:void 0,e),p=t=>{if(console.log('[MvuStore] å˜é‡æ›´æ–°ç»“æŸäº‹ä»¶è§¦å‘'),i.value)return void console.log('[MvuStore] æ­£åœ¨æ‰§è¡Œå†…éƒ¨æ›´æ–°ï¼Œè·³è¿‡äº‹ä»¶å¤„ç†ï¼ˆé¿å…æ•°æ®è¦†ç›–ï¼‰');const a=Mn.getMvuData(o.value);if(!a)return void console.warn('[MvuStore] è·å–åˆ°çš„æœ€æ–°æ•°æ®ä¸ºç©ºï¼Œä¿æŒç°æœ‰æ•°æ®ä¸å˜');if(!((e,t)=>{if(!e?.stat_data)return!0;const a=Object.keys(e.stat_data),n=Object.keys(t.stat_data||{});if(a.length>0&&n.length<.5*a.length)return console.warn('[MvuStore] æ•°æ®éªŒè¯å¤±è´¥ï¼šé”®æ•°é‡å‡å°‘è¿‡å¤š',{oldCount:a.length,newCount:n.length}),!1;for(const a of m){const n=v(e.stat_data,a),o=v(t.stat_data||{},a);if(void 0!==n&&void 0===o)return console.warn('[MvuStore] æ•°æ®éªŒè¯å¤±è´¥ï¼šå…³é”®è·¯å¾„ä¸¢å¤±',a),!1}return!0})(e.value,a))return void console.warn('[MvuStore] æ•°æ®éªŒè¯å¤±è´¥ï¼Œä¿æŒç°æœ‰æ•°æ®ä¸å˜');const n=Object.keys(a.stat_data||{});try{e.value=JSON.parse(JSON.stringify(a)),console.log('[MvuStore] å·²ä» MVU API è·å–æœ€æ–°æ•°æ®ï¼Œstat_data é”®:',n)}catch(t){e.value=a}f()},f=()=>{e.value&&r.value.forEach(t=>{try{t(e.value)}catch(e){console.error('[MvuStore] æ›´æ–°ç»“æŸç›‘å¬å™¨å›è°ƒå¤±è´¥:',e)}})},g=(0,l.computed)(()=>e.value?.stat_data||{}),h=(0,l.computed)(()=>e.value?.display_data||{}),y=(0,l.computed)(()=>e.value?.delta_data||{}),V=(0,l.computed)(()=>e.value?.initialized_lorebooks||[]),N=(0,l.computed)(()=>e.value?Mn.getAllVariableKeys(o.value):[]),E=()=>{if(c.value)return;const e=function(){try{if('undefined'!=typeof window&&'function'==typeof window.eventOn)return window.eventOn}catch{}return null}(),t=Mn.getEvents();if(e&&t)try{e(t.VARIABLE_UPDATE_STARTED,u),e(t.SINGLE_VARIABLE_UPDATED,d),e(t.VARIABLE_UPDATE_ENDED,p),c.value=!0,console.log('[MvuStore] å·²æ³¨å†Œ MVU äº‹ä»¶ç›‘å¬')}catch(e){console.error('[MvuStore] æ³¨å†Œäº‹ä»¶ç›‘å¬å¤±è´¥:',e)}else console.warn('[MvuStore] æ— æ³•æ³¨å†Œäº‹ä»¶ç›‘å¬ï¼ševentOn æˆ– Mvu.events ä¸å¯ç”¨')},b=()=>{if(!c.value)return;const e=function(){try{if('undefined'!=typeof window&&'function'==typeof window.eventOff)return window.eventOff}catch{}return null}(),t=Mn.getEvents();if(e&&t)try{e(t.VARIABLE_UPDATE_STARTED,u),e(t.SINGLE_VARIABLE_UPDATED,d),e(t.VARIABLE_UPDATE_ENDED,p),c.value=!1,console.log('[MvuStore] å·²å–æ¶ˆ MVU äº‹ä»¶ç›‘å¬')}catch(e){console.error('[MvuStore] å–æ¶ˆäº‹ä»¶ç›‘å¬å¤±è´¥:',e)}},k=async l=>{try{a.value=!0,n.value=null,l&&(o.value=l),console.log('[MvuStore] ç­‰å¾…MVUæ¡†æ¶åŠ è½½...');const s=await(async(e=3e3,t=100)=>{const a=Date.now();for(;Date.now()-a<e;){if(Mn.isMvuAvailable())return!0;await new Promise(e=>setTimeout(e,t))}return Mn.isMvuAvailable()})();if(t.value=s,!t.value)return console.warn('[MvuStore] MVUå˜é‡æ¡†æ¶æœªåŠ è½½ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®'),e.value={stat_data:{},display_data:{},delta_data:{},initialized_lorebooks:[]},void w();console.log('[MvuStore] MVUæ¡†æ¶å·²å°±ç»ªï¼Œå¼€å§‹åˆå§‹åŒ–...'),await I(),await B(),console.log('[MvuStore] åˆå§‹åŒ–å®Œæˆ')}catch(e){n.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥',console.error('[MvuStore] åˆå§‹åŒ–å¤±è´¥:',e),w()}finally{a.value=!1}};let C=0,S=null;const w=()=>{if(C>=3)return void console.warn('[MvuStore] å·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œåœæ­¢é‡è¯•');S&&clearTimeout(S),C++;const e=500*C;console.log(`[MvuStore] å°†åœ¨ ${e}ms åè¿›è¡Œç¬¬ ${C} æ¬¡é‡è¯•...`),S=setTimeout(async()=>{if(Mn.isMvuAvailable()&&!t.value){console.log('[MvuStore] MVUæ¡†æ¶ç°åœ¨å¯ç”¨ï¼Œé‡æ–°åˆå§‹åŒ–...'),t.value=!0;try{await I(),await B(),console.log('[MvuStore] é‡è¯•åˆå§‹åŒ–æˆåŠŸ'),C=0}catch(e){console.error('[MvuStore] é‡è¯•åˆå§‹åŒ–å¤±è´¥:',e),w()}}else Mn.isMvuAvailable()||(console.log('[MvuStore] MVUæ¡†æ¶ä»ä¸å¯ç”¨ï¼Œç»§ç»­ç­‰å¾…...'),w())},e)},I=async()=>{for(let e=0;e<3;e++){if(E(),c.value)return;console.log(`[MvuStore] äº‹ä»¶ç›‘å¬å™¨æ³¨å†Œå¤±è´¥ï¼Œé‡è¯• ${e+1}/3...`),await new Promise(e=>setTimeout(e,500))}console.warn('[MvuStore] äº‹ä»¶ç›‘å¬å™¨æ³¨å†Œæœ€ç»ˆå¤±è´¥ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨')},B=async()=>{let t=null;for(let a=0;a<3;a++){try{if(await A(),e.value&&e.value.stat_data)return;console.log(`[MvuStore] æ•°æ®åŠ è½½ä¸å®Œæ•´ï¼Œé‡è¯• ${a+1}/3...`)}catch(e){t=e instanceof Error?e:new Error(String(e)),console.warn(`[MvuStore] åŠ è½½æ•°æ®å¤±è´¥ï¼Œé‡è¯• ${a+1}/3:`,e)}await new Promise(e=>setTimeout(e,500))}if(t)throw t},A=async()=>{try{a.value=!0,n.value=null;const t=Mn.getMvuData(o.value);e.value=t?JSON.parse(JSON.stringify(t)):null,console.log('[MvuStore] åŠ è½½MVUæ•°æ®å®Œæˆ:',{hasData:!!t,stat_data_keys:e.value?Object.keys(e.value.stat_data||{}):[],has_è§„ç« åˆ¶åº¦:void 0!==e.value?.stat_data?.['è§„ç« åˆ¶åº¦'],è§„ç« åˆ¶åº¦_type:e.value?.stat_data?.['è§„ç« åˆ¶åº¦']?typeof e.value.stat_data['è§„ç« åˆ¶åº¦']:'undefined',è§„ç« åˆ¶åº¦_keys:e.value?.stat_data?.['è§„ç« åˆ¶åº¦']?Object.keys(e.value.stat_data['è§„ç« åˆ¶åº¦']):[]})}catch(e){n.value=e instanceof Error?e.message:'åŠ è½½MVUæ•°æ®å¤±è´¥',console.error('[MvuStore] åŠ è½½MVUæ•°æ®å¤±è´¥:',e)}finally{a.value=!1}},D=(t,a)=>{try{const n=Mn.getVariable(t,{...o.value,default_value:a});if(void 0!==n)return n;const l=t.split('.').reduce((e,t)=>e&&'object'==typeof e?e[t]:void 0,e.value?.stat_data);return void 0!==l?l:a}catch(e){return n.value=e instanceof Error?e.message:'è·å–å˜é‡å¤±è´¥',console.error(`[MvuStore] getVariable("${t}") å¤±è´¥:`,e),a}},M=async(e,t,a)=>{try{n.value=null;const l=await Mn.setVariable(e,t,{...o.value,reason:a});return l&&await A(),l}catch(e){return n.value=e instanceof Error?e.message:'è®¾ç½®å˜é‡å¤±è´¥',!1}},x=e=>(r.value.push(e),()=>{const t=r.value.indexOf(e);t>-1&&r.value.splice(t,1)}),T=async(e=5e3,t=200)=>{const a=Date.now();let n=null;for(console.log('[MvuStore] ç­‰å¾… MVU æ•°æ®å‡†å¤‡å°±ç»ª...');Date.now()-a<e;){if(!Mn.isMvuAvailable()){await new Promise(e=>setTimeout(e,t));continue}const e=Mn.getMvuData(o.value),a=e?JSON.stringify(Object.keys(e.stat_data||{})):'null';if(e&&e.stat_data&&Object.keys(e.stat_data).length>0){if(a===n)return console.log('[MvuStore] MVU æ•°æ®å·²ç¨³å®šï¼Œé”®:',Object.keys(e.stat_data)),!0;n=a}await new Promise(e=>setTimeout(e,t))}return console.warn('[MvuStore] ç­‰å¾… MVU æ•°æ®è¶…æ—¶ï¼Œå°è¯•ç»§ç»­åˆå§‹åŒ–...'),Mn.isMvuAvailable()},R=e=>{if(!e||'string'!=typeof e)return null;const t=[...e.matchAll(/<UpdateVariable>([\s\S]*?)<\/UpdateVariable>/gi)];return t.length>0?t[t.length-1][1].trim():null},O=e=>{const t=[];if(!e||'string'!=typeof e)return t;const a=e.split('\n');let n,o='',l=0,s=0,r=!1,c='';for(let e=0;e<a.length;e++){const i=a[e].trim();if(!i)continue;if(i.startsWith('//')){n=i.slice(2).trim();continue}o+=(o?'\n':'')+i;for(let e=0;e<i.length;e++){const t=i[e],a=e>0?i[e-1]:'';'"'!==t&&'\''!==t||'\\'===a?r||('{'===t?l++:'}'===t?l--:'['===t?s++:']'===t&&s--):r?t===c&&(r=!1):(r=!0,c=t)}const u=o.trim();if(0===l&&0===s&&(u.endsWith(');')||u.endsWith(')'))){const e=F(o,n);e&&t.push(e),o='',n=void 0,l=0,s=0,r=!1}}if(o.trim()){const e=F(o,n);e&&t.push(e)}return t},F=(e,t)=>{if(!e||'string'!=typeof e)return null;let a=e.trim();a.endsWith(';')&&(a=a.slice(0,-1).trim());const n=L(a);if(n>-1){const e=a.slice(n+2).trim();!t&&e&&(t=e),a=a.slice(0,n).trim()}if(!a)return null;const o=a.match(/^_\.(set|assign|add|remove)\s*\(\s*([\s\S]*)\s*\)$/i);if(o)return P(o[1].toLowerCase(),o[2],t);const l=a.match(/^(SET|ADD|SUB|MUL|DIV|APPEND|REMOVE|CLEAR|TOGGLE|INIT)\s*\(\s*([\s\S]*)\s*\)$/i);return l?j(l[1].toUpperCase(),l[2],t):(console.warn('[MvuStore] æ— æ³•è§£æå‘½ä»¤:',a.substring(0,100)+(a.length>100?'...':'')),null)},L=e=>{let t=!1,a='',n=-1;for(let o=0;o<e.length-1;o++){const l=e[o],s=e[o+1],r=o>0?e[o-1]:'';'"'!==l&&'\''!==l||'\\'===r?t||'/'!==l||'/'!==s||(n=o):t?l===a&&(t=!1):(t=!0,a=l)}return n},P=(e,t,a)=>{const n=U(t);if(n.length<1)return console.warn('[MvuStore] lodashå‘½ä»¤å‚æ•°ä¸è¶³:',e,t.substring(0,50)),null;const o='string'==typeof n[0]?n[0]:String(n[0]);switch(e){case'set':return{type:'SET',path:o,value:n.length>=3?n[2]:n[1],comment:a};case'assign':{if(n.length<3)return console.warn('[MvuStore] _.assignéœ€è¦3ä¸ªå‚æ•°:',t.substring(0,50)),null;const e='string'==typeof n[1]?n[1]:String(n[1]);return{type:'ASSIGN',path:`${o}.${e}`,parentPath:o,key:e,value:n[2],comment:a}}case'add':{const e=n.length>=2?n[1]:1;return{type:'ADD',path:o,value:'number'==typeof e?e:parseFloat(e)||1,comment:a}}case'remove':return n.length>=2?{type:'REMOVE',path:o,value:n[1],comment:a}:{type:'CLEAR',path:o,comment:a};default:return console.warn('[MvuStore] æœªçŸ¥çš„lodashæ–¹æ³•:',e),null}},j=(e,t,a)=>{const n=U(t);if(n.length<1)return console.warn('[MvuStore] å‘½ä»¤å‚æ•°ä¸è¶³:',e),null;return{type:e,path:'string'==typeof n[0]?n[0]:String(n[0]),value:n.length>=2?n[1]:void 0,comment:a}},U=e=>{const t=[];let a='',n=0,o=0,l=!1,s='';const r=e.trim();for(let e=0;e<r.length;e++){const c=r[e],i=e>0?r[e-1]:'';if('"'!==c&&'\''!==c||'\\'===i)if(l)a+=c;else if('{'!==c)if('}'!==c)if('['!==c)if(']'!==c){if(','===c&&0===n&&0===o){const e=a.trim();e&&t.push(W(e)),a='';continue}a+=c}else o--,a+=c;else o++,a+=c;else n--,a+=c;else n++,a+=c;else l?c===s&&(l=!1):(l=!0,s=c),a+=c}const c=a.trim();return c&&t.push(W(c)),t},W=e=>{const t=e.trim();if(t){if('null'===t)return null;if('true'===t)return!0;if('false'===t)return!1;if(/^-?\d+(\.\d+)?$/.test(t))return parseFloat(t);if(t.startsWith('\'')&&t.endsWith('\'')||t.startsWith('"')&&t.endsWith('"'))return t.slice(1,-1);if(t.startsWith('{')&&t.endsWith('}')||t.startsWith('[')&&t.endsWith(']'))try{return JSON.parse(t)}catch{try{const e=t.replace(/'/g,'"');return JSON.parse(e)}catch{return console.warn('[MvuStore] JSONè§£æå¤±è´¥:',t.substring(0,100)),t}}return t}},H=async e=>{try{const{type:t,path:a,value:n,parentPath:l}=e;let s,r;switch(console.log('[MvuStore] æ‰§è¡Œå‘½ä»¤:',{type:t,path:a,valueType:typeof n,valuePreview:'object'==typeof n?JSON.stringify(n).substring(0,200)+'...':n}),'SET'!==t&&'INIT'!==t&&'ASSIGN'!==t&&(s=D(a)),t){case'SET':case'INIT':r=n;break;case'ASSIGN':if(l){console.log(`[MvuStore] ASSIGN æ“ä½œï¼šç¡®ä¿çˆ¶è·¯å¾„ "${l}" å­˜åœ¨...`);await(async e=>{try{const t=Dn();if(!t)return!1;const a=Mn.getMvuData(o.value);if(!a)return!1;a.stat_data||(a.stat_data={});const n=e.split('.');let l=a.stat_data;for(let e=0;e<n.length;e++){const t=n[e];if(void 0===l[t]||null===l[t])console.log(`[MvuStore] åˆ›å»ºè·¯å¾„: ${n.slice(0,e+1).join('.')}`),l[t]={};else if('object'!=typeof l[t])return console.warn(`[MvuStore] è·¯å¾„ "${n.slice(0,e+1).join('.')}" ä¸æ˜¯å¯¹è±¡ï¼Œæ— æ³•åˆ›å»ºå­è·¯å¾„`),!1;l=l[t]}return await t.replaceMvuData(a,o.value),await A(),!0}catch(e){return console.error('[MvuStore] ç¡®ä¿è·¯å¾„å­˜åœ¨å¤±è´¥:',e),!1}})(l)||console.warn(`[MvuStore] æ— æ³•åˆ›å»ºçˆ¶è·¯å¾„ "${l}"ï¼Œå°è¯•ç›´æ¥è®¾ç½®å®Œæ•´è·¯å¾„...`)}r=n;break;case'ADD':if('number'!=typeof s||'number'!=typeof n)return{success:!1,command:e,error:'ADDæ“ä½œéœ€è¦æ•°å€¼ç±»å‹'};r=s+n;break;case'SUB':if('number'!=typeof s||'number'!=typeof n)return{success:!1,command:e,error:'SUBæ“ä½œéœ€è¦æ•°å€¼ç±»å‹'};r=s-n;break;case'MUL':if('number'!=typeof s||'number'!=typeof n)return{success:!1,command:e,error:'MULæ“ä½œéœ€è¦æ•°å€¼ç±»å‹'};r=s*n;break;case'DIV':if('number'!=typeof s||'number'!=typeof n)return{success:!1,command:e,error:'DIVæ“ä½œéœ€è¦æ•°å€¼ç±»å‹'};if(0===n)return{success:!1,command:e,error:'DIVæ“ä½œä¸èƒ½é™¤ä»¥é›¶'};r=s/n;break;case'APPEND':if(Array.isArray(s))r=[...s,n];else{if('string'!=typeof s||'string'!=typeof n)return{success:!1,command:e,error:'APPENDæ“ä½œéœ€è¦æ•°ç»„æˆ–å­—ç¬¦ä¸²ç±»å‹'};r=s+n}break;case'REMOVE':if(!Array.isArray(s))return{success:!1,command:e,error:'REMOVEæ“ä½œéœ€è¦æ•°ç»„ç±»å‹'};r=s.filter(e=>e!==n);break;case'CLEAR':r=Array.isArray(s)?[]:'object'==typeof s&&null!==s?{}:'string'==typeof s?'':'number'==typeof s?0:null;break;case'TOGGLE':if('boolean'!=typeof s)return{success:!1,command:e,error:'TOGGLEæ“ä½œéœ€è¦å¸ƒå°”ç±»å‹'};r=!s;break;default:return{success:!1,command:e,error:`æœªçŸ¥çš„å‘½ä»¤ç±»å‹: ${t}`}}const c=await M(a,r,e.comment||`${t}æ“ä½œ`);return{success:c,command:e,oldValue:s,newValue:r,error:c?void 0:'è®¾ç½®å˜é‡å¤±è´¥'}}catch(t){return{success:!1,command:e,error:t instanceof Error?t.message:'æ‰§è¡Œå‘½ä»¤å¤±è´¥'}}};let G=0;return{mvuData:e,isMvuAvailable:t,isLoading:a,error:n,currentOptions:o,statData:g,displayData:h,deltaData:y,initializedLorebooks:V,allVariableKeys:N,initialize:k,loadMvuData:A,refresh:async()=>{await A()},getVariable:D,setVariable:M,setVariables:async(e,t)=>{try{n.value=null;const a=await Mn.setVariables(e,{...o.value,reason:t});return a&&await A(),a}catch(e){return n.value=e instanceof Error?e.message:'æ‰¹é‡è®¾ç½®å˜é‡å¤±è´¥',!1}},updateVariable:async(e,t,a)=>{try{n.value=null;const o=t(D(e));return await M(e,o,a)}catch(e){return n.value=e instanceof Error?e.message:'æ›´æ–°å˜é‡å¤±è´¥',!1}},watchVariable:(e,t)=>{const a={path:e,callback:t};return s.value.push(a),()=>{const e=s.value.indexOf(a);e>-1&&s.value.splice(e,1)}},onUpdateEnd:x,switchOptions:async e=>{o.value=e,await A()},clearError:()=>{n.value=null},onChatSwitch:async()=>{console.log('[MvuStore] æ£€æµ‹åˆ°èŠå¤©åˆ‡æ¢ï¼Œé‡æ–°åˆå§‹åŒ–...'),e.value=null,n.value=null,a.value=!0,await T(),t.value&&await k(o.value),a.value=!1},destroy:()=>{b(),s.value=[],r.value=[]},registerEventListeners:E,unregisterEventListeners:b,extractUpdateVariableContent:R,parseCommand:e=>{const t=O(e);return t.length>0?t[0]:null},executeCommand:H,parseAndExecuteCommands:async t=>{const a=[];i.value=!0;try{const l=R(t);if(!l)return{success:!0,results:a,error:'æœªæ‰¾åˆ°UpdateVariableæ ‡ç­¾'};console.log('[MvuStore] æå–åˆ°UpdateVariableå†…å®¹ï¼Œé•¿åº¦:',l.length);const s=e.value?JSON.parse(JSON.stringify(e.value)):null,r=await(async t=>{const a=Dn();if(!a)return console.warn('[MvuStore] ensureBasicStructure: MVUå…¨å±€å¯¹è±¡ä¸å¯ç”¨'),!1;let l=t||e.value;l||(l=Mn.getMvuData(o.value)),l||(console.log('[MvuStore] åˆ›å»ºæ–°çš„ MVU æ•°æ®ç»“æ„...'),l={stat_data:{},display_data:{},delta_data:{},initialized_lorebooks:[]}),l.stat_data||(l.stat_data={});const s=l.stat_data.MC;if(s&&'object'==typeof s&&Object.keys(s).length>0)return console.log('[MvuStore] MC å¯¹è±¡å·²å­˜åœ¨ï¼Œè·³è¿‡åˆå§‹åŒ–'),!0;if(!s||'object'!=typeof s){console.log('[MvuStore] åˆå§‹åŒ–ç©ºçš„ MC å¯¹è±¡...'),l.stat_data.MC={};try{return await a.replaceMvuData(l,o.value),e.value=JSON.parse(JSON.stringify(l)),console.log('[MvuStore] MC åŸºç¡€ç»“æ„åˆå§‹åŒ–å®Œæˆ'),!0}catch(e){return console.error('[MvuStore] ä¿å­˜ MC åŸºç¡€ç»“æ„å¤±è´¥:',e),n.value='åˆå§‹åŒ–åŸºç¡€ç»“æ„å¤±è´¥: '+(e instanceof Error?e.message:String(e)),!1}}return!0})(s);r||console.warn('[MvuStore] åŸºç¡€ç»“æ„åˆå§‹åŒ–å¤±è´¥ï¼Œå°è¯•ç»§ç»­æ‰§è¡Œå‘½ä»¤...');const c=e.value?JSON.parse(JSON.stringify(e.value)):null,i=Dn();if(i&&'function'==typeof i.parseMessage&&(console.log('[MvuStore] å°è¯•ä½¿ç”¨ MVU åŸç”Ÿ parseMessage è§£æ...'),c))try{const t=JSON.parse(JSON.stringify(c));console.log('[MvuStore] parseMessage ä½¿ç”¨çš„æ•°æ®ï¼Œstat_data é”®:',Object.keys(t.stat_data||{})),await(async(e,t)=>{const a=(e=>{const t=[],a=/_\.assign\s*\(\s*['"]([^'"]+)['"]/gi;let n;for(;null!==(n=a.exec(e));){const e=n[1];e&&!t.includes(e)&&t.push(e)}return t})(e);if(0===a.length)return;console.log('[MvuStore] å‘ç° _.assign å‘½ä»¤ï¼Œéœ€è¦ç¡®ä¿ä»¥ä¸‹çˆ¶è·¯å¾„å­˜åœ¨:',a),t.stat_data||(t.stat_data={});let n=!1;for(const e of a){const a=e.split('.');let o=t.stat_data;for(let e=0;e<a.length;e++){const t=a[e];if(void 0===o[t]||null===o[t])console.log(`[MvuStore] åˆ›å»ºç¼ºå¤±è·¯å¾„: ${a.slice(0,e+1).join('.')}`),o[t]={},n=!0;else if('object'!=typeof o[t]){console.warn(`[MvuStore] è·¯å¾„ "${a.slice(0,e+1).join('.')}" ä¸æ˜¯å¯¹è±¡ï¼Œè·³è¿‡`);break}o=o[t]}}if(n){const e=Dn();if(e)try{await e.replaceMvuData(t,o.value),console.log('[MvuStore] å·²ä¿å­˜åˆ›å»ºçš„è·¯å¾„ç»“æ„')}catch(e){console.error('[MvuStore] ä¿å­˜è·¯å¾„ç»“æ„å¤±è´¥:',e)}}})(l,t);const a=await i.parseMessage(l,t);if(a){const n=Object.keys(a.stat_data||{}),l=Object.keys(t.stat_data||{});if(console.log('[MvuStore] parseMessage ç»“æœéªŒè¯:',{oldKeys:l.length,newKeys:n.length}),l.length>0&&0===n.length)throw console.warn('[MvuStore] parseMessage è¿”å›çš„æ•°æ®ä¸¢å¤±äº†æ‰€æœ‰é”®ï¼Œå°è¯•æ¢å¤...'),s&&(e.value=s),new Error('parseMessage è¿”å›æ•°æ®ä¸å®Œæ•´');return await i.replaceMvuData(a,o.value),e.value=JSON.parse(JSON.stringify(a)),console.log('[MvuStore] MVU parseMessage æ‰§è¡ŒæˆåŠŸï¼Œæœ¬åœ°ç¼“å­˜å·²æ›´æ–°'),console.log('[MvuStore] æ›´æ–°åçš„ stat_data é”®:',Object.keys(a.stat_data||{})),f(),{success:!0,results:[{success:!0,command:{type:'SET',path:'MVU_NATIVE',value:null}}],error:void 0}}console.log('[MvuStore] MVU parseMessage è¿”å› undefinedï¼Œå°è¯•è‡ªå®šä¹‰è§£æ...')}catch(e){console.warn('[MvuStore] MVU parseMessage å¤±è´¥ï¼Œå›é€€åˆ°è‡ªå®šä¹‰è§£æ:',e)}console.log('[MvuStore] ä½¿ç”¨è‡ªå®šä¹‰è§£æå™¨...');const u=O(l);console.log('[MvuStore] è§£æåˆ°',u.length,'æ¡å‘½ä»¤');for(const e of u){const t=await H(e);a.push(t),t.success?console.log(`[MvuStore] å‘½ä»¤æ‰§è¡ŒæˆåŠŸ: ${e.type}('${e.path}')`):console.warn(`[MvuStore] å‘½ä»¤æ‰§è¡Œå¤±è´¥: ${e.type}('${e.path}') - ${t.error}`)}const d=a.every(e=>e.success),m=a.filter(e=>e.success).length,v=a.length-m,p=Mn.getMvuData(o.value);if(p){const t=Object.keys(p.stat_data||{});Object.keys(e.value?.stat_data||{}).length>0&&0===t.length?console.warn('[MvuStore] æœ€æ–°æ•°æ®ä¸¢å¤±äº†æ‰€æœ‰é”®ï¼Œä¿æŒç°æœ‰æ•°æ®ä¸å˜'):(e.value=JSON.parse(JSON.stringify(p)),console.log('[MvuStore] æœ¬åœ°ç¼“å­˜å·²åŒæ­¥ï¼Œstat_data é”®:',t))}return console.log(`[MvuStore] å‘½ä»¤æ‰§è¡Œå®Œæˆ: ${m}æˆåŠŸ, ${v}å¤±è´¥`),f(),{success:d,results:a,error:d?void 0:`${v}æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥`}}catch(e){console.error('[MvuStore] è§£ææ‰§è¡Œå‘½ä»¤å¤±è´¥:',e);try{await A()}catch(e){console.error('[MvuStore] åˆ·æ–°MVUæ•°æ®å¤±è´¥:',e)}return{success:!1,results:a,error:e instanceof Error?e.message:'è§£ææ‰§è¡Œå‘½ä»¤å¤±è´¥'}}finally{const e=()=>{G=Math.max(0,G-1),0===G&&(i.value=!1,console.log('[MvuStore] å†…éƒ¨æ›´æ–°æ ‡å¿—å·²æ¸…é™¤'))};let t=!1;const a=x(()=>{t||(t=!0,a(),e())});setTimeout(()=>{t||(a(),e(),console.log('[MvuStore] å†…éƒ¨æ›´æ–°æ ‡å¿—è¶…æ—¶æ¸…é™¤'))},500)}}}}),Tn=t('app',()=>{const e=(0,l.ref)({isFullscreen:!1,theme:'dark',language:'zh-CN',volume:1,isMuted:!1}),t=(0,l.ref)(!0),a=(0,l.ref)(!1),n=(0,l.ref)(null),o=(0,l.ref)([]),s=()=>{try{if('undefined'!=typeof window){const e=window.SillyTavern;if(e){if(e.chatId)return String(e.chatId);if('function'==typeof e.getCurrentChatId){const t=e.getCurrentChatId();if(t)return String(t)}}if('function'==typeof window.getContext){const e=window.getContext();if(e?.chatId)return String(e.chatId)}}return null}catch{return null}},r=async()=>{const e=s();if(e===n.value)return void console.log('[AppStore] èŠå¤©IDæœªå˜åŒ–ï¼Œè·³è¿‡åˆ‡æ¢å¤„ç†');console.log('[AppStore] æ£€æµ‹åˆ°èŠå¤©åˆ‡æ¢:',n.value,'->',e),n.value=e;const t=xn();if(t.isMvuAvailable)try{await t.onChatSwitch(),console.log('[AppStore] MVU StoreèŠå¤©åˆ‡æ¢å¤„ç†å®Œæˆ')}catch(e){console.error('[AppStore] MVU StoreèŠå¤©åˆ‡æ¢å¤„ç†å¤±è´¥:',e)}for(const e of o.value)try{await e()}catch(e){console.error('[AppStore] èŠå¤©åˆ‡æ¢å›è°ƒæ‰§è¡Œå¤±è´¥:',e)}},c=(0,l.ref)(0);let i=null;const u=async(e=5e3,t=100)=>{const a=Date.now();for(console.log('[AppStore] ç­‰å¾…é…’é¦†ç¯å¢ƒå°±ç»ª...');Date.now()-a<e;){const e='function'==typeof window.eventOn,a=void 0!==window.Mvu,n='function'==typeof window.generate,o=void 0!==window.TavernHelper,l=s();if(e&&a&&n&&o&&!!l)return console.log('[AppStore] é…’é¦†ç¯å¢ƒå·²å°±ç»ª:',{eventOn:e,Mvu:a,generate:n,TavernHelper:o,chatId:l}),!0;await new Promise(e=>setTimeout(e,t))}return console.warn('[AppStore] ç­‰å¾…é…’é¦†ç¯å¢ƒè¶…æ—¶ï¼Œç»§ç»­åˆå§‹åŒ–ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨ï¼‰'),!1},d=async()=>{const e=xn();if('undefined'!=typeof window)try{if(await e.initialize(),e.isMvuAvailable&&e.mvuData)return console.log('[AppStore] MVU Storeåˆå§‹åŒ–æˆåŠŸ'),void(c.value=0);e.isMvuAvailable||(console.warn('[AppStore] MVUæ¡†æ¶æš‚ä¸å¯ç”¨ï¼Œå°†å®‰æ’é‡è¯•...'),m())}catch(e){console.warn('[AppStore] MVUåˆå§‹åŒ–å¤±è´¥ï¼Œå°†å®‰æ’é‡è¯•:',e),m()}else console.log('[AppStore] éæµè§ˆå™¨ç¯å¢ƒï¼Œè·³è¿‡MVUåˆå§‹åŒ–')},m=()=>{if(c.value>=5)return console.error('[AppStore] MVUåˆå§‹åŒ–é‡è¯•å·²è¾¾æœ€å¤§æ¬¡æ•°ï¼Œæ”¾å¼ƒé‡è¯•'),void('undefined'!=typeof toastr&&toastr.warning('å˜é‡ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨ã€‚è¯·å°è¯•åˆ·æ–°é¡µé¢ã€‚','åˆå§‹åŒ–è­¦å‘Š',{timeOut:5e3}));i&&clearTimeout(i),c.value++;const e=1e3*c.value;console.log(`[AppStore] å°†åœ¨ ${e}ms åè¿›è¡Œç¬¬ ${c.value} æ¬¡MVUåˆå§‹åŒ–é‡è¯•...`),i=setTimeout(async()=>{const e=xn();try{await e.initialize(),e.isMvuAvailable&&e.mvuData?(console.log('[AppStore] MVU Storeé‡è¯•åˆå§‹åŒ–æˆåŠŸ'),c.value=0,'undefined'!=typeof toastr&&toastr.success('å˜é‡ç³»ç»Ÿå·²å°±ç»ª','åˆå§‹åŒ–æˆåŠŸ',{timeOut:2e3})):m()}catch(e){console.warn(`[AppStore] ç¬¬ ${c.value} æ¬¡MVUåˆå§‹åŒ–é‡è¯•å¤±è´¥:`,e),m()}},e)};return{state:e,isInitialized:a,currentChatId:n,streamingEnabled:t,mvuInitRetryCount:c,initialize:async()=>{if(!a.value){console.log('[AppStore] æ­£åœ¨åˆå§‹åŒ–MCæˆ¿å­åº”ç”¨...');try{const a=localStorage.getItem('mc-app-theme');a&&(e.value.theme=a);const n=localStorage.getItem('mc-app-language');n&&(e.value.language=n);const o=localStorage.getItem('mc-app-volume');o&&(e.value.volume=parseFloat(o));const l=localStorage.getItem('mc-app-muted');l&&(e.value.isMuted='true'===l);const s=localStorage.getItem('mc-app-streaming');null!==s&&(t.value='true'===s)}catch(e){console.warn('[AppStore] åŠ è½½è®¾ç½®å¤±è´¥:',e)}n.value=s(),console.log('[AppStore] åˆå§‹èŠå¤©ID:',n.value),(()=>{try{if('undefined'==typeof window)return;if('function'==typeof window.eventOn)if(void 0!==window.iframe_events){const e=window.iframe_events;e.CHAT_CHANGED&&(window.eventOn(e.CHAT_CHANGED,r),console.log('[AppStore] å·²æ³¨å†ŒèŠå¤©åˆ‡æ¢äº‹ä»¶ç›‘å¬å™¨ (CHAT_CHANGED)'))}else window.eventOn('js_chat_changed',r),console.log('[AppStore] å·²æ³¨å†ŒèŠå¤©åˆ‡æ¢äº‹ä»¶ç›‘å¬å™¨ (js_chat_changed)');const e=window.SillyTavern;e?.eventSource?.on&&e.eventTypes?.CHAT_CHANGED&&(e.eventSource.on(e.eventTypes.CHAT_CHANGED,r),console.log('[AppStore] å·²é€šè¿‡SillyTavern.eventSourceæ³¨å†ŒèŠå¤©åˆ‡æ¢ç›‘å¬å™¨'))}catch(e){console.warn('[AppStore] è®¾ç½®èŠå¤©åˆ‡æ¢ç›‘å¬å™¨å¤±è´¥:',e)}})(),await u(),await d(),a.value=!0,console.log('[AppStore] MCæˆ¿å­åº”ç”¨åˆå§‹åŒ–å®Œæˆ')}},toggleFullscreen:()=>{e.value.isFullscreen=!e.value.isFullscreen},toggleTheme:()=>{e.value.theme='dark'===e.value.theme?'light':'dark',localStorage.setItem('mc-app-theme',e.value.theme),'light'===e.value.theme?document.documentElement.classList.add('light-theme'):document.documentElement.classList.remove('light-theme')},setTheme:t=>{e.value.theme=t,localStorage.setItem('mc-app-theme',t),'light'===t?document.documentElement.classList.add('light-theme'):document.documentElement.classList.remove('light-theme')},setLanguage:t=>{e.value.language=t,localStorage.setItem('mc-app-language',t)},setVolume:t=>{e.value.volume=Math.max(0,Math.min(1,t)),localStorage.setItem('mc-app-volume',String(e.value.volume))},toggleMute:()=>{e.value.isMuted=!e.value.isMuted,localStorage.setItem('mc-app-muted',String(e.value.isMuted))},setMuted:t=>{e.value.isMuted=t,localStorage.setItem('mc-app-muted',String(t))},toggleStreaming:()=>{t.value=!t.value,localStorage.setItem('mc-app-streaming',String(t.value)),console.log('[AppStore] æµå¼ä¼ è¾“:',t.value?'å¼€å¯':'å…³é—­')},setStreaming:e=>{t.value=e,localStorage.setItem('mc-app-streaming',String(e)),console.log('[AppStore] æµå¼ä¼ è¾“:',e?'å¼€å¯':'å…³é—­')},onChatSwitch:e=>(o.value.push(e),()=>{const t=o.value.indexOf(e);t>-1&&o.value.splice(t,1)}),handleChatSwitch:r,getCurrentChatId:s,retryMvuInitialization:async()=>{console.log('[AppStore] ç”¨æˆ·æ‰‹åŠ¨è§¦å‘MVUé‡æ–°åˆå§‹åŒ–...'),c.value=0;const e=xn();try{return await e.initialize(),!(!e.isMvuAvailable||!e.mvuData)&&(console.log('[AppStore] MVU Storeæ‰‹åŠ¨é‡æ–°åˆå§‹åŒ–æˆåŠŸ'),!0)}catch(e){return console.error('[AppStore] MVU Storeæ‰‹åŠ¨é‡æ–°åˆå§‹åŒ–å¤±è´¥:',e),!1}}}}),$n=['title'],_n={class:'collapse-icon'},Rn={class:'nav-menu'},On=['onClick'],Fn={class:'nav-icon'},Ln={key:0,class:'nav-label'},Pn={key:1,class:'lite-tag'},jn={key:0,class:'info-panels desktop-only'},Un={class:'info-panel settings-panel'},zn={class:'panel-body'},Wn={class:'setting-item'},Hn={class:'toggle-switch'},Gn=['checked'],Jn={class:'setting-hint'},qn={class:'sidebar-footer'},Kn={class:'mobile-settings'},Yn={class:'mobile-setting-item'},Xn={class:'toggle-switch small'},Zn=['checked'],Qn={key:0,class:'nav-label'},eo={key:0,class:'nav-label'},to={key:0,class:'nav-label'},ao={key:0,class:'nav-label'},no={key:0,class:'nav-label'},oo={key:0,class:'nav-label'},lo=(0,l.defineComponent)({__name:'Sidebar',props:{activeMenu:{default:'workplace'},collapsed:{type:Boolean,default:!1},unreadNotifications:{default:0},mobileVisible:{type:Boolean,default:!1}},emits:['menu-change','update:collapsed','open-help','open-ai-filter','open-save-manager','open-context-manager','open-history-text','open-changelog','open-variable-manager','view-notice','close-mobile'],setup(e,{emit:t}){const a=e,n=t,o=(0,l.ref)(a.collapsed),s=Tn(),r=(0,l.computed)(()=>s.streamingEnabled),c=()=>{s.toggleStreaming()},i=(0,l.computed)(()=>[{id:'workplace',icon:'ğŸ–¥ï¸',label:'æˆ‘çš„å·¥ä½'},{id:'personnel',icon:'ğŸ‘¥',label:'äººäº‹ç³»ç»Ÿ',liteTag:!0},{id:'handbook',icon:'ğŸ“–',label:'æ–‡æ¡£æŸ¥çœ‹'},{id:'forms',icon:'ğŸ“',label:'è¡¨å•ç”³è¯·'}]),u=()=>{o.value=!o.value,n('update:collapsed',o.value)};return(t,s)=>((0,l.openBlock)(),(0,l.createElementBlock)('aside',{class:(0,l.normalizeClass)(['sidebar',{'is-collapsed':o.value,'is-visible':e.mobileVisible}])},[(0,l.createCommentVNode)(' ç§»åŠ¨ç«¯å…³é—­æŒ‰é’® '),(0,l.createElementVNode)('button',{class:'mobile-close-btn',title:'å…³é—­èœå•',onClick:s[0]||(s[0]=e=>t.$emit('close-mobile'))},[...s[7]||(s[7]=[(0,l.createElementVNode)('span',{class:'close-icon'},'âœ•',-1)])]),(0,l.createCommentVNode)(' æŠ˜å æŒ‰é’®ï¼ˆä»…æ¡Œé¢ç«¯æ˜¾ç¤ºï¼‰ '),(0,l.createElementVNode)('button',{class:'collapse-btn',title:o.value?'å±•å¼€èœå•':'æ”¶èµ·èœå•',onClick:u},[(0,l.createElementVNode)('span',_n,(0,l.toDisplayString)(o.value?'â—€':'â–¶'),1)],8,$n),(0,l.createCommentVNode)(' å¯¼èˆªèœå• '),(0,l.createElementVNode)('nav',Rn,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(i.value,t=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t.id,class:(0,l.normalizeClass)(['nav-item',{'is-active':e.activeMenu===t.id,'is-disabled':t.disabled}]),onClick:e=>{return o=t.id,void(t.disabled||(n('menu-change',o),a.mobileVisible&&n('close-mobile')));var o}},[(0,l.createElementVNode)('span',Fn,(0,l.toDisplayString)(t.icon),1),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',Ln,(0,l.toDisplayString)(t.label),1)),!o.value&&t.liteTag?((0,l.openBlock)(),(0,l.createElementBlock)('span',Pn,'Lite')):(0,l.createCommentVNode)('v-if',!0)],10,On))),128))]),(0,l.createCommentVNode)(' ä¿¡æ¯é¢æ¿åŒºåŸŸï¼ˆå±•å¼€æ—¶æ˜¾ç¤ºï¼Œæ¡Œé¢ç«¯ï¼‰ '),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('div',jn,[(0,l.createCommentVNode)(' è®¾ç½®é¢æ¿ '),(0,l.createElementVNode)('div',Un,[s[10]||(s[10]=(0,l.createElementVNode)('div',{class:'panel-header'},[(0,l.createElementVNode)('span',{class:'panel-icon'},'âš™ï¸'),(0,l.createElementVNode)('span',{class:'panel-title'},'è®¾ç½®')],-1)),(0,l.createElementVNode)('div',zn,[(0,l.createCommentVNode)(' æµå¼ä¼ è¾“å¼€å…³ '),(0,l.createElementVNode)('div',Wn,[s[9]||(s[9]=(0,l.createElementVNode)('div',{class:'setting-label'},[(0,l.createElementVNode)('span',{class:'setting-icon'},'ğŸ“¡'),(0,l.createElementVNode)('span',{class:'setting-text'},'æµå¼ä¼ è¾“')],-1)),(0,l.createElementVNode)('label',Hn,[(0,l.createElementVNode)('input',{type:'checkbox',checked:r.value,onChange:c},null,40,Gn),s[8]||(s[8]=(0,l.createElementVNode)('span',{class:'toggle-slider'},null,-1))])]),(0,l.createElementVNode)('div',Jn,(0,l.toDisplayString)(r.value?'å®æ—¶æ˜¾ç¤ºAIå›å¤':'ç­‰å¾…å®Œæ•´å›å¤'),1)])]),(0,l.createCommentVNode)(' Liteç‰ˆæœ¬æç¤º '),s[11]||(s[11]=(0,l.createStaticVNode)('<div class="info-panel lite-info-panel" data-v-75b31306><div class="panel-header" data-v-75b31306><span class="panel-icon" data-v-75b31306>ğŸ’¡</span><span class="panel-title" data-v-75b31306>Liteç‰ˆæœ¬</span></div><div class="panel-body" data-v-75b31306><div class="lite-notice" data-v-75b31306><p data-v-75b31306>å½“å‰ä¸ºMCliteç®€åŒ–ç‰ˆ</p><p class="lite-detail" data-v-75b31306>éƒ¨åˆ†åŠŸèƒ½å·²ç®€åŒ–æˆ–ç¦ç”¨</p></div></div></div>',1))])),(0,l.createCommentVNode)(' åº•éƒ¨å¿«æ·æ“ä½œ '),(0,l.createElementVNode)('div',qn,[(0,l.createCommentVNode)(' ç§»åŠ¨ç«¯æµå¼ä¼ è¾“è®¾ç½®ï¼ˆç´§å‡‘ç‰ˆï¼‰ '),(0,l.createElementVNode)('div',Kn,[(0,l.createElementVNode)('div',Yn,[s[13]||(s[13]=(0,l.createElementVNode)('span',{class:'setting-icon'},'ğŸ“¡',-1)),s[14]||(s[14]=(0,l.createElementVNode)('span',{class:'setting-text'},'æµå¼',-1)),(0,l.createElementVNode)('label',Xn,[(0,l.createElementVNode)('input',{type:'checkbox',checked:r.value,onChange:c},null,40,Zn),s[12]||(s[12]=(0,l.createElementVNode)('span',{class:'toggle-slider'},null,-1))])])]),s[21]||(s[21]=(0,l.createElementVNode)('div',{class:'divider'},null,-1)),(0,l.createCommentVNode)(' æ ¸å¿ƒåŠŸèƒ½æŒ‰é’® '),(0,l.createElementVNode)('div',{class:'nav-item footer-item highlight-item',onClick:s[1]||(s[1]=e=>t.$emit('open-save-manager'))},[s[15]||(s[15]=(0,l.createElementVNode)('span',{class:'nav-icon'},'ğŸ’¾',-1)),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',Qn,'å­˜æ¡£ç®¡ç†'))]),(0,l.createElementVNode)('div',{class:'nav-item footer-item highlight-item',onClick:s[2]||(s[2]=e=>t.$emit('open-context-manager'))},[s[16]||(s[16]=(0,l.createElementVNode)('span',{class:'nav-icon'},'ğŸ“š',-1)),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',eo,'ä¸Šä¸‹æ–‡ç®¡ç†'))]),(0,l.createElementVNode)('div',{class:'nav-item footer-item highlight-item secondary',onClick:s[3]||(s[3]=e=>t.$emit('open-history-text'))},[s[17]||(s[17]=(0,l.createElementVNode)('span',{class:'nav-icon'},'ğŸ“œ',-1)),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',to,'å†å²æ­£æ–‡'))]),(0,l.createElementVNode)('div',{class:'nav-item footer-item highlight-item dev-tool',onClick:s[4]||(s[4]=e=>t.$emit('open-variable-manager'))},[s[18]||(s[18]=(0,l.createElementVNode)('span',{class:'nav-icon'},'ğŸ”§',-1)),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',ao,'å˜é‡ç®¡ç†å™¨'))]),s[22]||(s[22]=(0,l.createElementVNode)('div',{class:'divider'},null,-1)),(0,l.createElementVNode)('div',{class:'nav-item footer-item',onClick:s[5]||(s[5]=e=>t.$emit('open-changelog'))},[s[19]||(s[19]=(0,l.createElementVNode)('span',{class:'nav-icon'},'ğŸ“‹',-1)),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',no,'æ›´æ–°æ—¥å¿—'))]),(0,l.createElementVNode)('div',{class:'nav-item footer-item',onClick:s[6]||(s[6]=e=>t.$emit('open-help'))},[s[20]||(s[20]=(0,l.createElementVNode)('span',{class:'nav-icon'},'â“',-1)),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',oo,'å¸®åŠ©è¯´æ˜'))]),(0,l.createCommentVNode)(' AIè¿‡æ»¤æµ‹è¯•æŒ‰é’®å·²éšè—ï¼ˆåŠŸèƒ½å·²ç¦ç”¨ï¼‰\r\n      <div class="nav-item footer-item debug-item" @click="$emit(\'open-ai-filter\')">\r\n        <span class="nav-icon">ğŸ”¬</span>\r\n        <span v-if="!isCollapsed" class="nav-label">AIè¿‡æ»¤æµ‹è¯•</span>\r\n      </div>\r\n      ')])],2))}}),so=(0,I.A)(lo,[['__scopeId','data-v-75b31306']]),ro='MC.èŠ±åå†Œ',co={$meta:{extensible:!0,version:'2.0'},$schema:{primaryKey:'',displayField:'',groupByField:'',fields:{$meta:{extensible:!0}},groups:{$meta:{extensible:!0}}},entries:{$meta:{extensible:!0}}},io={$meta:{extensible:!0}};function uo(e){return e.startsWith('$')}function mo(e){return Object.keys(e).filter(e=>!uo(e))}function vo(e){return mo(e.fields).map(t=>({id:t,...e.fields[t]})).sort((e,t)=>(e.order??999)-(t.order??999))}function po(e){const t={};for(const a of Object.keys(e)){if(uo(a))continue;const n=e[a];n&&'object'==typeof n&&!('extensible'in n)&&(t[a]=n)}return t}function fo(e){const t={$meta:{extensible:!0}};for(const a of e)t[a.fieldId]={label:a.label,type:a.type,description:a.description,showInList:a.showInList,showInSummary:a.showInSummary,order:a.order,options:a.options,default:a.default};return t}function go(e){if(!e||'object'!=typeof e)return!1;return'$schemaRef'in e||!('entries'in e&&'$schema'in e)}function ho(e){if(!e||'object'!=typeof e)return!1;return'$schema'in e&&'entries'in e}class yo{static parseAllRosterSchemas(e){const t={},a={},n={},o={};for(const[t,l]of Object.entries(e)){if('$meta'===t||!l||'object'!=typeof l)continue;if(!('title'in l))continue;const e=l;if(e.$rosterMeta){const a=e.$rosterMeta;o[a.rosterId]={meta:a,sourceDocId:t}}e.sections&&this.traverseSections(e.sections,a,n)}for(const[e,{meta:l,sourceDocId:s}]of Object.entries(o))t[e]={meta:l,fields:(a[e]||[]).sort((e,t)=>e.order-t.order),groups:(n[e]||[]).sort((e,t)=>e.order-t.order),sourceDocId:s};return t}static traverseSections(e,t,a){for(const[n,o]of Object.entries(e))if(o&&'object'==typeof o&&'$meta'!==n){if(o.$groupDef){const e=o.$groupDef,t=e.belongsTo;a[t]||(a[t]=[]),a[t].push(e)}if(o.$fieldDef){const e=Array.isArray(o.$fieldDef)?o.$fieldDef:[o.$fieldDef];for(const a of e)a.belongsTo&&(t[a.belongsTo]||(t[a.belongsTo]=[]),t[a.belongsTo].push(a))}o.children&&this.traverseSections(o.children,t,a)}}static getRosterSchema(e,t){return this.parseAllRosterSchemas(e)[t]||null}static getSchemaFromRef(e,t){const a=t.split('.');if(a.length<3||'MC'!==a[0]||'æ–‡æ¡£'!==a[1])return console.warn('[RosterSchemaParser] æ— æ•ˆçš„ schemaRef è·¯å¾„:',t),null;const n=a.slice(2).join('.'),o=e[n];if(!o||'object'!=typeof o||!('title'in o))return console.warn('[RosterSchemaParser] æœªæ‰¾åˆ°æ–‡æ¡£:',n),null;const l=o;if(!l.$rosterMeta)return console.warn('[RosterSchemaParser] æ–‡æ¡£ä¸­æ²¡æœ‰ $rosterMeta:',n),null;const s=l.$rosterMeta,r={},c={};return l.sections&&this.traverseSections(l.sections,r,c),{meta:s,fields:(r[s.rosterId]||[]).sort((e,t)=>e.order-t.order),groups:(c[s.rosterId]||[]).sort((e,t)=>e.order-t.order),sourceDocId:n}}static toRosterSchema(e){const t=fo(e.fields),a={$meta:{extensible:!0}},n=[...e.groups].sort((e,t)=>e.order-t.order),o=[...e.fields].sort((e,t)=>e.order-t.order);if(0===n.length)a._default={label:'åŸºæœ¬ä¿¡æ¯',order:0,collapsed:!1,fields:o.map(e=>e.fieldId)};else{const e=[];let t=[];for(let a=0;a<o.length;a++){const n=o[a],l=o[a-1];if(l&&n.order-l.order>5){if(t.length>0){const a=t.reduce((e,t)=>e+t.order,0)/t.length;e.push({fields:[...t],avgOrder:a})}t=[n]}else t.push(n)}if(t.length>0){const a=t.reduce((e,t)=>e+t.order,0)/t.length;e.push({fields:[...t],avgOrder:a})}const l={};for(const e of n)l[e.groupId]=[];for(const t of e){let e=n[0],a=Math.abs(t.avgOrder-e.order);for(const o of n){const n=Math.abs(t.avgOrder-o.order);n<a&&(a=n,e=o)}l[e.groupId].push(...t.fields.map(e=>e.fieldId))}for(const e of n)a[e.groupId]={label:e.label,order:e.order,collapsed:e.collapsed,fields:l[e.groupId]}}const l=new Set(Object.values(a).filter(e=>'fields'in e).flatMap(e=>e.fields)),s=o.filter(e=>!l.has(e.fieldId)).map(e=>e.fieldId);return s.length>0&&(a._ungrouped={label:'å…¶ä»–ä¿¡æ¯',order:999,collapsed:!0,fields:s}),{$meta:{extensible:!0},primaryKey:e.meta.primaryKey,displayField:e.meta.displayField,groupByField:e.meta.groupByField||'',fields:t,groups:a}}}const Vo=t('roster',()=>{const e=xn(),t=(0,l.ref)(!1),a=(0,l.ref)(!1),n=(0,l.ref)(null),o=(0,l.ref)(null),s=(0,l.ref)(0);let r=null;const c=()=>{s.value;return e.getVariable(ro,null)},i=(0,l.computed)(()=>go(c())),u=(0,l.computed)(()=>{const t=c();if(ho(t))return t;if(go(t)){const a=t,n=po(a);let o=co.$schema;if(a.$schemaRef){const t=(s.value,e.getVariable('MC.æ–‡æ¡£',{})),n=yo.getSchemaFromRef(t,a.$schemaRef);n&&(o=yo.toRosterSchema(n))}return{$meta:{extensible:!0,version:'2.0'},$schema:o,entries:{$meta:{extensible:!0},...n}}}return co}),d=(0,l.computed)(()=>{const e=c();return go(e)?e:io}),m=(0,l.computed)(()=>u.value.$schema),v=(0,l.computed)(()=>{const e=c();if(go(e))return po(e);if(ho(e)){const t=e.entries||{},a={};for(const e of mo(t)){const n=t[e];n&&'object'==typeof n&&!('extensible'in n)&&(a[e]=n)}return a}return{}}),p=(0,l.computed)(()=>Object.values(v.value)),f=(0,l.computed)(()=>p.value.length),g=(0,l.computed)(()=>0===f.value),h=(0,l.computed)(()=>vo(m.value)),y=(0,l.computed)(()=>function(e){return mo(e.groups).map(t=>({id:t,...e.groups[t]})).sort((e,t)=>(e.order??999)-(t.order??999))}(m.value)),V=(0,l.computed)(()=>function(e){return vo(e).filter(e=>e.showInList)}(m.value)),N=(0,l.computed)(()=>function(e){return vo(e).filter(e=>e.showInSummary)}(m.value)),E=(0,l.computed)(()=>{const e=m.value.groupByField;if(!e)return{å…¨éƒ¨:p.value};const t={};for(const a of p.value){const n=String(a[e]||'æœªåˆ†ç»„');t[n]||(t[n]=[]),t[n].push(a)}return t}),b=(0,l.computed)(()=>Object.keys(E.value)),k=(0,l.computed)(()=>o.value?v.value[o.value]:null),C=e=>{const t=m.value.fields[e];return t&&'object'==typeof t&&'label'in t?t:void 0},S=e=>{const t=m.value.groups[e];return t&&'object'==typeof t&&'label'in t?t:void 0},w=e=>v.value[e];return{isInitialized:t,isLoading:a,error:n,selectedEntryId:o,updateVersion:s,isV3Format:i,roster:u,rosterV3:d,schema:m,entries:v,entriesArray:p,entryCount:f,isEmpty:g,fieldsSorted:h,groupsSorted:y,listFields:V,summaryFields:N,entriesByGroup:E,groupNames:b,selectedEntry:k,initialize:async()=>{if(!t.value)try{a.value=!0,e.isMvuAvailable||await e.initialize(),r||(r=e.onUpdateEnd(()=>{console.log('[RosterStore] æ”¶åˆ° MVU æ›´æ–°ç»“æŸäº‹ä»¶ï¼Œè§¦å‘åˆ·æ–°'),s.value++})),t.value=!0,console.log('[RosterStore] åˆå§‹åŒ–å®Œæˆï¼Œå½“å‰æ ¼å¼:',i.value?'v3':'v2')}catch(e){n.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥'}finally{a.value=!1}},refresh:async()=>{await e.refresh(),s.value++},destroy:()=>{r&&(r(),r=null)},selectEntry:e=>{o.value=e},getField:C,getGroup:S,getFieldsForGroup:e=>{const t=S(e);return t?t.fields.map(e=>{const t=C(e);return t?{id:e,...t}:null}).filter(e=>null!==e):[]},getEntry:w,getEntryDisplayValue:e=>{const t=m.value.displayField;return t?String(e[t]||''):''},getEntryPrimaryKey:e=>{const t=m.value.primaryKey;return t?String(e[t]||''):''},addEntry:async(t,a)=>{if(i.value){const n=`${ro}.${t}`;return await e.setVariable(n,a,'æ·»åŠ æ¡ç›®')}const n=`${ro}.entries.${t}`;return await e.setVariable(n,a,'æ·»åŠ æ¡ç›®')},updateEntry:async(t,a)=>{const n=w(t);if(!n)return!1;if(i.value){const o=`${ro}.${t}`;return await e.setVariable(o,{...n,...a},'æ›´æ–°æ¡ç›®')}const o=`${ro}.entries.${t}`;return await e.setVariable(o,{...n,...a},'æ›´æ–°æ¡ç›®')},removeEntry:async t=>{if(i.value){const a=d.value,n={};for(const e of Object.keys(a))e!==t&&(n[e]=a[e]);return await e.setVariable(ro,n,'åˆ é™¤æ¡ç›®')}const a={...v.value};return delete a[t],await e.setVariable(`${ro}.entries`,a,'åˆ é™¤æ¡ç›®')},addField:async(t,a)=>{if(i.value)return console.warn('[RosterStore] æ–°ç‰ˆæ ¼å¼ä¸æ”¯æŒç›´æ¥ä¿®æ”¹ Schemaï¼Œè¯·ä¿®æ”¹è§„ç« åˆ¶åº¦'),!1;const n=`${ro}.$schema.fields.${t}`;return await e.setVariable(n,a,'æ·»åŠ å­—æ®µ')},updateSchema:async t=>{if(i.value)return console.warn('[RosterStore] æ–°ç‰ˆæ ¼å¼ä¸æ”¯æŒç›´æ¥ä¿®æ”¹ Schemaï¼Œè¯·ä¿®æ”¹è§„ç« åˆ¶åº¦'),!1;const a=`${ro}.$schema`;return await e.setVariable(a,{...m.value,...t},'æ›´æ–° Schema')}}}),No={class:'field-label'},Eo={class:'field-value'},bo={key:0,class:'value-text'},ko={class:'text-content'},Co={class:'enum-badge'},So={class:'tags-container'},wo={key:0,class:'empty-tags'},Io={class:'boolean-icon'},Bo={class:'value-text'},Ao=(0,l.defineComponent)({__name:'SchemaFieldRenderer',props:{field:{},value:{}},setup(e){const t=e,a=(0,l.computed)(()=>null===t.value||void 0===t.value?'-':'object'==typeof t.value?JSON.stringify(t.value):String(t.value)),n=(0,l.computed)(()=>Array.isArray(t.value)?t.value.map(String):[]);return(t,o)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['schema-field',`field-type-${e.field.type}`])},[(0,l.createElementVNode)('span',No,(0,l.toDisplayString)(e.field.label),1),(0,l.createElementVNode)('div',Eo,[(0,l.createCommentVNode)(' string / number '),'string'===e.field.type||'number'===e.field.type?((0,l.openBlock)(),(0,l.createElementBlock)('span',bo,(0,l.toDisplayString)(a.value),1)):'text'===e.field.type?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' text (å¤šè¡Œæ–‡æœ¬) '),(0,l.createElementVNode)('p',ko,(0,l.toDisplayString)(a.value),1)],64)):'enum'===e.field.type?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' enum (æšä¸¾) '),(0,l.createElementVNode)('span',Co,(0,l.toDisplayString)(a.value),1)],64)):'tags'===e.field.type?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' tags (æ ‡ç­¾æ•°ç»„) '),(0,l.createElementVNode)('div',So,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(n.value,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('span',{key:t,class:'tag'},(0,l.toDisplayString)(e),1))),128)),0===n.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('span',wo,'æ— ')):(0,l.createCommentVNode)('v-if',!0)])],64)):'boolean'===e.field.type?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:4},[(0,l.createCommentVNode)(' boolean '),(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['boolean-value',e.value?'is-true':'is-false'])},[(0,l.createElementVNode)('span',Io,(0,l.toDisplayString)(e.value?'âœ“':'âœ—'),1),(0,l.createTextVNode)(' '+(0,l.toDisplayString)(e.value?'æ˜¯':'å¦'),1)],2)],64)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:5},[(0,l.createCommentVNode)(' æœªçŸ¥ç±»å‹ '),(0,l.createElementVNode)('span',Bo,(0,l.toDisplayString)(a.value),1)],64))])],2))}}),Do=(0,I.A)(Ao,[['__scopeId','data-v-7e8ff355']]),Mo={class:'roster-panel'},xo={class:'panel-header'},To={class:'header-left'},$o={key:0,class:'version-badge'},_o={class:'header-right'},Ro={class:'entry-count'},Oo={class:'panel-main'},Fo={class:'category-sidebar'},Lo={class:'category-list'},Po=['onClick'],jo={class:'category-name'},Uo={class:'category-count'},zo={class:'panel-body'},Wo={key:0,class:'state-container loading-state'},Ho={class:'state-container error-state'},Go={class:'content-area'},Jo={class:'group-header'},qo={class:'group-title'},Ko={class:'group-count'},Yo={class:'entry-table'},Xo={class:'table-header'},Zo={class:'table-body'},Qo=['onClick'],el={class:'col-name'},tl={class:'person-avatar'},al={class:'person-name'},nl={class:'summary-value'},ol={class:'col-action'},ll={class:'expand-btn'},sl={key:0,class:'row-details'},rl={class:'details-content'},cl={class:'section-title'},il={class:'field-grid'},ul=(0,l.defineComponent)({__name:'RosterPanel',emits:['close'],setup(e){const t=Vo(),{roster:n,rosterV3:o,isEmpty:s,entryCount:r,entriesByGroup:c,groupsSorted:i,summaryFields:u,selectedEntryId:d,isLoading:m,error:v,updateVersion:p,isV3Format:f}=a(t),{selectEntry:g,getEntryPrimaryKey:h,getEntryDisplayValue:y,getFieldsForGroup:V,refresh:N,initialize:E}=t,b=(0,l.ref)(null),k=(0,l.computed)(()=>f.value&&o.value.$schemaRef?'äººäº‹æ¡£æ¡ˆ':n.value.$meta?.description||'èŠ±åå†Œ');(0,l.watch)(p,e=>{console.log('[RosterPanel] updateVersion å˜åŒ–:',e,'å½“å‰æ¡ç›®æ•°:',r.value,'æ ¼å¼:',f.value?'v3':'v2')},{immediate:!1});const C=(0,l.computed)(()=>b.value?c.value[b.value]||[]:Object.values(c.value).flat()),S=e=>{const t=y(e);return t?t.charAt(0):'?'},w=(e,t)=>null==e?'-':'tags'===t.type&&Array.isArray(e)?e.length>0?e.join(', '):'-':String(e);return(0,l.onMounted)(async()=>{await E();const e=Object.keys(c.value);e.length>0&&(b.value=e[0]),console.log('[RosterPanel] é¢æ¿å·²æŒ‚è½½ï¼Œåˆå§‹æ¡ç›®æ•°:',r.value,'æ ¼å¼:',f.value?'v3':'v2')}),(0,l.onUnmounted)(()=>{console.log('[RosterPanel] é¢æ¿å·²å¸è½½')}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',Mo,[(0,l.createCommentVNode)(' é¡¶éƒ¨å¤´æ  '),(0,l.createElementVNode)('div',xo,[(0,l.createElementVNode)('div',To,[t[2]||(t[2]=(0,l.createElementVNode)('span',{class:'panel-icon'},'ğŸ‘¥',-1)),(0,l.createElementVNode)('h2',null,(0,l.toDisplayString)(k.value),1),(0,l.unref)(f)?((0,l.openBlock)(),(0,l.createElementBlock)('span',$o,'v3')):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',_o,[(0,l.createElementVNode)('span',Ro,(0,l.toDisplayString)((0,l.unref)(r))+' äºº',1),(0,l.createElementVNode)('button',{class:'close-btn',title:'å…³é—­',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'âœ•')])]),(0,l.createCommentVNode)(' ä¸»ä½“åŒºåŸŸ '),(0,l.createElementVNode)('div',Oo,[(0,l.createCommentVNode)(' å·¦ä¾§åˆ†ç±»å¯¼èˆª '),(0,l.createElementVNode)('aside',Fo,[t[3]||(t[3]=(0,l.createElementVNode)('div',{class:'sidebar-header'},[(0,l.createElementVNode)('span',{class:'sidebar-title'},'åˆ†ç±»')],-1)),(0,l.createElementVNode)('div',Lo,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(c),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t,class:(0,l.normalizeClass)(['category-item',{active:b.value===t}]),onClick:e=>(e=>{b.value===e?b.value=null:b.value=e})(t)},[(0,l.createElementVNode)('span',jo,(0,l.toDisplayString)(t),1),(0,l.createElementVNode)('span',Uo,(0,l.toDisplayString)(e.length),1)],10,Po))),128))])]),(0,l.createCommentVNode)(' å³ä¾§å†…å®¹åŒº '),(0,l.createElementVNode)('div',zo,[(0,l.createCommentVNode)(' åŠ è½½çŠ¶æ€ '),(0,l.unref)(m)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Wo,[...t[4]||(t[4]=[(0,l.createElementVNode)('div',{class:'state-icon'},'â³',-1),(0,l.createElementVNode)('p',null,'åŠ è½½ä¸­...',-1)])])):(0,l.unref)(v)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' é”™è¯¯çŠ¶æ€ '),(0,l.createElementVNode)('div',Ho,[t[5]||(t[5]=(0,l.createElementVNode)('div',{class:'state-icon'},'âš ï¸',-1)),(0,l.createElementVNode)('p',null,(0,l.toDisplayString)((0,l.unref)(v)),1),(0,l.createElementVNode)('button',{class:'retry-btn',onClick:t[1]||(t[1]=(...e)=>(0,l.unref)(N)&&(0,l.unref)(N)(...e))},'é‡è¯•')])],2112)):(0,l.unref)(s)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' ç©ºçŠ¶æ€ '),t[6]||(t[6]=(0,l.createElementVNode)('div',{class:'state-container empty-state'},[(0,l.createElementVNode)('div',{class:'state-icon'},'ğŸ“­'),(0,l.createElementVNode)('p',null,'æš‚æ— äººå‘˜æ•°æ®'),(0,l.createElementVNode)('p',{class:'empty-hint'},[(0,l.createTextVNode)('æ•°æ®ä» '),(0,l.createElementVNode)('code',null,'MC.èŠ±åå†Œ'),(0,l.createTextVNode)(' å˜é‡ä¸­è¯»å–')])],-1))],2112)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' äººå‘˜åˆ—è¡¨ '),(0,l.createElementVNode)('div',Go,[(0,l.createCommentVNode)(' å½“å‰åˆ†ç»„æ ‡é¢˜ '),(0,l.createElementVNode)('div',Jo,[(0,l.createElementVNode)('h3',qo,(0,l.toDisplayString)(b.value||'å…¨éƒ¨äººå‘˜'),1),(0,l.createElementVNode)('span',Ko,'å…± '+(0,l.toDisplayString)(C.value.length)+' äºº',1)]),(0,l.createCommentVNode)(' æ¡ç›®è¡¨æ ¼ '),(0,l.createElementVNode)('div',Yo,[(0,l.createCommentVNode)(' è¡¨å¤´ '),(0,l.createElementVNode)('div',Xo,[t[7]||(t[7]=(0,l.createElementVNode)('div',{class:'col-name'},'å§“å',-1)),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(u),e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:'col-summary'},(0,l.toDisplayString)(e.label),1))),128)),t[8]||(t[8]=(0,l.createElementVNode)('div',{class:'col-action'},'æ“ä½œ',-1))]),(0,l.createCommentVNode)(' è¡¨æ ¼å†…å®¹ '),(0,l.createElementVNode)('div',Zo,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(C.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:(0,l.unref)(h)(e),class:(0,l.normalizeClass)(['table-row',{'is-expanded':(0,l.unref)(d)===(0,l.unref)(h)(e)}])},[(0,l.createCommentVNode)(' ä¸»è¡Œ '),(0,l.createElementVNode)('div',{class:'row-main',onClick:t=>{return a=(0,l.unref)(h)(e),void(d.value===a?g(null):g(a));var a}},[(0,l.createElementVNode)('div',el,[(0,l.createElementVNode)('span',tl,(0,l.toDisplayString)(S(e)),1),(0,l.createElementVNode)('span',al,(0,l.toDisplayString)((0,l.unref)(y)(e)),1)]),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(u),t=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t.id,class:'col-summary'},[(0,l.createElementVNode)('span',nl,(0,l.toDisplayString)(w(e[t.id],t)),1)]))),128)),(0,l.createElementVNode)('div',ol,[(0,l.createElementVNode)('span',ll,(0,l.toDisplayString)((0,l.unref)(d)===(0,l.unref)(h)(e)?'æ”¶èµ· â–²':'è¯¦æƒ… â–¼'),1)])],8,Qo),(0,l.createCommentVNode)(' å±•å¼€çš„è¯¦æƒ…é¢æ¿ '),(0,l.unref)(d)===(0,l.unref)(h)(e)?((0,l.openBlock)(),(0,l.createElementBlock)('div',sl,[(0,l.createElementVNode)('div',rl,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(i),t=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t.id,class:'detail-section'},[(0,l.createElementVNode)('h4',cl,(0,l.toDisplayString)(t.label),1),(0,l.createElementVNode)('div',il,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(V)(t.id),t=>((0,l.openBlock)(),(0,l.createBlock)(Do,{key:t.id,field:t,value:e[t.id]},null,8,['field','value']))),128))])]))),128))])])):(0,l.createCommentVNode)('v-if',!0)],2))),128))])])])],2112))])])]))}}),dl=(0,I.A)(ul,[['__scopeId','data-v-4c76020e']]),ml='MC.æ–‡æ¡£',vl={$meta:{extensible:!0,version:'2.0',description:'å¤šæ–‡æ¡£ç®¡ç†å®¹å™¨'}},pl={title:'',description:'',order:0,sections:{$meta:{extensible:!0}}};function fl(e){return Object.keys(e).filter(e=>!('$meta'===e))}function gl(e){return fl(e).map(t=>({id:t,...e[t]})).sort((e,t)=>(e.order??999)-(t.order??999))}function hl(e,t=0){const a=[];for(const n of gl(e))a.push({...n,depth:t}),n.children&&a.push(...hl(n.children,t+1));return a}function yl(e){if('string'!=typeof e)return e;const t=e.trim();if(!(t.startsWith('{')&&t.endsWith('}')||t.startsWith('[')&&t.endsWith(']')))return e;try{const t=JSON.parse(e);return console.log('[DocumentStore] æˆåŠŸè§£æå­—ç¬¦ä¸²åŒ–çš„æ–‡æ¡£æ•°æ®'),t}catch(t){try{const t=e.replace(/\\"/g,'"').replace(/\\\\/g,'\\');if(t!==e){const e=JSON.parse(t);return console.log('[DocumentStore] æˆåŠŸè§£æåŒé‡è½¬ä¹‰çš„æ–‡æ¡£æ•°æ®'),e}}catch{}return console.warn('[DocumentStore] æ— æ³•è§£æå­—ç¬¦ä¸²åŒ–çš„æ–‡æ¡£æ•°æ®:',t),e}}const Vl=t('document',()=>{const e=xn(),t=(0,l.ref)(!1),a=(0,l.ref)(!1),n=(0,l.ref)(null),o=(0,l.ref)(null),s=(0,l.ref)(0);let r=null;const c=(0,l.computed)(()=>{const t=s.value,a=e.getVariable(ml,vl);if(console.log('[DocumentStore] è¯»å– MC.æ–‡æ¡£ å˜é‡ (version='+t+'):',{path:ml,rawDataType:typeof a,rawDataKeys:a&&'object'==typeof a?Object.keys(a):[],hasData:null!=a}),function(e){if(!e||'object'!=typeof e)return!1;const t=e;return'string'==typeof t.title&&'object'==typeof t.sections&&null!==t.sections}(a))return console.log('[DocumentStore] æ£€æµ‹åˆ°æ—§ç‰ˆå•æ–‡æ¡£ç»“æ„ï¼Œè¿›è¡Œè½¬æ¢'),{$meta:{extensible:!0,version:'2.0',description:'ä»æ—§ç‰ˆè½¬æ¢çš„æ–‡æ¡£å®¹å™¨'},default:{title:(n=a).title,description:n.description,order:0,sections:n.sections}};var n;if(a&&'object'==typeof a){return function(e){const t={};let a=!1;for(const[n,o]of Object.entries(e))if('$meta'!==n)if('string'==typeof o){console.warn(`[DocumentStore] æ£€æµ‹åˆ°å­—ç¬¦ä¸²åŒ–çš„æ–‡æ¡£: "${n}"ï¼Œå°è¯•ä¿®å¤...`),a=!0;const e=yl(o);e&&'object'==typeof e&&'title'in e?(console.log(`[DocumentStore] æ–‡æ¡£ "${n}" ä¿®å¤æˆåŠŸ`),t[n]=e):(console.error(`[DocumentStore] æ–‡æ¡£ "${n}" ä¿®å¤å¤±è´¥ï¼Œä¿æŒåŸå€¼`),t[n]=o)}else t[n]=o;else t[n]=o;return a&&console.log('[DocumentStore] å·²å®Œæˆå­—ç¬¦ä¸²åŒ–æ–‡æ¡£çš„ä¿®å¤å¤„ç†'),t}(a)}return a}),i=(0,l.computed)(()=>{return fl(e=c.value).map(t=>({id:t,...e[t]})).sort((e,t)=>(e.order??999)-(t.order??999));var e}),u=(0,l.computed)(()=>i.value.length),d=(0,l.computed)(()=>0===u.value),m=(0,l.computed)(()=>{const e=o.value;if(console.log('[DocumentStore] effectiveDocId è®¡ç®—è¢«è§¦å‘, currentDocId:',e),e)return console.log('[DocumentStore] effectiveDocId è®¡ç®—: ä½¿ç”¨é€‰ä¸­çš„æ–‡æ¡£',e),e;const t=i.value;return t.length>0?(console.log('[DocumentStore] effectiveDocId è®¡ç®—: ä½¿ç”¨é»˜è®¤æ–‡æ¡£',t[0].id),t[0].id):null}),v=(0,l.computed)(()=>{const e=m.value;if(console.log('[DocumentStore] currentDocument è®¡ç®—, docId:',e),!e)return null;const t=c.value[e];return t&&'object'==typeof t&&'title'in t?(console.log('[DocumentStore] currentDocument æ‰¾åˆ°æ–‡æ¡£:',t.title),t):(console.log('[DocumentStore] currentDocument æœªæ‰¾åˆ°æ–‡æ¡£'),null)}),p=(0,l.computed)(()=>v.value?.title||''),f=(0,l.computed)(()=>v.value?.description||''),g=(0,l.computed)(()=>v.value?.sections||{$meta:{extensible:!0}}),h=(0,l.computed)(()=>gl(g.value)),y=(0,l.computed)(()=>hl(g.value).length),V=(0,l.computed)(()=>0===y.value),N=(0,l.computed)(()=>hl(g.value)),E=()=>m.value,b=e=>{const t=g.value[e];return t&&'object'==typeof t&&'title'in t?t:void 0};return{isInitialized:t,isLoading:a,error:n,currentDocId:o,documentsContainer:c,documentList:i,documentCount:u,hasNoDocuments:d,effectiveDocId:m,currentDocument:v,title:p,description:f,sections:g,sectionsSorted:h,sectionCount:y,isEmpty:V,flatSections:N,initialize:async()=>{if(!t.value)try{a.value=!0,e.isMvuAvailable||await e.initialize(),r||(r=e.onUpdateEnd(()=>{console.log('[DocumentStore] æ”¶åˆ° MVU æ›´æ–°ç»“æŸäº‹ä»¶ï¼Œé€’å¢ dataVersion'),s.value++})),i.value.length>0&&!o.value&&(o.value=i.value[0].id),t.value=!0}catch(e){n.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥'}finally{a.value=!1}},refresh:async()=>{await e.refresh(),s.value++},selectDocument:e=>{console.log('[DocumentStore] selectDocument è¢«è°ƒç”¨, docId:',e),console.log('[DocumentStore] å½“å‰ currentDocId:',o.value),console.log('[DocumentStore] documentsContainer keys:',Object.keys(c.value));let t=c.value[e];if(console.log('[DocumentStore] æŸ¥æ‰¾åˆ°çš„æ–‡æ¡£:',t?'å­˜åœ¨':'ä¸å­˜åœ¨',typeof t),'string'==typeof t){console.warn('[DocumentStore] æ£€æµ‹åˆ°å­—ç¬¦ä¸²ç±»å‹çš„æ–‡æ¡£ï¼Œå°è¯•è§£æ...');const e=yl(t);e&&'object'==typeof e&&'title'in e&&(t=e,console.log('[DocumentStore] æ–‡æ¡£è§£ææˆåŠŸ:',t.title))}t&&'object'==typeof t&&'title'in t?(console.log('[DocumentStore] åˆ‡æ¢åˆ°æ–‡æ¡£:',e,'å½“å‰æ–‡æ¡£ID:',o.value),o.value!==e?(o.value=e,console.log('[DocumentStore] æ–‡æ¡£åˆ‡æ¢å®Œæˆï¼Œæ–°çš„æ–‡æ¡£ID:',o.value),console.log('[DocumentStore] effectiveDocId åº”è¯¥æ›´æ–°ä¸º:',m.value),console.log('[DocumentStore] currentDocument title:',v.value?.title)):console.log('[DocumentStore] æ–‡æ¡£IDæœªå˜åŒ–ï¼Œè·³è¿‡æ›´æ–°')):(console.warn('[DocumentStore] å°è¯•é€‰æ‹©ä¸å­˜åœ¨çš„æ–‡æ¡£:',e,'å¯ç”¨æ–‡æ¡£:',Object.keys(c.value)),console.warn('[DocumentStore] doc å†…å®¹:',JSON.stringify(t)))},getEffectiveDocId:E,getSection:b,getSectionChildren:e=>e.children?gl(e.children):[],addSection:async(t,a,n)=>{const o=E();if(!o)return!1;const l=n?`${ml}.${o}.sections.${n}.children.${t}`:`${ml}.${o}.sections.${t}`;return await e.setVariable(l,a,'æ·»åŠ èŠ‚ç‚¹')},updateSection:async(t,a,n)=>{const o=b(t);if(!o)return!1;const l=E();if(!l)return!1;const s=n?`${ml}.${l}.sections.${n}.children.${t}`:`${ml}.${l}.sections.${t}`;return await e.setVariable(s,{...o,...a},'æ›´æ–°èŠ‚ç‚¹')},removeSection:async(t,a)=>{const n=E();if(!n)return!1;const o=a?`${ml}.${n}.sections.${a}.children`:`${ml}.${n}.sections`,l={...e.getVariable(o,{})};return delete l[t],await e.setVariable(o,l,'åˆ é™¤èŠ‚ç‚¹')},updateTitle:async t=>{const a=E();return!!a&&await e.setVariable(`${ml}.${a}.title`,t,'æ›´æ–°æ ‡é¢˜')},updateDescription:async t=>{const a=E();return!!a&&await e.setVariable(`${ml}.${a}.description`,t,'æ›´æ–°æè¿°')},addDocument:async(t,a)=>await e.setVariable(`${ml}.${t}`,a,'æ·»åŠ æ–‡æ¡£'),removeDocument:async t=>{const a={...e.getVariable(ml,{})};if(delete a[t],o.value===t){const e=Object.keys(a).filter(e=>'$meta'!==e);o.value=e.length>0?e[0]:null}return await e.setVariable(ml,a,'åˆ é™¤æ–‡æ¡£')},DEFAULT_DOCUMENT_ENTRY:pl,destroy:()=>{r&&(r(),r=null)},dataVersion:s}}),Nl={key:0,class:'expand-icon'},El={key:1,class:'expand-placeholder'},bl={class:'node-title'},kl={key:0,class:'node-content'},Cl={key:1,class:'node-children'},Sl=(0,l.defineComponent)({__name:'TreeNodeRenderer',props:{section:{},depth:{default:0},defaultExpanded:{type:Boolean,default:!0}},setup(e){const t=e,a=(0,l.ref)(t.defaultExpanded),n=(0,l.computed)(()=>{if(!t.section.children)return!1;return Object.keys(t.section.children).filter(e=>'$meta'!==e).length>0}),o=(0,l.computed)(()=>t.section.children?gl(t.section.children):[]),s=()=>{n.value&&(a.value=!a.value)};return(t,r)=>{const c=(0,l.resolveComponent)('TreeNodeRenderer',!0);return(0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['tree-node',`depth-${e.depth}`])},[(0,l.createCommentVNode)(' èŠ‚ç‚¹æ ‡é¢˜ '),(0,l.createElementVNode)('div',{class:'node-header',onClick:s},[n.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',Nl,(0,l.toDisplayString)(a.value?'â–¼':'â–¶'),1)):((0,l.openBlock)(),(0,l.createElementBlock)('span',El)),(0,l.createElementVNode)('span',bl,(0,l.toDisplayString)(e.section.title),1)]),(0,l.createCommentVNode)(' èŠ‚ç‚¹å†…å®¹ '),!e.section.content||!a.value&&n.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('div',kl,(0,l.toDisplayString)(e.section.content),1)),(0,l.createCommentVNode)(' å­èŠ‚ç‚¹ï¼ˆé€’å½’ï¼‰ '),n.value&&a.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',Cl,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(o.value,t=>((0,l.openBlock)(),(0,l.createBlock)(c,{key:t.id,section:t,depth:e.depth+1,'default-expanded':e.defaultExpanded},null,8,['section','depth','default-expanded']))),128))])):(0,l.createCommentVNode)('v-if',!0)],2)}}}),wl=(0,I.A)(Sl,[['__scopeId','data-v-644583f3']]),Il={class:'panel-header'},Bl={class:'doc-count'},Al={class:'panel-main'},Dl={class:'sidebar-header'},Ml={key:0,class:'sidebar-title'},xl=['title'],Tl={key:0,class:'document-list'},$l=['onClick','onKeydown'],_l={class:'doc-info'},Rl={class:'doc-title'},Ol={key:0,class:'doc-desc'},Fl={key:1,class:'sidebar-empty'},Ll={key:2,class:'collapsed-list'},Pl=['onClick','title','onKeydown'],jl={class:'panel-body'},Ul={key:0,class:'loading-state'},zl={class:'error-state'},Wl={class:'document-content'},Hl={class:'current-doc-header'},Gl={class:'current-doc-title'},Jl={class:'section-count'},ql={key:0,class:'document-description'},Kl=(0,l.defineComponent)({__name:'DocumentPanel',emits:['close'],setup(e){const t=Vl(),{documentList:n,documentCount:o,hasNoDocuments:s,currentDocId:r,isLoading:c,error:i}=a(t),{refresh:u,initialize:d,selectDocument:m}=t,v=(0,l.computed)(()=>t.effectiveDocId),p=(0,l.computed)(()=>t.title),f=(0,l.computed)(()=>t.description),g=(0,l.computed)(()=>t.isEmpty),h=(0,l.computed)(()=>t.sectionCount),y=(0,l.computed)(()=>t.sectionsSorted),V=(0,l.ref)(!1),N=()=>{V.value=!V.value},E=(e,t=30)=>e.length>t?e.slice(0,t)+'...':e,b=e=>v.value===e,k=e=>{console.log('[DocumentPanel] ç‚¹å‡»é€‰æ‹©æ–‡æ¡£:',e,'å½“å‰æœ‰æ•ˆæ–‡æ¡£:',v.value),console.log('[DocumentPanel] currentDocId.value:',r.value),console.log('[DocumentPanel] å¯ç”¨æ–‡æ¡£åˆ—è¡¨:',n.value.map(e=>e.id)),m(e),console.log('[DocumentPanel] é€‰æ‹©å currentDocId:',r.value),console.log('[DocumentPanel] é€‰æ‹©å effectiveDocId:',v.value),console.log('[DocumentPanel] é€‰æ‹©å title:',p.value)};return(0,l.watch)(r,(e,t)=>{console.log('[DocumentPanel] currentDocId å˜åŒ–:',t,'->',e)}),(0,l.watch)(v,(e,t)=>{console.log('[DocumentPanel] effectiveDocId å˜åŒ–:',t,'->',e)}),(0,l.watch)(p,(e,t)=>{console.log('[DocumentPanel] title å˜åŒ–:',t,'->',e)}),(0,l.watch)(y,e=>{console.log('[DocumentPanel] sectionsSorted å˜åŒ–, èŠ‚ç‚¹æ•°:',e.length)},{deep:!0}),(0,l.onMounted)(()=>{d()}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['document-panel',{'sidebar-collapsed':V.value}])},[(0,l.createCommentVNode)(' é¡¶éƒ¨å¤´æ  '),(0,l.createElementVNode)('div',Il,[t[2]||(t[2]=(0,l.createElementVNode)('h2',null,'ğŸ“„ æ–‡æ¡£æŸ¥çœ‹',-1)),(0,l.createElementVNode)('span',Bl,(0,l.toDisplayString)((0,l.unref)(o))+' ä»½æ–‡æ¡£',1),(0,l.createElementVNode)('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'âœ•')]),(0,l.createElementVNode)('div',Al,[(0,l.createCommentVNode)(' å·¦ä¾§æ–‡æ¡£åˆ—è¡¨ä¾§æ  '),(0,l.createElementVNode)('aside',{class:(0,l.normalizeClass)(['document-sidebar',{collapsed:V.value}])},[(0,l.createElementVNode)('div',Dl,[V.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',Ml,'æ–‡æ¡£åˆ—è¡¨')),(0,l.createElementVNode)('button',{class:'toggle-btn',onClick:N,title:V.value?'å±•å¼€ä¾§æ ':'æ”¶èµ·ä¾§æ '},(0,l.toDisplayString)(V.value?'â–¶':'â—€'),9,xl)]),!V.value&&(0,l.unref)(o)>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',Tl,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(n),e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['doc-item',{active:b(e.id)}]),onClick:(0,l.withModifiers)(t=>k(e.id),['stop','prevent']),role:'button',tabindex:'0',onKeydown:(0,l.withKeys)(t=>k(e.id),['enter'])},[t[3]||(t[3]=(0,l.createElementVNode)('span',{class:'doc-icon'},'ğŸ“–',-1)),(0,l.createElementVNode)('div',_l,[(0,l.createElementVNode)('span',Rl,(0,l.toDisplayString)(e.title||e.id),1),e.description?((0,l.openBlock)(),(0,l.createElementBlock)('span',Ol,(0,l.toDisplayString)(E(e.description)),1)):(0,l.createCommentVNode)('v-if',!0)])],42,$l))),128))])):(0,l.createCommentVNode)('v-if',!0),V.value||0!==(0,l.unref)(o)?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('div',Fl,[...t[4]||(t[4]=[(0,l.createElementVNode)('span',null,'æš‚æ— æ–‡æ¡£',-1)])])),(0,l.createCommentVNode)(' æ”¶ç¼©çŠ¶æ€ä¸‹çš„å›¾æ ‡åˆ—è¡¨ '),V.value&&(0,l.unref)(o)>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ll,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(n),e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['collapsed-item',{active:b(e.id)}]),onClick:(0,l.withModifiers)(t=>k(e.id),['stop','prevent']),title:e.title||e.id,role:'button',tabindex:'0',onKeydown:(0,l.withKeys)(t=>k(e.id),['enter'])},' ğŸ“– ',42,Pl))),128))])):(0,l.createCommentVNode)('v-if',!0)],2),(0,l.createCommentVNode)(' å³ä¾§æ–‡æ¡£å†…å®¹åŒº '),(0,l.createElementVNode)('div',jl,[(0,l.createCommentVNode)(' åŠ è½½çŠ¶æ€ '),(0,l.unref)(c)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ul,[...t[5]||(t[5]=[(0,l.createElementVNode)('p',null,'åŠ è½½ä¸­...',-1)])])):(0,l.unref)(i)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' é”™è¯¯çŠ¶æ€ '),(0,l.createElementVNode)('div',zl,[(0,l.createElementVNode)('p',null,(0,l.toDisplayString)((0,l.unref)(i)),1),(0,l.createElementVNode)('button',{onClick:t[1]||(t[1]=(...e)=>(0,l.unref)(u)&&(0,l.unref)(u)(...e))},'é‡è¯•')])],2112)):(0,l.unref)(s)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' æ— æ–‡æ¡£çŠ¶æ€ '),t[6]||(t[6]=(0,l.createElementVNode)('div',{class:'empty-state'},[(0,l.createElementVNode)('p',null,'ğŸ“­ æš‚æ— æ–‡æ¡£'),(0,l.createElementVNode)('p',{class:'empty-hint'},[(0,l.createTextVNode)('æ–‡æ¡£æ•°æ®ä» '),(0,l.createElementVNode)('code',null,'MC.æ–‡æ¡£'),(0,l.createTextVNode)(' å˜é‡ä¸­è¯»å–')]),(0,l.createElementVNode)('p',{class:'empty-hint'},'AI ä¼šåœ¨æ¸¸æˆè¿›ç¨‹ä¸­è‡ªåŠ¨æ›´æ–°æ–‡æ¡£å†…å®¹')],-1))],2112)):g.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' å½“å‰æ–‡æ¡£ä¸ºç©º '),t[7]||(t[7]=(0,l.createElementVNode)('div',{class:'empty-state'},[(0,l.createElementVNode)('p',null,'ğŸ“ è¯¥æ–‡æ¡£æš‚æ— å†…å®¹')],-1))],2112)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:4},[(0,l.createCommentVNode)(' æ–‡æ¡£å†…å®¹ '),(0,l.createElementVNode)('div',Wl,[(0,l.createElementVNode)('div',Hl,[(0,l.createElementVNode)('h3',Gl,(0,l.toDisplayString)(p.value),1),(0,l.createElementVNode)('span',Jl,(0,l.toDisplayString)(h.value)+' èŠ‚',1)]),f.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',ql,(0,l.toDisplayString)(f.value),1)):(0,l.createCommentVNode)('v-if',!0),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(y.value,e=>((0,l.openBlock)(),(0,l.createBlock)(wl,{key:e.id,section:e,depth:0},null,8,['section']))),128))])],2112))])])],2))}}),Yl=(0,I.A)(Kl,[['__scopeId','data-v-40ace65a']]);class Xl{static parseDocuments(e){const t={},a={},n={},o={},l={};for(const[s,r]of Object.entries(e)){if('$meta'===s||!r||'object'!=typeof r)continue;if(!('title'in r))continue;const e=r;if(e.$formMeta){const a=e.$formMeta;t[a.formId]={meta:a,fields:[],sourceDocId:s}}if(e.$rosterMeta){const t=e.$rosterMeta;a[t.rosterId]={meta:t,fields:[],groups:[],sourceDocId:s}}e.sections&&this.traverseSections(e.sections,n,o,l,t,s)}for(const[e,a]of Object.entries(n))t[e]&&(t[e].fields=a.sort((e,t)=>e.formPosition-t.formPosition));for(const[e,t]of Object.entries(o))a[e]?a[e].fields=t.sort((e,t)=>e.order-t.order):a[e]={meta:{rosterId:e,targetPath:`MC.${e}`,primaryKey:'id',displayField:'name'},fields:t.sort((e,t)=>e.order-t.order),groups:[],sourceDocId:''};for(const[e,t]of Object.entries(l))a[e]&&(a[e].groups=t.sort((e,t)=>e.order-t.order));return{forms:t,rosters:a}}static traverseSections(e,t,a,n,o,l){for(const[,s]of Object.entries(e))if(s&&'object'==typeof s&&!('extensible'in s)){if(s.$formMeta&&o){const e=s.$formMeta;o[e.formId]||(o[e.formId]={meta:e,fields:[],sourceDocId:l||''})}if(s.$groupDef){const e=s.$groupDef,t=e.belongsTo;n[t]||(n[t]=[]),n[t].push(e)}if(s.$fieldDef){const e=Array.isArray(s.$fieldDef)?s.$fieldDef:[s.$fieldDef];for(const n of e)if(n.belongsTo)if('formPosition'in n){const e=n;t[e.belongsTo]||(t[e.belongsTo]=[]),t[e.belongsTo].push(e)}else if('order'in n){const e=n;a[e.belongsTo]||(a[e.belongsTo]=[]),a[e.belongsTo].push(e)}}s.children&&this.traverseSections(s.children,t,a,n,o,l)}}static getFormDefinition(e,t){return this.parseDocuments(e).forms[t]||null}static getAvailableForms(e){const t=this.parseDocuments(e);return Object.values(t.forms).map(e=>({formId:e.meta.formId,formName:e.meta.formName,description:e.meta.description}))}static getRosterSchemaDefinition(e,t){return this.parseDocuments(e).rosters[t]||null}static getRosterSchemaFromRef(e,t){const a=t.split('.');if(a.length<3||'MC'!==a[0]||'æ–‡æ¡£'!==a[1])return console.warn('[FormParserService] æ— æ•ˆçš„ schemaRef è·¯å¾„:',t),null;const n=a.slice(2).join('.'),o=e[n];if(!o||'object'!=typeof o||!('title'in o))return console.warn('[FormParserService] æœªæ‰¾åˆ°æ–‡æ¡£:',n),null;const l=o,s={},r={};l.sections&&this.traverseSections(l.sections,{},s,r,void 0,void 0);const c=l.$rosterMeta;if(!c){const e=Object.keys(s);if(0===e.length)return console.warn('[FormParserService] æ–‡æ¡£ä¸­æ²¡æœ‰èŠ±åå†Œå®šä¹‰:',n),null;const t=e[0];return{meta:{rosterId:t,targetPath:`MC.${t}`,primaryKey:'id',displayField:'name'},fields:(s[t]||[]).sort((e,t)=>e.order-t.order),groups:(r[t]||[]).sort((e,t)=>e.order-t.order),sourceDocId:n}}return{meta:c,fields:(s[c.rosterId]||[]).sort((e,t)=>e.order-t.order),groups:(r[c.rosterId]||[]).sort((e,t)=>e.order-t.order),sourceDocId:n}}static getAvailableRosters(e){const t=this.parseDocuments(e);return Object.values(t.rosters).map(e=>({rosterId:e.meta.rosterId,targetPath:e.meta.targetPath,displayField:e.meta.displayField}))}}const Zl='MC.ç”³è¯·è®°å½•',Ql=t('form',()=>{const e=xn(),t=(0,l.ref)(!1),a=(0,l.ref)(!1),n=(0,l.ref)(null),o=(0,l.ref)(null),s=(0,l.ref)({}),r=(0,l.ref)(0);let c=null;const i=(0,l.computed)(()=>{const t=r.value;return console.log('[FormStore] è¯»å–æ–‡æ¡£å®¹å™¨, version:',t),e.getVariable('MC.æ–‡æ¡£',{})}),u=(0,l.computed)(()=>Xl.parseDocuments(i.value)),d=(0,l.computed)(()=>{const e=u.value.forms;return Object.values(e).map(e=>({formId:e.meta.formId,formName:e.meta.formName,description:e.meta.description,sourceDocId:e.sourceDocId}))}),m=(0,l.computed)(()=>d.value.length),v=(0,l.computed)(()=>0===m.value),p=(0,l.computed)(()=>{const e=r.value,t=o.value,a=u.value.forms,n=Object.keys(a);if(console.log('[FormStore] effectiveFormId è®¡ç®—:',{version:e,currentFormId:t,availableFormIds:n,currentFormExists:!!t&&!!a[t]}),t&&a[t])return console.log('[FormStore] effectiveFormId è¿”å› currentFormId:',t),t;if(n.length>0){const e=n[0];return console.log('[FormStore] effectiveFormId fallback åˆ°:',e),e}return console.log('[FormStore] effectiveFormId è¿”å› null'),null}),f=(0,l.computed)(()=>{const e=p.value;return e&&u.value.forms[e]||null}),g=(0,l.computed)(()=>f.value?.fields||[]),h=(0,l.computed)(()=>f.value?.meta||null),y=()=>{const t=g.value,a={};for(const n of t)if(void 0!==n.defaultValue&&('string'==typeof n.defaultValue&&n.defaultValue.startsWith('{{')?'{{currentDate}}'===n.defaultValue&&(a[n.fieldId]=(new Date).toISOString().split('T')[0]):a[n.fieldId]=n.defaultValue),n.source){const t=e.getVariable(n.source,null);null!==t&&(a[n.fieldId]=t)}s.value=a},V=()=>{const e={},t=g.value,a=s.value;for(const n of t){const t=a[n.fieldId];if(!n.required||null!=t&&''!==t){if(n.conditionalRequired){const o=n.conditionalRequired,l=a[o.when.field];let s=!1;if(void 0!==o.when.equals?s=l===o.when.equals:void 0!==o.when.in&&(s=o.when.in.includes(l)),s&&o.required&&(null==t||''===t)){e[n.fieldId]=`${n.label}ä¸èƒ½ä¸ºç©º`;continue}}'string'==typeof t&&(n.minLength&&t.length<n.minLength&&(e[n.fieldId]=`${n.label}è‡³å°‘éœ€è¦${n.minLength}ä¸ªå­—ç¬¦`),n.maxLength&&t.length>n.maxLength&&(e[n.fieldId]=`${n.label}ä¸èƒ½è¶…è¿‡${n.maxLength}ä¸ªå­—ç¬¦`)),'number'==typeof t&&(void 0!==n.min&&t<n.min&&(e[n.fieldId]=`${n.label}ä¸èƒ½å°äº${n.min}`),void 0!==n.max&&t>n.max&&(e[n.fieldId]=`${n.label}ä¸èƒ½å¤§äº${n.max}`)),n.mustBeTrue&&!0!==t&&(e[n.fieldId]=`è¯·å‹¾é€‰${n.label}`)}else e[n.fieldId]=`${n.label}ä¸èƒ½ä¸ºç©º`}return{valid:0===Object.keys(e).length,errors:e}},N=(0,l.computed)(()=>{r.value;return e.getVariable(Zl,{})}),E=(e,t)=>{const a={appId:e,summary:t,formType:'',applicant:'',date:'',status:'å¾…å®¡æ‰¹',details:{}},n=t.match(/ã€(.+?)ã€‘/);n&&(a.formType=n[1]);const o=t.split('|').map(e=>e.trim());for(const e of o)if(e.startsWith('ç”³è¯·äººï¼š')){const t=e.match(/ç”³è¯·äººï¼š(.+?)(?:ï¼ˆ(.+?)ï¼‰)?$/);t&&(a.applicant=t[1],t[2]&&(a.details['éƒ¨é—¨']=t[2]))}else if(e.startsWith('æ—¥æœŸï¼š'))a.date=e.replace('æ—¥æœŸï¼š','');else if(e.startsWith('çŠ¶æ€ï¼š'))a.status=e.replace('çŠ¶æ€ï¼š','');else if(e.includes('ï¼š')){const[t,n]=e.split('ï¼š');t&&n&&!t.startsWith('ã€')&&(a.details[t]=n)}return a},b=(0,l.computed)(()=>{const e=h.value;if(!e?.targetPath)return[];const t=e.targetPath.split('.'),a=t[t.length-1],n=N.value[a];if(!n)return[];const o=[];for(const[e,t]of Object.entries(n))e.startsWith('$')||'string'!=typeof t||o.push(E(e,t));return o.sort((e,t)=>t.appId.localeCompare(e.appId))}),k=(0,l.computed)(()=>{const e=N.value,t=[];for(const[a,n]of Object.entries(e))if(!a.startsWith('$')&&n&&'object'==typeof n)for(const[e,a]of Object.entries(n))e.startsWith('$')||'string'!=typeof a||t.push(E(e,a));return t.sort((e,t)=>t.appId.localeCompare(e.appId))}),C=(0,l.computed)(()=>b.value.length),S=(0,l.computed)(()=>k.value.length),w=async(t,a)=>{try{let n=a;if(!n){const e=h.value;if(!e?.targetPath)return{success:!1,error:'æ— æ³•ç¡®å®šç”³è¯·ç±»åˆ«'};const t=e.targetPath.split('.');n=t[t.length-1]}const o=N.value[n];if(!o)return{success:!1,error:'æ‰¾ä¸åˆ°ç”³è¯·ç±»åˆ«'};const l=o[t];if('string'!=typeof l)return{success:!1,error:'æ‰¾ä¸åˆ°è¯¥ç”³è¯·è®°å½•'};let s=l;const c=[/çŠ¶æ€ï¼š[^|]+$/,/çŠ¶æ€ï¼š[^|]+\|/];let i=!1;for(const e of c)if(e.test(s)){s=s.replace(e,e=>e.endsWith('|')?'çŠ¶æ€ï¼šå·²æ‰¹å‡†ï¼ˆå¿«é€Ÿé€šè¿‡ï¼‰|':'çŠ¶æ€ï¼šå·²æ‰¹å‡†ï¼ˆå¿«é€Ÿé€šè¿‡ï¼‰'),i=!0;break}i||(s+=' | çŠ¶æ€ï¼šå·²æ‰¹å‡†ï¼ˆå¿«é€Ÿé€šè¿‡ï¼‰');const u=`${Zl}.${n}.${t}`;return await e.setVariable(u,s,`å¿«é€Ÿé€šè¿‡ç”³è¯· ${t}`),console.log('[FormStore] å¿«é€Ÿé€šè¿‡ç”³è¯·æˆåŠŸ:',t),r.value++,{success:!0}}catch(e){return console.error('[FormStore] å¿«é€Ÿé€šè¿‡ç”³è¯·å¤±è´¥:',e),{success:!1,error:e instanceof Error?e.message:'æ“ä½œå¤±è´¥'}}},I=async(t,a)=>{try{let n=a;if(!n){const e=h.value;if(!e?.targetPath)return{success:!1,error:'æ— æ³•ç¡®å®šç”³è¯·ç±»åˆ«'};const t=e.targetPath.split('.');n=t[t.length-1]}const o=N.value[n];if(!o||'string'!=typeof o[t])return{success:!1,error:'æ‰¾ä¸åˆ°è¯¥ç”³è¯·è®°å½•'};const l={...o};delete l[t];const s=`${Zl}.${n}`;return await e.setVariable(s,l,`åˆ é™¤ç”³è¯·è®°å½• ${t}`),console.log('[FormStore] åˆ é™¤ç”³è¯·è®°å½•æˆåŠŸ:',t),r.value++,{success:!0}}catch(e){return console.error('[FormStore] åˆ é™¤ç”³è¯·è®°å½•å¤±è´¥:',e),{success:!1,error:e instanceof Error?e.message:'åˆ é™¤å¤±è´¥'}}};return{isInitialized:t,isLoading:a,error:n,currentFormId:o,formData:s,dataVersion:r,availableForms:d,formCount:m,hasNoForms:v,effectiveFormId:p,currentForm:f,currentFields:g,currentFormMeta:h,getCurrentFormApplications:b,getAllApplications:k,applicationCount:C,totalApplicationCount:S,initialize:async()=>{if(!t.value)try{a.value=!0,e.isMvuAvailable||await e.initialize(),c||(c=e.onUpdateEnd(()=>{console.log('[FormStore] æ”¶åˆ° MVU æ›´æ–°ç»“æŸäº‹ä»¶ï¼Œé€’å¢ dataVersion'),r.value++})),d.value.length>0&&!o.value&&(o.value=d.value[0].formId),t.value=!0}catch(e){n.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥'}finally{a.value=!1}},refresh:async()=>{await e.refresh(),r.value++},destroy:()=>{c&&(c(),c=null)},selectForm:async e=>{if(console.log('[FormStore] selectForm è¢«è°ƒç”¨:',e),console.log('[FormStore] å½“å‰ currentFormId:',o.value),console.log('[FormStore] å¯ç”¨è¡¨å•åˆ—è¡¨:',Object.keys(u.value.forms)),o.value===e)return void console.log('[FormStore] é€‰æ‹©çš„æ˜¯åŒä¸€ä¸ªè¡¨å•ï¼Œè·³è¿‡');const t=!!u.value.forms[e];console.log('[FormStore] è¡¨å•æ˜¯å¦å­˜åœ¨:',t,e),s.value={},o.value=e,console.log('[FormStore] currentFormId å·²æ›´æ–°ä¸º:',o.value),r.value++,await(0,l.nextTick)(),await(0,l.nextTick)(),console.log('[FormStore] nextTick å effectiveFormId:',p.value),console.log('[FormStore] nextTick å currentForm:',f.value?.meta?.formName),console.log('[FormStore] nextTick å currentFields æ•°é‡:',g.value.length),y()},initializeFormData:y,autoFillFormData:()=>{const t=g.value,a={...s.value},n={applicant_name:'MC.ç©å®¶.å§“å',applicant_dept:'MC.ç©å®¶.éƒ¨é—¨',applicant_position:'MC.ç©å®¶.èŒä½',applicant_age:'MC.ç©å®¶.å¹´é¾„',å§“å:'MC.ç©å®¶.å§“å',éƒ¨é—¨:'MC.ç©å®¶.éƒ¨é—¨',èŒä½:'MC.ç©å®¶.èŒä½',å¹´é¾„:'MC.ç©å®¶.å¹´é¾„'},o=['apply_date','date','æ—¥æœŸ','ç”³è¯·æ—¥æœŸ'];for(const l of t){if(l.source){const t=e.getVariable(l.source,null);if(null!=t&&''!==t){a[l.fieldId]=t;continue}}const t=n[l.fieldId]?l.fieldId:n[l.label]?l.label:null;if(t){const o=n[t],s=e.getVariable(o,null);if(null!=s&&''!==s){a[l.fieldId]=s;continue}}o.includes(l.fieldId)||o.includes(l.label)?a[l.fieldId]||(a[l.fieldId]=(new Date).toISOString().split('T')[0]):void 0!==a[l.fieldId]&&null!==a[l.fieldId]&&''!==a[l.fieldId]||void 0!==l.defaultValue&&('string'==typeof l.defaultValue&&l.defaultValue.startsWith('{{')?'{{currentDate}}'===l.defaultValue&&(a[l.fieldId]=(new Date).toISOString().split('T')[0]):a[l.fieldId]=l.defaultValue)}s.value=a,console.log('[FormStore] è‡ªåŠ¨å¡«å†™å®Œæˆ:',a)},updateField:(e,t)=>{s.value={...s.value,[e]:t}},validateForm:V,submitForm:async()=>{const t=h.value;if(!t)return{success:!1,error:'æœªé€‰æ‹©è¡¨å•'};const a=V();if(!a.valid){return{success:!1,error:Object.values(a.errors)[0]}}try{const a=(()=>{const e=new Date;return`APP${[e.getFullYear(),String(e.getMonth()+1).padStart(2,'0'),String(e.getDate()).padStart(2,'0')].join('')}${String(Math.floor(900*Math.random())+100)}`})(),n=(()=>{const e=h.value;if(!e)return'';const t=s.value,a=[];a.push(`ã€${e.formName}ã€‘`);const n=t.applicant_name||'<user>',o=t.applicant_dept||'';a.push(`ç”³è¯·äººï¼š${n}${o?`ï¼ˆ${o}ï¼‰`:''}`),t.apply_date&&a.push(`æ—¥æœŸï¼š${t.apply_date}`);const l=g.value;for(const e of l){if(e.fieldId.startsWith('applicant')||'apply_date'===e.fieldId)continue;const n=t[e.fieldId];if(null==n||''===n)continue;let o;if(Array.isArray(n)){if(0===n.length)continue;o=n.map(e=>{if('object'==typeof e){const t=e;return Object.values(t).filter(e=>e).join(' ')}return String(e)}).join('ã€')}else o='object'==typeof n?JSON.stringify(n):String(n);a.push(`${e.label}ï¼š${o}`)}return a.push('çŠ¶æ€ï¼šå¾…å®¡æ‰¹'),a.join(' | ')})(),o=`${t.targetPath}.${a}`;return await e.setVariable(o,n,`æäº¤${t.formName}`),console.log('[FormStore] è¡¨å•æäº¤æˆåŠŸ:',a,n),s.value={},{success:!0,appId:a}}catch(e){return console.error('[FormStore] è¡¨å•æäº¤å¤±è´¥:',e),{success:!1,error:e instanceof Error?e.message:'æäº¤å¤±è´¥'}}},shouldShowField:e=>{if(!e.showWhen)return!0;const t=e.showWhen,a=s.value[t.field];return void 0!==t.equals?a===t.equals:void 0===t.in||t.in.includes(a)},getRosterEntries:t=>{const a=e.getVariable(t,{}),n=[];for(const[e,t]of Object.entries(a)){if(e.startsWith('$')||!t||'object'!=typeof t)continue;const a=t;n.push({id:String(a.id||e),name:String(a.name||e)})}return n},quickApproveApplication:w,quickApproveAllPending:async()=>{const e=b.value.filter(e=>e.status.includes('å¾…')||e.status.includes('å®¡æ‰¹ä¸­'));if(0===e.length)return{success:!0,count:0};let t=0;for(const a of e){(await w(a.appId)).success&&t++}return{success:!0,count:t}},deleteApplication:I,deleteAllApplications:async()=>{const e=b.value;if(0===e.length)return{success:!0,count:0};let t=0;for(const a of e){(await I(a.appId)).success&&t++}return{success:!0,count:t}}}}),es={class:'field-label'},ts={key:0,class:'required-mark'},as={key:0,class:'readonly-value'},ns=['value','placeholder','maxlength'],os=['value','placeholder','maxlength'],ls={key:0,class:'char-count'},ss=['value','min','max'],rs=['value'],cs=['value'],is=['value'],us=['value'],ds=['value'],ms={class:'radio-group'},vs=['name','value','checked','onChange'],ps={class:'radio-label'},fs={class:'checkbox-option'},gs=['checked'],hs={class:'checkbox-label'},ys={class:'table-input'},Vs={class:'data-table'},Ns={key:0,class:'required-mark'},Es=['type','value','min','max','onInput'],bs=['value','onChange'],ks=['value'],Cs={class:'action-col'},Ss=['onClick'],ws={key:10,class:'help-text'},Is={key:11,class:'error-text'},Bs=(0,l.defineComponent)({__name:'FormFieldRenderer',props:{field:{},value:{},error:{}},emits:['update'],setup(e,{emit:t}){const a=e,n=t,o=Ql(),s=(0,l.computed)(()=>a.value),r=(0,l.computed)(()=>'roster'===a.field.sourceType),c=(0,l.computed)(()=>r.value&&a.field.sourcePath?o.getRosterEntries(a.field.sourcePath):[]),i=(0,l.computed)(()=>a.field.options||[]),u=(0,l.ref)([{}]);(0,l.watch)(()=>a.value,e=>{'table'===a.field.inputType&&Array.isArray(e)&&(u.value=e.length>0?[...e]:[{}])},{immediate:!0});const d=e=>'string'==typeof e?e:e.value,m=e=>'string'==typeof e?e:e.label,v=e=>{const t=e.target;n('update',a.field.fieldId,t.value)},p=()=>{u.value=[...u.value,{}],n('update',a.field.fieldId,u.value)};return(t,o)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['form-field',{'has-error':e.error}])},[(0,l.createElementVNode)('label',es,[(0,l.createTextVNode)((0,l.toDisplayString)(e.field.label)+' ',1),e.field.required?((0,l.openBlock)(),(0,l.createElementBlock)('span',ts,'*')):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' åªè¯»å­—æ®µ '),'readonly'===e.field.inputType?((0,l.openBlock)(),(0,l.createElementBlock)('div',as,(0,l.toDisplayString)(s.value||'-'),1)):'text'===e.field.inputType?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' æ–‡æœ¬è¾“å…¥ '),(0,l.createElementVNode)('input',{type:'text',class:'text-input',value:s.value,placeholder:e.field.placeholder,maxlength:e.field.maxLength,onInput:o[0]||(o[0]=e=>v(e))},null,40,ns)],64)):'textarea'===e.field.inputType?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' å¤šè¡Œæ–‡æœ¬ '),(0,l.createElementVNode)('textarea',{class:'textarea-input',value:s.value,placeholder:e.field.placeholder,maxlength:e.field.maxLength,rows:'4',onInput:o[1]||(o[1]=e=>v(e))},null,40,os),e.field.maxLength?((0,l.openBlock)(),(0,l.createElementBlock)('div',ls,(0,l.toDisplayString)(s.value?.length||0)+' / '+(0,l.toDisplayString)(e.field.maxLength),1)):(0,l.createCommentVNode)('v-if',!0)],64)):'number'===e.field.inputType?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' æ•°å­—è¾“å…¥ '),(0,l.createElementVNode)('input',{type:'number',class:'number-input',value:s.value,min:e.field.min,max:e.field.max,onInput:o[2]||(o[2]=e=>(e=>{const t=e.target,o=t.value?Number(t.value):void 0;n('update',a.field.fieldId,o)})(e))},null,40,ss)],64)):'date'===e.field.inputType?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:4},[(0,l.createCommentVNode)(' æ—¥æœŸé€‰æ‹© '),(0,l.createElementVNode)('input',{type:'date',class:'date-input',value:s.value,onInput:o[3]||(o[3]=e=>v(e))},null,40,rs)],64)):'datetime'===e.field.inputType?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:5},[(0,l.createCommentVNode)(' æ—¥æœŸæ—¶é—´é€‰æ‹© '),(0,l.createElementVNode)('input',{type:'datetime-local',class:'datetime-input',value:s.value,onInput:o[4]||(o[4]=e=>v(e))},null,40,cs)],64)):'select'===e.field.inputType?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:6},[(0,l.createCommentVNode)(' ä¸‹æ‹‰é€‰æ‹© '),(0,l.createElementVNode)('select',{class:'select-input',value:s.value,onChange:o[5]||(o[5]=e=>(e=>{const t=e.target;n('update',a.field.fieldId,t.value)})(e))},[o[7]||(o[7]=(0,l.createElementVNode)('option',{value:''},'è¯·é€‰æ‹©...',-1)),r.value?((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,{key:0},(0,l.renderList)(c.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('option',{key:e.id,value:e.name},(0,l.toDisplayString)(e.name),9,us))),128)):((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,{key:1},(0,l.renderList)(i.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('option',{key:d(e),value:d(e)},(0,l.toDisplayString)(m(e)),9,ds))),128))],40,is)],64)):'radio'===e.field.inputType?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:7},[(0,l.createCommentVNode)(' å•é€‰æŒ‰é’®ç»„ '),(0,l.createElementVNode)('div',ms,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(i.value,t=>((0,l.openBlock)(),(0,l.createElementBlock)('label',{key:d(t),class:'radio-option'},[(0,l.createElementVNode)('input',{type:'radio',name:e.field.fieldId,value:d(t),checked:s.value===d(t),onChange:e=>{return o=d(t),void n('update',a.field.fieldId,o);var o}},null,40,vs),(0,l.createElementVNode)('span',ps,(0,l.toDisplayString)(m(t)),1)]))),128))])],64)):'checkbox'===e.field.inputType?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:8},[(0,l.createCommentVNode)(' å¤é€‰æ¡† '),(0,l.createElementVNode)('label',fs,[(0,l.createElementVNode)('input',{type:'checkbox',checked:!0===s.value,onChange:o[6]||(o[6]=e=>(e=>{const t=e.target;n('update',a.field.fieldId,t.checked)})(e))},null,40,gs),(0,l.createElementVNode)('span',hs,(0,l.toDisplayString)(e.field.checkboxLabel||e.field.label),1)])],64)):'table'===e.field.inputType?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:9},[(0,l.createCommentVNode)(' è¡¨æ ¼è¾“å…¥ '),(0,l.createElementVNode)('div',ys,[(0,l.createElementVNode)('table',Vs,[(0,l.createElementVNode)('thead',null,[(0,l.createElementVNode)('tr',null,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.field.columns,e=>((0,l.openBlock)(),(0,l.createElementBlock)('th',{key:e.key},[(0,l.createTextVNode)((0,l.toDisplayString)(e.label)+' ',1),e.required?((0,l.openBlock)(),(0,l.createElementBlock)('span',Ns,'*')):(0,l.createCommentVNode)('v-if',!0)]))),128)),o[8]||(o[8]=(0,l.createElementVNode)('th',{class:'action-col'},'æ“ä½œ',-1))])]),(0,l.createElementVNode)('tbody',null,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(u.value,(t,s)=>((0,l.openBlock)(),(0,l.createElementBlock)('tr',{key:s},[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.field.columns,e=>((0,l.openBlock)(),(0,l.createElementBlock)('td',{key:e.key},['text'===e.type||'number'===e.type?((0,l.openBlock)(),(0,l.createElementBlock)('input',{key:0,type:e.type,class:'table-cell-input',value:t[e.key],min:e.min,max:e.max,onInput:t=>((e,t,o)=>{const l=o.target,s=[...u.value];s[e]={...s[e],[t]:l.value},u.value=s,n('update',a.field.fieldId,s)})(s,e.key,t)},null,40,Es)):'select'===e.type?((0,l.openBlock)(),(0,l.createElementBlock)('select',{key:1,class:'table-cell-select',value:t[e.key],onChange:t=>((e,t,o)=>{const l=o.target,s=[...u.value];s[e]={...s[e],[t]:l.value},u.value=s,n('update',a.field.fieldId,s)})(s,e.key,t)},[o[9]||(o[9]=(0,l.createElementVNode)('option',{value:''},'-',-1)),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.options,e=>((0,l.openBlock)(),(0,l.createElementBlock)('option',{key:e,value:e},(0,l.toDisplayString)(e),9,ks))),128))],40,bs)):(0,l.createCommentVNode)('v-if',!0)]))),128)),(0,l.createElementVNode)('td',Cs,[u.value.length>(e.field.minRows||1)?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'remove-row-btn',title:'åˆ é™¤è¡Œ',onClick:e=>(e=>{const t=u.value.filter((_,t)=>t!==e);u.value=t,n('update',a.field.fieldId,t)})(s)},' âœ• ',8,Ss)):(0,l.createCommentVNode)('v-if',!0)])]))),128))])]),u.value.length<(e.field.maxRows||10)?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'add-row-btn',onClick:p},' + æ·»åŠ è¡Œ ')):(0,l.createCommentVNode)('v-if',!0)])],64)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' å¸®åŠ©æ–‡æœ¬ '),e.field.helpText?((0,l.openBlock)(),(0,l.createElementBlock)('div',ws,(0,l.toDisplayString)(e.field.helpText),1)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' é”™è¯¯ä¿¡æ¯ '),e.error?((0,l.openBlock)(),(0,l.createElementBlock)('div',Is,(0,l.toDisplayString)(e.error),1)):(0,l.createCommentVNode)('v-if',!0)],2))}}),As=(0,I.A)(Bs,[['__scopeId','data-v-c036bca0']]),Ds={class:'dialog-header'},Ms={class:'dialog-icon'},xs={class:'dialog-title'},Ts={class:'dialog-body'},$s={class:'dialog-message'},_s={class:'dialog-footer'},Rs=['disabled'],Os=['disabled'],Fs={key:0,class:'loading-spinner'},Ls=(0,l.defineComponent)({__name:'ConfirmDialog',setup(e){const{state:t,handleConfirm:a,handleCancel:n}=on(),o=()=>{t.showCancel&&!t.isProcessing&&n()};return(e,s)=>((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,null,[(0,l.createCommentVNode)(' ç§»é™¤ Teleportï¼Œç›´æ¥åœ¨å½“å‰å®¹å™¨ä¸­æ¸²æŸ“ï¼Œä»¥æ”¯æŒå…¨å±æ¨¡å¼ '),(0,l.createVNode)(l.Transition,{name:'confirm-dialog'},{default:(0,l.withCtx)(()=>[(0,l.unref)(t).visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'confirm-dialog-overlay',onClick:(0,l.withModifiers)(o,['self'])},[(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['confirm-dialog',[`type-${(0,l.unref)(t).type}`]]),role:'dialog','aria-modal':'true'},[(0,l.createCommentVNode)(' å¯¹è¯æ¡†å¤´éƒ¨ '),(0,l.createElementVNode)('div',Ds,[(0,l.createElementVNode)('span',Ms,(0,l.toDisplayString)((0,l.unref)(t).icon),1),(0,l.createElementVNode)('h3',xs,(0,l.toDisplayString)((0,l.unref)(t).title),1)]),(0,l.createCommentVNode)(' å¯¹è¯æ¡†å†…å®¹ '),(0,l.createElementVNode)('div',Ts,[(0,l.createElementVNode)('p',$s,(0,l.toDisplayString)((0,l.unref)(t).message),1)]),(0,l.createCommentVNode)(' å¯¹è¯æ¡†åº•éƒ¨æŒ‰é’® '),(0,l.createElementVNode)('div',_s,[(0,l.unref)(t).showCancel?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'btn btn-cancel',disabled:(0,l.unref)(t).isProcessing,onClick:s[0]||(s[0]=(...e)=>(0,l.unref)(n)&&(0,l.unref)(n)(...e))},(0,l.toDisplayString)((0,l.unref)(t).cancelText),9,Rs)):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['btn btn-confirm',[`btn-${(0,l.unref)(t).type}`]]),disabled:(0,l.unref)(t).isProcessing,onClick:s[1]||(s[1]=(...e)=>(0,l.unref)(a)&&(0,l.unref)(a)(...e))},[(0,l.unref)(t).isProcessing?((0,l.openBlock)(),(0,l.createElementBlock)('span',Fs)):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)((0,l.unref)(t).confirmText),1)],10,Os)])],2)])):(0,l.createCommentVNode)('v-if',!0)]),_:1})],2112))}}),Ps=(0,I.A)(Ls,[['__scopeId','data-v-61be8e67']]),js={class:'records-viewer'},Us={class:'viewer-header'},zs={class:'header-left'},Ws={class:'record-count'},Hs={class:'header-right'},Gs=['disabled'],Js={class:'pending-badge'},qs=['disabled'],Ks={class:'filter-bar'},Ys={class:'filter-item'},Xs={class:'filter-item search-item'},Zs={class:'records-list'},Qs=['onClick'],er={class:'card-header'},tr={class:'card-title'},ar={class:'app-id'},nr={class:'form-type'},or={class:'card-status'},lr={class:'card-summary'},sr={class:'summary-row'},rr={class:'summary-value'},cr={key:0,class:'summary-dept'},ir={class:'summary-row'},ur={class:'summary-value'},dr={key:0,class:'card-details'},mr={class:'detail-label'},vr={class:'detail-value'},pr={class:'detail-row full-summary'},fr={class:'detail-value'},gr={class:'card-actions'},hr=['disabled','onClick'],yr=['disabled','onClick'],Vr={class:'expand-indicator'},Nr={class:'empty-state'},Er={key:0},br={key:1},kr={class:'toast-icon'},Cr={class:'toast-text'},Sr=(0,l.defineComponent)({__name:'ApplicationRecordsViewer',props:{records:{}},emits:['close'],setup(e){const t=e,a=Ql(),{confirm:n}=on(),o=(0,l.ref)(''),s=(0,l.ref)(''),r=(0,l.ref)(null),c=(0,l.ref)(!1),i=(0,l.ref)(null),u=(0,l.computed)(()=>t.records.filter(e=>d(e.status)).length),d=e=>e.includes('å¾…')||e.includes('å®¡æ‰¹ä¸­'),m=(e,t)=>{i.value={type:e,text:t},setTimeout(()=>{i.value=null},3e3)},v=async()=>{if(c.value)return;const e=u.value;if(0===e)return;if(await n({title:'æ‰¹é‡å¿«é€Ÿé€šè¿‡',message:`ç¡®å®šè¦å°† ${e} æ¡å¾…å®¡æ‰¹çš„ç”³è¯·å…¨éƒ¨å¿«é€Ÿé€šè¿‡å—ï¼Ÿ\n\næ­¤æ“ä½œå°†è·³è¿‡æ­£å¸¸å®¡æ‰¹æµç¨‹ï¼Œç›´æ¥å°†æ‰€æœ‰å¾…å®¡æ‰¹ç”³è¯·æ ‡è®°ä¸º"å·²æ‰¹å‡†"ã€‚`,type:'warning',icon:'âš¡',confirmText:'å…¨éƒ¨é€šè¿‡',cancelText:'å–æ¶ˆ'})){c.value=!0;try{const e=await a.quickApproveAllPending();e.success?m('success',`å·²æˆåŠŸé€šè¿‡ ${e.count} æ¡ç”³è¯·`):m('error',`æ“ä½œå¤±è´¥: ${e.error}`)}finally{c.value=!1}}},p=async()=>{if(c.value)return;const e=t.records.length;if(0===e)return;if(await n({title:'æ¸…ç©ºæ‰€æœ‰è®°å½•',message:`ç¡®å®šè¦åˆ é™¤å…¨éƒ¨ ${e} æ¡ç”³è¯·è®°å½•å—ï¼Ÿ\n\nâš ï¸ æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼Œæ‰€æœ‰è®°å½•å°†è¢«æ°¸ä¹…åˆ é™¤ï¼`,type:'danger',icon:'ğŸ—‘ï¸',confirmText:'å…¨éƒ¨åˆ é™¤',cancelText:'å–æ¶ˆ'})){c.value=!0;try{const e=await a.deleteAllApplications();e.success?(m('success',`å·²åˆ é™¤ ${e.count} æ¡ç”³è¯·è®°å½•`),r.value=null):m('error',`æ“ä½œå¤±è´¥: ${e.error}`)}finally{c.value=!1}}},f=(0,l.computed)(()=>{let e=t.records;if(o.value&&(e=e.filter(e=>e.status.includes(o.value))),s.value.trim()){const t=s.value.toLowerCase();e=e.filter(e=>e.appId.toLowerCase().includes(t)||e.summary.toLowerCase().includes(t)||e.applicant.toLowerCase().includes(t))}return e}),g=e=>e.includes('å·²æ‰¹å‡†')||e.includes('å·²é€šè¿‡')?'status-approved':e.includes('å·²æ‹’ç»')||e.includes('å·²é©³å›')?'status-rejected':e.includes('å®¡æ‰¹ä¸­')||e.includes('å¾…')?'status-pending':'status-default';return(t,h)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',js,[(0,l.createCommentVNode)(' å¤´éƒ¨ '),(0,l.createElementVNode)('div',Us,[(0,l.createElementVNode)('div',zs,[h[3]||(h[3]=(0,l.createElementVNode)('span',{class:'viewer-icon'},'ğŸ“‹',-1)),h[4]||(h[4]=(0,l.createElementVNode)('h3',null,'ç”³è¯·è®°å½•',-1)),(0,l.createElementVNode)('span',Ws,(0,l.toDisplayString)(e.records.length)+' æ¡',1)]),(0,l.createElementVNode)('div',Hs,[(0,l.createCommentVNode)(' æ‰¹é‡å¿«é€Ÿé€šè¿‡æŒ‰é’® '),u.value>0?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'quick-approve-all-btn',disabled:c.value,title:'å°†æ‰€æœ‰å¾…å®¡æ‰¹çš„ç”³è¯·å¿«é€Ÿé€šè¿‡',onClick:(0,l.withModifiers)(v,['stop'])},[h[5]||(h[5]=(0,l.createElementVNode)('span',{class:'btn-icon'},'âš¡',-1)),h[6]||(h[6]=(0,l.createElementVNode)('span',{class:'btn-text'},'å…¨éƒ¨é€šè¿‡',-1)),(0,l.createElementVNode)('span',Js,(0,l.toDisplayString)(u.value),1)],8,Gs)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' æ‰¹é‡åˆ é™¤æŒ‰é’® '),e.records.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:1,class:'delete-all-btn',disabled:c.value,title:'åˆ é™¤æ‰€æœ‰ç”³è¯·è®°å½•',onClick:(0,l.withModifiers)(p,['stop'])},[...h[7]||(h[7]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ—‘ï¸',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'æ¸…ç©ºè®°å½•',-1)])],8,qs)):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('button',{class:'close-btn',title:'å…³é—­',onClick:h[0]||(h[0]=e=>t.$emit('close'))},'âœ•')])]),(0,l.createCommentVNode)(' ç­›é€‰æ  '),(0,l.createElementVNode)('div',Ks,[(0,l.createElementVNode)('div',Ys,[h[9]||(h[9]=(0,l.createElementVNode)('label',null,'çŠ¶æ€ç­›é€‰ï¼š',-1)),(0,l.withDirectives)((0,l.createElementVNode)('select',{'onUpdate:modelValue':h[1]||(h[1]=e=>o.value=e),class:'filter-select'},[...h[8]||(h[8]=[(0,l.createStaticVNode)('<option value="" data-v-5799a0c8>å…¨éƒ¨</option><option value="å¾…å®¡æ‰¹" data-v-5799a0c8>å¾…å®¡æ‰¹</option><option value="å®¡æ‰¹ä¸­" data-v-5799a0c8>å®¡æ‰¹ä¸­</option><option value="å·²æ‰¹å‡†" data-v-5799a0c8>å·²æ‰¹å‡†</option><option value="å·²æ‹’ç»" data-v-5799a0c8>å·²æ‹’ç»</option>',5)])],512),[[l.vModelSelect,o.value]])]),(0,l.createElementVNode)('div',Xs,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':h[2]||(h[2]=e=>s.value=e),type:'text',class:'search-input',placeholder:'æœç´¢ç”³è¯·ç¼–å·æˆ–å†…å®¹...'},null,512),[[l.vModelText,s.value]]),h[10]||(h[10]=(0,l.createElementVNode)('span',{class:'search-icon'},'ğŸ”',-1))])]),(0,l.createCommentVNode)(' è®°å½•åˆ—è¡¨ '),(0,l.createElementVNode)('div',Zs,[f.value.length>0?((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,{key:0},(0,l.renderList)(f.value,e=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.appId,class:(0,l.normalizeClass)(['record-card',g(e.status)]),onClick:t=>{return a=e.appId,void(r.value=r.value===a?null:a);var a}},[(0,l.createCommentVNode)(' å¡ç‰‡å¤´éƒ¨ '),(0,l.createElementVNode)('div',er,[(0,l.createElementVNode)('div',tr,[(0,l.createElementVNode)('span',ar,(0,l.toDisplayString)(e.appId),1),(0,l.createElementVNode)('span',nr,(0,l.toDisplayString)(e.formType),1)]),(0,l.createElementVNode)('div',or,[(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['status-badge',g(e.status)])},(0,l.toDisplayString)((t=e.status,t.includes('å·²æ‰¹å‡†')||t.includes('å·²é€šè¿‡')?'âœ“ å·²æ‰¹å‡†':t.includes('å·²æ‹’ç»')||t.includes('å·²é©³å›')?'âœ— å·²æ‹’ç»':t.includes('å®¡æ‰¹ä¸­')?'â³ å®¡æ‰¹ä¸­':t.includes('å¾…')?'â³ å¾…å®¡æ‰¹':t)),3)])]),(0,l.createCommentVNode)(' å¡ç‰‡æ‘˜è¦ '),(0,l.createElementVNode)('div',lr,[(0,l.createElementVNode)('div',sr,[h[11]||(h[11]=(0,l.createElementVNode)('span',{class:'summary-label'},'ç”³è¯·äººï¼š',-1)),(0,l.createElementVNode)('span',rr,(0,l.toDisplayString)(e.applicant),1),e.details['éƒ¨é—¨']?((0,l.openBlock)(),(0,l.createElementBlock)('span',cr,'ï¼ˆ'+(0,l.toDisplayString)(e.details['éƒ¨é—¨'])+'ï¼‰',1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',ir,[h[12]||(h[12]=(0,l.createElementVNode)('span',{class:'summary-label'},'æ—¥æœŸï¼š',-1)),(0,l.createElementVNode)('span',ur,(0,l.toDisplayString)(e.date),1)])]),(0,l.createCommentVNode)(' å±•å¼€è¯¦æƒ… '),r.value===e.appId?((0,l.openBlock)(),(0,l.createElementBlock)('div',dr,[h[16]||(h[16]=(0,l.createElementVNode)('div',{class:'details-divider'},null,-1)),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.details,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t,class:'detail-row'},[(0,l.createElementVNode)('span',mr,(0,l.toDisplayString)(t)+'ï¼š',1),(0,l.createElementVNode)('span',vr,(0,l.toDisplayString)(e),1)]))),128)),(0,l.createElementVNode)('div',pr,[h[13]||(h[13]=(0,l.createElementVNode)('span',{class:'detail-label'},'å®Œæ•´æ‘˜è¦ï¼š',-1)),(0,l.createElementVNode)('span',fr,(0,l.toDisplayString)(e.summary),1)]),(0,l.createCommentVNode)(' æ“ä½œæŒ‰é’® '),(0,l.createElementVNode)('div',gr,[(0,l.createCommentVNode)(' å¿«é€Ÿé€šè¿‡æŒ‰é’®ï¼ˆä»…å¯¹å¾…å®¡æ‰¹/å®¡æ‰¹ä¸­çš„è®°å½•æ˜¾ç¤ºï¼‰ '),d(e.status)?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'quick-approve-btn',disabled:c.value,onClick:(0,l.withModifiers)(t=>(async e=>{if(!c.value){c.value=!0;try{const t=await a.quickApproveApplication(e);t.success?m('success','ç”³è¯·å·²å¿«é€Ÿé€šè¿‡'):(console.error('å¿«é€Ÿé€šè¿‡å¤±è´¥:',t.error),m('error',`å¿«é€Ÿé€šè¿‡å¤±è´¥: ${t.error}`))}finally{c.value=!1}}})(e.appId),['stop'])},[h[14]||(h[14]=(0,l.createElementVNode)('span',{class:'btn-icon'},'âš¡',-1)),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(c.value?'å¤„ç†ä¸­...':'å¿«é€Ÿé€šè¿‡'),1)],8,hr)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' åˆ é™¤æŒ‰é’® '),(0,l.createElementVNode)('button',{class:'delete-btn',disabled:c.value,onClick:(0,l.withModifiers)(t=>(async e=>{if(c.value)return;if(await n({title:'åˆ é™¤ç”³è¯·è®°å½•',message:`ç¡®å®šè¦åˆ é™¤ç”³è¯·è®°å½• "${e}" å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`,type:'danger',icon:'ğŸ—‘ï¸',confirmText:'ç¡®è®¤åˆ é™¤',cancelText:'å–æ¶ˆ'})){c.value=!0;try{const t=await a.deleteApplication(e);t.success?(m('success','ç”³è¯·è®°å½•å·²åˆ é™¤'),r.value===e&&(r.value=null)):(console.error('åˆ é™¤å¤±è´¥:',t.error),m('error',`åˆ é™¤å¤±è´¥: ${t.error}`))}finally{c.value=!1}}})(e.appId),['stop'])},[h[15]||(h[15]=(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ—‘ï¸',-1)),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(c.value?'å¤„ç†ä¸­...':'åˆ é™¤'),1)],8,yr)])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' å±•å¼€æŒ‡ç¤ºå™¨ '),(0,l.createElementVNode)('div',Vr,[(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(r.value===e.appId?'â–² æ”¶èµ·':'â–¼ å±•å¼€è¯¦æƒ…'),1)])],10,Qs);var t}),128)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' ç©ºçŠ¶æ€ '),(0,l.createElementVNode)('div',Nr,[h[17]||(h[17]=(0,l.createElementVNode)('div',{class:'empty-icon'},'ğŸ“­',-1)),0===e.records.length?((0,l.openBlock)(),(0,l.createElementBlock)('p',Er,'æš‚æ— ç”³è¯·è®°å½•')):((0,l.openBlock)(),(0,l.createElementBlock)('p',br,'æ²¡æœ‰ç¬¦åˆç­›é€‰æ¡ä»¶çš„è®°å½•'))])],2112))]),(0,l.createCommentVNode)(' æ“ä½œç»“æœæç¤º '),(0,l.createVNode)(l.Transition,{name:'result-toast'},{default:(0,l.withCtx)(()=>[i.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:(0,l.normalizeClass)(['result-toast',i.value.type])},[(0,l.createElementVNode)('span',kr,(0,l.toDisplayString)('success'===i.value.type?'âœ…':'âŒ'),1),(0,l.createElementVNode)('span',Cr,(0,l.toDisplayString)(i.value.text),1)],2)):(0,l.createCommentVNode)('v-if',!0)]),_:1}),(0,l.createCommentVNode)(' ç¡®è®¤å¯¹è¯æ¡† '),(0,l.createVNode)(Ps)]))}}),wr=(0,I.A)(Sr,[['__scopeId','data-v-5799a0c8']]),Ir={class:'panel-header'},Br={class:'header-center'},Ar={class:'view-toggle'},Dr={key:0,class:'record-badge'},Mr={class:'header-right'},xr={class:'form-count'},Tr={class:'panel-main'},$r={class:'sidebar-header'},_r={key:0,class:'sidebar-title'},Rr=['title'],Or={key:0,class:'form-list'},Fr=['onClick'],Lr={class:'form-info'},Pr={class:'form-title'},jr={key:0,class:'form-desc'},Ur={key:1,class:'sidebar-empty'},zr={key:2,class:'collapsed-list'},Wr=['title','onClick'],Hr={class:'panel-body'},Gr={key:0,class:'state-container loading-state'},Jr={class:'state-container error-state'},qr={class:'form-header'},Kr={class:'form-header-top'},Yr={class:'form-title-section'},Xr={class:'form-title'},Zr={key:0,class:'form-description'},Qr={class:'form-header-actions'},ec=['disabled'],tc={key:0,class:'workflow-hint'},ac={key:0,class:'workflow-arrow'},nc={class:'form-fields'},oc={class:'form-actions'},lc=['disabled'],sc=['disabled'],rc={key:1,class:'submit-success'},cc=(0,l.defineComponent)({__name:'FormPanel',emits:['close'],setup(e){const t=Ql(),{isLoading:n,error:o,formData:s}=a(t),r=(0,l.computed)(()=>t.availableForms),c=(0,l.computed)(()=>t.formCount),i=(0,l.computed)(()=>t.hasNoForms),u=(0,l.computed)(()=>t.effectiveFormId),d=(0,l.computed)(()=>t.currentForm),m=(0,l.computed)(()=>t.currentFields),v=(0,l.computed)(()=>t.currentFormMeta),p=(0,l.computed)(()=>t.getCurrentFormApplications),f=(0,l.computed)(()=>t.applicationCount),{initialize:g,refresh:h,selectForm:y,updateField:V,validateForm:N,submitForm:E,shouldShowField:b,initializeFormData:k,autoFillFormData:C}=t,S=(0,l.ref)('form'),w=(0,l.ref)(!1),I=(0,l.ref)({}),B=(0,l.ref)(!1),A=(0,l.ref)(!1),D=(0,l.ref)(''),M=()=>{w.value=!w.value},x=(e,t=30)=>e.length>t?e.slice(0,t)+'...':e,T=e=>u.value===e,R=async e=>{console.log('[FormPanel] handleSelectForm è¢«è°ƒç”¨:',e),await y(e),console.log('[FormPanel] selectForm å®Œæˆ'),I.value={},A.value=!1},O=(e,t)=>{if(V(e,t),I.value[e]){const t={...I.value};delete t[e],I.value=t}},F=()=>{C(),I.value={}},L=()=>{k(),I.value={},A.value=!1},P=async()=>{B.value=!0,A.value=!1;const e=N();if(!e.valid)return I.value=e.errors,void(B.value=!1);const t=await E();B.value=!1,t.success?(A.value=!0,D.value=t.appId||'',I.value={},setTimeout(()=>{A.value=!1},5e3)):t.error&&(I.value={_global:t.error})};return(0,l.watch)(u,(e,t)=>{console.log('[FormPanel] effectiveFormId å˜åŒ–:',t,'->',e),e&&k()}),(0,l.watch)(d,(e,t)=>{console.log('[FormPanel] currentForm å˜åŒ–:',t?.meta?.formName,'->',e?.meta?.formName)}),(0,l.watch)(m,e=>{console.log('[FormPanel] currentFields å˜åŒ–, å­—æ®µæ•°:',e.length)},{deep:!0}),(0,l.watch)(v,(e,t)=>{console.log('[FormPanel] currentFormMeta å˜åŒ–:',t?.formName,'->',e?.formName)}),(0,l.onMounted)(()=>{g()}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['form-panel',{'sidebar-collapsed':w.value}])},[(0,l.createCommentVNode)(' é¡¶éƒ¨å¤´æ  '),(0,l.createElementVNode)('div',Ir,[t[8]||(t[8]=(0,l.createElementVNode)('div',{class:'header-left'},[(0,l.createElementVNode)('span',{class:'panel-icon'},'ğŸ“'),(0,l.createElementVNode)('h2',null,'è¡¨å•ç”³è¯·')],-1)),(0,l.createElementVNode)('div',Br,[(0,l.createCommentVNode)(' è§†å›¾åˆ‡æ¢æŒ‰é’® '),(0,l.createElementVNode)('div',Ar,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['toggle-btn',{active:'form'===S.value}]),onClick:t[0]||(t[0]=e=>S.value='form')},[...t[5]||(t[5]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ“',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'å¡«å†™ç”³è¯·',-1)])],2),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['toggle-btn',{active:'records'===S.value}]),onClick:t[1]||(t[1]=e=>S.value='records')},[t[6]||(t[6]=(0,l.createElementVNode)('span',{class:'btn-icon'},'ğŸ“‹',-1)),t[7]||(t[7]=(0,l.createElementVNode)('span',{class:'btn-text'},'ç”³è¯·è®°å½•',-1)),f.value>0?((0,l.openBlock)(),(0,l.createElementBlock)('span',Dr,(0,l.toDisplayString)(f.value),1)):(0,l.createCommentVNode)('v-if',!0)],2)])]),(0,l.createElementVNode)('div',Mr,[(0,l.createElementVNode)('span',xr,(0,l.toDisplayString)(c.value)+' ç§è¡¨å•',1),(0,l.createElementVNode)('button',{class:'close-btn',title:'å…³é—­',onClick:t[2]||(t[2]=t=>e.$emit('close'))},'âœ•')])]),(0,l.createElementVNode)('div',Tr,[(0,l.createCommentVNode)(' å·¦ä¾§è¡¨å•åˆ—è¡¨ä¾§æ  '),(0,l.createElementVNode)('aside',{class:(0,l.normalizeClass)(['form-sidebar',{collapsed:w.value}])},[(0,l.createElementVNode)('div',$r,[w.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',_r,'è¡¨å•åˆ—è¡¨')),(0,l.createElementVNode)('button',{class:'toggle-btn',title:w.value?'å±•å¼€ä¾§æ ':'æ”¶èµ·ä¾§æ ',onClick:M},(0,l.toDisplayString)(w.value?'â–¶':'â—€'),9,Rr)]),!w.value&&c.value>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',Or,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(r.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.formId,class:(0,l.normalizeClass)(['form-item',{active:T(e.formId)}]),onClick:t=>R(e.formId)},[t[9]||(t[9]=(0,l.createElementVNode)('span',{class:'form-icon'},'ğŸ“‹',-1)),(0,l.createElementVNode)('div',Lr,[(0,l.createElementVNode)('span',Pr,(0,l.toDisplayString)(e.formName),1),e.description?((0,l.openBlock)(),(0,l.createElementBlock)('span',jr,(0,l.toDisplayString)(x(e.description)),1)):(0,l.createCommentVNode)('v-if',!0)])],10,Fr))),128))])):(0,l.createCommentVNode)('v-if',!0),w.value||0!==c.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('div',Ur,[...t[10]||(t[10]=[(0,l.createElementVNode)('span',null,'æš‚æ— è¡¨å•',-1)])])),(0,l.createCommentVNode)(' æ”¶ç¼©çŠ¶æ€ä¸‹çš„å›¾æ ‡åˆ—è¡¨ '),w.value&&c.value>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',zr,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(r.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.formId,class:(0,l.normalizeClass)(['collapsed-item',{active:T(e.formId)}]),title:e.formName,onClick:t=>R(e.formId)},' ğŸ“‹ ',10,Wr))),128))])):(0,l.createCommentVNode)('v-if',!0)],2),(0,l.createCommentVNode)(' å³ä¾§å†…å®¹åŒº '),(0,l.createElementVNode)('div',Hr,[(0,l.createCommentVNode)(' è¡¨å•å¡«å†™è§†å›¾ '),'form'===S.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:0},[(0,l.createCommentVNode)(' åŠ è½½çŠ¶æ€ '),(0,l.unref)(n)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Gr,[...t[11]||(t[11]=[(0,l.createElementVNode)('div',{class:'state-icon'},'â³',-1),(0,l.createElementVNode)('p',null,'åŠ è½½ä¸­...',-1)])])):(0,l.unref)(o)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' é”™è¯¯çŠ¶æ€ '),(0,l.createElementVNode)('div',Jr,[t[12]||(t[12]=(0,l.createElementVNode)('div',{class:'state-icon'},'âš ï¸',-1)),(0,l.createElementVNode)('p',null,(0,l.toDisplayString)((0,l.unref)(o)),1),(0,l.createElementVNode)('button',{class:'retry-btn',onClick:t[3]||(t[3]=(...e)=>(0,l.unref)(h)&&(0,l.unref)(h)(...e))},'é‡è¯•')])],2112)):i.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' æ— è¡¨å•çŠ¶æ€ '),t[13]||(t[13]=(0,l.createElementVNode)('div',{class:'state-container empty-state'},[(0,l.createElementVNode)('div',{class:'state-icon'},'ğŸ“­'),(0,l.createElementVNode)('p',null,'æš‚æ— å¯ç”¨è¡¨å•'),(0,l.createElementVNode)('p',{class:'empty-hint'},[(0,l.createTextVNode)('è¡¨å•å®šä¹‰ä» '),(0,l.createElementVNode)('code',null,'MC.æ–‡æ¡£'),(0,l.createTextVNode)(' ä¸­çš„è§„ç« åˆ¶åº¦è§£æ')]),(0,l.createElementVNode)('p',{class:'empty-hint'},[(0,l.createTextVNode)('åœ¨è§„ç« åˆ¶åº¦ä¸­æ·»åŠ  '),(0,l.createElementVNode)('code',null,'$formMeta'),(0,l.createTextVNode)(' å’Œ '),(0,l.createElementVNode)('code',null,'$fieldDef'),(0,l.createTextVNode)(' å³å¯åˆ›å»ºè¡¨å•')])],-1))],2112)):d.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' è¡¨å•å†…å®¹ '),((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:u.value,class:'form-content'},[(0,l.createCommentVNode)(' è¡¨å•æ ‡é¢˜ '),(0,l.createElementVNode)('div',qr,[(0,l.createElementVNode)('div',Kr,[(0,l.createElementVNode)('div',Yr,[(0,l.createElementVNode)('h3',Xr,(0,l.toDisplayString)(v.value?.formName),1),v.value?.description?((0,l.openBlock)(),(0,l.createElementBlock)('span',Zr,(0,l.toDisplayString)(v.value.description),1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',Qr,[(0,l.createElementVNode)('button',{class:'auto-fill-btn',disabled:B.value,title:'ä»å˜é‡ç³»ç»Ÿè‡ªåŠ¨å¡«å†™ç”³è¯·äººã€éƒ¨é—¨ã€æ—¥æœŸç­‰å›ºå®šä¿¡æ¯',onClick:F},[...t[14]||(t[14]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'âœ¨',-1),(0,l.createElementVNode)('span',{class:'btn-text'},'è‡ªåŠ¨å¡«å†™',-1)])],8,ec)])])]),(0,l.createCommentVNode)(' å·¥ä½œæµæç¤º '),v.value?.workflow?((0,l.openBlock)(),(0,l.createElementBlock)('div',tc,[t[15]||(t[15]=(0,l.createElementVNode)('span',{class:'workflow-label'},'å®¡æ‰¹æµç¨‹ï¼š',-1)),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(v.value.workflow,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('span',{key:e.step,class:'workflow-step'},[(0,l.createTextVNode)((0,l.toDisplayString)(e.name)+' ',1),t<v.value.workflow.length-1?((0,l.openBlock)(),(0,l.createElementBlock)('span',ac,'â†’')):(0,l.createCommentVNode)('v-if',!0)]))),128))])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' è¡¨å•å­—æ®µ '),(0,l.createElementVNode)('div',nc,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(m.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:e.fieldId},[(0,l.unref)(b)(e)?((0,l.openBlock)(),(0,l.createBlock)(As,{key:0,field:e,value:(0,l.unref)(s)[e.fieldId],error:I.value[e.fieldId],onUpdate:O},null,8,['field','value','error'])):(0,l.createCommentVNode)('v-if',!0)],64))),128))]),(0,l.createCommentVNode)(' æäº¤æŒ‰é’® '),(0,l.createElementVNode)('div',oc,[(0,l.createElementVNode)('button',{class:'reset-btn',disabled:B.value,onClick:L},'é‡ç½®',8,lc),(0,l.createElementVNode)('button',{class:'submit-btn',disabled:B.value,onClick:P},(0,l.toDisplayString)(B.value?'æäº¤ä¸­...':'æäº¤ç”³è¯·'),9,sc)]),(0,l.createCommentVNode)(' æäº¤æˆåŠŸæç¤º '),A.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',rc,[t[16]||(t[16]=(0,l.createElementVNode)('span',{class:'success-icon'},'âœ…',-1)),(0,l.createElementVNode)('span',null,'ç”³è¯·å·²æäº¤ï¼Œç¼–å·ï¼š'+(0,l.toDisplayString)(D.value),1)])):(0,l.createCommentVNode)('v-if',!0)]))],2112)):(0,l.createCommentVNode)('v-if',!0)],64)):'records'===S.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' ç”³è¯·è®°å½•è§†å›¾ '),(0,l.createVNode)(wr,{records:p.value,onClose:t[4]||(t[4]=e=>S.value='form')},null,8,['records'])],64)):(0,l.createCommentVNode)('v-if',!0)])])],2))}}),ic=(0,I.A)(cc,[['__scopeId','data-v-a02a6064']]),uc={HISTORY_TEXT:'å†å²æ­£æ–‡',HISTORY_RECORD:'å†å²è®°å½•',SEGMENTED_TEXT:'åˆ†æ®µæ­£æ–‡',SMALL_SUMMARY:'å°æ€»ç»“',LARGE_SUMMARY:'å¤§æ€»ç»“'},dc={segmentCount:3,smallSummaryCount:25},mc={[uc.HISTORY_TEXT]:{name:uc.HISTORY_TEXT,enabled:!1,depth:2,order:100,role:'system'},[uc.HISTORY_RECORD]:{name:uc.HISTORY_RECORD,enabled:!1,depth:2,order:99,role:'system'},[uc.SEGMENTED_TEXT]:{name:uc.SEGMENTED_TEXT,enabled:!0,depth:2,order:100,role:'system'},[uc.SMALL_SUMMARY]:{name:uc.SMALL_SUMMARY,enabled:!0,depth:4,order:90,role:'system'},[uc.LARGE_SUMMARY]:{name:uc.LARGE_SUMMARY,enabled:!0,depth:6,order:80,role:'system'}},vc='\nâ€”â€”â€”â€”â€”â€”\n',pc='\n\n---\n\n';class fc{static extractHistoryRecordTag(e){if(!e||'string'!=typeof e)return null;const t=[...e.matchAll(/<å†å²è®°å½•>([\s\S]*?)<\/å†å²è®°å½•>/gi)];return t.length>0?t[t.length-1][1].trim():null}static extractGameTextTag(e){if(!e||'string'!=typeof e)return null;const t=[...e.matchAll(/<gametxt>([\s\S]*?)<\/gametxt>/gi)];if(t.length>0){return t[t.length-1][1].trim().replace(/<!--[\s\S]*?-->/g,'').trim()}return null}static KNOWN_FIELDS=['åºå·','æ—¥æœŸ','åœ°ç‚¹','æè¿°','æ ‡ç­¾','é‡è¦ä¿¡æ¯','è‡ªåŠ¨åŒ–ç³»ç»Ÿ'];static isFieldLine(e){const t=e.indexOf('|');if(-1===t)return null;const a=e.substring(0,t).trim();return this.KNOWN_FIELDS.includes(a)?a:null}static parseRecord(e){if(!e||'string'!=typeof e)return null;const t={_raw:e},a=e.split('\n');let n=null,o=[];const l=()=>{if(n&&o.length>0){const e=o.join('\n').trim();this.setFieldValue(t,n,e)}n=null,o=[]};for(const e of a){const t=e.trim(),a=this.isFieldLine(t);if(a){l(),n=a;const e=t.indexOf('|'),s=t.substring(e+1).trim();s&&o.push(s)}else n&&t&&o.push(t)}return l(),'number'!=typeof t.åºå·||isNaN(t.åºå·)?(console.warn('[HistoryRecordParser] è§£æå¤±è´¥ï¼šç¼ºå°‘æœ‰æ•ˆçš„åºå·å­—æ®µ'),null):{åºå·:t.åºå·,æ—¥æœŸ:t.æ—¥æœŸ||'',åœ°ç‚¹:t.åœ°ç‚¹||'',æè¿°:t.æè¿°||'',æ ‡ç­¾:t.æ ‡ç­¾||[],é‡è¦ä¿¡æ¯:t.é‡è¦ä¿¡æ¯||'',è‡ªåŠ¨åŒ–ç³»ç»Ÿ:t.è‡ªåŠ¨åŒ–ç³»ç»Ÿ||'',_raw:t._raw}}static setFieldValue(e,t,a){switch(t){case'åºå·':e.åºå·=parseInt(a,10);break;case'æ—¥æœŸ':e.æ—¥æœŸ=a;break;case'åœ°ç‚¹':e.åœ°ç‚¹=a;break;case'æè¿°':e.æè¿°=a;break;case'æ ‡ç­¾':e.æ ‡ç­¾=a.split('|').map(e=>e.trim()).filter(e=>e);break;case'é‡è¦ä¿¡æ¯':e.é‡è¦ä¿¡æ¯=a;break;case'è‡ªåŠ¨åŒ–ç³»ç»Ÿ':e.è‡ªåŠ¨åŒ–ç³»ç»Ÿ=a}}static parseRecords(e){if(!e||'string'!=typeof e)return[];const t=[],a=e.split(vc).filter(e=>e.trim());for(const e of a){const a=this.parseRecord(e.trim());a&&t.push(a)}if(0===t.length){const a=/<å†å²è®°å½•>([\s\S]*?)<\/å†å²è®°å½•>/gi,n=[...e.matchAll(a)];for(const e of n){const a=this.parseRecord(e[1].trim());a&&t.push(a)}}return t.sort((e,t)=>e.åºå·-t.åºå·),t}static parseHistoryTexts(e){if(!e||'string'!=typeof e)return[];const t=[],a=e.split(pc).filter(e=>e.trim());for(let e=0;e<a.length;e++){const n=a[e].trim().replace(/<!--[\s\S]*?-->/g,'').trim();n&&t.push({åºå·:e+1,å†…å®¹:n})}if(0===t.length){const a=/<gametxt>([\s\S]*?)<\/gametxt>/gi,n=[...e.matchAll(a)];for(let e=0;e<n.length;e++){const a=n[e][1].trim().replace(/<!--[\s\S]*?-->/g,'').trim();a&&t.push({åºå·:e+1,å†…å®¹:a})}}return t}static formatRecordFields(e,t){const a=[];for(const n of t){if('_raw'===n)continue;const t=e[n];null!=t&&''!==t&&('æ ‡ç­¾'===n&&Array.isArray(t)?t.length>0&&a.push(t.join('|')):'æ—¥æœŸ'===n||'æè¿°'===n?a.push(String(t)):'è‡ªåŠ¨åŒ–ç³»ç»Ÿ'===n?a.push(`è‡ªåŠ¨åŒ–ç³»ç»Ÿ|${t}`):a.push(String(t)))}return a.join(' ')}static formatSmallSummary(e){if(!e||0===e.length)return'';return e.map(e=>{const t=[];return e.æ—¥æœŸ&&t.push(e.æ—¥æœŸ),e.é‡è¦ä¿¡æ¯&&t.push(e.é‡è¦ä¿¡æ¯),e.è‡ªåŠ¨åŒ–ç³»ç»Ÿ&&t.push(`è‡ªåŠ¨åŒ–ç³»ç»Ÿ|${e.è‡ªåŠ¨åŒ–ç³»ç»Ÿ}`),t.join(' ')}).join(vc)}static formatLargeSummary(e){if(!e||0===e.length)return'';return e.map(e=>{const t=[];return e.æ—¥æœŸ&&t.push(e.æ—¥æœŸ),e.æè¿°&&t.push(e.æè¿°),t.join(' ')}).join(vc)}static formatSegmentedText(e){return e&&0!==e.length?e.map(e=>e.å†…å®¹).join(pc):''}static serializeRecords(e){return e&&0!==e.length?e.map(e=>{const t=[];return t.push(`åºå·|${e.åºå·}`),e.æ—¥æœŸ&&t.push(`æ—¥æœŸ|${e.æ—¥æœŸ}`),e.åœ°ç‚¹&&t.push(`åœ°ç‚¹|${e.åœ°ç‚¹}`),e.æè¿°&&t.push(`æè¿°|${e.æè¿°}`),e.æ ‡ç­¾&&e.æ ‡ç­¾.length>0&&t.push(`æ ‡ç­¾|${e.æ ‡ç­¾.join('|')}`),e.é‡è¦ä¿¡æ¯&&t.push(`é‡è¦ä¿¡æ¯|${e.é‡è¦ä¿¡æ¯}`),e.è‡ªåŠ¨åŒ–ç³»ç»Ÿ&&t.push(`è‡ªåŠ¨åŒ–ç³»ç»Ÿ|${e.è‡ªåŠ¨åŒ–ç³»ç»Ÿ}`),t.join('\n')}).join(vc):''}static serializeTexts(e){return e&&0!==e.length?e.map(e=>e.å†…å®¹).join(pc):''}static getRecordCount(e){if(!e)return 0;const t=e.split(vc).filter(e=>e.trim());if(t.length>0)return t.length;const a=e.match(/<å†å²è®°å½•>/gi);return a&&a.length>0?a.length:0}static getTextCount(e){if(!e)return 0;const t=e.split(pc).filter(e=>e.trim());if(t.length>0)return t.length;const a=e.match(/<gametxt>/gi);return a&&a.length>0?a.length:0}static getLatestSequence(e){return e&&0!==e.length?Math.max(...e.map(e=>e.åºå·)):0}static appendRecord(e,t){return e&&e.trim()?`${e}${vc}${t}`:t}static appendText(e,t){return e&&e.trim()?`${e}${pc}${t}`:t}}const gc=new class{lorebook='ã€MCæˆ¿å­ã€‘';initialized=!1;isAvailable(){return'function'==typeof getWorldbook&&'function'==typeof updateWorldbookWith}async initialize(e){try{if(e&&(this.lorebook=e),!this.isAvailable())return console.warn('[WorldbookService] ä¸–ç•Œä¹¦å…¨å±€APIä¸å¯ç”¨ï¼Œå¯èƒ½ä¸åœ¨é…’é¦†ç¯å¢ƒä¸­'),this.initialized=!0,!0;try{const e=await getWorldbook(this.lorebook);console.log(`[WorldbookService] ä¸–ç•Œä¹¦"${this.lorebook}"å·²å­˜åœ¨ï¼ŒåŒ…å«${e.length}ä¸ªæ¡ç›®`)}catch{console.log(`[WorldbookService] ä¸–ç•Œä¹¦"${this.lorebook}"ä¸å­˜åœ¨ï¼Œå°†åœ¨éœ€è¦æ—¶åˆ›å»º`)}return this.initialized=!0,console.log('[WorldbookService] åˆå§‹åŒ–å®Œæˆï¼Œä¸–ç•Œä¹¦:',this.lorebook),!0}catch(e){return console.error('[WorldbookService] åˆå§‹åŒ–å¤±è´¥:',e),!1}}async getEntry(e){try{if(!this.isAvailable())return console.warn('[WorldbookService] ä¸–ç•Œä¹¦APIä¸å¯ç”¨'),null;const t=await getWorldbook(this.lorebook);if(!t||!Array.isArray(t))return null;return t.find(t=>t.name===e)||null}catch(t){return console.error(`[WorldbookService] è·å–æ¡ç›®"${e}"å¤±è´¥:`,t),null}}async getEntryContent(e){const t=await this.getEntry(e);return t?.content||''}async setEntryContent(e,t){try{if(!this.isAvailable())return console.warn('[WorldbookService] ä¸–ç•Œä¹¦APIä¸å¯ç”¨'),!1;return await this.getEntry(e)?(await updateWorldbookWith(this.lorebook,a=>a.map(a=>a.name===e?{...a,content:t}:a)),console.log(`[WorldbookService] æ›´æ–°æ¡ç›®"${e}"æˆåŠŸï¼Œå†…å®¹é•¿åº¦: ${t.length}`),!0):(console.log(`[WorldbookService] æ¡ç›®"${e}"ä¸å­˜åœ¨ï¼Œè·³è¿‡æ›´æ–°ï¼ˆä¸è‡ªåŠ¨åˆ›å»ºï¼‰`),!1)}catch(t){return console.error(`[WorldbookService] è®¾ç½®æ¡ç›®"${e}"å†…å®¹å¤±è´¥:`,t),!1}}async appendToEntry(e,t,a='\n'){try{const n=await this.getEntryContent(e),o=n?`${n}${a}${t}`:t;return await this.setEntryContent(e,o)}catch(t){return console.error(`[WorldbookService] è¿½åŠ å†…å®¹åˆ°"${e}"å¤±è´¥:`,t),!1}}async ensureWorldbookExists(){try{if(!this.isAvailable())return!1;try{return await getWorldbook(this.lorebook),!0}catch{return console.log(`[WorldbookService] æ‡’åˆ›å»ºä¸–ç•Œä¹¦"${this.lorebook}"`),await createWorldbook(this.lorebook,[]),!0}}catch(e){return console.error('[WorldbookService] ç¡®ä¿ä¸–ç•Œä¹¦å­˜åœ¨å¤±è´¥:',e),!1}}async createEntry(e,t,a){try{return this.isAvailable()?(await this.ensureWorldbookExists(),await createWorldbookEntries(this.lorebook,[{name:e,content:t,enabled:a.enabled,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:a.role,depth:a.depth,order:a.order},probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}}]),console.log(`[WorldbookService] åˆ›å»ºæ¡ç›®"${e}"æˆåŠŸ`),!0):(console.warn('[WorldbookService] ä¸–ç•Œä¹¦APIä¸å¯ç”¨'),!1)}catch(t){return console.error(`[WorldbookService] åˆ›å»ºæ¡ç›®"${e}"å¤±è´¥:`,t),!1}}async setEntryEnabled(e,t){try{if(!this.isAvailable())return!1;return await this.getEntry(e)?(await updateWorldbookWith(this.lorebook,a=>a.map(a=>a.name===e?{...a,enabled:t}:a)),console.log(`[WorldbookService] ${t?'å¯ç”¨':'ç¦ç”¨'}æ¡ç›®"${e}"`),!0):(console.warn(`[WorldbookService] æ¡ç›®"${e}"ä¸å­˜åœ¨`),!1)}catch(t){return console.error(`[WorldbookService] è®¾ç½®æ¡ç›®"${e}"å¯ç”¨çŠ¶æ€å¤±è´¥:`,t),!1}}async entryExists(e){return null!==await this.getEntry(e)}async ensureAllEntries(){try{const e=Object.values(uc);for(const t of e){if(!await this.entryExists(t)){const e=mc[t];e&&(await this.createEntry(t,'',e),console.log(`[WorldbookService] åˆ›å»ºç¼ºå¤±çš„æ¡ç›®: ${t}`))}}return!0}catch(e){return console.error('[WorldbookService] ç¡®ä¿æ¡ç›®å­˜åœ¨å¤±è´¥:',e),!1}}async switchToFullMode(){try{return await this.setEntryEnabled(uc.HISTORY_TEXT,!0),await this.setEntryEnabled(uc.HISTORY_RECORD,!0),await this.setEntryEnabled(uc.SEGMENTED_TEXT,!1),await this.setEntryEnabled(uc.SMALL_SUMMARY,!1),await this.setEntryEnabled(uc.LARGE_SUMMARY,!1),console.log('[WorldbookService] å·²åˆ‡æ¢åˆ°å…¨é‡æ¨¡å¼'),!0}catch(e){return console.error('[WorldbookService] åˆ‡æ¢åˆ°å…¨é‡æ¨¡å¼å¤±è´¥:',e),!1}}async switchToSegmentedMode(){try{return await this.setEntryEnabled(uc.HISTORY_TEXT,!1),await this.setEntryEnabled(uc.HISTORY_RECORD,!1),await this.setEntryEnabled(uc.SEGMENTED_TEXT,!0),await this.setEntryEnabled(uc.SMALL_SUMMARY,!0),await this.setEntryEnabled(uc.LARGE_SUMMARY,!0),console.log('[WorldbookService] å·²åˆ‡æ¢åˆ°åˆ†æ®µæ¨¡å¼'),!0}catch(e){return console.error('[WorldbookService] åˆ‡æ¢åˆ°åˆ†æ®µæ¨¡å¼å¤±è´¥:',e),!1}}async getContextSnapshot(){const e={};for(const t of Object.values(uc))e[t]=await this.getEntryContent(t);return e}async restoreFromSnapshot(e){try{for(const[t,a]of Object.entries(e))await this.setEntryContent(t,a);return console.log('[WorldbookService] ä»å¿«ç…§æ¢å¤å®Œæˆ'),!0}catch(e){return console.error('[WorldbookService] ä»å¿«ç…§æ¢å¤å¤±è´¥:',e),!1}}async clearAllContextEntries(){try{for(const e of Object.values(uc))await this.setEntryContent(e,'');return console.log('[WorldbookService] å·²æ¸…ç©ºæ‰€æœ‰ä¸Šä¸‹æ–‡æ¡ç›®'),!0}catch(e){return console.error('[WorldbookService] æ¸…ç©ºæ¡ç›®å¤±è´¥:',e),!1}}},hc={class:'history-text-panel'},yc={class:'panel-header'},Vc={class:'header-left'},Nc={key:0,class:'text-count'},Ec={class:'header-actions'},bc=['disabled'],kc={class:'search-bar'},Cc={key:0,class:'search-result-count'},Sc={class:'panel-body'},wc={key:0,class:'state-container loading-state'},Ic={class:'state-container error-state'},Bc={class:'state-text'},Ac={class:'text-list'},Dc=['onClick'],Mc={class:'text-meta'},xc={class:'text-number'},Tc={key:0,class:'text-preview'},$c={class:'expand-icon'},_c={key:0,class:'text-content'},Rc=['innerHTML'],Oc={class:'content-actions'},Fc=['onClick'],Lc={key:0,class:'panel-footer'},Pc={class:'footer-info'},jc={class:'info-text'},Uc=(0,l.defineComponent)({__name:'HistoryTextPanel',emits:['close'],setup(e){const t=(0,l.ref)(!1),a=(0,l.ref)(null),n=(0,l.ref)([]),o=(0,l.ref)(''),s=(0,l.ref)(new Set),r=(0,l.computed)(()=>{if(!o.value.trim())return n.value;const e=o.value.toLowerCase();return n.value.filter(t=>t.å†…å®¹.toLowerCase().includes(e))}),c=async()=>{t.value=!0,a.value=null;try{await gc.initialize();const e=await gc.getEntryContent(uc.HISTORY_TEXT);n.value=fc.parseHistoryTexts(e),console.log('[HistoryTextPanel] å·²åŠ è½½',n.value.length,'æ¡å†å²æ­£æ–‡')}catch(e){console.error('[HistoryTextPanel] åŠ è½½å¤±è´¥:',e),a.value=e instanceof Error?e.message:'åŠ è½½å†å²æ­£æ–‡å¤±è´¥'}finally{t.value=!1}},i=()=>{},u=()=>{r.value.forEach(e=>{s.value.add(e.åºå·)})},d=()=>{s.value.clear()},m=e=>{const t=e.replace(/\n/g,' ').replace(/\s+/g,' ').trim();return t.length<=60?t:t.substring(0,60)+'...'};return(0,l.onMounted)(()=>{c()}),(e,v)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',hc,[(0,l.createCommentVNode)(' é¢æ¿å¤´éƒ¨ '),(0,l.createElementVNode)('div',yc,[(0,l.createElementVNode)('div',Vc,[v[2]||(v[2]=(0,l.createElementVNode)('span',{class:'panel-icon'},'ğŸ“œ',-1)),v[3]||(v[3]=(0,l.createElementVNode)('h2',{class:'panel-title'},'å†å²æ­£æ–‡',-1)),n.value.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('span',Nc,' å…± '+(0,l.toDisplayString)(n.value.length)+' æ¡ ',1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',Ec,[(0,l.createElementVNode)('button',{class:'btn-refresh',onClick:c,disabled:t.value,title:'åˆ·æ–°'},'ğŸ”„',8,bc),(0,l.createElementVNode)('button',{class:'btn-close',onClick:v[0]||(v[0]=t=>e.$emit('close'))},'âœ•')])]),(0,l.createCommentVNode)(' æœç´¢æ  '),(0,l.createElementVNode)('div',kc,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':v[1]||(v[1]=e=>o.value=e),type:'text',class:'search-input',placeholder:'æœç´¢æ­£æ–‡å†…å®¹...',onInput:i},null,544),[[l.vModelText,o.value]]),o.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',Cc,' æ‰¾åˆ° '+(0,l.toDisplayString)(r.value.length)+' æ¡ ',1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' é¢æ¿ä¸»ä½“ '),(0,l.createElementVNode)('div',Sc,[(0,l.createCommentVNode)(' åŠ è½½çŠ¶æ€ '),t.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',wc,[...v[4]||(v[4]=[(0,l.createElementVNode)('span',{class:'state-icon loading-spinner'},'â³',-1),(0,l.createElementVNode)('span',{class:'state-text'},'åŠ è½½ä¸­...',-1)])])):a.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' é”™è¯¯æç¤º '),(0,l.createElementVNode)('div',Ic,[v[5]||(v[5]=(0,l.createElementVNode)('span',{class:'state-icon error-icon'},'âš ï¸',-1)),(0,l.createElementVNode)('span',Bc,(0,l.toDisplayString)(a.value),1),(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:c},'é‡æ–°åŠ è½½')])],2112)):0===n.value.length?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' ç©ºçŠ¶æ€ '),v[6]||(v[6]=(0,l.createElementVNode)('div',{class:'state-container empty-state'},[(0,l.createElementVNode)('span',{class:'state-icon'},'ğŸ“'),(0,l.createElementVNode)('span',{class:'state-text'},'æš‚æ— å†å²æ­£æ–‡'),(0,l.createElementVNode)('p',{class:'state-hint'},'å†å²æ­£æ–‡ä¼šåœ¨æ¸¸æˆè¿›è¡Œè¿‡ç¨‹ä¸­è‡ªåŠ¨è®°å½•')],-1))],2112)):0===r.value.length?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' æœç´¢æ— ç»“æœ '),v[7]||(v[7]=(0,l.createElementVNode)('div',{class:'state-container empty-state'},[(0,l.createElementVNode)('span',{class:'state-icon'},'ğŸ”'),(0,l.createElementVNode)('span',{class:'state-text'},'æœªæ‰¾åˆ°åŒ¹é…å†…å®¹'),(0,l.createElementVNode)('p',{class:'state-hint'},'å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯æœç´¢')],-1))],2112)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:4},[(0,l.createCommentVNode)(' å†å²æ­£æ–‡åˆ—è¡¨ '),(0,l.createElementVNode)('div',Ac,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(r.value,(e,t)=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.åºå·,class:(0,l.normalizeClass)(['text-item',{'is-expanded':s.value.has(e.åºå·)}])},[(0,l.createCommentVNode)(' æ¡ç›®å¤´éƒ¨ '),(0,l.createElementVNode)('div',{class:'text-header',onClick:t=>{return a=e.åºå·,void(s.value.has(a)?s.value.delete(a):s.value.add(a));var a}},[(0,l.createElementVNode)('div',Mc,[(0,l.createElementVNode)('span',xc,'#'+(0,l.toDisplayString)(e.åºå·),1),s.value.has(e.åºå·)?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',Tc,(0,l.toDisplayString)(m(e.å†…å®¹)),1))]),(0,l.createElementVNode)('span',$c,(0,l.toDisplayString)(s.value.has(e.åºå·)?'â–¼':'â–¶'),1)],8,Dc),(0,l.createCommentVNode)(' æ¡ç›®å†…å®¹ï¼ˆå±•å¼€æ—¶æ˜¾ç¤ºï¼‰ '),s.value.has(e.åºå·)?((0,l.openBlock)(),(0,l.createElementBlock)('div',_c,[(0,l.createElementVNode)('div',{class:'content-body',innerHTML:(a=e.å†…å®¹,a.replace(/\n/g,'<br>'))},null,8,Rc),(0,l.createElementVNode)('div',Oc,[(0,l.createElementVNode)('button',{class:'btn-action',onClick:t=>(async e=>{try{await navigator.clipboard.writeText(e),'undefined'!=typeof toastr&&toastr.success('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')}catch(e){console.error('[HistoryTextPanel] å¤åˆ¶å¤±è´¥:',e),'undefined'!=typeof toastr&&toastr.error('å¤åˆ¶å¤±è´¥')}})(e.å†…å®¹),title:'å¤åˆ¶å†…å®¹'},'ğŸ“‹ å¤åˆ¶',8,Fc)])])):(0,l.createCommentVNode)('v-if',!0)],2);var a}),128))])],2112))]),(0,l.createCommentVNode)(' åº•éƒ¨å·¥å…·æ  '),n.value.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',Lc,[(0,l.createElementVNode)('div',Pc,[(0,l.createElementVNode)('span',jc,' æ˜¾ç¤º '+(0,l.toDisplayString)(r.value.length)+' / '+(0,l.toDisplayString)(n.value.length)+' æ¡ ',1)]),(0,l.createElementVNode)('div',{class:'footer-actions'},[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:u},'å…¨éƒ¨å±•å¼€'),(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:d},'å…¨éƒ¨æ”¶èµ·')])])):(0,l.createCommentVNode)('v-if',!0)]))}}),zc=(0,I.A)(Uc,[['__scopeId','data-v-9256f22a']]),Wc={class:'changelog-panel'},Hc={class:'panel-header'},Gc={class:'header-right'},Jc=['disabled'],qc={class:'panel-body'},Kc={key:0,class:'loading-state'},Yc={class:'error-state'},Xc={class:'error-message'},Zc=['innerHTML'],Qc={class:'panel-footer'},ei={class:'footer-info'},ti={key:0,class:'update-time'},ai={key:1,class:'cache-status'},ni={class:'footer-actions'},oi=['disabled'],li=['href'],si={class:'cache-dialog'},ri={class:'dialog-body'},ci={class:'cache-options'},ii={class:'cache-option'},ui={class:'cache-option'},di={class:'dialog-footer'},mi=['disabled'],vi='CrHouse815',pi='-MC-_lite-',fi=(0,l.defineComponent)({__name:'ChangelogPanel',emits:['close'],setup(e,{emit:t}){const a=`https://cdn.jsdelivr.net/gh/${vi}/${pi}@main`,n=`https://github.com/${vi}/${pi}`,o=(0,l.ref)(!1),s=(0,l.ref)('æ­£åœ¨åŠ è½½æ›´æ–°æ—¥å¿—...'),r=(0,l.ref)(null),c=(0,l.ref)(''),i=(0,l.ref)(null),u=(0,l.ref)(!1),d=(0,l.ref)(!1),m=(0,l.ref)({browserCache:!0,forceRefresh:!0}),v=(0,l.computed)(()=>n),p=(0,l.computed)(()=>c.value?E(c.value):''),f=(0,l.computed)(()=>m.value.browserCache||m.value.forceRefresh),g=async(e=!1)=>{o.value=!0,s.value='æ­£åœ¨åŠ è½½æ›´æ–°æ—¥å¿—...',r.value=null;try{const t=Date.now(),n=`${a}/CHANGELOG.md?t=${t}`;console.log('[ChangelogPanel] æ­£åœ¨è·å–æ›´æ–°æ—¥å¿—:',n,e?'(å¼ºåˆ¶æ— ç¼“å­˜)':'');const o=e?{cache:'no-store',headers:{'Cache-Control':'no-cache, no-store, must-revalidate',Pragma:'no-cache'}}:{},l=await fetch(n,o);if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);c.value=await l.text(),i.value=new Date,console.log('[ChangelogPanel] æ›´æ–°æ—¥å¿—è·å–æˆåŠŸ, é•¿åº¦:',c.value.length)}catch(e){console.error('[ChangelogPanel] è·å–æ›´æ–°æ—¥å¿—å¤±è´¥:',e),r.value=`è·å–æ›´æ–°æ—¥å¿—å¤±è´¥: ${e.message||'ç½‘ç»œé”™è¯¯'}`,c.value=N(),c.value&&(r.value=null,console.log('[ChangelogPanel] ä½¿ç”¨æœ¬åœ°æ›´æ–°æ—¥å¿—'))}finally{o.value=!1}},h=()=>{d.value=!0},y=async()=>{d.value=!1,o.value=!0,u.value=!1;const e=[];try{m.value.browserCache&&(s.value='æ­£åœ¨æ¸…ç†æµè§ˆå™¨ç¼“å­˜...',await V(),e.push('æµè§ˆå™¨ç¼“å­˜'),console.log('[ChangelogPanel] æµè§ˆå™¨ç¼“å­˜å·²æ¸…ç†')),m.value.forceRefresh?(s.value='æ­£åœ¨å¼ºåˆ¶åˆ·æ–°å†…å®¹...',await g(!0)):await g(!1),u.value=!0,setTimeout(()=>{u.value=!1},3e3),e.length>0&&console.log('[ChangelogPanel] å·²æ¸…ç†:',e.join(', '))}catch(e){console.error('[ChangelogPanel] ç¼“å­˜æ¸…ç†å¤±è´¥:',e),r.value=`ç¼“å­˜æ¸…ç†å¤±è´¥: ${e.message||'æœªçŸ¥é”™è¯¯'}`}finally{o.value=!1,s.value='æ­£åœ¨åŠ è½½æ›´æ–°æ—¥å¿—...'}},V=async()=>{try{if('caches'in window){const e=await caches.keys(),t=e.filter(e=>e.includes('jsdelivr')||e.includes('workbox')||e.includes('runtime'));for(const e of t)await caches.delete(e),console.log('[ChangelogPanel] å·²åˆ é™¤ç¼“å­˜:',e);for(const t of e)try{const e=await caches.open(t),a=await e.keys();for(const t of a)(t.url.includes('jsdelivr.net')||t.url.includes(vi))&&(await e.delete(t),console.log('[ChangelogPanel] å·²åˆ é™¤ç¼“å­˜æ¡ç›®:',t.url))}catch(e){}}const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a&&(a.includes('jsdelivr')||a.includes('changelog')||a.includes('CHANGELOG'))&&e.push(a)}e.forEach(e=>{localStorage.removeItem(e),console.log('[ChangelogPanel] å·²åˆ é™¤ localStorage:',e)});const t=[];for(let e=0;e<sessionStorage.length;e++){const a=sessionStorage.key(e);a&&(a.includes('jsdelivr')||a.includes('changelog')||a.includes('CHANGELOG'))&&t.push(a)}t.forEach(e=>{sessionStorage.removeItem(e),console.log('[ChangelogPanel] å·²åˆ é™¤ sessionStorage:',e)})}catch(e){console.warn('[ChangelogPanel] æ¸…ç†æµè§ˆå™¨ç¼“å­˜æ—¶å‡ºç°è­¦å‘Š:',e)}},N=()=>`# MClite æ›´æ–°æ—¥å¿—\n\n> æ­¤ä¸ºæœ¬åœ°ç¼“å­˜ç‰ˆæœ¬ï¼Œå¦‚éœ€æŸ¥çœ‹æœ€æ–°æ›´æ–°æ—¥å¿—ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•ã€‚\n\n**ä¸»è¦æ›´æ–°**ï¼š\n- æ–°å¢æ›´æ–°æ—¥å¿—é¢æ¿\n- æ·»åŠ ç‰ˆæœ¬å·æ˜¾ç¤º\n- æ”¯æŒä» GitHub è¿œç¨‹è·å–æ›´æ–°æ—¥å¿—\n\n---\n\n*å®Œæ•´æ›´æ–°æ—¥å¿—è¯·è®¿é—® [GitHub ä»“åº“](${n})*\n`,E=e=>{const t=e.split('\n'),a=[];let n=!1,o=[],l='';for(let e=0;e<t.length;e++){let s=t[e];if(s.startsWith('```')){if(n){n=!1;const e=l?' language-'+l:'',t=b(o.join('\n'));a.push('<pre class="code-block'+e+'"><code>'+t+'</code></pre>'),l=''}else n=!0,l=s.slice(3).trim(),o=[];continue}if(n){o.push(s);continue}if(s=b(s),s.startsWith('### ')){a.push('<h4 class="md-h4">'+S(s.slice(4))+'</h4>');continue}if(s.startsWith('## ')){a.push('<h3 class="md-h3">'+S(s.slice(3))+'</h3>');continue}if(s.startsWith('# ')){a.push('<h2 class="md-h2">'+S(s.slice(2))+'</h2>');continue}if('---'===s||'----'===s||'-----'===s){a.push('<hr class="md-hr">');continue}if(s.startsWith('&gt; ')){a.push('<blockquote class="md-quote">'+S(s.slice(5))+'</blockquote>');continue}if(s.startsWith('- ')){a.push('<li class="md-li">'+S(s.slice(2))+'</li>');continue}const r=k(s);r?a.push('<li class="md-li-ordered">'+S(r)+'</li>'):s.trim()?a.push('<p class="md-p">'+S(s)+'</p>'):a.push('')}let s=a.join('\n');return s=s.split('</blockquote>\n<blockquote class="md-quote">').join('<br>'),s},b=e=>e.split('&').join('&amp;').split('<').join('&lt;').split('>').join('&gt;').split('"').join('&quot;'),k=e=>{for(let t=1;t<=3;t++){const a=e.slice(0,t);if(C(a)&&'.'===e.charAt(t)&&' '===e.charAt(t+1))return e.slice(t+2)}return null},C=e=>{for(let t=0;t<e.length;t++){const a=e.charCodeAt(t);if(a<48||a>57)return!1}return e.length>0},S=e=>{let t='',a=0;for(;a<e.length;){if('`'===e.charAt(a)){const n=e.indexOf('`',a+1);if(n>a){t+='<code class="inline-code">'+e.slice(a+1,n)+'</code>',a=n+1;continue}}if('*'===e.charAt(a)&&'*'===e.charAt(a+1)){const n=w(e,a+2);if(n>a){t+='<strong>'+e.slice(a+2,n)+'</strong>',a=n+2;continue}}if('*'===e.charAt(a)&&'*'!==e.charAt(a+1)){const n=I(e,a+1);if(n>a){t+='<em>'+e.slice(a+1,n)+'</em>',a=n+1;continue}}if('['===e.charAt(a)){const n=e.indexOf(']',a+1);if(n>a&&'('===e.charAt(n+1)){const o=e.indexOf(')',n+2);if(o>n){const l=e.slice(a+1,n);t+='<a href="'+e.slice(n+2,o)+'" target="_blank" rel="noopener">'+l+'</a>',a=o+1;continue}}}if('v'===e.charAt(a)&&B(e.charAt(a+1))){const n=A(e,a+1);if(n>a+1){const o=e.slice(a,n);if(D(o)){t+='<span class="version-highlight">'+o+'</span>',a=n;continue}}}t+=e.charAt(a),a++}return t},w=(e,t)=>{for(let a=t;a<e.length-1;a++)if('*'===e.charAt(a)&&'*'===e.charAt(a+1))return a;return-1},I=(e,t)=>{for(let a=t;a<e.length;a++)if('*'===e.charAt(a)&&'*'!==e.charAt(a+1)&&(0===a||'*'!==e.charAt(a-1)))return a;return-1},B=e=>{const t=e.charCodeAt(0);return t>=48&&t<=57},A=(e,t)=>{let a=t,n=0;for(;a<e.length;){const o=e.charAt(a);if(B(o))a++;else{if(!('.'===o&&n<2&&a>t&&B(e.charAt(a-1))))break;n++,a++}}return a},D=e=>{let t=0;for(let a=0;a<e.length;a++)'.'===e.charAt(a)&&t++;return t>=1};return(0,l.onMounted)(()=>{g()}),(e,t)=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',Wc,[(0,l.createCommentVNode)(' é¢æ¿å¤´éƒ¨ '),(0,l.createElementVNode)('div',Hc,[t[5]||(t[5]=(0,l.createElementVNode)('div',{class:'header-left'},[(0,l.createElementVNode)('span',{class:'header-icon'},'ğŸ“‹'),(0,l.createElementVNode)('h3',{class:'header-title'},'æ›´æ–°æ—¥å¿—')],-1)),(0,l.createElementVNode)('div',Gc,[(0,l.createElementVNode)('button',{class:'btn-refresh',onClick:g,disabled:o.value,title:'åˆ·æ–°'},[(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['refresh-icon',{spinning:o.value}])},'ğŸ”„',2)],8,Jc),(0,l.createElementVNode)('button',{class:'btn-close',onClick:t[0]||(t[0]=t=>e.$emit('close')),title:'å…³é—­'},'âœ•')])]),(0,l.createCommentVNode)(' é¢æ¿å†…å®¹ '),(0,l.createElementVNode)('div',qc,[(0,l.createCommentVNode)(' åŠ è½½çŠ¶æ€ '),o.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',Kc,[t[6]||(t[6]=(0,l.createElementVNode)('div',{class:'loading-spinner'},null,-1)),(0,l.createElementVNode)('p',null,(0,l.toDisplayString)(s.value),1)])):r.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' é”™è¯¯çŠ¶æ€ '),(0,l.createElementVNode)('div',Yc,[t[7]||(t[7]=(0,l.createElementVNode)('span',{class:'error-icon'},'âš ï¸',-1)),(0,l.createElementVNode)('p',Xc,(0,l.toDisplayString)(r.value),1),(0,l.createElementVNode)('button',{class:'btn-retry',onClick:g},'é‡è¯•')])],2112)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' æ›´æ–°æ—¥å¿—å†…å®¹ '),(0,l.createElementVNode)('div',{class:'changelog-content',innerHTML:p.value},null,8,Zc)],2112))]),(0,l.createCommentVNode)(' é¢æ¿åº•éƒ¨ '),(0,l.createElementVNode)('div',Qc,[(0,l.createElementVNode)('div',ei,[i.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',ti,' æœ€åæ›´æ–°ï¼š'+(0,l.toDisplayString)((a=i.value,a.toLocaleString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}))),1)):(0,l.createCommentVNode)('v-if',!0),u.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',ai,' âœ“ ç¼“å­˜å·²æ¸…ç† ')):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',ni,[(0,l.createElementVNode)('button',{class:'btn-clear-cache',onClick:h,disabled:o.value,title:'æ¸…ç†æµè§ˆå™¨ç¼“å­˜å¹¶ä» CDN è·å–æœ€æ–°ç‰ˆæœ¬'},[...t[8]||(t[8]=[(0,l.createElementVNode)('span',{class:'cache-icon'},'ğŸ—‘ï¸',-1),(0,l.createElementVNode)('span',null,'æ¸…ç†ç¼“å­˜',-1)])],8,oi),(0,l.createElementVNode)('a',{class:'btn-github',href:v.value,target:'_blank',rel:'noopener noreferrer',title:'åœ¨ GitHub ä¸ŠæŸ¥çœ‹'},[...t[9]||(t[9]=[(0,l.createElementVNode)('span',{class:'github-icon'},'ğŸ“‚',-1),(0,l.createElementVNode)('span',null,'GitHub',-1)])],8,li)])]),(0,l.createCommentVNode)(' ç¼“å­˜æ¸…ç†ç¡®è®¤å¯¹è¯æ¡† '),d.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'cache-dialog-overlay',onClick:t[4]||(t[4]=(0,l.withModifiers)(e=>d.value=!1,['self']))},[(0,l.createElementVNode)('div',si,[t[13]||(t[13]=(0,l.createElementVNode)('div',{class:'dialog-header'},[(0,l.createElementVNode)('span',{class:'dialog-icon'},'ğŸ—‘ï¸'),(0,l.createElementVNode)('h4',null,'æ¸…ç†ç¼“å­˜')],-1)),(0,l.createElementVNode)('div',ri,[t[12]||(t[12]=(0,l.createElementVNode)('p',null,'é€‰æ‹©è¦æ‰§è¡Œçš„ç¼“å­˜æ¸…ç†æ“ä½œï¼š',-1)),(0,l.createElementVNode)('div',ci,[(0,l.createElementVNode)('label',ii,[(0,l.withDirectives)((0,l.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t[1]||(t[1]=e=>m.value.browserCache=e)},null,512),[[l.vModelCheckbox,m.value.browserCache]]),t[10]||(t[10]=(0,l.createElementVNode)('span',{class:'option-text'},[(0,l.createElementVNode)('strong',null,'æµè§ˆå™¨ç¼“å­˜'),(0,l.createElementVNode)('small',null,'æ¸…ç†æœ¬åœ°æµè§ˆå™¨å­˜å‚¨çš„ jsdelivr èµ„æºç¼“å­˜')],-1))]),(0,l.createElementVNode)('label',ui,[(0,l.withDirectives)((0,l.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t[2]||(t[2]=e=>m.value.forceRefresh=e)},null,512),[[l.vModelCheckbox,m.value.forceRefresh]]),t[11]||(t[11]=(0,l.createElementVNode)('span',{class:'option-text'},[(0,l.createElementVNode)('strong',null,'å¼ºåˆ¶åˆ·æ–°'),(0,l.createElementVNode)('small',null,'ä½¿ç”¨ no-cache æ¨¡å¼é‡æ–°è·å–èµ„æº')],-1))])])]),(0,l.createElementVNode)('div',di,[(0,l.createElementVNode)('button',{class:'btn-cancel',onClick:t[3]||(t[3]=e=>d.value=!1)},'å–æ¶ˆ'),(0,l.createElementVNode)('button',{class:'btn-confirm',onClick:y,disabled:!f.value},'ç¡®è®¤æ¸…ç†',8,mi)])])])):(0,l.createCommentVNode)('v-if',!0)]);var a}}}),gi=(0,I.A)(fi,[['__scopeId','data-v-64d33b34']]),hi={key:0,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},yi={key:1,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},Vi={key:1,class:'toggle-placeholder'},Ni={key:3,class:'edit-actions'},Ei={key:4,class:'children-hint'},bi={class:'item-actions'},ki={key:0,class:'item-children'},Ci=(0,l.defineComponent)({__name:'TreeItem',props:{name:{},value:{},path:{},depth:{},expandedPaths:{},editingPath:{},searchQuery:{default:''}},emits:['toggle','edit','save','cancel','delete','add-child','copy-path'],setup(e,{emit:t}){const a=e,n=t,o=(0,l.ref)(null),s=(0,l.ref)(!1),r=(0,l.ref)(null),c=(0,l.computed)(()=>null===a.value?'null':void 0===a.value?'undefined':Array.isArray(a.value)?'array':typeof a.value),i=(0,l.computed)(()=>'object'===c.value||'array'===c.value),u=(0,l.computed)(()=>a.expandedPaths.has(a.path)),d=(0,l.computed)(()=>a.editingPath===a.path),m=(0,l.computed)(()=>{if(!a.searchQuery)return!1;const e=a.searchQuery.toLowerCase();return a.path.toLowerCase().includes(e)||a.name.toLowerCase().includes(e)||!i.value&&String(a.value).toLowerCase().includes(e)}),v=(0,l.computed)(()=>/^\d+$/.test(a.name)?`[${a.name}]`:a.name),p=(0,l.computed)(()=>{if(null===a.value)return'null';if(void 0===a.value)return'undefined';switch(c.value){case'string':{const e=String(a.value),t=80;return`"${e.length>t?e.substring(0,t)+'...':e}"`}case'number':default:return String(a.value);case'boolean':return a.value?'true':'false';case'array':return`Array(${a.value.length})`;case'object':return`Object {${Object.keys(a.value).length}}`}}),f=(0,l.computed)(()=>'array'===c.value?`[${a.value.length}]`:'object'===c.value?`{${Object.keys(a.value).length}}`:''),g=(0,l.computed)(()=>'array'===c.value||'object'===c.value?a.value:{});function h(e){return'array'===c.value?`${a.path}[${e}]`:`${a.path}.${e}`}function y(){i.value&&n('toggle',a.path)}function V(){i.value||(r.value=a.value,n('edit',a.path),(0,l.nextTick)(()=>{o.value?.focus(),o.value instanceof HTMLInputElement&&o.value.select()}))}function N(){n('save',a.path,r.value)}return(0,l.watch)(()=>a.editingPath,e=>{e===a.path&&(r.value=a.value,(0,l.nextTick)(()=>{o.value?.focus(),o.value instanceof HTMLInputElement&&o.value.select()}))}),(t,a)=>{const n=(0,l.resolveComponent)('TreeItem',!0);return(0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['tree-item',{'is-expanded':u.value,'is-match':m.value}])},[(0,l.createCommentVNode)(' èŠ‚ç‚¹è¡Œ '),(0,l.createElementVNode)('div',{class:'item-row',style:(0,l.normalizeStyle)({paddingLeft:16*e.depth+8+'px'}),onClick:y,onMouseenter:a[11]||(a[11]=e=>s.value=!0),onMouseleave:a[12]||(a[12]=e=>s.value=!1)},[(0,l.createCommentVNode)(' å±•å¼€/æŠ˜å å›¾æ ‡ '),i.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',{key:0,class:'toggle-btn',onClick:a[0]||(a[0]=(0,l.withModifiers)(a=>t.$emit('toggle',e.path),['stop']))},[u.value?((0,l.openBlock)(),(0,l.createElementBlock)('svg',hi,[...a[20]||(a[20]=[(0,l.createElementVNode)('path',{d:'M19 9l-7 7-7-7'},null,-1)])])):((0,l.openBlock)(),(0,l.createElementBlock)('svg',yi,[...a[21]||(a[21]=[(0,l.createElementVNode)('path',{d:'M9 5l7 7-7 7'},null,-1)])]))])):((0,l.openBlock)(),(0,l.createElementBlock)('span',Vi)),(0,l.createCommentVNode)(' é”®å '),(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['item-key',{'is-meta':'$meta'===e.name}])},(0,l.toDisplayString)(v.value),3),(0,l.createCommentVNode)(' åˆ†éš”ç¬¦ '),a[27]||(a[27]=(0,l.createElementVNode)('span',{class:'separator'},':',-1)),(0,l.createCommentVNode)(' å€¼æ˜¾ç¤º/ç¼–è¾‘ '),d.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:2,class:'inline-editor',onClick:a[7]||(a[7]=(0,l.withModifiers)(()=>{},['stop']))},['string'===c.value?(0,l.withDirectives)(((0,l.openBlock)(),(0,l.createElementBlock)('input',{key:0,ref_key:'editorInput',ref:o,type:'text','onUpdate:modelValue':a[1]||(a[1]=e=>r.value=e),class:'edit-input',onKeydown:[(0,l.withKeys)(N,['enter']),a[2]||(a[2]=(0,l.withKeys)(e=>t.$emit('cancel'),['escape']))]},null,544)),[[l.vModelText,r.value]]):'number'===c.value?(0,l.withDirectives)(((0,l.openBlock)(),(0,l.createElementBlock)('input',{key:1,ref_key:'editorInput',ref:o,type:'number','onUpdate:modelValue':a[3]||(a[3]=e=>r.value=e),class:'edit-input',step:'any',onKeydown:[(0,l.withKeys)(N,['enter']),a[4]||(a[4]=(0,l.withKeys)(e=>t.$emit('cancel'),['escape']))]},null,544)),[[l.vModelText,r.value,void 0,{number:!0}]]):'boolean'===c.value?(0,l.withDirectives)(((0,l.openBlock)(),(0,l.createElementBlock)('select',{key:2,ref_key:'editorInput',ref:o,'onUpdate:modelValue':a[5]||(a[5]=e=>r.value=e),class:'edit-select',onChange:N},[...a[22]||(a[22]=[(0,l.createElementVNode)('option',{value:!0},'true',-1),(0,l.createElementVNode)('option',{value:!1},'false',-1)])],544)),[[l.vModelSelect,r.value]]):((0,l.openBlock)(),(0,l.createElementBlock)('div',Ni,[(0,l.createElementVNode)('button',{class:'btn-edit-save',onClick:N},'âœ“'),(0,l.createElementVNode)('button',{class:'btn-edit-cancel',onClick:a[6]||(a[6]=e=>t.$emit('cancel'))},'âœ—')]))])):((0,l.openBlock)(),(0,l.createElementBlock)('span',{key:3,class:(0,l.normalizeClass)(['item-value',[`type-${c.value}`]]),onDblclick:(0,l.withModifiers)(V,['stop'])},(0,l.toDisplayString)(p.value),35)),(0,l.createCommentVNode)(' å­èŠ‚ç‚¹æ•°é‡æç¤º '),i.value&&!u.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',Ei,(0,l.toDisplayString)(f.value),1)):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' æ“ä½œæŒ‰é’® '),(0,l.withDirectives)((0,l.createElementVNode)('div',bi,[(0,l.createElementVNode)('button',{class:'action-btn',onClick:a[8]||(a[8]=(0,l.withModifiers)(a=>t.$emit('copy-path',e.path),['stop'])),title:'å¤åˆ¶è·¯å¾„'},[...a[23]||(a[23]=[(0,l.createElementVNode)('svg',{viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,l.createElementVNode)('rect',{x:'9',y:'9',width:'13',height:'13',rx:'2'}),(0,l.createElementVNode)('path',{d:'M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1'})],-1)])]),i.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'action-btn',onClick:(0,l.withModifiers)(V,['stop']),title:'ç¼–è¾‘'},[...a[24]||(a[24]=[(0,l.createElementVNode)('svg',{viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,l.createElementVNode)('path',{d:'M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7'}),(0,l.createElementVNode)('path',{d:'M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z'})],-1)])])),i.value?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:1,class:'action-btn',onClick:a[9]||(a[9]=(0,l.withModifiers)(a=>t.$emit('add-child',e.path),['stop'])),title:'æ·»åŠ å­é¡¹'},[...a[25]||(a[25]=[(0,l.createElementVNode)('svg',{viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,l.createElementVNode)('circle',{cx:'12',cy:'12',r:'10'}),(0,l.createElementVNode)('path',{d:'M12 8v8M8 12h8'})],-1)])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('button',{class:'action-btn action-delete',onClick:a[10]||(a[10]=(0,l.withModifiers)(a=>t.$emit('delete',e.path),['stop'])),title:'åˆ é™¤'},[...a[26]||(a[26]=[(0,l.createElementVNode)('svg',{viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,l.createElementVNode)('path',{d:'M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2'})],-1)])])],512),[[l.vShow,s.value&&!d.value]])],36),(0,l.createCommentVNode)(' å­èŠ‚ç‚¹ '),i.value&&u.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',ki,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(g.value,(o,s)=>((0,l.openBlock)(),(0,l.createBlock)(n,{key:s,name:String(s),value:o,path:h(s),depth:e.depth+1,'expanded-paths':e.expandedPaths,'editing-path':e.editingPath,'search-query':e.searchQuery,onToggle:a[13]||(a[13]=e=>t.$emit('toggle',e)),onEdit:a[14]||(a[14]=e=>t.$emit('edit',e)),onSave:a[15]||(a[15]=(e,a)=>t.$emit('save',e,a)),onCancel:a[16]||(a[16]=e=>t.$emit('cancel')),onDelete:a[17]||(a[17]=e=>t.$emit('delete',e)),onAddChild:a[18]||(a[18]=e=>t.$emit('add-child',e)),onCopyPath:a[19]||(a[19]=e=>t.$emit('copy-path',e))},null,8,['name','value','path','depth','expanded-paths','editing-path','search-query']))),128))])):(0,l.createCommentVNode)('v-if',!0)],2)}}}),Si=(0,I.A)(Ci,[['__scopeId','data-v-78809202']]),wi={class:'variable-manager-panel'},Ii={class:'panel-header'},Bi={class:'header-left'},Ai={class:'header-actions'},Di=['disabled'],Mi={class:'toolbar'},xi={class:'search-box'},Ti={class:'view-options'},$i={class:'option-toggle'},_i={key:0,class:'state-container'},Ri={class:'tree-view'},Oi={class:'tree-root'},Fi={class:'status-bar'},Li={class:'stat-item'},Pi={key:0,class:'stat-item'},ji={key:1,class:'stat-item'},Ui={class:'modal-dialog'},zi={class:'modal-header'},Wi={class:'modal-body'},Hi={class:'form-group'},Gi={class:'path-input-group'},Ji={key:0,class:'path-prefix'},qi={class:'form-group'},Ki={class:'type-selector'},Yi=['onClick'],Xi={class:'type-icon'},Zi={class:'type-name'},Qi={key:0,class:'form-group'},eu={key:2,class:'boolean-toggle'},tu={class:'modal-footer'},au=['disabled'],nu=(0,l.defineComponent)({__name:'VariableManagerPanel',emits:['close','variable-updated'],setup(e,{emit:t}){const a=t,n=xn(),o=(0,l.ref)(null),s=(0,l.ref)(''),r=(0,l.ref)(!1),c=(0,l.ref)(new Set),i=(0,l.ref)(null),u=(0,l.ref)(!1),d=(0,l.ref)(''),m=(0,l.ref)(!1),v=(0,l.ref)(null),p=(0,l.ref)(''),f=(0,l.ref)('string'),g=(0,l.ref)(''),h=[{value:'string',label:'å­—ç¬¦ä¸²',icon:'T'},{value:'number',label:'æ•°å­—',icon:'#'},{value:'boolean',label:'å¸ƒå°”',icon:'?'},{value:'object',label:'å¯¹è±¡',icon:'{}'},{value:'array',label:'æ•°ç»„',icon:'[]'},{value:'null',label:'ç©ºå€¼',icon:'Ã¸'}],y=(0,l.computed)(()=>n.isMvuAvailable),V=(0,l.computed)(()=>n.statData),N=(0,l.computed)(()=>{if(!V.value)return{};const e=(t,a='')=>{if(null===t||'object'!=typeof t)return t;if(Array.isArray(t))return t.map((t,n)=>e(t,`${a}[${n}]`));const n={};for(const[o,l]of Object.entries(t)){if(!r.value&&'$meta'===o)continue;const t=a?`${a}.${o}`:o;if(s.value){const a=s.value.toLowerCase(),r=t.toLowerCase().includes(a),i='object'!=typeof l||null===l?String(l).toLowerCase().includes(a):JSON.stringify(l).toLowerCase().includes(a);if(!r&&!i){if('object'==typeof l&&null!==l){const a=e(l,t);(Object.keys(a).length>0||Array.isArray(a)&&a.length>0)&&(n[o]=a,c.value.add(t))}continue}{const e=t.split('.');let a='';for(const t of e)a=a?`${a}.${t}`:t,c.value.add(a)}}n[o]='object'==typeof l&&null!==l?e(l,t):l}return n};return e(V.value)}),E=(0,l.computed)(()=>{const e=t=>{if(null===t||'object'!=typeof t)return 1;let a=0;const n=Array.isArray(t)?t:Object.values(t);for(const t of n)'object'==typeof t&&null!==t?a+=e(t):a++;return a};return V.value?e(V.value):0});function b(e){c.value.has(e)?c.value.delete(e):c.value.add(e)}function k(){const e=(t,a='')=>{if(null!==t&&'object'==typeof t)if(Array.isArray(t))t.forEach((t,n)=>{const o=`${a}[${n}]`;'object'==typeof t&&null!==t&&(c.value.add(o),e(t,o))});else for(const[n,o]of Object.entries(t)){if(!r.value&&'$meta'===n)continue;const t=a?`${a}.${n}`:n;'object'==typeof o&&null!==o&&(c.value.add(t),e(o,t))}};V.value&&e(V.value)}function C(){c.value.clear()}async function S(){u.value=!0;try{await n.refresh(),d.value=(new Date).toLocaleTimeString()}catch(e){console.error('[VariableManager] åˆ·æ–°å¤±è´¥:',e)}finally{u.value=!1}}function w(e){i.value=e}async function I(e,t){try{await n.setVariable(e,t,'å˜é‡ç®¡ç†å™¨ç¼–è¾‘')&&(a('variable-updated',e,t),await S())}catch(e){console.error('[VariableManager] ä¿å­˜å¤±è´¥:',e)}finally{i.value=null}}function B(){i.value=null}async function A(e){if(confirm(`ç¡®å®šè¦åˆ é™¤å˜é‡ "${e}" å—ï¼Ÿ`))try{await n.setVariable(e,void 0,'å˜é‡ç®¡ç†å™¨åˆ é™¤')&&await S()}catch(e){console.error('[VariableManager] åˆ é™¤å¤±è´¥:',e)}}function D(e){v.value=e,p.value='',f.value='string',g.value='',m.value=!0}async function M(e){try{await navigator.clipboard.writeText(e)}catch(e){console.error('[VariableManager] å¤åˆ¶å¤±è´¥:',e)}}function x(){v.value=null,p.value='',f.value='string',g.value='',m.value=!0}function T(){m.value=!1,v.value=null}async function R(){if(!p.value.trim())return;const e=v.value?`${v.value}.${p.value.trim()}`:p.value.trim();let t;switch(f.value){case'string':t=g.value||'';break;case'number':t='number'==typeof g.value?g.value:0;break;case'boolean':t=!0===g.value;break;case'object':t={};break;case'array':t=[];break;case'null':t=null}try{await n.setVariable(e,t,'å˜é‡ç®¡ç†å™¨æ–°å¢')&&(a('variable-updated',e,t),v.value&&c.value.add(v.value),await S(),T())}catch(e){console.error('[VariableManager] æ·»åŠ å¤±è´¥:',e)}}return(0,l.onMounted)(async()=>{if(V.value&&0!==Object.keys(V.value).length?d.value=(new Date).toLocaleTimeString():await S(),V.value)for(const e of Object.keys(V.value))(r.value||'$meta'!==e)&&c.value.add(e)}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',wi,[(0,l.createCommentVNode)(' é¢æ¿å¤´éƒ¨ '),(0,l.createElementVNode)('div',Ii,[(0,l.createElementVNode)('div',Bi,[t[9]||(t[9]=(0,l.createElementVNode)('span',{class:'header-title'},'å˜é‡ç®¡ç†å™¨',-1)),(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['status-dot',{connected:y.value}])},null,2)]),(0,l.createElementVNode)('div',Ai,[(0,l.createElementVNode)('button',{class:'btn-text',onClick:x,title:'åœ¨æ ¹çº§æ·»åŠ å˜é‡'},[...t[10]||(t[10]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'+',-1),(0,l.createElementVNode)('span',{class:'btn-label'},'æ–°å¢',-1)])]),(0,l.createElementVNode)('button',{class:'btn-icon-only',onClick:k,title:'å±•å¼€å…¨éƒ¨'},[...t[11]||(t[11]=[(0,l.createElementVNode)('svg',{viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,l.createElementVNode)('path',{d:'M4 4h16M4 12h16M4 20h16'}),(0,l.createElementVNode)('path',{d:'M9 8l3-3 3 3M9 16l3 3 3-3'})],-1)])]),(0,l.createElementVNode)('button',{class:'btn-icon-only',onClick:C,title:'æŠ˜å å…¨éƒ¨'},[...t[12]||(t[12]=[(0,l.createElementVNode)('svg',{viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,l.createElementVNode)('path',{d:'M4 4h16M4 12h16M4 20h16'}),(0,l.createElementVNode)('path',{d:'M9 4l3 3 3-3M9 20l3-3 3 3'})],-1)])]),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['btn-icon-only',{loading:u.value}]),onClick:S,disabled:u.value},[...t[13]||(t[13]=[(0,l.createElementVNode)('svg',{class:'icon-refresh',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,l.createElementVNode)('path',{d:'M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15'})],-1)])],10,Di),(0,l.createElementVNode)('button',{class:'btn-icon-only btn-close',onClick:t[0]||(t[0]=t=>e.$emit('close'))},[...t[14]||(t[14]=[(0,l.createElementVNode)('svg',{viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,l.createElementVNode)('path',{d:'M18 6L6 18M6 6l12 12'})],-1)])])])]),(0,l.createCommentVNode)(' å·¥å…·æ  '),(0,l.createElementVNode)('div',Mi,[(0,l.createCommentVNode)(' æœç´¢æ¡† '),(0,l.createElementVNode)('div',xi,[t[16]||(t[16]=(0,l.createElementVNode)('svg',{class:'search-icon',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,l.createElementVNode)('circle',{cx:'11',cy:'11',r:'8'}),(0,l.createElementVNode)('path',{d:'M21 21l-4.35-4.35'})],-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>s.value=e),type:'text',placeholder:'æœç´¢å˜é‡è·¯å¾„æˆ–å€¼...',class:'search-input'},null,512),[[l.vModelText,s.value]]),s.value?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'btn-clear',onClick:t[2]||(t[2]=e=>s.value='')},[...t[15]||(t[15]=[(0,l.createElementVNode)('svg',{viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,l.createElementVNode)('path',{d:'M18 6L6 18M6 6l12 12'})],-1)])])):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' æ˜¾ç¤ºé€‰é¡¹ '),(0,l.createElementVNode)('div',Ti,[(0,l.createElementVNode)('label',$i,[(0,l.withDirectives)((0,l.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t[3]||(t[3]=e=>r.value=e)},null,512),[[l.vModelCheckbox,r.value]]),t[17]||(t[17]=(0,l.createElementVNode)('span',null,'æ˜¾ç¤º $meta',-1))])])]),(0,l.createCommentVNode)(' ä¸»å†…å®¹åŒº - æ ‘å½¢è§†å›¾ '),(0,l.createElementVNode)('div',{class:'main-content',ref_key:'treeContainerRef',ref:o},[(0,l.createCommentVNode)(' åŠ è½½çŠ¶æ€ '),u.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',_i,[...t[18]||(t[18]=[(0,l.createElementVNode)('div',{class:'loading-spinner'},null,-1),(0,l.createElementVNode)('span',{class:'state-text'},'æ­£åœ¨åŠ è½½...',-1)])])):V.value&&0!==Object.keys(V.value).length?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' æ ‘å½¢è§†å›¾ '),(0,l.createElementVNode)('div',Ri,[(0,l.createElementVNode)('div',Oi,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(N.value,(e,t)=>((0,l.openBlock)(),(0,l.createBlock)(Si,{key:String(t),name:String(t),value:e,path:String(t),depth:0,'expanded-paths':c.value,'editing-path':i.value,'search-query':s.value,onToggle:b,onEdit:w,onSave:I,onCancel:B,onDelete:A,onAddChild:D,onCopyPath:M},null,8,['name','value','path','expanded-paths','editing-path','search-query']))),128))])])],2112)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' ç©ºæ•°æ®çŠ¶æ€ '),(0,l.createElementVNode)('div',{class:'state-container'},[t[19]||(t[19]=(0,l.createElementVNode)('svg',{class:'state-icon',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'1.5'},[(0,l.createElementVNode)('rect',{x:'3',y:'3',width:'18',height:'18',rx:'2'}),(0,l.createElementVNode)('path',{d:'M9 9h6M9 13h6M9 17h4'})],-1)),t[20]||(t[20]=(0,l.createElementVNode)('span',{class:'state-text'},'æš‚æ— å˜é‡æ•°æ®',-1)),(0,l.createElementVNode)('button',{class:'btn-primary',onClick:S},'åˆ·æ–°')])],2112))],512),(0,l.createCommentVNode)(' åº•éƒ¨çŠ¶æ€æ  '),(0,l.createElementVNode)('div',Fi,[(0,l.createElementVNode)('span',Li,'å…± '+(0,l.toDisplayString)(E.value)+' ä¸ªå¶å­èŠ‚ç‚¹',1),c.value.size>0?((0,l.openBlock)(),(0,l.createElementBlock)('span',Pi,'å·²å±•å¼€ '+(0,l.toDisplayString)(c.value.size)+' é¡¹',1)):(0,l.createCommentVNode)('v-if',!0),d.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',ji,'æ›´æ–°äº '+(0,l.toDisplayString)(d.value),1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' æ·»åŠ å˜é‡å¯¹è¯æ¡† '),m.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay',onClick:(0,l.withModifiers)(T,['self'])},[(0,l.createElementVNode)('div',Ui,[(0,l.createElementVNode)('div',zi,[(0,l.createElementVNode)('h3',null,(0,l.toDisplayString)(v.value?'æ·»åŠ å­å˜é‡':'æ·»åŠ æ–°å˜é‡'),1),(0,l.createElementVNode)('button',{class:'btn-close-modal',onClick:T},[...t[21]||(t[21]=[(0,l.createElementVNode)('svg',{viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,l.createElementVNode)('path',{d:'M18 6L6 18M6 6l12 12'})],-1)])])]),(0,l.createElementVNode)('div',Wi,[(0,l.createElementVNode)('div',Hi,[t[22]||(t[22]=(0,l.createElementVNode)('label',{class:'form-label'},'å˜é‡åç§°',-1)),(0,l.createElementVNode)('div',Gi,[v.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',Ji,(0,l.toDisplayString)(v.value)+'.',1)):(0,l.createCommentVNode)('v-if',!0),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[4]||(t[4]=e=>p.value=e),type:'text',placeholder:'è¾“å…¥å˜é‡å...',class:'form-input',onKeydown:(0,l.withKeys)(R,['enter'])},null,544),[[l.vModelText,p.value]])])]),(0,l.createElementVNode)('div',qi,[t[23]||(t[23]=(0,l.createElementVNode)('label',{class:'form-label'},'ç±»å‹',-1)),(0,l.createElementVNode)('div',Ki,[((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(h,e=>(0,l.createElementVNode)('button',{key:e.value,class:(0,l.normalizeClass)(['type-option',{active:f.value===e.value,[`type-${e.value}`]:!0}]),onClick:t=>f.value=e.value},[(0,l.createElementVNode)('span',Xi,(0,l.toDisplayString)(e.icon),1),(0,l.createElementVNode)('span',Zi,(0,l.toDisplayString)(e.label),1)],10,Yi)),64))])]),'object'!==f.value&&'array'!==f.value&&'null'!==f.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',Qi,[t[24]||(t[24]=(0,l.createElementVNode)('label',{class:'form-label'},'åˆå§‹å€¼',-1)),'string'===f.value?(0,l.withDirectives)(((0,l.openBlock)(),(0,l.createElementBlock)('input',{key:0,'onUpdate:modelValue':t[5]||(t[5]=e=>g.value=e),type:'text',placeholder:'è¾“å…¥å­—ç¬¦ä¸²å€¼...',class:'form-input'},null,512)),[[l.vModelText,g.value]]):'number'===f.value?(0,l.withDirectives)(((0,l.openBlock)(),(0,l.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[6]||(t[6]=e=>g.value=e),type:'number',step:'any',placeholder:'è¾“å…¥æ•°å­—...',class:'form-input'},null,512)),[[l.vModelText,g.value,void 0,{number:!0}]]):'boolean'===f.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',eu,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['bool-btn',{active:!0===g.value}]),onClick:t[7]||(t[7]=e=>g.value=!0)},' true ',2),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['bool-btn',{active:!1===g.value}]),onClick:t[8]||(t[8]=e=>g.value=!1)},' false ',2)])):(0,l.createCommentVNode)('v-if',!0)])):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',tu,[(0,l.createElementVNode)('button',{class:'btn-secondary',onClick:T},'å–æ¶ˆ'),(0,l.createElementVNode)('button',{class:'btn-primary',onClick:R,disabled:!p.value.trim()},'æ·»åŠ ',8,au)])])])):(0,l.createCommentVNode)('v-if',!0)]))}}),ou=(0,I.A)(nu,[['__scopeId','data-v-2eea0e48']]),lu={class:'dialog-header'},su={class:'header-left'},ru={class:'header-icon'},cu={class:'header-status'},iu={key:0,class:'review-summary'},uu={class:'tag-name'},du={class:'tag-status'},mu={key:1,class:'issues-section'},vu={class:'issues-list'},pu={class:'issue-icon'},fu={class:'issue-message'},gu={key:2,class:'variables-section'},hu={class:'section-title'},yu={class:'variables-list'},Vu={class:'var-path'},Nu={class:'var-op'},Eu={class:'var-value'},bu={key:0,class:'more-hint'},ku={class:'content-section'},Cu={class:'section-header'},Su={class:'section-actions'},wu={key:0,class:'raw-content'},Iu=['innerHTML'],Bu={class:'dialog-footer'},Au=['disabled'],Du=['disabled'],Mu={key:0,class:'loading-spinner'},xu={key:1,class:'btn-icon'},Tu=(0,l.defineComponent)({__name:'AIResponseReviewDialog',props:{visible:{type:Boolean,default:!1},reviewResult:{default:null},isProcessing:{type:Boolean,default:!1}},emits:['confirm','rollback','close'],setup(e,{emit:t}){const a=e,n=t,o=(0,l.ref)(!1),s=(0,l.ref)(),r=(0,l.computed)(()=>a.reviewResult?a.reviewResult.passed?'status-passed':'status-failed':'status-pending'),c=(0,l.computed)(()=>{if(!a.reviewResult)return'å®¡æŸ¥ä¸­...';if(a.reviewResult.passed){const e=a.reviewResult.issues.filter(e=>'warning'===e.level).length;return e>0?`é€šè¿‡ (${e}è­¦å‘Š)`:'é€šè¿‡'}return`æœªé€šè¿‡ (${a.reviewResult.issues.filter(e=>'error'===e.level).length}é”™è¯¯)`}),i=(0,l.computed)(()=>a.reviewResult?.gameTextContent?a.reviewResult.gameTextContent.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>'):'<p class="empty-hint">æœªæå–åˆ°æ¸¸æˆæ–‡æœ¬å†…å®¹</p>'),u={thinking:'æ€è€ƒè¿‡ç¨‹',gametxt:'æ¸¸æˆæ–‡æœ¬',å†å²è®°å½•:'å†å²è®°å½•',UpdateVariable:'å˜é‡æ›´æ–°'},d=e=>e.exists?e.isClosed?'tag-ok':'tag-error':'tag-missing',m=e=>e.exists?e.isClosed?'âœ“':'âœ—':'â—‹',v=e=>e.exists?e.isClosed?'æ­£å¸¸':`æœªé—­åˆ (${e.openCount}/${e.closeCount})`:'æœªæ‰¾åˆ°',p=e=>{switch(e){case'error':return'âŒ';case'warning':return'âš ï¸';case'info':return'â„¹ï¸';default:return'â€¢'}},f=e=>{switch(e){case'set':return'=';case'add':return'+=';case'subtract':return'-=';case'append':return'<<';case'remove':return'DEL';default:return'?'}},g=e=>{if(null===e)return'null';if(void 0===e)return'undefined';if('string'==typeof e){const t=30;return e.length>t?`"${e.substring(0,t)}..."`:`"${e}"`}if('object'==typeof e){const t=JSON.stringify(e);return t.length>30?t.substring(0,30)+'...':t}return String(e)},h=()=>{n('confirm')},y=()=>{n('rollback')},V=()=>{},N=()=>{o.value=!o.value};return(0,l.watch)(()=>a.visible,e=>{e&&(o.value=!1,(0,l.nextTick)(()=>{s.value&&(s.value.scrollTop=0)}))}),(t,a)=>((0,l.openBlock)(),(0,l.createBlock)(l.Transition,{name:'review-dialog'},{default:(0,l.withCtx)(()=>[e.visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'review-dialog-overlay',onClick:(0,l.withModifiers)(V,['self'])},[(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['review-dialog',{'has-errors':!e.reviewResult?.passed}])},[(0,l.createCommentVNode)(' å¯¹è¯æ¡†å¤´éƒ¨ '),(0,l.createElementVNode)('div',lu,[(0,l.createElementVNode)('div',su,[(0,l.createElementVNode)('span',ru,(0,l.toDisplayString)(e.reviewResult?.passed?'âœ…':'âš ï¸'),1),a[0]||(a[0]=(0,l.createElementVNode)('h3',{class:'header-title'},'AIè¾“å‡ºå®¡æŸ¥',-1))]),(0,l.createElementVNode)('div',cu,[(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['status-badge',r.value])},(0,l.toDisplayString)(c.value),3)])]),(0,l.createCommentVNode)(' å®¡æŸ¥æ‘˜è¦ '),e.reviewResult?((0,l.openBlock)(),(0,l.createElementBlock)('div',iu,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.reviewResult.tagChecks,(e,t)=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t,class:'summary-item'},[(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['tag-icon',d(e)])},(0,l.toDisplayString)(m(e)),3),(0,l.createElementVNode)('span',uu,(0,l.toDisplayString)((a=e.tagName,u[a]||a)),1),(0,l.createElementVNode)('span',du,(0,l.toDisplayString)(v(e)),1)]);var a}),128))])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' é—®é¢˜åˆ—è¡¨ '),e.reviewResult&&e.reviewResult.issues.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',mu,[a[1]||(a[1]=(0,l.createElementVNode)('div',{class:'section-title'},[(0,l.createElementVNode)('span',{class:'section-icon'},'ğŸ“‹'),(0,l.createElementVNode)('span',null,'é—®é¢˜åˆ—è¡¨')],-1)),(0,l.createElementVNode)('div',vu,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.reviewResult.issues,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t,class:(0,l.normalizeClass)(['issue-item',`issue-${e.level}`])},[(0,l.createElementVNode)('span',pu,(0,l.toDisplayString)(p(e.level)),1),(0,l.createElementVNode)('span',fu,(0,l.toDisplayString)(e.message),1)],2))),128))])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' å˜é‡æ›´æ–°é¢„è§ˆ '),e.reviewResult?.variableCheck?.commands?.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',gu,[(0,l.createElementVNode)('div',hu,[a[2]||(a[2]=(0,l.createElementVNode)('span',{class:'section-icon'},'ğŸ“Š',-1)),(0,l.createElementVNode)('span',null,'å˜é‡æ›´æ–°é¢„è§ˆ ('+(0,l.toDisplayString)(e.reviewResult.variableCheck.commands.length)+'æ¡)',1)]),(0,l.createElementVNode)('div',yu,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.reviewResult.variableCheck.commands.slice(0,10),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t,class:'variable-item'},[(0,l.createElementVNode)('span',Vu,(0,l.toDisplayString)(e.path),1),(0,l.createElementVNode)('span',Nu,(0,l.toDisplayString)(f(e.operation)),1),(0,l.createElementVNode)('span',Eu,(0,l.toDisplayString)(g(e.value)),1)]))),128)),e.reviewResult.variableCheck.commands.length>10?((0,l.openBlock)(),(0,l.createElementBlock)('div',bu,' ... è¿˜æœ‰ '+(0,l.toDisplayString)(e.reviewResult.variableCheck.commands.length-10)+' æ¡ ',1)):(0,l.createCommentVNode)('v-if',!0)])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' AIå›å¤å†…å®¹é¢„è§ˆ '),(0,l.createElementVNode)('div',ku,[(0,l.createElementVNode)('div',Cu,[a[3]||(a[3]=(0,l.createElementVNode)('div',{class:'section-title'},[(0,l.createElementVNode)('span',{class:'section-icon'},'ğŸ“'),(0,l.createElementVNode)('span',null,'AIå›å¤å†…å®¹')],-1)),(0,l.createElementVNode)('div',Su,[(0,l.createElementVNode)('button',{class:'btn-toggle',onClick:N},(0,l.toDisplayString)(o.value?'æ˜¾ç¤ºè§£æå†…å®¹':'æ˜¾ç¤ºåŸå§‹å†…å®¹'),1)])]),(0,l.createElementVNode)('div',{ref_key:'contentPreview',ref:s,class:'content-preview'},[o.value?((0,l.openBlock)(),(0,l.createElementBlock)('pre',wu,(0,l.toDisplayString)(e.reviewResult?.originalText),1)):((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:1,class:'parsed-content',innerHTML:i.value},null,8,Iu))],512)]),(0,l.createCommentVNode)(' å¯¹è¯æ¡†åº•éƒ¨æŒ‰é’® '),(0,l.createElementVNode)('div',Bu,[(0,l.createElementVNode)('button',{class:'btn btn-rollback',disabled:e.isProcessing,onClick:y},[...a[4]||(a[4]=[(0,l.createElementVNode)('span',{class:'btn-icon'},'â†©ï¸',-1),(0,l.createElementVNode)('span',null,'å›é€€å–æ¶ˆ',-1)])],8,Au),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['btn btn-confirm',{'btn-warning':!e.reviewResult?.passed}]),disabled:e.isProcessing,onClick:h},[e.isProcessing?((0,l.openBlock)(),(0,l.createElementBlock)('span',Mu)):((0,l.openBlock)(),(0,l.createElementBlock)('span',xu,(0,l.toDisplayString)(e.reviewResult?.passed?'âœ“':'âš ï¸'),1)),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(e.reviewResult?.passed?'ç¡®è®¤åº”ç”¨':'å¼ºåˆ¶åº”ç”¨'),1)],10,Du)])],2)])):(0,l.createCommentVNode)('v-if',!0)]),_:1}))}}),$u=(0,I.A)(Tu,[['__scopeId','data-v-dbd9312c']]);const _u=new class{state;initialized=!1;enabled=!0;constructor(){this.state={mode:'segmented',config:{...dc},historyRecords:[],historyTexts:[],segmentedContent:null,isProcessing:!1,lastUpdateTime:0,error:null}}isEnabled(){return this.enabled}enable(){this.enabled=!0,console.log('[ContextManager] ä¸Šä¸‹æ–‡ç®¡ç†åŠŸèƒ½å·²å¯ç”¨')}disable(){this.enabled=!1,console.log('[ContextManager] ä¸Šä¸‹æ–‡ç®¡ç†åŠŸèƒ½å·²ç¦ç”¨ï¼ˆå°†ä½¿ç”¨å¤–æŒ‚ä¸–ç•Œä¹¦ï¼‰')}setEnabled(e){this.enabled=e,console.log('[ContextManager] ä¸Šä¸‹æ–‡ç®¡ç†åŠŸèƒ½å·²'+(e?'å¯ç”¨':'ç¦ç”¨'))}async initialize(){try{return console.log('[ContextManager] æ­£åœ¨åˆå§‹åŒ–...'),this.enabled?(await gc.initialize(),await this.loadFromWorldbook(),this.initialized=!0,console.log('[ContextManager] åˆå§‹åŒ–å®Œæˆ'),!0):(console.log('[ContextManager] ä¸Šä¸‹æ–‡ç®¡ç†åŠŸèƒ½å·²ç¦ç”¨ï¼Œè·³è¿‡åˆå§‹åŒ–ä¸–ç•Œä¹¦æœåŠ¡'),this.initialized=!0,!0)}catch(e){return console.error('[ContextManager] åˆå§‹åŒ–å¤±è´¥:',e),this.state.error=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥',!1}}async loadFromWorldbook(){if(this.enabled)try{const e=await gc.getEntryContent(uc.HISTORY_RECORD);this.state.historyRecords=fc.parseRecords(e);const t=await gc.getEntryContent(uc.HISTORY_TEXT);this.state.historyTexts=fc.parseHistoryTexts(t),console.log(`[ContextManager] å·²åŠ è½½ ${this.state.historyRecords.length} æ¡å†å²è®°å½•ï¼Œ${this.state.historyTexts.length} æ¡å†å²æ­£æ–‡`)}catch(e){console.error('[ContextManager] ä»ä¸–ç•Œä¹¦åŠ è½½æ•°æ®å¤±è´¥:',e)}else console.log('[ContextManager] åŠŸèƒ½å·²ç¦ç”¨ï¼Œè·³è¿‡ä»ä¸–ç•Œä¹¦åŠ è½½æ•°æ®')}getState(){return this.state}getConfig(){return{...this.state.config}}async setConfig(e){this.state.config={...this.state.config,...e},await this.regenerateSegments()}async setSegmentCount(e){await this.setConfig({segmentCount:Math.max(0,e)})}async setSmallSummaryCount(e){await this.setConfig({smallSummaryCount:Math.max(0,e)})}getMode(){return this.state.mode}async switchMode(e){e!==this.state.mode&&(this.state.mode=e,'full'===e?await gc.switchToFullMode():(await gc.switchToSegmentedMode(),await this.regenerateSegments()),console.log(`[ContextManager] å·²åˆ‡æ¢åˆ°${'full'===e?'å…¨é‡':'åˆ†æ®µ'}æ¨¡å¼`))}calculateRanges(e,t,a){const n={totalCount:e,segmentRange:null,smallSummaryRange:null,largeSummaryRange:null};if(0===e)return n;if(t>0&&e>0){const a=Math.max(1,e-t+1),o=e;n.segmentRange=[a,o]}const o=t>0?Math.max(0,e-t):e;if(a>0&&o>0){const e=Math.max(1,o-a+1);n.smallSummaryRange=[e,o]}const l=a>0&&n.smallSummaryRange?n.smallSummaryRange[0]-1:t>0&&n.segmentRange?n.segmentRange[0]-1:e;return l>=1&&(n.largeSummaryRange=[1,l]),n}generateSegmentedContent(){const{historyRecords:e,historyTexts:t,config:a}=this.state,{segmentCount:n,smallSummaryCount:o}=a,l=e.length,s=this.calculateRanges(l,n,o);let r='';if(s.segmentRange&&t.length>0){const[e,a]=s.segmentRange,n=t.slice(e-1,a);r=fc.formatSegmentedText(n)}let c='';if(s.smallSummaryRange){const[t,a]=s.smallSummaryRange,n=e.slice(t-1,a);c=fc.formatSmallSummary(n)}let i='';if(s.largeSummaryRange){const[t,a]=s.largeSummaryRange,n=e.slice(t-1,a);i=fc.formatLargeSummary(n)}return{segmentedText:r,smallSummary:c,largeSummary:i,ranges:s}}async regenerateSegments(){if(!this.enabled)return console.log('[ContextManager] åŠŸèƒ½å·²ç¦ç”¨ï¼Œè·³è¿‡åˆ†æ®µç”Ÿæˆ'),!0;try{this.state.isProcessing=!0,this.state.error=null;if(!(this.state.historyRecords.length>0||this.state.historyTexts.length>0))return console.log('[ContextManager] æ²¡æœ‰å†å²æ•°æ®ï¼Œè·³è¿‡åˆ†æ®µç”Ÿæˆï¼ˆé¿å…è¦†ç›–ç°æœ‰ä¸–ç•Œä¹¦å†…å®¹ï¼‰'),!0;const e=this.generateSegmentedContent();return this.state.segmentedContent=e,e.segmentedText&&await gc.setEntryContent(uc.SEGMENTED_TEXT,e.segmentedText),e.smallSummary&&await gc.setEntryContent(uc.SMALL_SUMMARY,e.smallSummary),e.largeSummary&&await gc.setEntryContent(uc.LARGE_SUMMARY,e.largeSummary),this.state.lastUpdateTime=Date.now(),console.log('[ContextManager] åˆ†æ®µå†…å®¹å·²æ›´æ–°',{åˆ†æ®µæ­£æ–‡æ¡æ•°:e.ranges.segmentRange?e.ranges.segmentRange[1]-e.ranges.segmentRange[0]+1:0,å°æ€»ç»“æ¡æ•°:e.ranges.smallSummaryRange?e.ranges.smallSummaryRange[1]-e.ranges.smallSummaryRange[0]+1:0,å¤§æ€»ç»“æ¡æ•°:e.ranges.largeSummaryRange?e.ranges.largeSummaryRange[1]-e.ranges.largeSummaryRange[0]+1:0}),!0}catch(e){return console.error('[ContextManager] é‡æ–°ç”Ÿæˆåˆ†æ®µå¤±è´¥:',e),this.state.error=e instanceof Error?e.message:'ç”Ÿæˆåˆ†æ®µå¤±è´¥',!1}finally{this.state.isProcessing=!1}}async processAIResponse(e){if(!this.enabled)return console.log('[ContextManager] åŠŸèƒ½å·²ç¦ç”¨ï¼Œè·³è¿‡å¤„ç†AIå›å¤'),!1;try{this.state.isProcessing=!0,this.state.error=null;let t=!1;const a=fc.extractGameTextTag(e);if(a){const e=await gc.getEntryContent(uc.HISTORY_TEXT),n=fc.appendText(e,a);await gc.setEntryContent(uc.HISTORY_TEXT,n);const o=this.state.historyTexts.length+1;this.state.historyTexts.push({åºå·:o,å†…å®¹:a}),t=!0,console.log('[ContextManager] å·²è¿½åŠ å†å²æ­£æ–‡ï¼Œå½“å‰å…±',this.state.historyTexts.length,'æ¡')}const n=fc.extractHistoryRecordTag(e);if(n){const e=fc.parseRecord(n);if(e){const a=await gc.getEntryContent(uc.HISTORY_RECORD),o=fc.appendRecord(a,n);await gc.setEntryContent(uc.HISTORY_RECORD,o),this.state.historyRecords.push(e),t=!0,console.log('[ContextManager] å·²è¿½åŠ å†å²è®°å½•ï¼Œå½“å‰å…±',this.state.historyRecords.length,'æ¡')}}return t&&'segmented'===this.state.mode&&await this.regenerateSegments(),this.state.lastUpdateTime=Date.now(),t}catch(e){return console.error('[ContextManager] å¤„ç†AIå›å¤å¤±è´¥:',e),this.state.error=e instanceof Error?e.message:'å¤„ç†AIå›å¤å¤±è´¥',!1}finally{this.state.isProcessing=!1}}getRecordCount(){return this.state.historyRecords.length}getTextCount(){return this.state.historyTexts.length}getLatestRecords(e){return this.state.historyRecords.slice(-e)}getLatestTexts(e){return this.state.historyTexts.slice(-e)}async clearAll(e=!1){if(!this.enabled&&!e)return console.log('[ContextManager] åŠŸèƒ½å·²ç¦ç”¨ï¼Œåªæ¸…ç©ºæœ¬åœ°çŠ¶æ€'),this.state.historyRecords=[],this.state.historyTexts=[],this.state.segmentedContent=null,this.state.lastUpdateTime=Date.now(),!0;try{return this.state.isProcessing=!0,(this.enabled||e)&&(gc.isAvailable()?(await gc.clearAllContextEntries(),console.log('[ContextManager] å·²æ¸…ç©ºä¸–ç•Œä¹¦æ¡ç›®')):console.warn('[ContextManager] ä¸–ç•Œä¹¦æœåŠ¡ä¸å¯ç”¨ï¼Œè·³è¿‡æ¸…ç©ºä¸–ç•Œä¹¦æ¡ç›®')),this.state.historyRecords=[],this.state.historyTexts=[],this.state.segmentedContent=null,this.state.lastUpdateTime=Date.now(),console.log('[ContextManager] å·²æ¸…ç©ºæ‰€æœ‰å†å²æ•°æ®'),!0}catch(e){return console.error('[ContextManager] æ¸…ç©ºæ•°æ®å¤±è´¥:',e),this.state.error=e instanceof Error?e.message:'æ¸…ç©ºæ•°æ®å¤±è´¥',!1}finally{this.state.isProcessing=!1}}async getSaveData(){const e=await gc.getContextSnapshot();return{config:{...this.state.config},worldbookSnapshots:e,timestamp:Date.now()}}async restoreFromSaveData(e){try{return this.state.isProcessing=!0,this.state.config={...e.config},await gc.restoreFromSnapshot(e.worldbookSnapshots),await this.loadFromWorldbook(),'segmented'===this.state.mode&&await this.regenerateSegments(),this.state.lastUpdateTime=Date.now(),console.log('[ContextManager] å·²ä»å­˜æ¡£æ¢å¤'),!0}catch(e){return console.error('[ContextManager] ä»å­˜æ¡£æ¢å¤å¤±è´¥:',e),this.state.error=e instanceof Error?e.message:'æ¢å¤å¤±è´¥',!1}finally{this.state.isProcessing=!1}}getStatistics(){const e=this.state.segmentedContent?.ranges||this.calculateRanges(this.state.historyRecords.length,this.state.config.segmentCount,this.state.config.smallSummaryCount);return{recordCount:this.state.historyRecords.length,textCount:this.state.historyTexts.length,segmentCount:e.segmentRange?e.segmentRange[1]-e.segmentRange[0]+1:0,smallSummaryCount:e.smallSummaryRange?e.smallSummaryRange[1]-e.smallSummaryRange[0]+1:0,largeSummaryCount:e.largeSummaryRange?e.largeSummaryRange[1]-e.largeSummaryRange[0]+1:0,mode:this.state.mode}}},Ru={enabled:!0,saveOnAIResponse:!0,maxAutoSaves:10,autoSavePrefix:'[è‡ªåŠ¨]',debounceMs:1e3},Ou='saves',Fu='config',Lu='1.0.0',Pu='mc_house_auto_save_config';const ju=new class{db=null;initialized=!1;autoSaveConfig={...Ru};autoSaveDebounceTimer=null;lastAutoSaveTime=0;onAutoSaveCallbacks=[];onLoadCompleteCallbacks=[];async initialize(){return!(!this.initialized||!this.db)||(this.loadAutoSaveConfig(),new Promise((e,t)=>{const a=indexedDB.open('MC_House_SaveDB',2);a.onerror=()=>{console.error('[SaveService] æ‰“å¼€æ•°æ®åº“å¤±è´¥:',a.error),t(a.error)},a.onsuccess=()=>{this.db=a.result,this.initialized=!0,console.log('[SaveService] æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ'),e(!0)},a.onupgradeneeded=e=>{const t=e.target.result,a=e.oldVersion;if(t.objectStoreNames.contains(Ou)){if(a<2){const t=e.target.transaction;if(t){const e=t.objectStore(Ou);e.indexNames.contains('isAutoSave')||e.createIndex('isAutoSave','isAutoSave',{unique:!1}),e.indexNames.contains('saveSource')||e.createIndex('saveSource','saveSource',{unique:!1})}}}else{const e=t.createObjectStore(Ou,{keyPath:'id'});e.createIndex('name','name',{unique:!1}),e.createIndex('createdAt','createdAt',{unique:!1}),e.createIndex('updatedAt','updatedAt',{unique:!1}),e.createIndex('isAutoSave','isAutoSave',{unique:!1}),e.createIndex('saveSource','saveSource',{unique:!1})}t.objectStoreNames.contains(Fu)||t.createObjectStore(Fu,{keyPath:'key'})}}))}generateId(e='save'){return`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}loadAutoSaveConfig(){try{const e=localStorage.getItem(Pu);if(e){const t=JSON.parse(e);this.autoSaveConfig={...Ru,...t}}}catch(e){console.warn('[SaveService] åŠ è½½è‡ªåŠ¨å­˜æ¡£é…ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:',e),this.autoSaveConfig={...Ru}}}saveAutoSaveConfigToStorage(){try{localStorage.setItem(Pu,JSON.stringify(this.autoSaveConfig))}catch(e){console.error('[SaveService] ä¿å­˜è‡ªåŠ¨å­˜æ¡£é…ç½®å¤±è´¥:',e)}}getAutoSaveConfig(){return{...this.autoSaveConfig}}updateAutoSaveConfig(e){this.autoSaveConfig={...this.autoSaveConfig,...e},this.saveAutoSaveConfigToStorage(),console.log('[SaveService] è‡ªåŠ¨å­˜æ¡£é…ç½®å·²æ›´æ–°:',this.autoSaveConfig)}resetAutoSaveConfig(){this.autoSaveConfig={...Ru},this.saveAutoSaveConfigToStorage()}onAutoSave(e){return this.onAutoSaveCallbacks.push(e),()=>{const t=this.onAutoSaveCallbacks.indexOf(e);t>-1&&this.onAutoSaveCallbacks.splice(t,1)}}emitAutoSaveEvent(e,t){this.onAutoSaveCallbacks.forEach(a=>{try{a(e,t)}catch(e){console.error('[SaveService] è‡ªåŠ¨å­˜æ¡£å›è°ƒæ‰§è¡Œå¤±è´¥:',e)}})}onLoadComplete(e){return this.onLoadCompleteCallbacks.push(e),()=>{const t=this.onLoadCompleteCallbacks.indexOf(e);t>-1&&this.onLoadCompleteCallbacks.splice(t,1)}}emitLoadCompleteEvent(e){console.log('[SaveService] è§¦å‘å­˜æ¡£åŠ è½½å®Œæˆäº‹ä»¶ï¼Œé€šçŸ¥',this.onLoadCompleteCallbacks.length,'ä¸ªå›è°ƒ'),this.onLoadCompleteCallbacks.forEach(t=>{try{t(e)}catch(e){console.error('[SaveService] å­˜æ¡£åŠ è½½å®Œæˆå›è°ƒæ‰§è¡Œå¤±è´¥:',e)}})}getMvuData(){try{return'undefined'!=typeof window&&window.Mvu&&window.Mvu.getMvuData({type:'message',message_id:'latest'})||null}catch(e){return console.error('[SaveService] è·å–MVUæ•°æ®å¤±è´¥:',e),null}}async restoreMvuData(e){try{return!('undefined'==typeof window||!window.Mvu)&&(await window.Mvu.replaceMvuData(e,{type:'message',message_id:'latest'}),!0)}catch(e){return console.error('[SaveService] æ¢å¤MVUæ•°æ®å¤±è´¥:',e),!1}}aiContentDataProvider=null;aiContentDataRestorer=null;setAIContentDataProvider(e){this.aiContentDataProvider=e,console.log('[SaveService] AIå†…å®¹æ•°æ®æä¾›è€…å·²æ³¨å†Œ')}setAIContentDataRestorer(e){this.aiContentDataRestorer=e,console.log('[SaveService] AIå†…å®¹æ•°æ®æ¢å¤è€…å·²æ³¨å†Œ')}getAIContentData(){if(this.aiContentDataProvider)try{return this.aiContentDataProvider()}catch(e){console.error('[SaveService] è·å–AIå†…å®¹æ•°æ®å¤±è´¥:',e)}return null}async restoreAIContentData(e){if(this.aiContentDataRestorer&&e)try{return this.aiContentDataRestorer(e),await new Promise(e=>setTimeout(e,10)),console.log('[SaveService] AIå†…å®¹æ•°æ®å·²æ¢å¤'),!0}catch(e){console.error('[SaveService] æ¢å¤AIå†…å®¹æ•°æ®å¤±è´¥:',e)}return!1}async createSave(e,t){try{await this.initialize();const a=this.getMvuData(),n=await _u.getSaveData(),o=this.getAIContentData(),l={id:this.generateId(),name:e,createdAt:Date.now(),updatedAt:Date.now(),mvuData:a,contextData:n,aiContentData:o||void 0,version:Lu,customData:t};return await this.putSave(l),console.log('[SaveService] å­˜æ¡£åˆ›å»ºæˆåŠŸ:',l.id,o?'(å«AIå†…å®¹)':''),l}catch(e){return console.error('[SaveService] åˆ›å»ºå­˜æ¡£å¤±è´¥:',e),null}}async updateSave(e,t){try{await this.initialize();const a=await this.getSave(e);if(!a)return console.warn('[SaveService] å­˜æ¡£ä¸å­˜åœ¨:',e),!1;const n=this.getMvuData(),o=await _u.getSaveData(),l=this.getAIContentData(),s={...a,updatedAt:Date.now(),mvuData:n,contextData:o,aiContentData:l||a.aiContentData,customData:t||a.customData};return await this.putSave(s),console.log('[SaveService] å­˜æ¡£æ›´æ–°æˆåŠŸ:',e),!0}catch(e){return console.error('[SaveService] æ›´æ–°å­˜æ¡£å¤±è´¥:',e),!1}}async autoSaveOnAIResponse(e){if(!this.autoSaveConfig.enabled||!this.autoSaveConfig.saveOnAIResponse)return console.log('[SaveService] è‡ªåŠ¨å­˜æ¡£æœªå¯ç”¨'),null;const t=Date.now();if(t-this.lastAutoSaveTime<this.autoSaveConfig.debounceMs)return console.log('[SaveService] è‡ªåŠ¨å­˜æ¡£é˜²æŠ–ä¸­ï¼Œè·³è¿‡'),null;this.lastAutoSaveTime=t;try{console.log('[SaveService] å¼€å§‹AIå›å¤åè‡ªåŠ¨å­˜æ¡£...');const t=(new Date).toLocaleString('zh-CN',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}),a=`${this.autoSaveConfig.autoSavePrefix} ${t}`,n=await this.createAutoSave(a,'ai_response',e);return n&&(await this.cleanupAutoSaves(),this.emitAutoSaveEvent(n)),n}catch(e){const t=e instanceof Error?e.message:'è‡ªåŠ¨å­˜æ¡£å¤±è´¥';return console.error('[SaveService] AIå›å¤åè‡ªåŠ¨å­˜æ¡£å¤±è´¥:',e),this.emitAutoSaveEvent(null,t),null}}async createAutoSave(e,t='auto',a){try{await this.initialize();const n=this.getMvuData(),o=await _u.getSaveData(),l=this.getAIContentData(),s={id:this.generateId('auto'),name:e,createdAt:Date.now(),updatedAt:Date.now(),mvuData:n,contextData:o,aiContentData:l||void 0,version:Lu,isAutoSave:!0,saveSource:t,messageId:a};return await this.putSave(s),console.log('[SaveService] è‡ªåŠ¨å­˜æ¡£åˆ›å»ºæˆåŠŸ:',s.id,l?'(å«AIå†…å®¹)':''),s}catch(e){return console.error('[SaveService] åˆ›å»ºè‡ªåŠ¨å­˜æ¡£å¤±è´¥:',e),null}}async cleanupAutoSaves(){try{const e=await this.listAutoSaves();if(e.length<=this.autoSaveConfig.maxAutoSaves)return;const t=e.sort((e,t)=>t.updatedAt-e.updatedAt).slice(this.autoSaveConfig.maxAutoSaves);for(const e of t)await this.deleteSave(e.id),console.log('[SaveService] æ¸…ç†æ—§çš„è‡ªåŠ¨å­˜æ¡£:',e.id);console.log('[SaveService] è‡ªåŠ¨å­˜æ¡£æ¸…ç†å®Œæˆï¼Œåˆ é™¤äº†',t.length,'ä¸ªæ—§å­˜æ¡£')}catch(e){console.error('[SaveService] æ¸…ç†è‡ªåŠ¨å­˜æ¡£å¤±è´¥:',e)}}async listAutoSaves(){return(await this.listSaves()).filter(e=>!0===e.isAutoSave)}async listManualSaves(){return(await this.listSaves()).filter(e=>!0!==e.isAutoSave)}debouncedAutoSave(e){this.autoSaveDebounceTimer&&clearTimeout(this.autoSaveDebounceTimer),this.autoSaveDebounceTimer=setTimeout(async()=>{await this.autoSaveOnAIResponse(e)},this.autoSaveConfig.debounceMs)}cancelDebouncedAutoSave(){this.autoSaveDebounceTimer&&(clearTimeout(this.autoSaveDebounceTimer),this.autoSaveDebounceTimer=null)}async loadSave(e){try{await this.initialize();const t=await this.getSave(e);if(!t)return console.warn('[SaveService] å­˜æ¡£ä¸å­˜åœ¨:',e),!1;console.log('[SaveService] å¼€å§‹åŠ è½½å­˜æ¡£:',e);const a={mvu:!1,context:!1,aiContent:!1};if(t.mvuData)try{a.mvu=await this.restoreMvuData(t.mvuData),a.mvu?console.log('[SaveService] MVUæ•°æ®æ¢å¤æˆåŠŸï¼Œstat_dataé”®:',Object.keys(t.mvuData.stat_data||{})):console.warn('[SaveService] MVUæ•°æ®æ¢å¤å¤±è´¥')}catch(e){console.error('[SaveService] MVUæ•°æ®æ¢å¤å¼‚å¸¸:',e)}else a.mvu=!0;if(t.contextData)try{await _u.restoreFromSaveData(t.contextData),a.context=!0,console.log('[SaveService] ä¸Šä¸‹æ–‡ç®¡ç†æ•°æ®æ¢å¤æˆåŠŸ')}catch(e){console.error('[SaveService] ä¸Šä¸‹æ–‡ç®¡ç†æ•°æ®æ¢å¤å¼‚å¸¸:',e)}else a.context=!0;if(t.aiContentData)try{a.aiContent=await this.restoreAIContentData(t.aiContentData),console.log('[SaveService] AIå†…å®¹æ•°æ®æ¢å¤æˆåŠŸ')}catch(e){console.error('[SaveService] AIå†…å®¹æ•°æ®æ¢å¤å¼‚å¸¸:',e)}else a.aiContent=!0;await new Promise(e=>setTimeout(e,50));const n=a.mvu&&a.context&&a.aiContent;return console.log('[SaveService] å­˜æ¡£åŠ è½½å®Œæˆ:',{id:e,mvu:a.mvu?'æˆåŠŸ':'å¤±è´¥',context:a.context?'æˆåŠŸ':'å¤±è´¥',aiContent:a.aiContent?'æˆåŠŸ':'å¤±è´¥',overall:n?'å…¨éƒ¨æˆåŠŸ':'éƒ¨åˆ†å¤±è´¥'}),this.emitLoadCompleteEvent(t),n||'undefined'==typeof toastr||toastr.warning('éƒ¨åˆ†æ•°æ®æ¢å¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°','å­˜æ¡£åŠ è½½è­¦å‘Š',{timeOut:3e3}),n}catch(e){return console.error('[SaveService] åŠ è½½å­˜æ¡£å¤±è´¥:',e),!1}}async getSave(e){return this.db||await this.initialize(),this.db?new Promise((t,a)=>{const n=this.db.transaction([Ou],'readonly').objectStore(Ou).get(e);n.onerror=()=>a(n.error),n.onsuccess=()=>t(n.result||null)}):null}async putSave(e){if(this.db||await this.initialize(),!this.db)throw new Error('æ•°æ®åº“æœªåˆå§‹åŒ–');return new Promise((t,a)=>{const n=this.db.transaction([Ou],'readwrite').objectStore(Ou).put(e);n.onerror=()=>a(n.error),n.onsuccess=()=>t()})}async deleteSave(e){return this.db||await this.initialize(),!!this.db&&new Promise((t,a)=>{const n=this.db.transaction([Ou],'readwrite').objectStore(Ou).delete(e);n.onerror=()=>a(n.error),n.onsuccess=()=>{console.log('[SaveService] å­˜æ¡£åˆ é™¤æˆåŠŸ:',e),t(!0)}})}async listSaves(){return this.db||await this.initialize(),this.db?new Promise((e,t)=>{const a=this.db.transaction([Ou],'readonly').objectStore(Ou).getAll();a.onerror=()=>t(a.error),a.onsuccess=()=>{const t=a.result.map(e=>({id:e.id,name:e.name,createdAt:e.createdAt,updatedAt:e.updatedAt,version:e.version,isAutoSave:e.isAutoSave,saveSource:e.saveSource})).sort((e,t)=>t.updatedAt-e.updatedAt);e(t)}}):[]}async getSaveStats(){const e=await this.listSaves(),t=e.filter(e=>!e.isAutoSave),a=e.filter(e=>e.isAutoSave);return{total:e.length,manual:t.length,auto:a.length,oldestSave:e.length>0?e[e.length-1]:null,newestSave:e.length>0?e[0]:null}}async exportSave(e){try{const t=await this.getSave(e);return t?JSON.stringify(t,null,2):null}catch(e){return console.error('[SaveService] å¯¼å‡ºå­˜æ¡£å¤±è´¥:',e),null}}async importSave(e,t){try{await this.initialize();const a=JSON.parse(e);return a.id=this.generateId(),t&&(a.name=t),a.updatedAt=Date.now(),await this.putSave(a),console.log('[SaveService] å­˜æ¡£å¯¼å…¥æˆåŠŸ:',a.id),a}catch(e){return console.error('[SaveService] å¯¼å…¥å­˜æ¡£å¤±è´¥:',e),null}}async quickSave(){try{const e=await this.listSaves();if(e.length>0)return await this.updateSave(e[0].id);return null!==await this.createSave('å¿«é€Ÿå­˜æ¡£')}catch(e){return console.error('[SaveService] å¿«é€Ÿä¿å­˜å¤±è´¥:',e),!1}}async quickLoad(){try{const e=await this.listSaves();return 0===e.length?(console.warn('[SaveService] æ²¡æœ‰å¯åŠ è½½çš„å­˜æ¡£'),!1):await this.loadSave(e[0].id)}catch(e){return console.error('[SaveService] å¿«é€ŸåŠ è½½å¤±è´¥:',e),!1}}};function Uu(){const e=(0,l.ref)(!1),t=(0,l.ref)(!1),a=(0,l.ref)(null),n=(0,l.ref)([]),o=(0,l.ref)(null),s=(0,l.ref)(ju.getAutoSaveConfig()),r=(0,l.ref)({total:0,manual:0,auto:0,oldestSave:null,newestSave:null}),c=(0,l.ref)(null);let i=null,u=null;const d=(0,l.computed)(()=>n.value.filter(e=>!e.isAutoSave)),m=(0,l.computed)(()=>n.value.filter(e=>!0===e.isAutoSave)),v=(0,l.computed)(()=>n.value.length>0),p=(0,l.computed)(()=>s.value.enabled),f=async()=>{try{return t.value=!0,a.value=null,await ju.initialize(),await g(),await h(),s.value=ju.getAutoSaveConfig(),i=ju.onAutoSave((e,t)=>{e?(c.value={id:e.id,name:e.name,createdAt:e.createdAt,updatedAt:e.updatedAt,version:e.version,isAutoSave:e.isAutoSave,saveSource:e.saveSource},g(),h(),console.log('[useSave] è‡ªåŠ¨å­˜æ¡£å®Œæˆ:',e.name)):t&&console.error('[useSave] è‡ªåŠ¨å­˜æ¡£å¤±è´¥:',t)}),u=ju.onLoadComplete(async e=>{console.log('[useSave] å­˜æ¡£åŠ è½½å®Œæˆï¼Œé€šçŸ¥ mvuStore åˆ·æ–°æ•°æ®...');try{const e=xn();await e.loadMvuData(),console.log('[useSave] mvuStore æ•°æ®å·²åˆ·æ–°ï¼Œstat_data é”®:',Object.keys(e.statData||{}))}catch(e){console.error('[useSave] åˆ·æ–° mvuStore æ•°æ®å¤±è´¥:',e)}}),e.value=!0,!0}catch(e){return a.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥',!1}finally{t.value=!1}},g=async()=>{try{n.value=await ju.listSaves()}catch(e){console.error('[useSave] åˆ·æ–°åˆ—è¡¨å¤±è´¥:',e)}},h=async()=>{try{r.value=await ju.getSaveStats()}catch(e){console.error('[useSave] åˆ·æ–°ç»Ÿè®¡å¤±è´¥:',e)}},y=async e=>{try{return t.value=!0,a.value=null,await ju.exportSave(e)}catch(e){return a.value=e instanceof Error?e.message:'å¯¼å‡ºå­˜æ¡£å¤±è´¥',null}finally{t.value=!1}},V=async(e,n)=>{try{t.value=!0,a.value=null;const o=await ju.importSave(e,n);return o&&await g(),o}catch(e){return a.value=e instanceof Error?e.message:'å¯¼å…¥å­˜æ¡£å¤±è´¥',null}finally{t.value=!1}},N=e=>{ju.updateAutoSaveConfig(e),s.value=ju.getAutoSaveConfig()};return(0,l.onMounted)(()=>{f()}),(0,l.onUnmounted)(()=>{i&&(i(),i=null),u&&(u(),u=null)}),{isInitialized:e,isProcessing:t,error:a,saveList:n,currentSave:o,autoSaveConfig:s,saveStats:r,lastAutoSave:c,manualSaveList:d,autoSaveList:m,hasSaves:v,isAutoSaveEnabled:p,initialize:f,refreshList:g,refreshStats:h,createSave:async(e,n)=>{try{t.value=!0,a.value=null;const l=await ju.createSave(e,n);return l&&(await g(),o.value={id:l.id,name:l.name,createdAt:l.createdAt,updatedAt:l.updatedAt,version:l.version}),l}catch(e){return a.value=e instanceof Error?e.message:'åˆ›å»ºå­˜æ¡£å¤±è´¥',null}finally{t.value=!1}},updateSave:async(e,n)=>{try{t.value=!0,a.value=null;const o=await ju.updateSave(e,n);return o&&await g(),o}catch(e){return a.value=e instanceof Error?e.message:'æ›´æ–°å­˜æ¡£å¤±è´¥',!1}finally{t.value=!1}},loadSave:async e=>{try{t.value=!0,a.value=null;const l=await ju.loadSave(e);if(l){const t=n.value.find(t=>t.id===e);t&&(o.value=t)}return l}catch(e){return a.value=e instanceof Error?e.message:'åŠ è½½å­˜æ¡£å¤±è´¥',!1}finally{t.value=!1}},deleteSave:async e=>{try{t.value=!0,a.value=null;const n=await ju.deleteSave(e);return n&&(await g(),o.value?.id===e&&(o.value=null)),n}catch(e){return a.value=e instanceof Error?e.message:'åˆ é™¤å­˜æ¡£å¤±è´¥',!1}finally{t.value=!1}},exportSave:y,importSave:V,quickSave:async()=>{try{t.value=!0,a.value=null;const e=await ju.quickSave();return e&&await g(),e}catch(e){return a.value=e instanceof Error?e.message:'å¿«é€Ÿä¿å­˜å¤±è´¥',!1}finally{t.value=!1}},quickLoad:async()=>{try{t.value=!0,a.value=null;const e=await ju.quickLoad();return e&&(await g(),n.value.length>0&&(o.value=n.value[0])),e}catch(e){return a.value=e instanceof Error?e.message:'å¿«é€ŸåŠ è½½å¤±è´¥',!1}finally{t.value=!1}},downloadSave:async(e,t)=>{try{const a=await y(e);if(!a)return;const o=n.value.find(t=>t.id===e),l=t||`${o?.name||'save'}_${(new Date).toISOString().slice(0,10)}.json`,s=new Blob([a],{type:'application/json'}),r=URL.createObjectURL(s),c=document.createElement('a');c.href=r,c.download=l,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r)}catch(e){a.value=e instanceof Error?e.message:'ä¸‹è½½å­˜æ¡£å¤±è´¥'}},uploadSave:async(e,n)=>{try{t.value=!0,a.value=null;const o=await e.text();return await V(o,n)}catch(e){return a.value=e instanceof Error?e.message:'ä¸Šä¼ å­˜æ¡£å¤±è´¥',null}finally{t.value=!1}},updateAutoSaveConfig:N,toggleAutoSave:()=>{N({enabled:!s.value.enabled})},toggleSaveOnAIResponse:()=>{N({saveOnAIResponse:!s.value.saveOnAIResponse})},setMaxAutoSaves:e=>{e>=1&&e<=50&&N({maxAutoSaves:e})},setAutoSavePrefix:e=>{N({autoSavePrefix:e||'[è‡ªåŠ¨]'})},resetAutoSaveConfig:()=>{ju.resetAutoSaveConfig(),s.value=ju.getAutoSaveConfig()},triggerAutoSave:async()=>{try{t.value=!0,a.value=null;const e=await ju.autoSaveOnAIResponse();return e&&(await g(),await h()),e}catch(e){return a.value=e instanceof Error?e.message:'è‡ªåŠ¨å­˜æ¡£å¤±è´¥',null}finally{t.value=!1}},clearAllAutoSaves:async()=>{try{t.value=!0,a.value=null;const e=await ju.listAutoSaves();for(const t of e)await ju.deleteSave(t.id);return await g(),await h(),console.log('[useSave] å·²æ¸…ç†æ‰€æœ‰è‡ªåŠ¨å­˜æ¡£ï¼Œå…±',e.length,'ä¸ª'),!0}catch(e){return a.value=e instanceof Error?e.message:'æ¸…ç†è‡ªåŠ¨å­˜æ¡£å¤±è´¥',!1}finally{t.value=!1}},convertAutoSaveToManual:async(e,n)=>{try{t.value=!0,a.value=null;const o=await ju.getSave(e);if(!o||!o.isAutoSave)return a.value='å­˜æ¡£ä¸å­˜åœ¨æˆ–ä¸æ˜¯è‡ªåŠ¨å­˜æ¡£',!1;const l=await ju.exportSave(e);if(!l)return a.value='å¯¼å‡ºå­˜æ¡£å¤±è´¥',!1;return!!await ju.importSave(l,n||o.name.replace(/^\[è‡ªåŠ¨\]\s*/,''))&&(await ju.deleteSave(e),await g(),await h(),!0)}catch(e){return a.value=e instanceof Error?e.message:'è½¬æ¢å­˜æ¡£å¤±è´¥',!1}finally{t.value=!1}},service:ju}}const zu={class:'auto-save-settings'},Wu={class:'setting-item'},Hu={class:'toggle-switch'},Gu=['checked'],Ju={class:'toggle-switch'},qu=['checked','disabled'],Ku={class:'setting-control'},Yu=['value','disabled'],Xu={class:'setting-control'},Zu=['value','disabled'],Qu={class:'setting-control'},ed=['value','disabled'],td={class:'status-section'},ad={class:'status-items'},nd={class:'status-item'},od={class:'status-item'},ld={key:0,class:'status-item'},sd={class:'status-value'},rd=(0,l.defineComponent)({__name:'AutoSaveSettings',setup(e){const{autoSaveConfig:t,lastAutoSave:a,toggleAutoSave:n,toggleSaveOnAIResponse:o,setMaxAutoSaves:s,setAutoSavePrefix:r,updateAutoSaveConfig:c,resetAutoSaveConfig:i}=Uu(),u=e=>{const t=e.target,a=parseInt(t.value,10);!isNaN(a)&&a>=1&&a<=50&&s(a)},d=e=>{const t=e.target;r(t.value)},m=e=>{const t=e.target,a=parseInt(t.value,10);!isNaN(a)&&a>=500&&a<=1e4&&c({debounceMs:a})},v=async()=>{await an('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è‡ªåŠ¨å­˜æ¡£è®¾ç½®ä¸ºé»˜è®¤å€¼å—ï¼Ÿ','é‡ç½®è®¾ç½®')&&i()};return(e,s)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',zu,[s[15]||(s[15]=(0,l.createElementVNode)('h4',{class:'settings-title'},'è‡ªåŠ¨å­˜æ¡£è®¾ç½®',-1)),(0,l.createCommentVNode)(' ä¸»å¼€å…³ '),(0,l.createElementVNode)('div',Wu,[s[3]||(s[3]=(0,l.createElementVNode)('div',{class:'setting-info'},[(0,l.createElementVNode)('div',{class:'setting-label'},'å¯ç”¨è‡ªåŠ¨å­˜æ¡£'),(0,l.createElementVNode)('div',{class:'setting-desc'},'æ€»å¼€å…³ï¼Œå…³é—­åå°†ä¸ä¼šè‡ªåŠ¨åˆ›å»ºä»»ä½•å­˜æ¡£')],-1)),(0,l.createElementVNode)('label',Hu,[(0,l.createElementVNode)('input',{type:'checkbox',checked:(0,l.unref)(t).enabled,onChange:s[0]||(s[0]=(...e)=>(0,l.unref)(n)&&(0,l.unref)(n)(...e))},null,40,Gu),s[2]||(s[2]=(0,l.createElementVNode)('span',{class:'toggle-slider'},null,-1))])]),(0,l.createCommentVNode)(' AIå›å¤åè‡ªåŠ¨å­˜æ¡£ '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['setting-item',{disabled:!(0,l.unref)(t).enabled}])},[s[5]||(s[5]=(0,l.createElementVNode)('div',{class:'setting-info'},[(0,l.createElementVNode)('div',{class:'setting-label'},'AIå›å¤åè‡ªåŠ¨å­˜æ¡£'),(0,l.createElementVNode)('div',{class:'setting-desc'},'æ¯æ¬¡AIç”Ÿæˆå›å¤ç»“æŸåè‡ªåŠ¨åˆ›å»ºå­˜æ¡£')],-1)),(0,l.createElementVNode)('label',Ju,[(0,l.createElementVNode)('input',{type:'checkbox',checked:(0,l.unref)(t).saveOnAIResponse,disabled:!(0,l.unref)(t).enabled,onChange:s[1]||(s[1]=(...e)=>(0,l.unref)(o)&&(0,l.unref)(o)(...e))},null,40,qu),s[4]||(s[4]=(0,l.createElementVNode)('span',{class:'toggle-slider'},null,-1))])],2),(0,l.createCommentVNode)(' æœ€å¤§è‡ªåŠ¨å­˜æ¡£æ•°é‡ '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['setting-item',{disabled:!(0,l.unref)(t).enabled}])},[s[7]||(s[7]=(0,l.createElementVNode)('div',{class:'setting-info'},[(0,l.createElementVNode)('div',{class:'setting-label'},'æœ€å¤§è‡ªåŠ¨å­˜æ¡£æ•°é‡'),(0,l.createElementVNode)('div',{class:'setting-desc'},'è¶…è¿‡æ­¤æ•°é‡æ—¶ä¼šè‡ªåŠ¨åˆ é™¤æœ€æ—§çš„è‡ªåŠ¨å­˜æ¡£')],-1)),(0,l.createElementVNode)('div',Ku,[(0,l.createElementVNode)('input',{type:'number',class:'number-input',value:(0,l.unref)(t).maxAutoSaves,disabled:!(0,l.unref)(t).enabled,min:'1',max:'50',onChange:u},null,40,Yu),s[6]||(s[6]=(0,l.createElementVNode)('span',{class:'unit'},'ä¸ª',-1))])],2),(0,l.createCommentVNode)(' è‡ªåŠ¨å­˜æ¡£å‰ç¼€ '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['setting-item',{disabled:!(0,l.unref)(t).enabled}])},[s[8]||(s[8]=(0,l.createElementVNode)('div',{class:'setting-info'},[(0,l.createElementVNode)('div',{class:'setting-label'},'è‡ªåŠ¨å­˜æ¡£å‰ç¼€'),(0,l.createElementVNode)('div',{class:'setting-desc'},'è‡ªåŠ¨å­˜æ¡£åç§°çš„å‰ç¼€ï¼Œä¾¿äºåŒºåˆ†')],-1)),(0,l.createElementVNode)('div',Xu,[(0,l.createElementVNode)('input',{type:'text',class:'text-input',value:(0,l.unref)(t).autoSavePrefix,disabled:!(0,l.unref)(t).enabled,placeholder:'[è‡ªåŠ¨]',onChange:d},null,40,Zu)])],2),(0,l.createCommentVNode)(' é˜²æŠ–é—´éš” '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['setting-item',{disabled:!(0,l.unref)(t).enabled}])},[s[10]||(s[10]=(0,l.createElementVNode)('div',{class:'setting-info'},[(0,l.createElementVNode)('div',{class:'setting-label'},'é˜²æŠ–é—´éš”'),(0,l.createElementVNode)('div',{class:'setting-desc'},'ä¸¤æ¬¡è‡ªåŠ¨å­˜æ¡£ä¹‹é—´çš„æœ€å°é—´éš”æ—¶é—´')],-1)),(0,l.createElementVNode)('div',Qu,[(0,l.createElementVNode)('input',{type:'number',class:'number-input',value:(0,l.unref)(t).debounceMs,disabled:!(0,l.unref)(t).enabled,min:'500',max:'10000',step:'100',onChange:m},null,40,ed),s[9]||(s[9]=(0,l.createElementVNode)('span',{class:'unit'},'æ¯«ç§’',-1))])],2),(0,l.createCommentVNode)(' é‡ç½®æŒ‰é’® '),(0,l.createElementVNode)('div',{class:'setting-actions'},[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:v},'é‡ç½®ä¸ºé»˜è®¤å€¼')]),(0,l.createCommentVNode)(' å½“å‰çŠ¶æ€ '),(0,l.createElementVNode)('div',td,[s[14]||(s[14]=(0,l.createElementVNode)('h5',{class:'status-title'},'å½“å‰çŠ¶æ€',-1)),(0,l.createElementVNode)('div',ad,[(0,l.createElementVNode)('div',nd,[s[11]||(s[11]=(0,l.createElementVNode)('span',{class:'status-label'},'è‡ªåŠ¨å­˜æ¡£:',-1)),(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['status-value',{active:(0,l.unref)(t).enabled}])},(0,l.toDisplayString)((0,l.unref)(t).enabled?'å·²å¯ç”¨':'å·²ç¦ç”¨'),3)]),(0,l.createElementVNode)('div',od,[s[12]||(s[12]=(0,l.createElementVNode)('span',{class:'status-label'},'AIå›å¤å­˜æ¡£:',-1)),(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['status-value',{active:(0,l.unref)(t).saveOnAIResponse&&(0,l.unref)(t).enabled}])},(0,l.toDisplayString)((0,l.unref)(t).saveOnAIResponse&&(0,l.unref)(t).enabled?'å·²å¯ç”¨':'å·²ç¦ç”¨'),3)]),(0,l.unref)(a)?((0,l.openBlock)(),(0,l.createElementBlock)('div',ld,[s[13]||(s[13]=(0,l.createElementVNode)('span',{class:'status-label'},'æœ€åå­˜æ¡£:',-1)),(0,l.createElementVNode)('span',sd,(0,l.toDisplayString)((0,l.unref)(a).name),1)])):(0,l.createCommentVNode)('v-if',!0)])]),(0,l.createCommentVNode)(' è¯´æ˜ä¿¡æ¯ '),s[16]||(s[16]=(0,l.createElementVNode)('div',{class:'info-section'},[(0,l.createElementVNode)('h5',{class:'info-title'},'ğŸ’¡ è¯´æ˜'),(0,l.createElementVNode)('ul',{class:'info-list'},[(0,l.createElementVNode)('li',null,'è‡ªåŠ¨å­˜æ¡£ä¼šåœ¨æ¯æ¬¡AIå›å¤ç»“æŸåè‡ªåŠ¨åˆ›å»º'),(0,l.createElementVNode)('li',null,'è‡ªåŠ¨å­˜æ¡£ä¸æ‰‹åŠ¨å­˜æ¡£åˆ†å¼€ç®¡ç†ï¼Œäº’ä¸å½±å“'),(0,l.createElementVNode)('li',null,'è¶…å‡ºæ•°é‡é™åˆ¶æ—¶ï¼Œæœ€æ—§çš„è‡ªåŠ¨å­˜æ¡£ä¼šè¢«è‡ªåŠ¨åˆ é™¤'),(0,l.createElementVNode)('li',null,'å¯ä»¥å°†é‡è¦çš„è‡ªåŠ¨å­˜æ¡£è½¬æ¢ä¸ºæ‰‹åŠ¨å­˜æ¡£ä»¥æ°¸ä¹…ä¿ç•™')])],-1))]))}}),cd=(0,I.A)(rd,[['__scopeId','data-v-1d1dfdc8']]),id={class:'save-manager'},ud={class:'save-header'},dd={class:'header-actions'},md=['disabled'],vd={class:'save-stats'},pd={class:'stat-item'},fd={class:'stat-value'},gd={class:'stat-item'},hd={class:'stat-value'},yd={class:'stat-item'},Vd={class:'stat-value'},Nd={class:'tab-bar'},Ed={class:'save-content'},bd={key:0,class:'save-list-container'},kd={class:'create-save-section'},Cd=['disabled'],Sd={key:0,class:'save-list'},wd={class:'save-info'},Id={class:'save-name'},Bd={class:'save-time'},Ad={class:'save-actions'},Dd=['onClick','disabled'],Md=['onClick','disabled'],xd=['onClick','disabled'],Td=['onClick','disabled'],$d={key:1,class:'empty-state'},_d={class:'save-list-container'},Rd={class:'auto-save-actions'},Od=['disabled'],Fd=['disabled'],Ld={key:0,class:'save-list'},Pd={class:'save-info'},jd={class:'save-name'},Ud={class:'save-time'},zd={key:0,class:'save-source'},Wd={class:'save-actions'},Hd=['onClick','disabled'],Gd=['onClick','disabled'],Jd=['onClick','disabled'],qd={key:1,class:'empty-state'},Kd={class:'settings-container'},Yd={class:'save-footer'},Xd={class:'footer-left'},Zd=['disabled'],Qd=['disabled'],em={class:'footer-right'},tm={class:'import-btn btn btn-secondary'},am={key:0,class:'error-message'},nm={class:'confirm-dialog'},om={class:'confirm-title'},lm={class:'confirm-message'},sm=(0,l.defineComponent)({__name:'SaveManager',emits:['close','save-loaded','save-created'],setup(e,{emit:t}){const a=t,{isProcessing:n,error:o,saveList:s,currentSave:r,saveStats:c,manualSaveList:i,autoSaveList:u,hasSaves:d,refreshList:m,refreshStats:v,createSave:p,updateSave:f,loadSave:g,deleteSave:h,quickSave:y,quickLoad:V,downloadSave:N,uploadSave:E,triggerAutoSave:b,clearAllAutoSaves:k,convertAutoSaveToManual:C}=Uu(),S=(0,l.ref)('manual'),w=(0,l.ref)(''),I=(0,l.ref)(!1),B=(0,l.ref)(''),A=(0,l.ref)('');let D=null;const M=e=>new Date(e).toLocaleString('zh-CN',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}),x=()=>{},T=(e,t,a)=>{B.value=e,A.value=t,D=a,I.value=!0},R=()=>{I.value=!1,D=null},O=()=>{D&&D(),I.value=!1,D=null},F=async()=>{if(!w.value.trim())return;const e=await p(w.value.trim());e&&(w.value='',a('save-created',e.id))},L=async e=>{T('è¯»å–å­˜æ¡£','ç¡®å®šè¦è¯»å–æ­¤å­˜æ¡£å—ï¼Ÿå½“å‰æœªä¿å­˜çš„è¿›åº¦å°†ä¸¢å¤±ã€‚',async()=>{await g(e)&&a('save-loaded',e)})},P=(e,t)=>{T('åˆ é™¤å­˜æ¡£',`ç¡®å®šè¦åˆ é™¤å­˜æ¡£"${t}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`,async()=>{await h(e)})},j=async e=>{const t=e.target,a=t.files?.[0];a&&(await E(a),t.value='')},U=async()=>{await y()},W=async()=>{T('å¿«é€ŸåŠ è½½','ç¡®å®šè¦åŠ è½½æœ€è¿‘çš„å­˜æ¡£å—ï¼Ÿå½“å‰æœªä¿å­˜çš„è¿›åº¦å°†ä¸¢å¤±ã€‚',async()=>{await V()})},H=async()=>{await b()},G=()=>{T('æ¸…ç©ºè‡ªåŠ¨å­˜æ¡£','ç¡®å®šè¦åˆ é™¤æ‰€æœ‰è‡ªåŠ¨å­˜æ¡£å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚',async()=>{await k()})};return(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',id,[(0,l.createCommentVNode)(' é¡¶éƒ¨æ ‡é¢˜æ  '),(0,l.createElementVNode)('div',ud,[t[6]||(t[6]=(0,l.createElementVNode)('h3',{class:'save-title'},[(0,l.createElementVNode)('span',{class:'icon'},'ğŸ’¾'),(0,l.createTextVNode)(' å­˜æ¡£ç®¡ç† ')],-1)),(0,l.createElementVNode)('div',dd,[(0,l.createElementVNode)('button',{class:'btn btn-icon',onClick:t[0]||(t[0]=(...e)=>(0,l.unref)(m)&&(0,l.unref)(m)(...e)),disabled:(0,l.unref)(n),title:'åˆ·æ–°'},[(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)({spinning:(0,l.unref)(n)})},'ğŸ”„',2)],8,md),(0,l.createElementVNode)('button',{class:'btn btn-icon',onClick:t[1]||(t[1]=t=>e.$emit('close')),title:'å…³é—­'},'âœ–')])]),(0,l.createCommentVNode)(' å­˜æ¡£ç»Ÿè®¡ '),(0,l.createElementVNode)('div',vd,[(0,l.createElementVNode)('div',pd,[t[7]||(t[7]=(0,l.createElementVNode)('span',{class:'stat-label'},'æ€»è®¡',-1)),(0,l.createElementVNode)('span',fd,(0,l.toDisplayString)((0,l.unref)(c).total),1)]),(0,l.createElementVNode)('div',gd,[t[8]||(t[8]=(0,l.createElementVNode)('span',{class:'stat-label'},'æ‰‹åŠ¨',-1)),(0,l.createElementVNode)('span',hd,(0,l.toDisplayString)((0,l.unref)(c).manual),1)]),(0,l.createElementVNode)('div',yd,[t[9]||(t[9]=(0,l.createElementVNode)('span',{class:'stat-label'},'è‡ªåŠ¨',-1)),(0,l.createElementVNode)('span',Vd,(0,l.toDisplayString)((0,l.unref)(c).auto),1)])]),(0,l.createCommentVNode)(' æ ‡ç­¾é¡µåˆ‡æ¢ '),(0,l.createElementVNode)('div',Nd,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['tab-btn',{active:'manual'===S.value}]),onClick:t[2]||(t[2]=e=>S.value='manual')},' æ‰‹åŠ¨å­˜æ¡£ ('+(0,l.toDisplayString)((0,l.unref)(i).length)+') ',3),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['tab-btn',{active:'auto'===S.value}]),onClick:t[3]||(t[3]=e=>S.value='auto')},' è‡ªåŠ¨å­˜æ¡£ ('+(0,l.toDisplayString)((0,l.unref)(u).length)+') ',3),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['tab-btn',{active:'settings'===S.value}]),onClick:t[4]||(t[4]=e=>S.value='settings')},' è®¾ç½® ',2)]),(0,l.createCommentVNode)(' å†…å®¹åŒºåŸŸ '),(0,l.createElementVNode)('div',Ed,[(0,l.createCommentVNode)(' æ‰‹åŠ¨å­˜æ¡£åˆ—è¡¨ '),'manual'===S.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',bd,[(0,l.createCommentVNode)(' åˆ›å»ºæ–°å­˜æ¡£ '),(0,l.createElementVNode)('div',kd,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>w.value=e),type:'text',class:'save-name-input',placeholder:'è¾“å…¥å­˜æ¡£åç§°...',onKeyup:(0,l.withKeys)(F,['enter'])},null,544),[[l.vModelText,w.value]]),(0,l.createElementVNode)('button',{class:'btn btn-primary',onClick:F,disabled:(0,l.unref)(n)||!w.value.trim()},' åˆ›å»ºå­˜æ¡£ ',8,Cd)]),(0,l.createCommentVNode)(' å­˜æ¡£åˆ—è¡¨ '),(0,l.unref)(i).length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',Sd,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(i),e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['save-item',{active:(0,l.unref)(r)?.id===e.id}])},[(0,l.createElementVNode)('div',wd,[(0,l.createElementVNode)('div',Id,(0,l.toDisplayString)(e.name),1),(0,l.createElementVNode)('div',Bd,[(0,l.createElementVNode)('span',null,'åˆ›å»º: '+(0,l.toDisplayString)(M(e.createdAt)),1),(0,l.createElementVNode)('span',null,'æ›´æ–°: '+(0,l.toDisplayString)(M(e.updatedAt)),1)])]),(0,l.createElementVNode)('div',Ad,[(0,l.createElementVNode)('button',{class:'btn btn-sm btn-primary',onClick:t=>L(e.id),disabled:(0,l.unref)(n),title:'è¯»å–'},' ğŸ“‚ ',8,Dd),(0,l.createElementVNode)('button',{class:'btn btn-sm btn-secondary',onClick:t=>(async e=>{T('è¦†ç›–å­˜æ¡£','ç¡®å®šè¦è¦†ç›–æ­¤å­˜æ¡£å—ï¼ŸåŸæœ‰æ•°æ®å°†è¢«æ›¿æ¢ã€‚',async()=>{await f(e)})})(e.id),disabled:(0,l.unref)(n),title:'è¦†ç›–'},' ğŸ’¾ ',8,Md),(0,l.createElementVNode)('button',{class:'btn btn-sm btn-secondary',onClick:t=>(async e=>{await N(e)})(e.id),disabled:(0,l.unref)(n),title:'å¯¼å‡º'},' ğŸ“¤ ',8,xd),(0,l.createElementVNode)('button',{class:'btn btn-sm btn-danger',onClick:t=>P(e.id,e.name),disabled:(0,l.unref)(n),title:'åˆ é™¤'},' ğŸ—‘ï¸ ',8,Td)])],2))),128))])):((0,l.openBlock)(),(0,l.createElementBlock)('div',$d,[...t[10]||(t[10]=[(0,l.createElementVNode)('p',null,'æš‚æ— æ‰‹åŠ¨å­˜æ¡£',-1),(0,l.createElementVNode)('p',{class:'hint'},'åœ¨ä¸Šæ–¹è¾“å…¥åç§°åˆ›å»ºæ–°å­˜æ¡£',-1)])]))])):'auto'===S.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' è‡ªåŠ¨å­˜æ¡£åˆ—è¡¨ '),(0,l.createElementVNode)('div',_d,[(0,l.createCommentVNode)(' è‡ªåŠ¨å­˜æ¡£æ“ä½œ '),(0,l.createElementVNode)('div',Rd,[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:H,disabled:(0,l.unref)(n)},' ç«‹å³è‡ªåŠ¨å­˜æ¡£ ',8,Od),(0,l.createElementVNode)('button',{class:'btn btn-danger',onClick:G,disabled:(0,l.unref)(n)||0===(0,l.unref)(u).length},' æ¸…ç©ºè‡ªåŠ¨å­˜æ¡£ ',8,Fd)]),(0,l.createCommentVNode)(' è‡ªåŠ¨å­˜æ¡£åˆ—è¡¨ '),(0,l.unref)(u).length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ld,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(u),e=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:'save-item auto-save'},[(0,l.createElementVNode)('div',Pd,[(0,l.createElementVNode)('div',jd,[t[11]||(t[11]=(0,l.createElementVNode)('span',{class:'auto-badge'},'è‡ªåŠ¨',-1)),(0,l.createTextVNode)(' '+(0,l.toDisplayString)(e.name),1)]),(0,l.createElementVNode)('div',Ud,[(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(M(e.updatedAt)),1),e.saveSource?((0,l.openBlock)(),(0,l.createElementBlock)('span',zd,' æ¥æº: '+(0,l.toDisplayString)((a=e.saveSource,{manual:'æ‰‹åŠ¨',auto:'è‡ªåŠ¨',ai_response:'AIå›å¤'}[a]||a)),1)):(0,l.createCommentVNode)('v-if',!0)])]),(0,l.createElementVNode)('div',Wd,[(0,l.createElementVNode)('button',{class:'btn btn-sm btn-primary',onClick:t=>L(e.id),disabled:(0,l.unref)(n),title:'è¯»å–'},' ğŸ“‚ ',8,Hd),(0,l.createElementVNode)('button',{class:'btn btn-sm btn-secondary',onClick:t=>(async e=>{T('è½¬ä¸ºæ‰‹åŠ¨å­˜æ¡£','ç¡®å®šè¦å°†æ­¤è‡ªåŠ¨å­˜æ¡£è½¬ä¸ºæ‰‹åŠ¨å­˜æ¡£å—ï¼Ÿ',async()=>{await C(e)})})(e.id),disabled:(0,l.unref)(n),title:'è½¬ä¸ºæ‰‹åŠ¨å­˜æ¡£'},' ğŸ“Œ ',8,Gd),(0,l.createElementVNode)('button',{class:'btn btn-sm btn-danger',onClick:t=>P(e.id,e.name),disabled:(0,l.unref)(n),title:'åˆ é™¤'},' ğŸ—‘ï¸ ',8,Jd)])]);var a}),128))])):((0,l.openBlock)(),(0,l.createElementBlock)('div',qd,[...t[12]||(t[12]=[(0,l.createElementVNode)('p',null,'æš‚æ— è‡ªåŠ¨å­˜æ¡£',-1),(0,l.createElementVNode)('p',{class:'hint'},'AIå›å¤ç»“æŸåä¼šè‡ªåŠ¨åˆ›å»ºå­˜æ¡£',-1)])]))])],2112)):'settings'===S.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' è®¾ç½®é¢æ¿ '),(0,l.createElementVNode)('div',Kd,[(0,l.createVNode)(cd)])],2112)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' åº•éƒ¨æ“ä½œæ  '),(0,l.createElementVNode)('div',Yd,[(0,l.createElementVNode)('div',Xd,[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:U,disabled:(0,l.unref)(n)},'å¿«é€Ÿä¿å­˜',8,Zd),(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:W,disabled:(0,l.unref)(n)||!(0,l.unref)(d)},' å¿«é€ŸåŠ è½½ ',8,Qd)]),(0,l.createElementVNode)('div',em,[(0,l.createElementVNode)('label',tm,[t[13]||(t[13]=(0,l.createTextVNode)(' å¯¼å…¥å­˜æ¡£ ',-1)),(0,l.createElementVNode)('input',{type:'file',accept:'.json',onChange:j,hidden:''},null,32)])])]),(0,l.createCommentVNode)(' é”™è¯¯æç¤º '),(0,l.unref)(o)?((0,l.openBlock)(),(0,l.createElementBlock)('div',am,[(0,l.createTextVNode)((0,l.toDisplayString)((0,l.unref)(o))+' ',1),(0,l.createElementVNode)('button',{class:'btn-close',onClick:x},'Ã—')])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' ç¡®è®¤å¯¹è¯æ¡† '),I.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:1,class:'confirm-overlay',onClick:(0,l.withModifiers)(R,['self'])},[(0,l.createElementVNode)('div',nm,[(0,l.createElementVNode)('div',om,(0,l.toDisplayString)(B.value),1),(0,l.createElementVNode)('div',lm,(0,l.toDisplayString)(A.value),1),(0,l.createElementVNode)('div',{class:'confirm-actions'},[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:R},'å–æ¶ˆ'),(0,l.createElementVNode)('button',{class:'btn btn-danger',onClick:O},'ç¡®è®¤')])])])):(0,l.createCommentVNode)('v-if',!0)]))}}),rm=(0,I.A)(sm,[['__scopeId','data-v-63e5f2b9']]);const cm={class:'context-manager-panel'},im={class:'panel-header'},um={class:'panel-body'},dm={class:'enable-section'},mm={class:'enable-row'},vm={class:'toggle-switch'},pm=['checked','disabled'],fm={class:'stats-section'},gm={class:'stats-grid'},hm={class:'stat-item'},ym={class:'stat-value'},Vm={class:'stat-item'},Nm={class:'stat-value'},Em={class:'stat-item'},bm={class:'stat-value'},km={class:'stat-item'},Cm={class:'stat-value'},Sm={key:0,class:'last-update'},wm={class:'mode-section'},Im={class:'mode-selector'},Bm=['disabled'],Am=['disabled'],Dm={class:'config-section'},Mm={class:'config-item'},xm={class:'config-control'},Tm=['disabled'],$m={class:'config-item'},_m={class:'config-control'},Rm=['disabled'],Om={class:'actions-section'},Fm={class:'action-buttons'},Lm=['disabled'],Pm={key:0},jm={key:1},Um=['disabled'],zm=['disabled'],Wm=['disabled'],Hm={key:0,class:'error-message'},Gm=(0,l.defineComponent)({__name:'ContextManagerPanel',emits:['close'],setup(e){const{isProcessing:t,error:a,mode:n,config:o,statistics:s,formattedLastUpdateTime:r,isEnabled:c,refresh:i,setSegmentCount:u,setSmallSummaryCount:d,switchMode:m,regenerateSegments:v,clearAll:p,setEnabled:f}=function(){const e=(0,l.ref)(!1),t=(0,l.ref)(!1),a=(0,l.ref)(null),n=(0,l.ref)('segmented'),o=(0,l.ref)(!1),s=(0,l.ref)({segmentCount:3,smallSummaryCount:25}),r=(0,l.ref)({recordCount:0,textCount:0,segmentCount:0,smallSummaryCount:0,largeSummaryCount:0,mode:'segmented'}),c=(0,l.ref)([]),i=(0,l.ref)([]),u=(0,l.ref)(null),d=(0,l.ref)(0),m=(0,l.computed)(()=>r.value.recordCount>0),v=(0,l.computed)(()=>'segmented'===n.value),p=(0,l.computed)(()=>d.value?new Date(d.value).toLocaleString('zh-CN'):''),f=()=>{const e=_u.getState(),l=_u.getStatistics(),m=_u.getConfig();n.value=e.mode,s.value=m,r.value=l,t.value=e.isProcessing,a.value=e.error,d.value=e.lastUpdateTime,u.value=e.segmentedContent,o.value=_u.isEnabled(),c.value=_u.getLatestRecords(10),i.value=_u.getLatestTexts(5)};return(0,l.onMounted)(async()=>{console.log('[useContextManager] Composableå·²æŒ‚è½½'),f()}),{isInitialized:e,isProcessing:t,error:a,mode:n,config:s,statistics:r,latestRecords:c,latestTexts:i,segmentedContent:u,lastUpdateTime:d,isEnabled:o,hasRecords:m,isSegmentedMode:v,formattedLastUpdateTime:p,initialize:async()=>{try{t.value=!0,a.value=null;const n=await _u.initialize();return n&&(e.value=!0,f()),n}catch(e){return a.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥',!1}finally{t.value=!1}},refresh:async()=>{await _u.loadFromWorldbook(),f()},setSegmentCount:async e=>{try{return t.value=!0,a.value=null,await _u.setSegmentCount(e),f(),!0}catch(e){return a.value=e instanceof Error?e.message:'è®¾ç½®å¤±è´¥',!1}finally{t.value=!1}},setSmallSummaryCount:async e=>{try{return t.value=!0,a.value=null,await _u.setSmallSummaryCount(e),f(),!0}catch(e){return a.value=e instanceof Error?e.message:'è®¾ç½®å¤±è´¥',!1}finally{t.value=!1}},updateConfig:async e=>{try{return t.value=!0,a.value=null,await _u.setConfig(e),f(),!0}catch(e){return a.value=e instanceof Error?e.message:'æ›´æ–°é…ç½®å¤±è´¥',!1}finally{t.value=!1}},switchMode:async e=>{try{return t.value=!0,a.value=null,await _u.switchMode(e),f(),!0}catch(e){return a.value=e instanceof Error?e.message:'åˆ‡æ¢æ¨¡å¼å¤±è´¥',!1}finally{t.value=!1}},regenerateSegments:async()=>{try{t.value=!0,a.value=null;const e=await _u.regenerateSegments();return f(),e}catch(e){return a.value=e instanceof Error?e.message:'é‡æ–°ç”Ÿæˆå¤±è´¥',!1}finally{t.value=!1}},clearAll:async(e=!1)=>{try{t.value=!0,a.value=null;const n=await _u.clearAll(e);return f(),n}catch(e){return a.value=e instanceof Error?e.message:'æ¸…ç©ºå¤±è´¥',!1}finally{t.value=!1}},getSaveData:async()=>await _u.getSaveData(),restoreFromSaveData:async e=>{try{t.value=!0,a.value=null;const n=await _u.restoreFromSaveData(e);return f(),n}catch(e){return a.value=e instanceof Error?e.message:'æ¢å¤å¤±è´¥',!1}finally{t.value=!1}},syncState:f,setEnabled:async e=>{try{return t.value=!0,a.value=null,_u.setEnabled(e),e&&await _u.initialize(),f(),!0}catch(e){return a.value=e instanceof Error?e.message:'è®¾ç½®å¯ç”¨çŠ¶æ€å¤±è´¥',!1}finally{t.value=!1}},service:_u}}(),g=(0,l.reactive)({segmentCount:3,smallSummaryCount:25}),h=async()=>{await i(),'undefined'!=typeof toastr&&toastr.success('æ•°æ®å·²åˆ·æ–°')},y=async()=>{await u(g.segmentCount)&&'undefined'!=typeof toastr&&toastr.success('åˆ†æ®µæ•°é‡å·²æ›´æ–°')},V=async()=>{await d(g.smallSummaryCount)&&'undefined'!=typeof toastr&&toastr.success('å°æ€»ç»“èŒƒå›´å·²æ›´æ–°')},N=async()=>{await m(n.value)&&'undefined'!=typeof toastr&&toastr.success(`å·²åˆ‡æ¢åˆ°${'segmented'===n.value?'åˆ†æ®µ':'å®Œæ•´'}æ¨¡å¼`)},E=async()=>{await v()&&'undefined'!=typeof toastr&&toastr.success('åˆ†æ®µå·²é‡æ–°ç”Ÿæˆ')},b=async()=>{const e=c.value?'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä¸Šä¸‹æ–‡æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚':'åŠŸèƒ½æœªå¯ç”¨ï¼Œä»…æ¸…ç©ºæœ¬åœ°çŠ¶æ€ã€‚ç¡®å®šç»§ç»­å—ï¼Ÿ';if(!await tn(e,'æ¸…ç©ºæ•°æ®'))return;await p(!1)&&'undefined'!=typeof toastr&&toastr.success('æ•°æ®å·²æ¸…ç©º')},k=async()=>{if(!await tn('ç¡®å®šè¦å¼ºåˆ¶æ¸…ç©ºä¸–ç•Œä¹¦ä¸­çš„ä¸Šä¸‹æ–‡æ¡ç›®å—ï¼Ÿæ­¤æ“ä½œä¼šå½±å“ä¸–ç•Œä¹¦å†…å®¹ï¼Œä¸å¯æ¢å¤ï¼','å¼ºåˆ¶æ¸…ç©ºä¸–ç•Œä¹¦'))return;await p(!0)&&'undefined'!=typeof toastr&&toastr.success('ä¸–ç•Œä¹¦æ¡ç›®å·²æ¸…ç©º')},C=async e=>{const t=e.target;if(t.checked){if(await an('å¯ç”¨åå°†ç”±æœ¬ç³»ç»Ÿç®¡ç†ä¸–ç•Œä¹¦æ¡ç›®ã€‚å¦‚æœæ‚¨ä½¿ç”¨å¤–æŒ‚çš„ä¸–ç•Œä¹¦æ¥æä¾›ä¸Šä¸‹æ–‡ï¼Œè¯·ä¿æŒç¦ç”¨çŠ¶æ€ã€‚ç¡®å®šå¯ç”¨å—ï¼Ÿ','å¯ç”¨ä¸Šä¸‹æ–‡ç®¡ç†')){await f(!0)&&'undefined'!=typeof toastr&&toastr.success('ä¸Šä¸‹æ–‡ç®¡ç†å·²å¯ç”¨')}else t.checked=!1}else{await f(!1)&&'undefined'!=typeof toastr&&toastr.info('ä¸Šä¸‹æ–‡ç®¡ç†å·²ç¦ç”¨')}};return(0,l.onMounted)(()=>{g.segmentCount=o.value.segmentCount,g.smallSummaryCount=o.value.smallSummaryCount}),(e,o)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',cm,[(0,l.createCommentVNode)(' å¤´éƒ¨ '),(0,l.createElementVNode)('div',im,[o[5]||(o[5]=(0,l.createElementVNode)('h3',null,'ğŸ“š ä¸Šä¸‹æ–‡ç®¡ç†',-1)),(0,l.createElementVNode)('button',{class:'btn-close',onClick:o[0]||(o[0]=t=>e.$emit('close'))},'âœ•')]),(0,l.createCommentVNode)(' å†…å®¹ '),(0,l.createElementVNode)('div',um,[(0,l.createCommentVNode)(' åŠŸèƒ½å¯ç”¨å¼€å…³ '),(0,l.createElementVNode)('div',dm,[o[8]||(o[8]=(0,l.createElementVNode)('div',{class:'section-title'},'âš¡ åŠŸèƒ½å¼€å…³',-1)),(0,l.createElementVNode)('div',mm,[o[7]||(o[7]=(0,l.createElementVNode)('span',{class:'enable-label'},'ä¸Šä¸‹æ–‡ç®¡ç†åŠŸèƒ½',-1)),(0,l.createElementVNode)('label',vm,[(0,l.createElementVNode)('input',{type:'checkbox',checked:(0,l.unref)(c),onChange:C,disabled:(0,l.unref)(t)},null,40,pm),o[6]||(o[6]=(0,l.createElementVNode)('span',{class:'toggle-slider'},null,-1))])]),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['enable-status',{enabled:(0,l.unref)(c),disabled:!(0,l.unref)(c)}])},(0,l.toDisplayString)((0,l.unref)(c)?'âœ… å·²å¯ç”¨ - æ­£åœ¨ç®¡ç†ä¸–ç•Œä¹¦':'âš ï¸ å·²ç¦ç”¨ - ä½¿ç”¨å¤–æŒ‚ä¸–ç•Œä¹¦'),3)]),(0,l.createCommentVNode)(' ç»Ÿè®¡ä¿¡æ¯ '),(0,l.createElementVNode)('div',fm,[o[13]||(o[13]=(0,l.createElementVNode)('div',{class:'section-title'},'ğŸ“Š ç»Ÿè®¡ä¿¡æ¯',-1)),(0,l.createElementVNode)('div',gm,[(0,l.createElementVNode)('div',hm,[o[9]||(o[9]=(0,l.createElementVNode)('span',{class:'stat-label'},'å†å²è®°å½•',-1)),(0,l.createElementVNode)('span',ym,(0,l.toDisplayString)((0,l.unref)(s).recordCount),1)]),(0,l.createElementVNode)('div',Vm,[o[10]||(o[10]=(0,l.createElementVNode)('span',{class:'stat-label'},'å†å²æ­£æ–‡',-1)),(0,l.createElementVNode)('span',Nm,(0,l.toDisplayString)((0,l.unref)(s).textCount),1)]),(0,l.createElementVNode)('div',Em,[o[11]||(o[11]=(0,l.createElementVNode)('span',{class:'stat-label'},'åˆ†æ®µæ­£æ–‡',-1)),(0,l.createElementVNode)('span',bm,(0,l.toDisplayString)((0,l.unref)(s).segmentCount),1)]),(0,l.createElementVNode)('div',km,[o[12]||(o[12]=(0,l.createElementVNode)('span',{class:'stat-label'},'å°æ€»ç»“',-1)),(0,l.createElementVNode)('span',Cm,(0,l.toDisplayString)((0,l.unref)(s).smallSummaryCount),1)])]),(0,l.unref)(r)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Sm,'æœ€åæ›´æ–°: '+(0,l.toDisplayString)((0,l.unref)(r)),1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' æ¨¡å¼åˆ‡æ¢ '),(0,l.createElementVNode)('div',wm,[o[16]||(o[16]=(0,l.createElementVNode)('div',{class:'section-title'},'ğŸ›ï¸ æ¨¡å¼é…ç½®',-1)),(0,l.createElementVNode)('div',Im,[(0,l.createElementVNode)('label',{class:(0,l.normalizeClass)(['mode-option',{active:'segmented'===(0,l.unref)(n),disabled:!(0,l.unref)(c)}])},[(0,l.withDirectives)((0,l.createElementVNode)('input',{type:'radio','onUpdate:modelValue':o[1]||(o[1]=e=>(0,l.isRef)(n)?n.value=e:null),value:'segmented',onChange:N,disabled:!(0,l.unref)(c)},null,40,Bm),[[l.vModelRadio,(0,l.unref)(n)]]),o[14]||(o[14]=(0,l.createElementVNode)('span',null,'åˆ†æ®µæ¨¡å¼',-1))],2),(0,l.createElementVNode)('label',{class:(0,l.normalizeClass)(['mode-option',{active:'full'===(0,l.unref)(n),disabled:!(0,l.unref)(c)}])},[(0,l.withDirectives)((0,l.createElementVNode)('input',{type:'radio','onUpdate:modelValue':o[2]||(o[2]=e=>(0,l.isRef)(n)?n.value=e:null),value:'full',onChange:N,disabled:!(0,l.unref)(c)},null,40,Am),[[l.vModelRadio,(0,l.unref)(n)]]),o[15]||(o[15]=(0,l.createElementVNode)('span',null,'å®Œæ•´æ¨¡å¼',-1))],2)])]),(0,l.createCommentVNode)(' é…ç½®é€‰é¡¹ '),(0,l.createElementVNode)('div',Dm,[o[21]||(o[21]=(0,l.createElementVNode)('div',{class:'section-title'},'âš™ï¸ åˆ†æ®µé…ç½®',-1)),(0,l.createElementVNode)('div',Mm,[o[17]||(o[17]=(0,l.createElementVNode)('label',null,'åˆ†æ®µæ­£æ–‡æ•°é‡',-1)),(0,l.createElementVNode)('div',xm,[(0,l.withDirectives)((0,l.createElementVNode)('input',{type:'number','onUpdate:modelValue':o[3]||(o[3]=e=>g.segmentCount=e),min:'0',max:'20',class:'config-input'},null,512),[[l.vModelText,g.segmentCount,void 0,{number:!0}]]),(0,l.createElementVNode)('button',{class:'btn-apply',onClick:y,disabled:(0,l.unref)(t)},'åº”ç”¨',8,Tm)]),o[18]||(o[18]=(0,l.createElementVNode)('span',{class:'config-hint'},'è®¾ä¸º0åˆ™ä¸ä½¿ç”¨åˆ†æ®µæ­£æ–‡',-1))]),(0,l.createElementVNode)('div',$m,[o[19]||(o[19]=(0,l.createElementVNode)('label',null,'å°æ€»ç»“èŒƒå›´',-1)),(0,l.createElementVNode)('div',_m,[(0,l.withDirectives)((0,l.createElementVNode)('input',{type:'number','onUpdate:modelValue':o[4]||(o[4]=e=>g.smallSummaryCount=e),min:'0',max:'100',class:'config-input'},null,512),[[l.vModelText,g.smallSummaryCount,void 0,{number:!0}]]),(0,l.createElementVNode)('button',{class:'btn-apply',onClick:V,disabled:(0,l.unref)(t)},'åº”ç”¨',8,Rm)]),o[20]||(o[20]=(0,l.createElementVNode)('span',{class:'config-hint'},'è®¾ä¸º0åˆ™ä¸ä½¿ç”¨å°æ€»ç»“',-1))])]),(0,l.createCommentVNode)(' æ“ä½œæŒ‰é’® '),(0,l.createElementVNode)('div',Om,[o[22]||(o[22]=(0,l.createElementVNode)('div',{class:'section-title'},'ğŸ”§ æ“ä½œ',-1)),(0,l.createElementVNode)('div',Fm,[(0,l.createElementVNode)('button',{class:'btn btn-primary',onClick:h,disabled:(0,l.unref)(t)},[(0,l.unref)(t)?((0,l.openBlock)(),(0,l.createElementBlock)('span',Pm,'å¤„ç†ä¸­...')):((0,l.openBlock)(),(0,l.createElementBlock)('span',jm,'ğŸ”„ åˆ·æ–°æ•°æ®'))],8,Lm),(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:E,disabled:(0,l.unref)(t)||!(0,l.unref)(c)},' ğŸ”€ é‡æ–°åˆ†æ®µ ',8,Um),(0,l.createElementVNode)('button',{class:'btn btn-danger',onClick:b,disabled:(0,l.unref)(t)},'ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰',8,zm),(0,l.unref)(c)?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'btn btn-danger-outline',onClick:k,disabled:(0,l.unref)(t)},' ğŸ—‘ï¸ å¼ºåˆ¶æ¸…ç©ºä¸–ç•Œä¹¦ ',8,Wm))])]),(0,l.createCommentVNode)(' é”™è¯¯æç¤º '),(0,l.unref)(a)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Hm,'âš ï¸ '+(0,l.toDisplayString)((0,l.unref)(a)),1)):(0,l.createCommentVNode)('v-if',!0)])]))}}),Jm=(0,I.A)(Gm,[['__scopeId','data-v-71562640']]),qm=[{name:'thinking',displayName:'æ€è€ƒè¿‡ç¨‹',required:!1},{name:'gametxt',displayName:'æ¸¸æˆæ–‡æœ¬',required:!0},{name:'å†å²è®°å½•',displayName:'å†å²è®°å½•',required:!1},{name:'UpdateVariable',displayName:'å˜é‡æ›´æ–°',required:!1}];class Km{static instance;constructor(){}static getInstance(){return Km.instance||(Km.instance=new Km),Km.instance}review(e){const t=Date.now(),a=[],n=this.checkAllTags(e);for(const e of n){const t=qm.find(t=>t.name===e.tagName),n=t?.displayName||e.tagName;t?.required&&!e.exists?a.push({level:'error',category:'tag',message:`ç¼ºå°‘å¿…éœ€çš„ <${n}> æ ‡ç­¾`,field:e.tagName}):e.exists&&!e.isClosed?a.push({level:'error',category:'tag',message:`<${n}> æ ‡ç­¾æœªæ­£ç¡®é—­åˆï¼ˆå¼€å§‹:${e.openCount}, ç»“æŸ:${e.closeCount}ï¼‰`,field:e.tagName}):e.warning&&a.push({level:'warning',category:'tag',message:e.warning,field:e.tagName})}const o=this.extractTagContent(e,'gametxt'),l=this.extractTagContent(e,'å†å²è®°å½•'),s=this.extractTagContent(e,'thinking');let r=null;const c=n.find(e=>'UpdateVariable'===e.tagName);if(c?.exists&&c.content){r=this.parseVariableCommands(c.content);for(const e of r.errors)a.push({level:'error',category:'variable',message:e,field:'UpdateVariable'});for(const e of r.warnings)a.push({level:'warning',category:'variable',message:e,field:'UpdateVariable'})}o&&o.length<10&&a.push({level:'warning',category:'format',message:'æ¸¸æˆæ–‡æœ¬å†…å®¹è¿‡çŸ­ï¼Œå¯èƒ½ä¸å®Œæ•´',field:'gametxt'});return{passed:!a.some(e=>'error'===e.level),originalText:e,tagChecks:n,variableCheck:r,gameTextContent:o,historyContent:l,thinkingContent:s,issues:a,timestamp:t}}checkAllTags(e){return qm.map(t=>this.checkTag(e,t.name))}checkTag(e,t){const a=new RegExp(`<${this.escapeRegex(t)}>`,'gi'),n=new RegExp(`</${this.escapeRegex(t)}>`,'gi'),o=e.match(a)||[],l=e.match(n)||[],s=o.length,r=l.length,c=s>0,i=s===r&&s>0;let u,d;return c&&(u=this.extractTagContent(e,t),s>1&&(d=`å­˜åœ¨å¤šä¸ª <${t}> æ ‡ç­¾ï¼ˆ${s}ä¸ªï¼‰ï¼Œä½¿ç”¨æœ€åä¸€ä¸ª`)),{tagName:t,exists:c,isClosed:i,openCount:s,closeCount:r,content:u,warning:d}}extractTagContent(e,t){if(!e||'string'!=typeof e)return'';const a=new RegExp(`<${this.escapeRegex(t)}>([\\s\\S]*?)</${this.escapeRegex(t)}>`,'gi'),n=[...e.matchAll(a)];return n.length>0?n[n.length-1][1].trim():''}parseVariableCommands(e){const t=[];if(!e||!e.trim())return{success:!0,rawContent:e,commands:[],errors:[],warnings:['å˜é‡æ›´æ–°å†…å®¹ä¸ºç©º']};const a=this.tryParseAsMvuCommands(e);if(a.commands.length>0)return{success:0===a.errors.length,rawContent:e,commands:a.commands,errors:a.errors,warnings:a.warnings};const n=this.tryParseAsJson(e);if(n.success)return{success:!0,rawContent:e,commands:n.commands,errors:n.errors,warnings:n.warnings};const o=this.tryParseAsLines(e);return o.commands.length>0?{success:0===o.errors.length,rawContent:e,commands:o.commands,errors:o.errors,warnings:o.warnings}:(t.push('æ— æ³•è§£æå˜é‡æ›´æ–°æŒ‡ä»¤æ ¼å¼ï¼Œè¯·æ£€æŸ¥æ˜¯å¦ç¬¦åˆMVUå‘½ä»¤ã€JSONæˆ–è¡Œå‘½ä»¤æ ¼å¼'),{success:!1,rawContent:e,commands:[],errors:t,warnings:[]})}tryParseAsMvuCommands(e){const t=[],a=[],n=e.split('\n');let o,l='',s=0,r=0,c=!1,i='';for(let e=0;e<n.length;e++){const u=n[e].trim();if(!u)continue;if(u.startsWith('//')){o=u.slice(2).trim();continue}l+=(l?'\n':'')+u;for(let e=0;e<u.length;e++){const t=u[e],a=e>0?u[e-1]:'';'"'!==t&&'\''!==t||'\\'===a?c||('{'===t?s++:'}'===t?s--:'['===t?r++:']'===t&&r--):c?t===i&&(c=!1):(c=!0,i=t)}const d=l.trim();if(0===s&&0===r&&(d.endsWith(');')||d.endsWith(')'))){const e=this.parseMvuSingleCommand(l,o);if(e)t.push(e);else if(l.trim()){const e=l.substring(0,50)+(l.length>50?'...':'');a.push(`æ— æ³•è§£æå‘½ä»¤: "${e}"`)}l='',o=void 0,s=0,r=0,c=!1}}if(l.trim()){const e=this.parseMvuSingleCommand(l,o);if(e)t.push(e);else{const e=l.substring(0,50)+(l.length>50?'...':'');a.push(`æ— æ³•è§£æå‘½ä»¤: "${e}"`)}}return{commands:t,errors:[],warnings:a}}parseMvuSingleCommand(e,t){if(!e||'string'!=typeof e)return null;let a=e.trim();a.endsWith(';')&&(a=a.slice(0,-1).trim());const n=this.findLastCommentIndex(a);if(n>-1){const e=a.slice(n+2).trim();!t&&e&&(t=e),a=a.slice(0,n).trim()}if(!a)return null;const o=a.match(/^_\.(set|assign|add|remove)\s*\(\s*([\s\S]*)\s*\)$/i);if(o)return this.parseLodashStyleCommand(o[1].toLowerCase(),o[2],t);const l=a.match(/^(SET|ADD|SUB|MUL|DIV|APPEND|REMOVE|CLEAR|TOGGLE|INIT)\s*\(\s*([\s\S]*)\s*\)$/i);return l?this.parseOldStyleCommand(l[1].toUpperCase(),l[2],t):null}findLastCommentIndex(e){let t=!1,a='',n=-1;for(let o=0;o<e.length-1;o++){const l=e[o],s=e[o+1],r=o>0?e[o-1]:'';'"'!==l&&'\''!==l||'\\'===r?t||'/'!==l||'/'!==s||(n=o):t?l===a&&(t=!1):(t=!0,a=l)}return n}parseLodashStyleCommand(e,t,a){const n=this.parseMvuArguments(t);if(n.length<1)return null;const o='string'==typeof n[0]?n[0]:String(n[0]);switch(e){case'set':{const e=n.length>=3?n[2]:n[1];return{path:o,operation:'set',value:e,comment:a,rawLine:`_.set('${o}', ${JSON.stringify(e)})`}}case'assign':{if(n.length<3)return null;const e='string'==typeof n[1]?n[1]:String(n[1]);return{path:`${o}.${e}`,operation:'set',value:n[2],comment:a,rawLine:`_.assign('${o}', '${e}', ${JSON.stringify(n[2])})`}}case'add':{const e=n.length>=2?n[1]:1;return{path:o,operation:'add',value:'number'==typeof e?e:parseFloat(String(e))||1,comment:a,rawLine:`_.add('${o}', ${e})`}}case'remove':return{path:o,operation:'remove',value:n.length>=2?n[1]:void 0,comment:a,rawLine:`_.remove('${o}'${n.length>=2?', '+JSON.stringify(n[1]):''})`};default:return null}}parseOldStyleCommand(e,t,a){const n=this.parseMvuArguments(t);if(n.length<1)return null;const o='string'==typeof n[0]?n[0]:String(n[0]),l=n.length>=2?n[1]:void 0;let s;switch(e){case'SET':case'INIT':s='set';break;case'ADD':s='add';break;case'SUB':s='subtract';break;case'APPEND':s='append';break;case'REMOVE':case'CLEAR':s='remove';break;default:s='unknown'}return{path:o,operation:s,value:l,comment:a,rawLine:`${e}('${o}'${void 0!==l?', '+JSON.stringify(l):''})`}}parseMvuArguments(e){const t=[];let a='',n=0,o=0,l=!1,s='';const r=e.trim();for(let e=0;e<r.length;e++){const c=r[e],i=e>0?r[e-1]:'';if('"'!==c&&'\''!==c||'\\'===i)if(l)a+=c;else if('{'!==c)if('}'!==c)if('['!==c)if(']'!==c){if(','===c&&0===n&&0===o){const e=a.trim();e&&t.push(this.parseMvuValue(e)),a='';continue}a+=c}else o--,a+=c;else o++,a+=c;else n--,a+=c;else n++,a+=c;else l?c===s&&(l=!1):(l=!0,s=c),a+=c}const c=a.trim();return c&&t.push(this.parseMvuValue(c)),t}parseMvuValue(e){const t=e.trim();if(t){if('null'===t)return null;if('true'===t)return!0;if('false'===t)return!1;if(/^-?\d+(\.\d+)?$/.test(t))return parseFloat(t);if(t.startsWith('\'')&&t.endsWith('\'')||t.startsWith('"')&&t.endsWith('"'))return t.slice(1,-1);if(t.startsWith('{')&&t.endsWith('}')||t.startsWith('[')&&t.endsWith(']'))try{return JSON.parse(t)}catch{try{const e=t.replace(/'/g,'"');return JSON.parse(e)}catch{return t}}return t}}tryParseAsJson(e){const t=[],a=[],n=[];try{let o=e.trim();o=o.split('\n').filter(e=>!e.trim().startsWith('//')&&!e.trim().startsWith('#')).join('\n');const l=JSON.parse(o);return'object'!=typeof l||null===l?{success:!1,commands:[],errors:['JSONè§£æç»“æœä¸æ˜¯å¯¹è±¡'],warnings:[]}:(this.extractJsonCommands(l,'',n),0===n.length&&a.push('JSONæ ¼å¼æ­£ç¡®ä½†æœªæ£€æµ‹åˆ°å˜é‡æ›´æ–°æŒ‡ä»¤'),{success:!0,commands:n,errors:t,warnings:a})}catch(e){return{success:!1,commands:[],errors:[],warnings:[]}}}extractJsonCommands(e,t,a){for(const[n,o]of Object.entries(e)){const e=t?`${t}.${n}`:n;null===o||'object'!=typeof o||Array.isArray(o)?a.push({path:e,operation:'set',value:o,rawLine:`${e} = ${JSON.stringify(o)}`}):'operation'in o||'value'in o||'set'in o||'add'in o?a.push(this.parseJsonCommand(e,o)):this.extractJsonCommands(o,e,a)}}parseJsonCommand(e,t){let a,n,o='set';return'operation'in t?(o=this.normalizeOperation(t.operation),a=t.value??t.newValue,n=t.comment||t.reason):'set'in t?(o='set',a=t.set):'add'in t?(o='add',a=t.add):'subtract'in t||'sub'in t?(o='subtract',a=t.subtract??t.sub):'value'in t?(o='set',a=t.value,n=t.comment||t.reason):(o='unknown',a=t),{path:e,operation:o,value:a,comment:n,rawLine:JSON.stringify({[e]:t})}}normalizeOperation(e){switch(e.toLowerCase().trim()){case'set':case'=':case'assign':return'set';case'add':case'+':case'+=':case'increase':return'add';case'subtract':case'sub':case'-':case'-=':case'decrease':return'subtract';case'append':case'push':return'append';case'remove':case'delete':return'remove';default:return'unknown'}}tryParseAsLines(e){const t=[],a=[],n=e.split('\n').filter(e=>e.trim());for(let e=0;e<n.length;e++){const o=n[e].trim(),l=e+1;if(o.startsWith('//')||o.startsWith('#')||o.startsWith('--'))continue;const s=this.parseLineCommand(o);s?a.push(s):o.length>0&&t.push(`ç¬¬${l}è¡Œæ— æ³•è§£æ: "${o.substring(0,50)}${o.length>50?'...':''}"`)}return{commands:a,errors:[],warnings:t}}parseLineCommand(e){const t=[/^([a-zA-Z\u4e00-\u9fa5_][\w\u4e00-\u9fa5.]*)\s*\+=\s*(.+)$/,/^([a-zA-Z\u4e00-\u9fa5_][\w\u4e00-\u9fa5.]*)\s*-=\s*(.+)$/,/^([a-zA-Z\u4e00-\u9fa5_][\w\u4e00-\u9fa5.]*)\s*=\s*(.+)$/,/^([a-zA-Z\u4e00-\u9fa5_][\w\u4e00-\u9fa5.]*)\s*:\s*(.+)$/],a=['add','subtract','set','set'];for(let n=0;n<t.length;n++){const o=e.match(t[n]);if(o){const t=o[1].trim();let l,s=o[2].trim();const r=s.match(/\/\/\s*(.+)$/);r&&(l=r[1].trim(),s=s.substring(0,r.index).trim());const c=this.parseValue(s);return{path:t,operation:a[n],value:c,comment:l,rawLine:e}}}return null}parseValue(e){if('null'===(e=e.trim()))return null;if('undefined'===e)return;if('true'===e)return!0;if('false'===e)return!1;const t=Number(e);if(!isNaN(t)&&''!==e)return t;if(e.startsWith('"')&&e.endsWith('"')||e.startsWith('\'')&&e.endsWith('\''))return e.slice(1,-1);if(e.startsWith('[')&&e.endsWith(']')||e.startsWith('{')&&e.endsWith('}'))try{return JSON.parse(e)}catch{}return e}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')}quickCheck(e){const t=[];for(const a of qm)if(a.required){const n=this.checkTag(e,a.name);n.exists&&n.isClosed||t.push(a.displayName)}return{passed:0===t.length,missingTags:t}}getSummary(e){const t=[];e.passed?t.push('âœ… æ ¼å¼å®¡æŸ¥é€šè¿‡'):t.push('âŒ æ ¼å¼å®¡æŸ¥æœªé€šè¿‡');const a=e.issues.filter(e=>'error'===e.level).length,n=e.issues.filter(e=>'warning'===e.level).length;return a>0&&t.push(`  - ${a} ä¸ªé”™è¯¯`),n>0&&t.push(`  - ${n} ä¸ªè­¦å‘Š`),e.variableCheck&&t.push(`  - ${e.variableCheck.commands.length} æ¡å˜é‡æ›´æ–°æŒ‡ä»¤`),t.join('\n')}}const Ym=Km.getInstance();function Xm(){const e=(0,l.ref)(''),t=(0,l.ref)(''),a=(0,l.ref)([]),n=(0,l.ref)(0),o=(0,l.ref)(!1),s=(0,l.ref)(!1),r=(0,l.ref)(null),c=(0,l.ref)(''),i=(0,l.ref)([]),u=(0,l.ref)(''),d=(0,l.ref)('idle'),m=(0,l.ref)(null),v=(0,l.ref)(!1),p=(0,l.ref)('standard'),f=(0,l.ref)(!0),g=(0,l.ref)(!1),h=(0,l.ref)(null),y=(0,l.ref)(null),V=(0,l.ref)(null),N=(0,l.ref)(!1),E=(0,l.ref)(null);let b=null,k=null,C=!1;const S=(0,l.computed)(()=>!!e.value),w=(0,l.computed)(()=>a.value.length>1),I=()=>(new Date).toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'}),B=e=>{if(!e||'string'!=typeof e)return'';const t=[...e.matchAll(/<gametxt>([\s\S]*?)<\/gametxt>/gi)];if(t.length>0){return t[t.length-1][1].trim().replace(/<!--[\s\S]*?-->/g,'').trim()}return e},A=e=>{if(!e||'string'!=typeof e)return null;const t=[...e.matchAll(/<UpdateVariable>([\s\S]*?)<\/UpdateVariable>/gi)];return t.length>0?t[t.length-1][1].trim():null},D=(e,t=['gametxt'])=>{const a={isValid:!0,hasGameText:/<gametxt>[\s\S]*?<\/gametxt>/i.test(e),hasUpdateVariable:/<UpdateVariable>[\s\S]*?<\/UpdateVariable>/i.test(e),hasHistoryRecord:/<å†å²è®°å½•>[\s\S]*?<\/å†å²è®°å½•>/i.test(e),missingTags:[]};return t.includes('gametxt')&&!a.hasGameText&&a.missingTags.push('gametxt'),t.includes('UpdateVariable')&&!a.hasUpdateVariable&&a.missingTags.push('UpdateVariable'),t.includes('å†å²è®°å½•')&&!a.hasHistoryRecord&&a.missingTags.push('å†å²è®°å½•'),a.isValid=0===a.missingTags.length,a},M=async(l,r)=>{const i=D(l);i.isValid||(console.warn('[useAIInteraction] AIå“åº”æ ¼å¼ä¸å®Œæ•´:',i.missingTags),'undefined'!=typeof toastr&&toastr.warning(`AIå“åº”ç¼ºå°‘: ${i.missingTags.join(', ')}`,'æ ¼å¼è­¦å‘Š',{timeOut:3e3})),t.value=l,console.log('[useAIInteraction] å·²ä¿å­˜AIå›å¤ç”¨äºä¸‹æ¬¡ä¸Šä¸‹æ–‡æ³¨å…¥');const u=i.hasGameText?B(l):'';if(u){window.__currentSwipeGeneration?(a.value.push(u),n.value=a.value.length-1,e.value=u,delete window.__currentSwipeGeneration,console.log('[useAIInteraction] æ–°swipeå·²æ·»åŠ ')):(e.value=u,a.value=[u],n.value=0,console.log('[useAIInteraction] å†…å®¹å·²æ›´æ–°')),c.value=I()}else i.hasGameText||console.warn('[useAIInteraction] æœªæå–åˆ°æœ‰æ•ˆçš„æ˜¾ç¤ºæ–‡æœ¬ï¼ˆç¼ºå°‘gametxtæ ‡ç­¾ï¼‰');i.hasUpdateVariable&&await P(l),await j(l),await W(l),await U(),o.value=!1,s.value=!1};let x=null;const T=(e,t,a,n)=>{const o=new Set([...Object.keys(e||{}),...Object.keys(t||{})]);for(const l of o){const o=a?`${a}.${l}`:l,s=e?.[l],r=t?.[l];if(void 0===s&&void 0===r)continue;if(void 0===s&&void 0!==r){n.push({path:o,oldValue:void 0,newValue:r,comment:'æ–°å¢'});continue}if(void 0!==s&&void 0===r)continue;const c=typeof s;if(c===typeof r)if('object'===c&&null!==s&&null!==r){if(Array.isArray(s)||Array.isArray(r)){JSON.stringify(s)!==JSON.stringify(r)&&n.push({path:o,oldValue:s,newValue:r,comment:'æ•°ç»„å˜åŒ–'});continue}T(s,r,o,n)}else s!==r&&n.push({path:o,oldValue:s,newValue:r});else n.push({path:o,oldValue:s,newValue:r,comment:'ç±»å‹å˜åŒ–'})}},R=e=>{const t=[],a=e.deltaData;if(a&&'object'==typeof a&&Object.keys(a).length>0&&(console.log('[useAIInteraction] ä» delta_data æå–å˜é‡å˜åŒ–:',Object.keys(a)),console.log('[useAIInteraction] delta_data å†…å®¹:',JSON.stringify(a).substring(0,500)),O(a,'',t),t.length>0))return t;const n=e.displayData;return n&&'object'==typeof n&&Object.keys(n).length>0&&(console.log('[useAIInteraction] ä» display_data æå–å˜é‡å˜åŒ–:',Object.keys(n)),console.log('[useAIInteraction] display_data å†…å®¹:',JSON.stringify(n).substring(0,500)),L(n,'',t,e),t.length>0)?t:(console.log('[useAIInteraction] delta_data å’Œ display_data éƒ½æ²¡æœ‰å˜åŒ–ï¼Œå°è¯•å¿«ç…§å¯¹æ¯”...'),(e=>{const t=[];if(!x)return console.log('[useAIInteraction] æ²¡æœ‰æ›´æ–°å‰å¿«ç…§ï¼Œæ— æ³•å¯¹æ¯”æ£€æµ‹å˜åŒ–'),t;const a=e.statData;return a&&'object'==typeof a?(T(x,a,'',t),console.log('[useAIInteraction] é€šè¿‡å¯¹æ¯”æ£€æµ‹åˆ°',t.length,'ä¸ªå˜é‡å˜åŒ–'),t):(console.log('[useAIInteraction] å½“å‰æ•°æ®ä¸ºç©ºï¼Œæ— æ³•å¯¹æ¯”æ£€æµ‹å˜åŒ–'),t)})(e))},O=(e,t,a)=>{for(const n of Object.keys(e)){const o=e[n],l=t?`${t}.${n}`:n;if(o&&'object'==typeof o&&'new'in o)a.push({path:l,oldValue:o.old,newValue:o.new,comment:o.reason||o.comment});else if(o&&'object'==typeof o&&'newValue'in o)a.push({path:l,oldValue:o.oldValue,newValue:o.newValue,comment:o.reason||o.comment});else{if(null!=o&&'object'!=typeof o){const e=x?F(x,l):void 0;e!==o&&a.push({path:l,oldValue:e,newValue:o});continue}o&&'object'==typeof o&&!Array.isArray(o)&&O(o,l,a)}}},F=(e,t)=>t.split('.').reduce((e,t)=>e&&'object'==typeof e?e[t]:void 0,e),L=(e,t,a,n)=>{for(const o of Object.keys(e)){const l=e[o],s=t?`${t}.${o}`:o;if('string'==typeof l){const e=n.getVariable(s),t=x?F(x,s):void 0;a.push({path:s,oldValue:t,newValue:e,comment:l})}else l&&'object'==typeof l&&!Array.isArray(l)&&L(l,s,a,n)}},P=async e=>{try{const t=xn();if(i.value=[],!t.isMvuAvailable)return void console.log('[useAIInteraction] MVUä¸å¯ç”¨ï¼Œè·³è¿‡å˜é‡æ›´æ–°');if(!t.mvuData){console.warn('[useAIInteraction] MVUæ•°æ®æœªåŠ è½½ï¼Œå°è¯•åˆå§‹åŒ–...');try{await t.initialize({type:'message',message_id:'latest'}),console.log('[useAIInteraction] MVUåˆå§‹åŒ–æˆåŠŸ')}catch(e){return void console.error('[useAIInteraction] MVUåˆå§‹åŒ–å¤±è´¥:',e)}}if(!A(e))return void console.log('[useAIInteraction] æœªå‘ç°å˜é‡æ›´æ–°æŒ‡ä»¤');console.log('[useAIInteraction] å‘ç°å˜é‡æ›´æ–°æŒ‡ä»¤ï¼Œå¼€å§‹è§£ææ‰§è¡Œ...'),(e=>{try{const t=e.statData;t&&'object'==typeof t?(x=JSON.parse(JSON.stringify(t)),console.log('[useAIInteraction] å·²ä¿å­˜å˜é‡æ›´æ–°å‰å¿«ç…§ï¼Œé¡¶çº§é”®:',Object.keys(x||{}))):x=null}catch(e){console.warn('[useAIInteraction] ä¿å­˜å˜é‡å¿«ç…§å¤±è´¥:',e),x=null}})(t);const a=await t.parseAndExecuteCommands(e);if(a.success){console.log('[useAIInteraction] å˜é‡æ›´æ–°æˆåŠŸï¼Œå…±æ‰§è¡Œ',a.results.length,'æ¡æŒ‡ä»¤'),await t.refresh();if(1===a.results.length&&'MVU_NATIVE'===a.results[0].command?.path){console.log('[useAIInteraction] ä½¿ç”¨ MVU åŸç”Ÿè§£æï¼Œä» MVU æ•°æ®æå–å˜é‡å˜åŒ–...');const e=R(t);i.value=e,console.log('[useAIInteraction] æå–åˆ°',e.length,'ä¸ªå˜é‡å˜åŒ–'),0===e.length&&(console.log('[useAIInteraction] è°ƒè¯•ä¿¡æ¯ - delta_data:',JSON.stringify(t.deltaData).substring(0,300)),console.log('[useAIInteraction] è°ƒè¯•ä¿¡æ¯ - display_data:',JSON.stringify(t.displayData).substring(0,300)),console.log('[useAIInteraction] è°ƒè¯•ä¿¡æ¯ - å¿«ç…§å­˜åœ¨:',!!x))}else a.results.forEach(e=>{e.success&&'MVU_NATIVE'!==e.command?.path&&i.value.push({path:e.command.path,oldValue:e.oldValue,newValue:e.newValue,comment:e.command.comment})});console.log('[useAIInteraction] æœ€ç»ˆå˜é‡å˜åŒ–æ•°:',i.value.length),x=null}else console.warn('[useAIInteraction] å˜é‡æ›´æ–°å¤±è´¥:',a.error),x=null}catch(e){console.error('[useAIInteraction] è§£æå˜é‡æ›´æ–°å¤±è´¥:',e),x=null}},j=async e=>{try{if(await _u.processAIResponse(e)){const e=_u.getStatistics();console.log('[useAIInteraction] ä¸Šä¸‹æ–‡å·²æ›´æ–°:',{å†å²è®°å½•æ•°:e.recordCount,å†å²æ­£æ–‡æ•°:e.textCount,åˆ†æ®µæ­£æ–‡æ•°:e.segmentCount,å°æ€»ç»“æ•°:e.smallSummaryCount,å¤§æ€»ç»“æ•°:e.largeSummaryCount})}}catch(e){console.error('[useAIInteraction] ä¸Šä¸‹æ–‡ç®¡ç†å¤„ç†å¤±è´¥:',e)}},U=async()=>{try{const e=ju.getAutoSaveConfig();if(!e.enabled||!e.saveOnAIResponse)return void console.log('[useAIInteraction] è‡ªåŠ¨å­˜æ¡£æœªå¯ç”¨ï¼Œè·³è¿‡');let t;d.value='saving',console.log('[useAIInteraction] å¼€å§‹æ‰§è¡Œè‡ªåŠ¨å­˜æ¡£...'),'function'==typeof window.getLastMessageId&&(t=window.getLastMessageId());const a=await ju.autoSaveOnAIResponse(t);a?(d.value='success',m.value=a.name,console.log('[useAIInteraction] è‡ªåŠ¨å­˜æ¡£æˆåŠŸ:',a.name),'undefined'!=typeof toastr&&toastr.info(`å·²è‡ªåŠ¨å­˜æ¡£: ${a.name}`,'è‡ªåŠ¨å­˜æ¡£',{timeOut:2e3})):d.value='idle'}catch(e){d.value='error',console.error('[useAIInteraction] è‡ªåŠ¨å­˜æ¡£å¤±è´¥:',e)}},W=async e=>{let t=[],a=!1;try{if(console.log('[useAIInteraction] ä¿å­˜AIå›å¤åˆ°é…’é¦†èŠå¤©è®°å½•ï¼ˆåŒå±‚åŒ–æ¨¡å¼ + é”™è¯¯æ¢å¤ï¼‰'),'function'!=typeof window.TavernHelper?.setChatMessages)return console.warn('[useAIInteraction] TavernHelperä¸å¯ç”¨'),!1;try{const e='function'==typeof window.getLastMessageId?window.getLastMessageId()??-1:-1;e>=0&&(t=await window.TavernHelper.getChatMessages(`0-${e}`),t&&t.length>0&&(t=JSON.parse(JSON.stringify(t)),a=!0,console.log('[useAIInteraction] å·²åˆ›å»ºæ¶ˆæ¯å¿«ç…§ï¼Œå…±',t.length,'æ¡æ¶ˆæ¯')))}catch(e){console.warn('[useAIInteraction] è·å–æ¶ˆæ¯å¿«ç…§å¤±è´¥ï¼Œç»§ç»­æ‰§è¡Œï¼ˆæ— å›æ»šèƒ½åŠ›ï¼‰:',e)}const n=await window.TavernHelper.getChatMessages('0');if(!n||0===n.length)throw new Error('æ¶ˆæ¯0ä¸å­˜åœ¨ï¼Œæ— æ³•ä¿å­˜AIå›å¤');const o=n[0];return o.message=e,await window.TavernHelper.setChatMessages([o],{refresh:'none'}),console.log('[useAIInteraction] AIå›å¤å·²ä¿å­˜åˆ°æ¶ˆæ¯0'),await H(),console.log('[useAIInteraction] åŒå±‚åŒ–ä¿å­˜æˆåŠŸ'),!0}catch(e){if(console.error('[useAIInteraction] ä¿å­˜AIå›å¤å¤±è´¥ï¼Œå°è¯•å›æ»š:',e),a&&t.length>0)try{await window.TavernHelper.setChatMessages(t,{refresh:'none'}),console.log('[useAIInteraction] å›æ»šæˆåŠŸï¼Œå·²æ¢å¤åŸå§‹æ¶ˆæ¯'),'undefined'!=typeof toastr&&toastr.warning('ä¿å­˜å¤±è´¥ï¼Œå·²å›æ»šåˆ°åŸå§‹çŠ¶æ€','åŒå±‚åŒ–é”™è¯¯',{timeOut:3e3})}catch(e){console.error('[useAIInteraction] å›æ»šå¤±è´¥:',e),'undefined'!=typeof toastr&&toastr.error('ä¿å­˜å¤±è´¥ä¸”æ— æ³•å›æ»šï¼Œæ¶ˆæ¯å¯èƒ½å·²æŸå','ä¸¥é‡é”™è¯¯',{timeOut:5e3})}return!1}},H=async()=>{let e=0;for(;e<3;)try{if('function'!=typeof window.getLastMessageId)return!0;const e=window.getLastMessageId?.()??-1;if(e<=0)return console.log('[useAIInteraction] æ— éœ€æ¸…ç†å¤šä½™æ¶ˆæ¯ï¼Œå½“å‰åªæœ‰æ¶ˆæ¯0'),!0;if('function'==typeof window.deleteChatMessages){const t=Array.from({length:e},(_,e)=>e+1);return console.log('[useAIInteraction] åˆ é™¤å¤šä½™æ¶ˆæ¯:',t),await window.deleteChatMessages(t,{refresh:'none'}),console.log('[useAIInteraction] å¤šä½™æ¶ˆæ¯å·²åˆ é™¤ï¼Œä¿æŒåŒå±‚åŒ–'),!0}return!0}catch(t){if(e++,console.warn(`[useAIInteraction] æ¸…ç†å¤šä½™æ¶ˆæ¯å¤±è´¥ (å°è¯• ${e}/3):`,t),e>=3)return console.error('[useAIInteraction] æ¸…ç†å¤šä½™æ¶ˆæ¯æœ€ç»ˆå¤±è´¥ï¼Œæ¶ˆæ¯å±‚çº§å¯èƒ½æ··ä¹±'),'undefined'!=typeof toastr&&toastr.warning('æ¶ˆæ¯æ¸…ç†å¤±è´¥ï¼Œå±‚çº§å¯èƒ½æ··ä¹±','åŒå±‚åŒ–è­¦å‘Š',{timeOut:3e3}),!1;await new Promise(t=>setTimeout(t,100*e))}return!1},G=async()=>{try{if('function'!=typeof window.TavernHelper?.getChatMessages)return!1;const e=await window.TavernHelper.getChatMessages();if(e&&e.length>0)for(let t=0;t<e.length;t++)if(!e[t].is_user)return e.splice(t,1),await window.TavernHelper.setChatMessages(e,{refresh:'none'}),!0;return!1}catch(e){return console.error('[useAIInteraction] åˆ é™¤é…’é¦†æ¶ˆæ¯å¤±è´¥:',e),!1}},J=async()=>{try{if('function'!=typeof window.getChatMessages)return console.warn('[useAIInteraction] getChatMessageså‡½æ•°ä¸å¯ç”¨'),!1;const o=window.getLastMessageId?.()??-1;if(o<0)return console.log('[useAIInteraction] é…’é¦†èŠå¤©è®°å½•ä¸ºç©º'),!1;const l=await window.getChatMessages(`0-${o}`,{role:'all',hide_state:'unhidden',include_swipes:!0});for(let o=l.length-1;o>=0;o--){const s=l[o];if('user'!==s.role){const o=s.swipes?.[s.swipe_id||0]||s.message||'',l=B(o);if(l)return e.value=l,a.value=s.swipes?s.swipes.map(e=>B(e)):[l],n.value=s.swipe_id||0,c.value=I(),t.value=o,console.log('[useAIInteraction] å·²åŠ è½½æœ€æ–°å†…å®¹ï¼Œå¹¶æ¢å¤lastAIResponseï¼Œé•¿åº¦:',o.length),!0}}return!1}catch(e){return console.error('[useAIInteraction] ä»é…’é¦†åŠ è½½å†…å®¹å¤±è´¥:',e),!1}},q=e=>{const a=xn();let n,o={};try{if('undefined'!=typeof window&&window.Mvu){const e=window.Mvu;if('function'==typeof e.getMvuData){const t=e.getMvuData({type:'message',message_id:'latest'});t&&t.stat_data?(o=t.stat_data,console.log('[useAIInteraction] ä» MVU API è·å–åˆ°å˜é‡æ•°æ®ï¼Œé”®æ•°é‡:',Object.keys(o).length)):console.warn('[useAIInteraction] MVU API è¿”å›æ•°æ®ä¸ºç©º')}}0===Object.keys(o).length&&(a.mvuData?.stat_data?(o=a.mvuData.stat_data,console.log('[useAIInteraction] ä» store ç¼“å­˜è·å–å˜é‡æ•°æ®ï¼Œé”®æ•°é‡:',Object.keys(o).length)):console.warn('[useAIInteraction] store ç¼“å­˜ä¸­ä¹Ÿæ²¡æœ‰å˜é‡æ•°æ®')),0===Object.keys(o).length&&a.isMvuAvailable&&(console.log('[useAIInteraction] å°è¯•å¼ºåˆ¶åˆ·æ–° store...'),a.refresh().catch(e=>{console.error('[useAIInteraction] åˆ·æ–° store å¤±è´¥:',e)}),a.mvuData?.stat_data&&(o=a.mvuData.stat_data))}catch(e){console.error('[useAIInteraction] è·å– MVU æ•°æ®å¤±è´¥:',e)}try{n=JSON.stringify(o,null,2)}catch(e){console.error('[useAIInteraction] åºåˆ—åŒ–å˜é‡æ•°æ®å¤±è´¥:',e),n='{}'}let l='';l+=`<status_current_variables>\n${n}\n</status_current_variables>\n\n`,t.value&&(l+=`<last_ai_response>\n${t.value}\n</last_ai_response>\n\n`,console.log('[useAIInteraction] å·²æ³¨å…¥ä¸Šä¸€æ¬¡AIå›å¤ï¼Œé•¿åº¦:',t.value.length)),l+=e;const s=Object.keys(o);return console.log('[useAIInteraction] å·²æ„å»ºåŒ…å«å˜é‡æ•°æ®å’Œä¸Šä¸‹æ–‡çš„prompt:',{å˜é‡æ•°æ®å¤§å°:n.length+'å­—ç¬¦',é¡¶çº§é”®:s,MCé”®:o.MC?Object.keys(o.MC):'æ— MCå¯¹è±¡',ç”¨æˆ·è¾“å…¥é•¿åº¦:e.length+'å­—ç¬¦',ä¸Šä¸€æ¬¡AIå›å¤é•¿åº¦:t.value?t.value.length+'å­—ç¬¦':'æ— '}),l},K=()=>{try{return C?(console.log('[useAIInteraction] ç›‘å¬å™¨å·²å­˜åœ¨ï¼Œè·³è¿‡é‡å¤ç»‘å®š'),!0):(console.log('[useAIInteraction] è®¾ç½®AIäº‹ä»¶ç›‘å¬å™¨'),'function'!=typeof window.eventOn?(console.warn('[useAIInteraction] eventOnå‡½æ•°ä¸å¯ç”¨'),!1):(Y(),b=(t,a)=>(t=>{if(!t)return;console.log('[useAIInteraction] æ”¶åˆ°æµå¼æ–‡æœ¬ï¼Œé•¿åº¦:',t.length);const a=B(t);a&&(s.value=!0,o.value=!1,e.value=a)})(t),k=(l,c)=>(async(l,c)=>{if(!l)return console.warn('[useAIInteraction] æ”¶åˆ°ç©ºçš„AIå›å¤'),o.value=!1,void(s.value=!1);console.log('[useAIInteraction] AIç”Ÿæˆç»“æŸï¼ŒID:',c),console.log('[useAIInteraction] AIå›å¤é•¿åº¦:',l.length);try{if(r.value=null,f.value){console.log('[useAIInteraction] å®¡æŸ¥æ¨¡å¼å¯ç”¨ï¼Œå¼€å§‹å®¡æŸ¥AIå›å¤...'),E.value={currentContent:e.value,swipes:[...a.value],currentSwipeIndex:n.value,lastAIResponse:t.value},console.log('[useAIInteraction] å·²ä¿å­˜å®¡æŸ¥å‰å†…å®¹å¿«ç…§ï¼Œå†…å®¹é•¿åº¦:',e.value.length);const o=Ym.review(l);h.value=o,y.value=l,V.value=c;const r=B(l);return r&&(e.value=r),g.value=!0,s.value=!1,void console.log('[useAIInteraction] å®¡æŸ¥ç»“æœ:',{passed:o.passed,issueCount:o.issues.length,variableCommands:o.variableCheck?.commands?.length||0})}await M(l,c)}catch(e){console.error('[useAIInteraction] å¤„ç†AIå›å¤å¤±è´¥:',e),r.value=e instanceof Error?e.message:'å¤„ç†AIå›å¤å¤±è´¥',o.value=!1,s.value=!1}})(l,c),void 0!==window.iframe_events?(window.eventOn(window.iframe_events.STREAM_TOKEN_RECEIVED_FULLY,b),window.eventOn(window.iframe_events.GENERATION_ENDED,k)):(window.eventOn('js_stream_token_received_fully',b),window.eventOn('js_generation_ended',k)),C=!0,console.log('[useAIInteraction] ç›‘å¬å™¨è®¾ç½®æˆåŠŸ'),!0))}catch(e){return console.error('[useAIInteraction] è®¾ç½®AIç›‘å¬å™¨å¤±è´¥:',e),!1}},Y=()=>{try{if(!C&&!b&&!k)return;console.log('[useAIInteraction] æ¸…ç†AIäº‹ä»¶ç›‘å¬å™¨'),'function'==typeof window.eventRemoveListener&&(b&&(void 0!==window.iframe_events?window.eventRemoveListener(window.iframe_events.STREAM_TOKEN_RECEIVED_FULLY,b):window.eventRemoveListener('js_stream_token_received_fully',b)),k&&(void 0!==window.iframe_events?window.eventRemoveListener(window.iframe_events.GENERATION_ENDED,k):window.eventRemoveListener('js_generation_ended',k))),b=null,k=null,C=!1}catch(e){console.error('[useAIInteraction] æ¸…ç†AIç›‘å¬å™¨å¤±è´¥:',e)}},X=()=>e.value||0!==a.value.length||t.value?{currentContent:e.value,swipes:[...a.value],currentSwipeIndex:n.value,lastUserInput:u.value,lastUpdateTime:c.value,lastAIResponse:t.value}:null,Z=o=>{console.log('[useAIInteraction] æ¢å¤AIå†…å®¹æ•°æ®'),e.value=o.currentContent||'',a.value=o.swipes||[],n.value=o.currentSwipeIndex||0,u.value=o.lastUserInput||'',c.value=o.lastUpdateTime||'',t.value=o.lastAIResponse||'',console.log('[useAIInteraction] AIå†…å®¹å·²æ¢å¤:',{contentLength:e.value.length,swipesCount:a.value.length,currentIndex:n.value,lastAIResponseLength:t.value.length})};(0,l.onMounted)(async()=>{console.log('[useAIInteraction] Composableå·²æŒ‚è½½'),K(),ju.setAIContentDataProvider(X),ju.setAIContentDataRestorer(Z),await _u.initialize(),await Q(),await J()});const Q=async(e=3e3,t=100)=>{const a=xn(),n=Date.now();for(;Date.now()-n<e;){if(a.isMvuAvailable&&a.mvuData?.stat_data)return void console.log('[useAIInteraction] MVU Store å·²å°±ç»ª');if(a.isLoading)await new Promise(e=>setTimeout(e,t));else{if(!a.isLoading&&!a.mvuData){console.log('[useAIInteraction] è§¦å‘ MVU Store åˆå§‹åŒ–...');try{await a.initialize()}catch(e){console.warn('[useAIInteraction] MVU Store åˆå§‹åŒ–å¤±è´¥:',e)}}await new Promise(e=>setTimeout(e,t))}}console.warn('[useAIInteraction] ç­‰å¾… MVU Store è¶…æ—¶ï¼Œç»§ç»­æ‰§è¡Œ')};return(0,l.onUnmounted)(()=>{console.log('[useAIInteraction] Composableæ­£åœ¨å¸è½½'),Y()}),{currentContent:e,swipes:a,currentSwipeIndex:n,isProcessing:o,isStreaming:s,error:r,lastUpdateTime:c,variableChanges:i,lastAIResponse:t,hasContent:S,hasMultipleSwipes:w,sendMessageToAI:async t=>{if(!t.trim())return r.value='æ¶ˆæ¯ä¸èƒ½ä¸ºç©º',!1;try{if(console.log('[useAIInteraction] å‘é€æ¶ˆæ¯ç»™AIï¼ˆåŒå±‚åŒ–æ¨¡å¼ + ä¸»åŠ¨å˜é‡æ³¨å…¥ï¼‰:',t),u.value=t.trim(),e.value='',a.value=[],n.value=0,i.value=[],'function'!=typeof window.generate)throw new Error('generateå‡½æ•°ä¸å¯ç”¨ï¼Œè¯·ç¡®ä¿åœ¨é…’é¦†ç¯å¢ƒä¸­è¿è¡Œ');o.value=!0,r.value=null;const l=q(t.trim()),s=Tn().streamingEnabled;return console.log('[useAIInteraction] æµå¼ä¼ è¾“æ¨¡å¼:',s?'å¼€å¯':'å…³é—­'),await window.generate({user_input:l,should_stream:s,max_chat_history:0}),!0}catch(e){return console.error('[useAIInteraction] å‘é€æ¶ˆæ¯å¤±è´¥:',e),r.value=e instanceof Error?e.message:'å‘é€æ¶ˆæ¯å¤±è´¥',o.value=!1,!1}},regenerateAIResponse:async()=>{try{if(console.log('[useAIInteraction] é‡æ–°ç”ŸæˆAIå›å¤ï¼ˆä¸»åŠ¨å˜é‡æ³¨å…¥ï¼‰'),!u.value)return console.warn('[useAIInteraction] æ²¡æœ‰å¯é‡æ–°ç”Ÿæˆçš„ç”¨æˆ·è¾“å…¥'),!1;if('function'!=typeof window.generate)throw new Error('generateå‡½æ•°ä¸å¯ç”¨');await G(),e.value='',a.value=[],n.value=0,i.value=[],o.value=!0,r.value=null;const t=q(u.value),l=Tn().streamingEnabled;return await window.generate({user_input:t,should_stream:l,max_chat_history:0}),!0}catch(e){return console.error('[useAIInteraction] é‡æ–°ç”Ÿæˆå¤±è´¥:',e),r.value=e instanceof Error?e.message:'é‡æ–°ç”Ÿæˆå¤±è´¥',o.value=!1,!1}},generateSwipe:async()=>{try{if(console.log('[useAIInteraction] ç”Ÿæˆæ›´å¤šå›å¤ï¼ˆä¸»åŠ¨å˜é‡æ³¨å…¥ï¼‰'),!u.value)return console.warn('[useAIInteraction] æ²¡æœ‰å¯ç”Ÿæˆswipeçš„ç”¨æˆ·è¾“å…¥'),!1;if('function'!=typeof window.generate)throw new Error('generateå‡½æ•°ä¸å¯ç”¨');await G(),window.__currentSwipeGeneration=!0,o.value=!0,r.value=null;const e=q(u.value),t=Tn().streamingEnabled;return await window.generate({user_input:e,should_stream:t,max_chat_history:0}),!0}catch(e){return console.error('[useAIInteraction] ç”Ÿæˆswipeå¤±è´¥:',e),r.value=e instanceof Error?e.message:'ç”Ÿæˆswipeå¤±è´¥',o.value=!1,delete window.__currentSwipeGeneration,!1}},switchSwipe:t=>{if(a.value.length<=1)return;let o=n.value;o='prev'===t?o>0?o-1:a.value.length-1:o<a.value.length-1?o+1:0,n.value=o,e.value=a.value[o]},clearContent:async()=>{if(e.value='',a.value=[],n.value=0,i.value=[],u.value='',t.value='',r.value=null,c.value='','function'==typeof window.deleteChatMessages)try{const e=window.getLastMessageId?.()??-1;if(e>=0){const t=Array.from({length:e+1},(_,e)=>e);await window.deleteChatMessages(t,{refresh:'none'})}}catch(e){console.error('[useAIInteraction] æ¸…é™¤é…’é¦†èŠå¤©è®°å½•å¤±è´¥:',e)}},loadLatestFromTavern:J,setupAIListeners:K,cleanupAIListeners:Y,extractGameText:B,extractUpdateVariableContent:A,buildPromptWithVariables:q,validateResponseFormat:D,contextManagerService:_u,autoSaveStatus:d,lastAutoSaveName:m,performAutoSave:U,triggerManualAutoSave:async()=>{try{let e;d.value='saving','function'==typeof window.getLastMessageId&&(e=window.getLastMessageId());const t=await ju.createAutoSave(`[æ‰‹åŠ¨è§¦å‘] ${(new Date).toLocaleTimeString('zh-CN')}`,'auto',e);return t?(d.value='success',m.value=t.name,!0):(d.value='error',!1)}catch(e){return d.value='error',console.error('[useAIInteraction] æ‰‹åŠ¨è§¦å‘è‡ªåŠ¨å­˜æ¡£å¤±è´¥:',e),!1}},getAIContentData:X,restoreAIContentData:Z,reviewModeEnabled:f,showReviewDialog:g,currentReviewResult:h,isReviewProcessing:N,confirmReview:async()=>{if(y.value){console.log('[useAIInteraction] ç”¨æˆ·ç¡®è®¤å®¡æŸ¥ï¼Œç»§ç»­å¤„ç†AIå›å¤'),N.value=!0;try{g.value=!1,await M(y.value,V.value||''),y.value=null,V.value=null,h.value=null,E.value=null,console.log('[useAIInteraction] å®¡æŸ¥ç¡®è®¤å¤„ç†å®Œæˆ')}catch(e){console.error('[useAIInteraction] å®¡æŸ¥ç¡®è®¤å¤„ç†å¤±è´¥:',e),r.value=e instanceof Error?e.message:'å¤„ç†å¤±è´¥'}finally{N.value=!1}}else console.warn('[useAIInteraction] æ²¡æœ‰å¾…å¤„ç†çš„AIå›å¤')},rollbackReview:async()=>{console.log('[useAIInteraction] ç”¨æˆ·å›é€€å®¡æŸ¥ï¼Œå–æ¶ˆæœ¬æ¬¡AIå›å¤'),N.value=!0;try{if(g.value=!1,E.value)console.log('[useAIInteraction] æ¢å¤å®¡æŸ¥å‰çš„å†…å®¹å¿«ç…§'),e.value=E.value.currentContent,a.value=[...E.value.swipes],n.value=E.value.currentSwipeIndex,t.value=E.value.lastAIResponse,console.log('[useAIInteraction] å·²æ¢å¤å†…å®¹ï¼Œé•¿åº¦:',e.value.length);else{console.warn('[useAIInteraction] æ²¡æœ‰å®¡æŸ¥å‰å¿«ç…§ï¼Œå°è¯•ä»é…’é¦†æ¢å¤...');if(!await J()&&t.value){const o=B(t.value);o&&(e.value=o,a.value=[o],n.value=0,console.log('[useAIInteraction] å·²ä» lastAIResponse æ¢å¤å†…å®¹'))}}y.value=null,V.value=null,h.value=null,E.value=null,await H(),'undefined'!=typeof toastr&&toastr.info('å·²å›é€€æœ¬æ¬¡AIå›å¤ï¼Œä¿ç•™ä¸Šä¸€æ¬¡å†…å®¹','å®¡æŸ¥å›é€€',{timeOut:2e3}),console.log('[useAIInteraction] å®¡æŸ¥å›é€€å®Œæˆï¼Œå·²ä¿ç•™ä¸Šä¸€æ¬¡å†…å®¹')}catch(e){console.error('[useAIInteraction] å®¡æŸ¥å›é€€å¤±è´¥:',e)}finally{N.value=!1,o.value=!1,s.value=!1}},toggleReviewMode:()=>(f.value=!f.value,console.log('[useAIInteraction] å®¡æŸ¥æ¨¡å¼:',f.value?'å¯ç”¨':'ç¦ç”¨'),'undefined'!=typeof toastr&&toastr.info(f.value?'å®¡æŸ¥æ¨¡å¼å·²å¯ç”¨':'å®¡æŸ¥æ¨¡å¼å·²ç¦ç”¨','è®¾ç½®',{timeOut:2e3}),f.value),setReviewMode:e=>{f.value=e,console.log('[useAIInteraction] å®¡æŸ¥æ¨¡å¼è®¾ç½®ä¸º:',e?'å¯ç”¨':'ç¦ç”¨')},aiResponseReviewService:Ym,isMvuInterceptorEnabled:v,currentFilterPreset:p,initializeMvuInterceptor:()=>(console.log('[useAIInteraction] MVUæ‹¦æˆªå™¨å·²ç¦ç”¨ï¼Œè·³è¿‡åˆå§‹åŒ–'),!1),toggleMvuInterceptor:()=>(console.log('[useAIInteraction] MVUæ‹¦æˆªå™¨å·²ç¦ç”¨'),!1),enableMvuInterceptor:()=>{console.log('[useAIInteraction] MVUæ‹¦æˆªå™¨å·²ç¦ç”¨')},disableMvuInterceptor:()=>{console.log('[useAIInteraction] MVUæ‹¦æˆªå™¨å·²ç¦ç”¨')},setFilterPreset:e=>{console.log('[useAIInteraction] MVUæ‹¦æˆªå™¨å·²ç¦ç”¨ï¼Œæ— æ³•è®¾ç½®é¢„è®¾:',e)},getMvuInterceptorStats:()=>null,getAverageCompressionRatio:()=>0,mvuInterceptorService:null}}const Zm={class:'main-area'},Qm={class:'modal help-modal'},ev={class:'modal-header'},tv={class:'modal-footer'},av={class:'modal save-manager-modal'},nv={class:'modal context-manager-modal'},ov={class:'modal history-text-modal'},lv={class:'modal roster-modal'},sv={class:'modal document-modal'},rv={class:'modal form-modal'},cv={class:'modal changelog-modal'},iv={class:'modal variable-manager-modal'},uv=(0,l.defineComponent)({__name:'GameLayout',setup(e){const{currentContent:t,isProcessing:a,isStreaming:n,error:o,lastUpdateTime:s,variableChanges:r,sendMessageToAI:c,reviewModeEnabled:i,showReviewDialog:u,currentReviewResult:d,isReviewProcessing:m,confirmReview:v,rollbackReview:p,toggleReviewMode:f}=Xm(),{quickSave:g,quickLoad:h}=Uu(),{statData:y,isMvuAvailable:V,getVariable:N,refresh:E,updateVersion:b,onUpdate:k,forceRefresh:C}=function(e){const t=xn(),a=(0,l.ref)(0),n=(0,l.ref)('pending'),o=(0,l.ref)(null);let s=null,r=null,c=0;const i=async()=>{try{return n.value='initializing',o.value=null,await t.initialize(e),t.isMvuAvailable&&t.mvuData?(n.value='success',console.log('[useMVU] MVUåˆå§‹åŒ–æˆåŠŸ'),!0):t.isMvuAvailable?t.mvuData?(n.value='success',!0):(n.value='failed',o.value='MVUæ•°æ®ä¸ºç©º',console.warn('[useMVU] MVUæ•°æ®ä¸ºç©º'),!1):(n.value='failed',o.value='MVUæ¡†æ¶ä¸å¯ç”¨',console.warn('[useMVU] MVUæ¡†æ¶ä¸å¯ç”¨'),!1)}catch(e){return n.value='failed',o.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥',console.error('[useMVU] MVUåˆå§‹åŒ–å¤±è´¥:',e),!1}},u=()=>{if(c>=3)return console.warn('[useMVU] å·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œåœæ­¢é‡è¯•'),void(n.value='failed');c++,n.value='retrying';const e=1e3*c;console.log(`[useMVU] å°†åœ¨ ${e}ms åè¿›è¡Œç¬¬ ${c} æ¬¡é‡è¯•...`),r=setTimeout(async()=>{!await i()&&c<3&&u()},e)};return(0,l.onMounted)(async()=>{console.log('[useMVU] onMounted, isMvuAvailable:',t.isMvuAvailable),t.isMvuAvailable&&t.mvuData?(console.log('[useMVU] Storeå·²åˆå§‹åŒ–ï¼Œè·³è¿‡åˆå§‹åŒ–'),n.value='success'):await i()||u(),s=t.onUpdateEnd(()=>{console.log('[useMVU] æ”¶åˆ°å˜é‡æ›´æ–°ç»“æŸäº‹ä»¶ï¼Œè§¦å‘åˆ·æ–°'),a.value++,'failed'!==n.value&&'retrying'!==n.value||(n.value='success',o.value=null,console.log('[useMVU] MVUå·²å°±ç»ªï¼ˆé€šè¿‡æ›´æ–°äº‹ä»¶ç¡®è®¤ï¼‰'))})}),(0,l.onUnmounted)(()=>{s&&(s(),s=null),r&&(clearTimeout(r),r=null)}),{mvuData:(0,l.computed)(()=>(a.value,t.mvuData)),statData:(0,l.computed)(()=>(a.value,t.statData)),displayData:(0,l.computed)(()=>(a.value,t.displayData)),deltaData:(0,l.computed)(()=>(a.value,t.deltaData)),isLoading:(0,l.computed)(()=>t.isLoading),error:(0,l.computed)(()=>t.error),isMvuAvailable:(0,l.computed)(()=>t.isMvuAvailable),updateVersion:a,initState:n,initError:o,refresh:t.refresh,forceRefresh:()=>(a.value++,t.refresh()),getVariable:t.getVariable,setVariable:t.setVariable,setVariables:t.setVariables,updateVariable:t.updateVariable,clearError:t.clearError,onUpdate:e=>t.onUpdateEnd(e),retryInitialize:async()=>(r&&(clearTimeout(r),r=null),c=0,await i())}}(),S=(0,l.computed)(()=>{b.value;return N('MC.ç³»ç»Ÿ.å½“å‰æ—¶é—´.æ—¥æœŸ','')}),w=(0,l.computed)(()=>{b.value;return N('MC.ç³»ç»Ÿ.å½“å‰æ—¶é—´.æ—¶é—´','')}),I=(0,l.computed)(()=>{b.value;return N('MC.ç³»ç»Ÿ.å½“å‰åœ°ç‚¹','')}),A=(0,l.computed)(()=>{b.value;return N('MC.ç©å®¶.å§“å','')}),D=(0,l.computed)(()=>{b.value;return N('MC.ç©å®¶.èŒä½','')}),M=(0,l.computed)(()=>{b.value;return N('MC.ç©å®¶.éƒ¨é—¨','')});(0,l.watch)([y,b],([e,t])=>{e&&console.log('[GameLayout] MVUæ•°æ®æ›´æ–° (v'+t+'):',{æ—¥æœŸ:N('MC.ç³»ç»Ÿ.å½“å‰æ—¶é—´.æ—¥æœŸ',''),æ—¶é—´:N('MC.ç³»ç»Ÿ.å½“å‰æ—¶é—´.æ—¶é—´',''),åœ°ç‚¹:N('MC.ç³»ç»Ÿ.å½“å‰åœ°ç‚¹',''),ç©å®¶å§“å:N('MC.ç©å®¶.å§“å',''),ç©å®¶èŒä½:N('MC.ç©å®¶.èŒä½',''),ç©å®¶éƒ¨é—¨:N('MC.ç©å®¶.éƒ¨é—¨','')})},{deep:!1,immediate:!1});const x=(0,l.ref)(!1),T=(0,l.ref)(!1),R=(0,l.ref)(!1),O=(0,l.ref)('connected'),F=(0,l.ref)(!1),L=(0,l.ref)('workplace'),P=(0,l.ref)(!1),j=(0,l.ref)(!1),U=(0,l.ref)(!1),W=(0,l.ref)(!1),H=(0,l.ref)(!1),G=(0,l.ref)(!1),J=(0,l.ref)(!1),q=(0,l.ref)(!1),K=(0,l.ref)(!1),Y=(0,l.ref)(!1),X=(0,l.ref)(!1),Z=()=>{document.fullscreenElement?(document.exitFullscreen?.(),x.value=!1):(document.documentElement.requestFullscreen?.(),x.value=!0)},Q=()=>{x.value=!!document.fullscreenElement},ee=e=>{'handbook'!==e?'personnel'!==e?'forms'!==e?(L.value=e,console.log('[GameLayout] åˆ‡æ¢åˆ°è§†å›¾:',e)):q.value=!0:G.value=!0:J.value=!0},te=async e=>{console.log('[GameLayout] å‘é€æ¶ˆæ¯ç»™AI:',e);try{await c(e)}catch(e){console.error('[GameLayout] AIäº¤äº’é”™è¯¯:',e),'undefined'!=typeof toastr&&toastr.error('å‘é€æ¶ˆæ¯å¤±è´¥ï¼Œè¯·é‡è¯•')}},ae=()=>{console.log('[GameLayout] æ¸…é™¤AIé”™è¯¯')},ne=async e=>{console.log('[GameLayout] æ”¶åˆ°å¼€å§‹æ¸¸æˆè¯·æ±‚ï¼Œæç¤ºè¯é•¿åº¦:',e.length);try{await c(e),'undefined'!=typeof toastr&&toastr.success('æ¸¸æˆå¼€å§‹ï¼Œæ­£åœ¨ç”Ÿæˆå¼€å±€åœºæ™¯...','å¼€å§‹æ¸¸æˆ',{timeOut:3e3})}catch(e){console.error('[GameLayout] å¼€å§‹æ¸¸æˆå¤±è´¥:',e),'undefined'!=typeof toastr&&toastr.error('å¼€å§‹æ¸¸æˆå¤±è´¥ï¼Œè¯·é‡è¯•','é”™è¯¯',{timeOut:3e3})}},oe=()=>{X.value=!X.value,X.value?document.documentElement.classList.add('dark-theme'):document.documentElement.classList.remove('dark-theme'),console.log('[GameLayout] ä¸»é¢˜åˆ‡æ¢:',X.value?'æ·±è‰²':'æµ…è‰²')},le=e=>{console.log('[GameLayout] å­˜æ¡£å·²åŠ è½½:',e),U.value=!1,'undefined'!=typeof toastr&&toastr.success('å­˜æ¡£å·²åŠ è½½')},se=e=>{console.log('[GameLayout] å­˜æ¡£å·²åˆ›å»º:',e),'undefined'!=typeof toastr&&toastr.success('å­˜æ¡£å·²åˆ›å»º')},re=(e,t)=>{console.log('[GameLayout] å˜é‡å·²æ›´æ–°:',e,t),C(),'undefined'!=typeof toastr&&toastr.success(`å˜é‡ ${e} å·²æ›´æ–°`)},ce=async()=>{console.log('[GameLayout] ç”¨æˆ·ç¡®è®¤AIå“åº”å®¡æŸ¥');try{await v(),C()}catch(e){console.error('[GameLayout] å®¡æŸ¥ç¡®è®¤å¤„ç†å¤±è´¥:',e)}},ie=async()=>{console.log('[GameLayout] ç”¨æˆ·å›é€€AIå“åº”');try{await p()}catch(e){console.error('[GameLayout] å®¡æŸ¥å›é€€å¤„ç†å¤±è´¥:',e)}},ue=()=>{R.value=window.innerWidth<=768,R.value||(T.value=!1)},de=()=>{ue()};return(0,l.onMounted)(()=>{console.log('[GameLayout] MCliteå¸ƒå±€å·²åŠ è½½'),document.addEventListener('fullscreenchange',Q),window.addEventListener('resize',de),ue(),console.log('[GameLayout] MVUå¯ç”¨çŠ¶æ€:',V.value)}),(0,l.onUnmounted)(()=>{document.removeEventListener('fullscreenchange',Q),window.removeEventListener('resize',de)}),(e,c)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['game-layout',{'is-fullscreen':x.value,'sidebar-open':T.value}])},[(0,l.createCommentVNode)(' é¡¶éƒ¨çŠ¶æ€æ  '),(0,l.createVNode)(B,{'connection-status':O.value,'is-fullscreen':x.value,'is-dark-theme':X.value,'game-date':S.value,'game-period':w.value,'game-location':I.value,'player-name':A.value,'player-position':D.value,'player-department':M.value,onToggleFullscreen:Z,onToggleTheme:oe},null,8,['connection-status','is-fullscreen','is-dark-theme','game-date','game-period','game-location','player-name','player-position','player-department']),(0,l.createCommentVNode)(' ä¸­é—´åŒºåŸŸï¼šä¸»å†…å®¹ + å³ä¾§å¯¼èˆª '),(0,l.createElementVNode)('div',Zm,[(0,l.createCommentVNode)(' ä¸»å†…å®¹åŒºï¼ˆæ¸¸æˆæ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸï¼‰ '),(0,l.createVNode)(Ga,{ref:'mainContentRef','current-content':(0,l.unref)(t),'is-processing':(0,l.unref)(a),'is-streaming':(0,l.unref)(n),'variable-changes':(0,l.unref)(r),'last-update-time':(0,l.unref)(s),onGameStart:ne},null,8,['current-content','is-processing','is-streaming','variable-changes','last-update-time']),(0,l.createCommentVNode)(' å³ä¾§å¯¼èˆªæ  '),(0,l.createVNode)(so,{ref:'sidebarRef','active-menu':L.value,collapsed:F.value,'mobile-visible':T.value,onMenuChange:ee,'onUpdate:collapsed':c[0]||(c[0]=e=>F.value=e),onOpenHelp:c[1]||(c[1]=e=>P.value=!0),onOpenAiFilter:c[2]||(c[2]=e=>j.value=!0),onOpenSaveManager:c[3]||(c[3]=e=>U.value=!0),onOpenContextManager:c[4]||(c[4]=e=>W.value=!0),onOpenHistoryText:c[5]||(c[5]=e=>H.value=!0),onOpenChangelog:c[6]||(c[6]=e=>K.value=!0),onOpenVariableManager:c[7]||(c[7]=e=>Y.value=!0),onCloseMobile:c[8]||(c[8]=e=>T.value=!1)},null,8,['active-menu','collapsed','mobile-visible']),(0,l.createCommentVNode)(' ç§»åŠ¨ç«¯ä¾§è¾¹æ é®ç½© '),T.value&&R.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'sidebar-overlay',onClick:c[9]||(c[9]=e=>T.value=!1)})):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' ç§»åŠ¨ç«¯æµ®åŠ¨èœå•æŒ‰é’® '),R.value&&!T.value?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'mobile-menu-fab',title:'æ‰“å¼€èœå•',onClick:c[10]||(c[10]=e=>T.value=!0)},[...c[30]||(c[30]=[(0,l.createElementVNode)('span',{class:'fab-icon'},'â˜°',-1)])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' åº•éƒ¨è¾“å…¥æ  '),(0,l.createVNode)(An,{ref:'bottomBarRef','is-loading':(0,l.unref)(a),error:(0,l.unref)(o),onSend:te,onClearError:ae},null,8,['is-loading','error']),(0,l.createCommentVNode)(' AIä¸Šä¸‹æ–‡è¿‡æ»¤æµ‹è¯•é¢æ¿ï¼ˆå·²ç¦ç”¨ï¼‰\n    <Teleport to="body">\n      <div v-if="showAIFilterPanel" class="modal-overlay fullscreen-modal" @click.self="showAIFilterPanel = false">\n        <div class="modal ai-filter-modal">\n          <AIContextFilterPanel @close="showAIFilterPanel = false" />\n        </div>\n      </div>\n    </Teleport>\n    '),(0,l.createCommentVNode)(' å¸®åŠ©å¼¹çª— '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[P.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal help-overlay',onClick:c[13]||(c[13]=(0,l.withModifiers)(e=>P.value=!1,['self']))},[(0,l.createElementVNode)('div',Qm,[(0,l.createElementVNode)('div',ev,[c[31]||(c[31]=(0,l.createElementVNode)('h3',null,'â“ å¸®åŠ©è¯´æ˜',-1)),(0,l.createElementVNode)('button',{class:'btn-close',onClick:c[11]||(c[11]=e=>P.value=!1)},'âœ•')]),c[32]||(c[32]=(0,l.createElementVNode)('div',{class:'modal-body'},[(0,l.createElementVNode)('div',{class:'help-section'},[(0,l.createElementVNode)('h4',null,'ğŸ“ å¦‚ä½•å¼€æ–°æ¡£ï¼Ÿ'),(0,l.createElementVNode)('ol',{class:'help-steps'},[(0,l.createElementVNode)('li',null,[(0,l.createTextVNode)('æ‰“å¼€'),(0,l.createElementVNode)('strong',null,'ä¸Šä¸‹æ–‡é¢æ¿'),(0,l.createTextVNode)('ï¼Œç‚¹å‡»"æ¸…ç©ºæ‰€æœ‰"æŒ‰é’®ï¼Œæ¸…ç†ä¸–ç•Œä¹¦å†…å®¹')]),(0,l.createElementVNode)('li',null,[(0,l.createTextVNode)('å¼€å¯'),(0,l.createElementVNode)('strong',null,'æ–°èŠå¤©')]),(0,l.createElementVNode)('li',null,[(0,l.createTextVNode)('æ‰“å¼€'),(0,l.createElementVNode)('strong',null,'å­˜æ¡£ç®¡ç†é¢æ¿'),(0,l.createTextVNode)(' - è®¾ç½® - ä¿®æ”¹'),(0,l.createElementVNode)('strong',null,'[è‡ªåŠ¨å­˜æ¡£]å‰ç¼€')]),(0,l.createElementVNode)('li',null,'æ­£å¸¸æ¸¸ç©å³å¯')])])],-1)),(0,l.createElementVNode)('div',tv,[(0,l.createElementVNode)('button',{class:'btn btn-primary',onClick:c[12]||(c[12]=e=>P.value=!1)},'æˆ‘çŸ¥é“äº†')])])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' å­˜æ¡£ç®¡ç†é¢æ¿ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[U.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal save-manager-overlay',onClick:c[15]||(c[15]=(0,l.withModifiers)(e=>U.value=!1,['self']))},[(0,l.createElementVNode)('div',av,[(0,l.createVNode)(rm,{onClose:c[14]||(c[14]=e=>U.value=!1),onSaveLoaded:le,onSaveCreated:se})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' ä¸Šä¸‹æ–‡ç®¡ç†é¢æ¿ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[W.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal context-manager-overlay',onClick:c[17]||(c[17]=(0,l.withModifiers)(e=>W.value=!1,['self']))},[(0,l.createElementVNode)('div',nv,[(0,l.createVNode)(Jm,{onClose:c[16]||(c[16]=e=>W.value=!1)})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' å†å²æ­£æ–‡é¢æ¿ - æ¨¡æ€æ¡†æ–¹å¼ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[H.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal history-text-overlay',onClick:c[19]||(c[19]=(0,l.withModifiers)(e=>H.value=!1,['self']))},[(0,l.createElementVNode)('div',ov,[(0,l.createVNode)(zc,{onClose:c[18]||(c[18]=e=>H.value=!1)})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' MClite v2 èŠ±åå†Œé¢æ¿ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[G.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal roster-overlay',onClick:c[21]||(c[21]=(0,l.withModifiers)(e=>G.value=!1,['self']))},[(0,l.createElementVNode)('div',lv,[(0,l.createVNode)(dl,{onClose:c[20]||(c[20]=e=>G.value=!1)})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' MClite v2 æ–‡æ¡£é¢æ¿ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[J.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal document-overlay',onClick:c[23]||(c[23]=(0,l.withModifiers)(e=>J.value=!1,['self']))},[(0,l.createElementVNode)('div',sv,[(0,l.createVNode)(Yl,{onClose:c[22]||(c[22]=e=>J.value=!1)})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' MClite v2 è¡¨å•é¢æ¿ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[q.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal form-overlay',onClick:c[25]||(c[25]=(0,l.withModifiers)(e=>q.value=!1,['self']))},[(0,l.createElementVNode)('div',rv,[(0,l.createVNode)(ic,{onClose:c[24]||(c[24]=e=>q.value=!1)})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' æ›´æ–°æ—¥å¿—é¢æ¿ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[K.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal changelog-overlay',onClick:c[27]||(c[27]=(0,l.withModifiers)(e=>K.value=!1,['self']))},[(0,l.createElementVNode)('div',cv,[(0,l.createVNode)(gi,{onClose:c[26]||(c[26]=e=>K.value=!1)})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' å˜é‡ç®¡ç†å™¨é¢æ¿ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[Y.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal variable-manager-overlay',onClick:c[29]||(c[29]=(0,l.withModifiers)(e=>Y.value=!1,['self']))},[(0,l.createElementVNode)('div',iv,[(0,l.createVNode)(ou,{onClose:c[28]||(c[28]=e=>Y.value=!1),onVariableUpdated:re})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' AIå“åº”å®¡æŸ¥å¯¹è¯æ¡† '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[(0,l.createVNode)($u,{visible:(0,l.unref)(u),'review-result':(0,l.unref)(d),'is-processing':(0,l.unref)(m),onConfirm:ce,onRollback:ie},null,8,['visible','review-result','is-processing'])]))],2))}}),dv=(0,I.A)(uv,[['__scopeId','data-v-382df8a8']]),mv={key:0,class:'error-boundary'},vv={class:'error-content'},pv={class:'error-message'},fv={key:0,class:'error-details'},gv=(0,l.defineComponent)({__name:'ErrorBoundary',props:{showDetails:{type:Boolean,default:!0},fallbackMessage:{default:'ç»„ä»¶åŠ è½½æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚'}},emits:['error','retry','dismiss'],setup(e,{expose:t,emit:a}){const n=e,o=a,s=(0,l.ref)(!1),r=(0,l.ref)(''),c=(0,l.ref)('');(0,l.onErrorCaptured)((e,t,a)=>(s.value=!0,r.value=e.message||n.fallbackMessage,n.showDetails&&(c.value=`\né”™è¯¯ç±»å‹: ${e.name}\né”™è¯¯ä¿¡æ¯: ${e.message}\nç»„ä»¶ä¿¡æ¯: ${a}\nå †æ ˆä¿¡æ¯:\n${e.stack||'æ— å †æ ˆä¿¡æ¯'}\n    `.trim()),console.error('[ErrorBoundary] æ•è·åˆ°é”™è¯¯:',e),console.error('[ErrorBoundary] ç»„ä»¶ä¿¡æ¯:',a),o('error',e,a),!1));const i=()=>{s.value=!1,r.value='',c.value='',o('retry')},u=()=>{s.value=!1,r.value='',c.value='',o('dismiss')};return t({reset:()=>{s.value=!1,r.value='',c.value=''},hasError:s}),(e,t)=>s.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',mv,[(0,l.createElementVNode)('div',vv,[t[1]||(t[1]=(0,l.createElementVNode)('div',{class:'error-icon'},'âš ï¸',-1)),t[2]||(t[2]=(0,l.createElementVNode)('h3',{class:'error-title'},'å‡ºç°äº†ä¸€äº›é—®é¢˜',-1)),(0,l.createElementVNode)('p',pv,(0,l.toDisplayString)(r.value),1),(0,l.createElementVNode)('div',{class:'error-actions'},[(0,l.createElementVNode)('button',{class:'btn btn-primary',onClick:i},'é‡è¯•'),(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:u},'å¿½ç•¥')]),c.value?((0,l.openBlock)(),(0,l.createElementBlock)('details',fv,[t[0]||(t[0]=(0,l.createElementVNode)('summary',null,'æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯',-1)),(0,l.createElementVNode)('pre',null,(0,l.toDisplayString)(c.value),1)])):(0,l.createCommentVNode)('v-if',!0)])])):(0,l.renderSlot)(e.$slots,'default',{key:1})}}),hv=(0,I.A)(gv,[['__scopeId','data-v-7b143150']]),yv=(0,l.defineComponent)({__name:'App',setup(e){const t=Tn(),a=(0,l.ref)(),n=(e,t)=>{console.error('[App] æ•è·åˆ°é”™è¯¯:',e),console.error('[App] ç»„ä»¶ä¿¡æ¯:',t),'undefined'!=typeof toastr&&toastr.error('åº”ç”¨å‘ç”Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•')},o=()=>{console.log('[App] ç”¨æˆ·ç‚¹å‡»é‡è¯•'),t.initialize()};return(0,l.onMounted)(async()=>{console.log('[App] MCæˆ¿å­åº”ç”¨å·²æŒ‚è½½');try{await t.initialize(),console.log('[App] åº”ç”¨çŠ¶æ€åˆå§‹åŒ–å®Œæˆ')}catch(e){console.error('[App] åˆå§‹åŒ–å¤±è´¥:',e)}}),(0,l.onUnmounted)(()=>{console.log('[App] MCæˆ¿å­åº”ç”¨æ­£åœ¨å¸è½½')}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{id:'app-container',ref_key:'appContainer',ref:a},[(0,l.createVNode)(hv,{onError:n,onRetry:o},{default:(0,l.withCtx)(()=>[((0,l.openBlock)(),(0,l.createBlock)(l.Suspense,null,{default:(0,l.withCtx)(()=>[(0,l.createVNode)(dv)]),fallback:(0,l.withCtx)(()=>[...t[0]||(t[0]=[(0,l.createElementVNode)('div',{class:'loading-container'},[(0,l.createElementVNode)('div',{class:'loading-spinner'}),(0,l.createElementVNode)('p',{class:'loading-text'},'æ­£åœ¨åŠ è½½MCæˆ¿å­...')],-1)])]),_:1}))]),_:1}),(0,l.createCommentVNode)(' å…¨å±€ç¡®è®¤å¯¹è¯æ¡† '),(0,l.createVNode)(Ps)],512))}}),Vv=(0,I.A)(yv,[['__scopeId','data-v-9c83b896']]),Nv=e(),Ev=(0,l.createApp)(Vv);Ev.use(Nv),Ev.mount('#app');Tn().initialize(),console.log('[MCæˆ¿å­] åº”ç”¨å·²å¯åŠ¨'),'undefined'!=typeof toastr&&toastr.success('MCæˆ¿å­ç³»ç»ŸåŠ è½½æˆåŠŸ'),window.addEventListener('pagehide',()=>{console.log('[MCæˆ¿å­] åº”ç”¨æ­£åœ¨å¸è½½'),'undefined'!=typeof toastr&&toastr.info('MCæˆ¿å­ç³»ç»Ÿå·²å¸è½½')});
//# sourceMappingURL=index.js.map</script><style>.top-bar[data-v-255ae3ac]{display:flex;align-items:center;justify-content:space-between;gap:var(--spacing-sm);height:50px;padding:0 var(--spacing-md);background:var(--office-header);border-bottom:1px solid var(--border-color);flex-shrink:0;position:relative;z-index:100}.top-bar-left[data-v-255ae3ac]{display:flex;align-items:center;gap:var(--spacing-xs);min-width:0;flex-shrink:0}.player-card[data-v-255ae3ac]{display:flex;align-items:center;gap:6px;padding:4px 8px;background:hsla(0,0%,100%,.08);border:1px solid hsla(0,0%,100%,.1);border-radius:var(--radius-sm);min-width:0;flex:1;max-width:180px}.player-avatar[data-v-255ae3ac]{flex-shrink:0;width:26px;height:26px;display:flex;align-items:center;justify-content:center;background:rgba(99,102,241,.3);border-radius:50%}.player-avatar .avatar-icon[data-v-255ae3ac]{font-size:13px}.player-info[data-v-255ae3ac]{display:flex;flex-direction:column;min-width:0;line-height:1.15}.player-name[data-v-255ae3ac]{font-size:12px;font-weight:600;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.player-role[data-v-255ae3ac]{font-size:9px;color:hsla(0,0%,100%,.55);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.top-bar-center[data-v-255ae3ac]{display:flex;align-items:center;justify-content:center;gap:var(--spacing-sm);flex:1;min-width:0}.datetime-group[data-v-255ae3ac]{display:flex;align-items:center;gap:4px}.date-item[data-v-255ae3ac],.time-item[data-v-255ae3ac],.location-item[data-v-255ae3ac]{display:flex;align-items:center;gap:3px;padding:3px 6px;background:hsla(0,0%,100%,.08);border-radius:var(--radius-xs);border:1px solid hsla(0,0%,100%,.1)}.item-icon[data-v-255ae3ac]{font-size:11px;flex-shrink:0}.item-value[data-v-255ae3ac]{font-size:11px;font-weight:500;color:#fff;white-space:nowrap}.location-text[data-v-255ae3ac]{max-width:120px;overflow:hidden;text-overflow:ellipsis}.period-badge[data-v-255ae3ac]{display:inline-block;padding:2px 6px;border-radius:3px;font-size:10px;font-weight:600;font-family:monospace;letter-spacing:.3px}.period-badge.period-morning[data-v-255ae3ac]{background:rgba(255,193,7,.25);color:#ffc107;box-shadow:inset 0 0 0 1px rgba(255,193,7,.3)}.period-badge.period-noon[data-v-255ae3ac]{background:rgba(255,152,0,.25);color:#ff9800;box-shadow:inset 0 0 0 1px rgba(255,152,0,.3)}.period-badge.period-afternoon[data-v-255ae3ac]{background:rgba(255,87,34,.25);color:#ff7043;box-shadow:inset 0 0 0 1px rgba(255,87,34,.3)}.period-badge.period-evening[data-v-255ae3ac]{background:rgba(156,39,176,.25);color:#ce93d8;box-shadow:inset 0 0 0 1px rgba(156,39,176,.3)}.period-badge.period-night[data-v-255ae3ac]{background:rgba(63,81,181,.25);color:#9fa8da;box-shadow:inset 0 0 0 1px rgba(63,81,181,.3)}.period-badge.period-default[data-v-255ae3ac]{background:rgba(158,158,158,.25);color:#bdbdbd;box-shadow:inset 0 0 0 1px rgba(158,158,158,.3)}.top-bar-right[data-v-255ae3ac]{display:flex;align-items:center;gap:var(--spacing-xs);flex-shrink:0}.connection-indicator[data-v-255ae3ac]{padding:4px}.connection-indicator .status-dot[data-v-255ae3ac]{width:8px;height:8px;border-radius:50%;transition:background-color var(--transition-normal)}.connection-indicator.connected .status-dot[data-v-255ae3ac]{background:var(--success-color);box-shadow:0 0 6px var(--success-color)}.connection-indicator.connecting .status-dot[data-v-255ae3ac]{background:var(--warning-color);animation:pulse-255ae3ac 1.5s ease-in-out infinite}.connection-indicator.disconnected .status-dot[data-v-255ae3ac]{background:var(--error-color)}@keyframes pulse-255ae3ac{0%,100%{opacity:1}50%{opacity:.4}}.action-buttons[data-v-255ae3ac]{display:flex;align-items:center;gap:4px}.action-btn[data-v-255ae3ac]{display:flex;align-items:center;justify-content:center;width:34px;height:34px;background:hsla(0,0%,100%,.1);border:1px solid hsla(0,0%,100%,.15);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast)}.action-btn .btn-icon[data-v-255ae3ac]{font-size:15px}.action-btn[data-v-255ae3ac]:hover{background:hsla(0,0%,100%,.2);border-color:hsla(0,0%,100%,.25)}.action-btn[data-v-255ae3ac]:active{transform:scale(0.95)}@media (max-width:1024px){.top-bar[data-v-255ae3ac]{gap:var(--spacing-xs)}.player-card[data-v-255ae3ac]{max-width:150px}.location-text[data-v-255ae3ac]{max-width:100px}}@media (max-width:768px){.top-bar[data-v-255ae3ac]{height:46px;padding:0 var(--spacing-sm);gap:6px}.top-bar-left[data-v-255ae3ac]{gap:4px}.player-card[data-v-255ae3ac]{max-width:120px;padding:3px 6px}.player-avatar[data-v-255ae3ac]{width:22px;height:22px}.player-avatar .avatar-icon[data-v-255ae3ac]{font-size:11px}.player-name[data-v-255ae3ac]{font-size:11px}.player-role[data-v-255ae3ac]{font-size:8px}.top-bar-center[data-v-255ae3ac]{gap:4px;justify-content:flex-start}.datetime-group[data-v-255ae3ac]{gap:3px}.date-item[data-v-255ae3ac],.time-item[data-v-255ae3ac]{padding:2px 4px}.item-icon[data-v-255ae3ac]{font-size:10px}.item-value[data-v-255ae3ac]{font-size:10px}.period-badge[data-v-255ae3ac]{font-size:9px;padding:2px 4px}.location-item[data-v-255ae3ac]{display:none}.connection-indicator[data-v-255ae3ac]{padding:2px}.connection-indicator .status-dot[data-v-255ae3ac]{width:6px;height:6px}.action-btn[data-v-255ae3ac]{width:30px;height:30px}.action-btn .btn-icon[data-v-255ae3ac]{font-size:13px}}@media (max-width:480px){.top-bar[data-v-255ae3ac]{height:42px;padding:0 6px;grid-template-columns:auto 1fr auto;gap:4px}.player-card[data-v-255ae3ac]{max-width:100px;padding:2px 4px;gap:4px}.player-avatar[data-v-255ae3ac]{width:20px;height:20px}.player-avatar .avatar-icon[data-v-255ae3ac]{font-size:10px}.player-info[data-v-255ae3ac]{display:flex;flex-direction:column}.player-name[data-v-255ae3ac]{font-size:10px}.player-role[data-v-255ae3ac]{display:none}.top-bar-center[data-v-255ae3ac]{justify-content:center}.datetime-group[data-v-255ae3ac]{gap:2px}.date-item[data-v-255ae3ac]{display:none}.time-item[data-v-255ae3ac]{padding:2px 4px}.period-badge[data-v-255ae3ac]{font-size:9px;padding:2px 5px}.action-buttons[data-v-255ae3ac]{gap:2px}.action-btn[data-v-255ae3ac]{width:28px;height:28px}.action-btn .btn-icon[data-v-255ae3ac]{font-size:12px}}@media (max-width:360px){.top-bar[data-v-255ae3ac]{height:38px;padding:0 4px;gap:2px}.player-card[data-v-255ae3ac]{max-width:80px;padding:2px 3px}.player-avatar[data-v-255ae3ac]{width:18px;height:18px}.player-avatar .avatar-icon[data-v-255ae3ac]{font-size:9px}.player-name[data-v-255ae3ac]{font-size:9px}.period-badge[data-v-255ae3ac]{font-size:8px;padding:1px 3px}.connection-indicator[data-v-255ae3ac]{display:none}.action-btn[data-v-255ae3ac]{width:26px;height:26px}.action-btn .btn-icon[data-v-255ae3ac]{font-size:11px}}
.content-renderer[data-v-17b96b08]{font-size:var(--font-md,15px);line-height:1.8;color:var(--text-color,#1a1a1a)}.content-renderer--dark[data-v-17b96b08]{color:var(--text-color,#e8e8e8)}.content-text[data-v-17b96b08] .block-dialogue{color:#0d47a1;font-weight:500}.content-text[data-v-17b96b08] .block-thought{color:#6b21a8;font-style:italic;opacity:.9}.content-text[data-v-17b96b08] .block-scenery{color:#166534;opacity:.95}.content-text[data-v-17b96b08] .block-system{color:#b91c1c;font-weight:700}.content-renderer--dark .content-text[data-v-17b96b08] .block-dialogue{color:#93c5fd;font-weight:500}.content-renderer--dark .content-text[data-v-17b96b08] .block-thought{color:#c4b5fd;opacity:.95}.content-renderer--dark .content-text[data-v-17b96b08] .block-scenery{color:#6ee7b7;opacity:1}.content-renderer--dark .content-text[data-v-17b96b08] .block-system{color:#fca5a5;font-weight:700}.streaming-cursor[data-v-17b96b08]{display:inline-block;animation:cursorBlink-17b96b08 1s step-end infinite;color:var(--primary-color,#1a5fb4);font-weight:bold}.content-renderer--dark .streaming-cursor[data-v-17b96b08]{color:var(--primary-color,#60a5fa)}@keyframes cursorBlink-17b96b08{0%,50%{opacity:1}51%,100%{opacity:0}}
.variable-changes-panel[data-v-2e3cf9d4]{background:var(--bg-tertiary,#f5f5f5);border:1px solid var(--border-color,#e0e0e0);border-radius:var(--radius-md,8px);overflow:hidden;transition:all var(--transition-normal,0.3s) ease}.variable-changes-panel.expanded[data-v-2e3cf9d4]{box-shadow:var(--shadow-sm,0 2px 4px rgba(0,0,0,0.1))}.panel-header[data-v-2e3cf9d4]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-sm,8px) var(--spacing-md,12px);cursor:pointer;-webkit-user-select:none;user-select:none;transition:background var(--transition-fast,0.15s)}.panel-header[data-v-2e3cf9d4]:hover{background:var(--bg-hover,rgba(0,0,0,0.05))}.header-left[data-v-2e3cf9d4]{display:flex;align-items:center;gap:var(--spacing-sm,8px)}.header-icon[data-v-2e3cf9d4]{font-size:14px}.header-title[data-v-2e3cf9d4]{font-size:var(--font-sm,14px);font-weight:500;color:var(--text-color,#333)}.changes-count[data-v-2e3cf9d4]{display:inline-flex;align-items:center;justify-content:center;min-width:20px;height:20px;padding:0 6px;background:var(--primary-color,#6366f1);color:#fff;font-size:var(--font-xs,12px);font-weight:600;border-radius:10px}.header-right[data-v-2e3cf9d4]{display:flex;align-items:center}.toggle-icon[data-v-2e3cf9d4]{font-size:10px;color:var(--text-secondary,#666);transition:transform var(--transition-fast,0.15s)}.panel-content[data-v-2e3cf9d4]{border-top:1px solid var(--border-color,#e0e0e0);background:var(--bg-color,#fff)}.no-changes[data-v-2e3cf9d4]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--spacing-lg,16px);gap:var(--spacing-xs,4px)}.no-changes .empty-icon[data-v-2e3cf9d4]{font-size:24px;opacity:.5}.no-changes .empty-text[data-v-2e3cf9d4]{font-size:var(--font-sm,14px);color:var(--text-disabled,#999)}.changes-list[data-v-2e3cf9d4]{max-height:300px;overflow-y:auto;padding:var(--spacing-sm,8px)}.change-item[data-v-2e3cf9d4]{display:flex;flex-direction:column;gap:var(--spacing-xs,4px);padding:var(--spacing-sm,8px);border-radius:var(--radius-sm,4px);margin-bottom:var(--spacing-xs,4px);background:var(--bg-secondary,#fafafa);border-left:3px solid rgba(0,0,0,0);transition:all var(--transition-fast,0.15s)}.change-item[data-v-2e3cf9d4]:last-child{margin-bottom:0}.change-item[data-v-2e3cf9d4]:hover{background:var(--bg-hover,#f0f0f0)}.change-item.change-new[data-v-2e3cf9d4]{border-left-color:var(--success-color,#4caf50);background:rgba(76,175,80,.05)}.change-item.change-new .path-icon[data-v-2e3cf9d4]{color:var(--success-color,#4caf50)}.change-item.change-increase[data-v-2e3cf9d4]{border-left-color:var(--info-color,#2196f3);background:rgba(33,150,243,.05)}.change-item.change-increase .path-icon[data-v-2e3cf9d4]{color:var(--info-color,#2196f3)}.change-item.change-decrease[data-v-2e3cf9d4]{border-left-color:var(--warning-color,#ff9800);background:rgba(255,152,0,.05)}.change-item.change-decrease .path-icon[data-v-2e3cf9d4]{color:var(--warning-color,#ff9800)}.change-item.change-modify[data-v-2e3cf9d4]{border-left-color:var(--primary-color,#6366f1);background:rgba(99,102,241,.05)}.change-item.change-modify .path-icon[data-v-2e3cf9d4]{color:var(--primary-color,#6366f1)}.change-path[data-v-2e3cf9d4]{display:flex;align-items:center;gap:var(--spacing-xs,4px)}.change-path .path-icon[data-v-2e3cf9d4]{font-size:12px}.change-path .path-text[data-v-2e3cf9d4]{font-size:var(--font-xs,12px);font-family:monospace;color:var(--text-secondary,#666);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.change-values[data-v-2e3cf9d4]{display:flex;align-items:center;gap:var(--spacing-sm,8px);padding-left:var(--spacing-md,12px)}.change-values .old-value[data-v-2e3cf9d4]{font-size:var(--font-sm,14px);font-family:monospace;color:var(--text-disabled,#999);text-decoration:line-through}.change-values .arrow[data-v-2e3cf9d4]{font-size:var(--font-xs,12px);color:var(--text-disabled,#999)}.change-values .new-value[data-v-2e3cf9d4]{font-size:var(--font-sm,14px);font-family:monospace;color:var(--text-color,#333);font-weight:500}.change-comment[data-v-2e3cf9d4]{display:flex;align-items:center;gap:var(--spacing-xs,4px);padding-left:var(--spacing-md,12px)}.change-comment .comment-icon[data-v-2e3cf9d4]{font-size:10px;opacity:.7}.change-comment .comment-text[data-v-2e3cf9d4]{font-size:var(--font-xs,12px);color:var(--text-secondary,#666);font-style:italic}.panel-footer[data-v-2e3cf9d4]{display:flex;justify-content:flex-end;gap:var(--spacing-sm,8px);padding:var(--spacing-sm,8px) var(--spacing-md,12px);border-top:1px solid var(--border-color,#e0e0e0);background:var(--bg-tertiary,#f5f5f5)}.btn-clear[data-v-2e3cf9d4],.btn-copy[data-v-2e3cf9d4]{display:flex;align-items:center;gap:var(--spacing-xs,4px);padding:var(--spacing-xs,4px) var(--spacing-sm,8px);font-size:var(--font-xs,12px);color:var(--text-secondary,#666);background:rgba(0,0,0,0);border:1px solid var(--border-color,#e0e0e0);border-radius:var(--radius-sm,4px);cursor:pointer;transition:all var(--transition-fast,0.15s)}.btn-clear[data-v-2e3cf9d4]:hover,.btn-copy[data-v-2e3cf9d4]:hover{background:var(--bg-hover,#f0f0f0);color:var(--text-color,#333);border-color:var(--border-hover,#ccc)}.btn-clear .btn-icon[data-v-2e3cf9d4],.btn-copy .btn-icon[data-v-2e3cf9d4]{font-size:10px}.expand-enter-active[data-v-2e3cf9d4],.expand-leave-active[data-v-2e3cf9d4]{transition:all .3s ease;max-height:400px;overflow:hidden}.expand-enter-from[data-v-2e3cf9d4],.expand-leave-to[data-v-2e3cf9d4]{max-height:0;opacity:0}@media (max-width:768px){.changes-list[data-v-2e3cf9d4]{max-height:200px}.change-item[data-v-2e3cf9d4]{padding:var(--spacing-xs,4px) var(--spacing-sm,8px)}.change-values[data-v-2e3cf9d4]{flex-wrap:wrap}}
.game-start-panel[data-v-6f814e5e]{display:flex;flex-direction:column;height:100%;background:var(--bg-secondary);border-radius:var(--radius-md);overflow:hidden}.panel-header[data-v-6f814e5e]{flex-shrink:0;background:linear-gradient(135deg,var(--primary-color) 0%,var(--primary-hover) 100%);color:#fff;position:relative;overflow:hidden}.panel-header .header-content[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-xs) var(--spacing-md);position:relative;z-index:1}.panel-header .header-icon-wrapper[data-v-6f814e5e]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:hsla(0,0%,100%,.2);border-radius:var(--radius-sm)}.panel-header .header-icon[data-v-6f814e5e]{font-size:18px}.panel-header .header-text[data-v-6f814e5e]{display:flex;flex-direction:column;gap:2px}.panel-header .header-title[data-v-6f814e5e]{margin:0;font-size:var(--font-md);font-weight:600}.panel-header .header-subtitle[data-v-6f814e5e]{margin:0;font-size:var(--font-xs);opacity:.8}.form-progress[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) 0;margin-bottom:var(--spacing-sm)}.form-progress .progress-bar[data-v-6f814e5e]{flex:1;height:6px;background:var(--bg-tertiary);border-radius:var(--radius-xs);overflow:hidden}.form-progress .progress-fill[data-v-6f814e5e]{height:100%;background:linear-gradient(90deg,var(--primary-color),var(--success-color));border-radius:var(--radius-xs);transition:width .3s ease}.form-progress .progress-text[data-v-6f814e5e]{font-size:var(--font-xs);color:var(--text-secondary);white-space:nowrap}.panel-body[data-v-6f814e5e]{flex:1;overflow-y:auto;padding:var(--spacing-md)}.setting-section[data-v-6f814e5e]{background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-md);margin-bottom:var(--spacing-md);overflow:hidden;transition:all var(--transition-fast)}.setting-section[data-v-6f814e5e]:last-child{margin-bottom:0}.setting-section.has-content[data-v-6f814e5e]{border-color:var(--primary-color)}.section-header[data-v-6f814e5e]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border-bottom:1px solid var(--border-color)}.section-header .section-header-left[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-sm)}.section-header .section-icon[data-v-6f814e5e]{font-size:16px}.section-header .section-title[data-v-6f814e5e]{margin:0;font-size:var(--font-md);font-weight:600;color:var(--text-color)}.required-badge[data-v-6f814e5e],.optional-badge[data-v-6f814e5e]{padding:2px 8px;font-size:var(--font-xs);font-weight:600;border-radius:var(--radius-xs);text-transform:uppercase;letter-spacing:.5px}.required-badge[data-v-6f814e5e]{background:var(--error-light);color:var(--error-color)}.optional-badge[data-v-6f814e5e]{background:var(--info-light);color:var(--info-color)}.section-content[data-v-6f814e5e]{padding:var(--spacing-md)}.form-row[data-v-6f814e5e]{margin-bottom:var(--spacing-md)}.form-row[data-v-6f814e5e]:last-child{margin-bottom:0}.form-row-2col[data-v-6f814e5e]{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md)}.form-group[data-v-6f814e5e]{display:flex;flex-direction:column;gap:var(--spacing-xs);position:relative}.form-label[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-xs);font-size:var(--font-sm);font-weight:500;color:var(--text-color)}.form-label .required-mark[data-v-6f814e5e]{color:var(--error-color);font-weight:700}.form-label .optional-mark[data-v-6f814e5e]{font-size:var(--font-xs);color:var(--text-disabled);font-weight:400}.form-input[data-v-6f814e5e],.form-textarea[data-v-6f814e5e]{padding:var(--spacing-sm) var(--spacing-md);border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:var(--font-sm);color:var(--text-color);background:var(--bg-secondary);transition:all var(--transition-fast)}.form-input[data-v-6f814e5e]:focus,.form-textarea[data-v-6f814e5e]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px var(--primary-light)}.form-input[data-v-6f814e5e]::placeholder,.form-textarea[data-v-6f814e5e]::placeholder{color:var(--text-disabled)}.form-input.has-error[data-v-6f814e5e],.form-textarea.has-error[data-v-6f814e5e]{border-color:var(--error-color);background:var(--error-light)}.form-input.has-value[data-v-6f814e5e],.form-textarea.has-value[data-v-6f814e5e]{border-color:var(--success-color);background:var(--success-light)}.form-textarea[data-v-6f814e5e]{resize:vertical;min-height:80px;font-family:inherit;line-height:1.5}.help-text[data-v-6f814e5e]{font-size:var(--font-xs);color:var(--text-secondary);display:flex;align-items:center;gap:var(--spacing-xs)}.error-text[data-v-6f814e5e]{font-size:var(--font-xs);color:var(--error-color);display:flex;align-items:center;gap:var(--spacing-xs)}.char-count[data-v-6f814e5e]{font-size:var(--font-xs);color:var(--text-disabled);text-align:right;margin-top:var(--spacing-xs)}.scene-type-selector[data-v-6f814e5e]{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:var(--spacing-sm)}.scene-type-btn[data-v-6f814e5e]{display:flex;flex-direction:column;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-sm);background:var(--bg-secondary);border:2px solid var(--border-color);border-radius:var(--radius-md);cursor:pointer;transition:all var(--transition-fast);position:relative}.scene-type-btn[data-v-6f814e5e]:hover{border-color:var(--primary-color);background:var(--primary-light)}.scene-type-btn.active[data-v-6f814e5e]{border-color:var(--primary-color);background:var(--primary-light)}.scene-type-btn.active .scene-label[data-v-6f814e5e]{color:var(--primary-color);font-weight:600}.scene-type-btn.active .check-icon[data-v-6f814e5e]{opacity:1;transform:scale(1)}.scene-type-btn .scene-icon[data-v-6f814e5e]{font-size:24px}.scene-type-btn .scene-label[data-v-6f814e5e]{font-size:var(--font-xs);color:var(--text-secondary);transition:all var(--transition-fast);text-align:center;line-height:1.2}.scene-type-btn .check-icon[data-v-6f814e5e]{position:absolute;top:4px;right:4px;width:16px;height:16px;background:var(--primary-color);color:#fff;border-radius:50%;font-size:10px;display:flex;align-items:center;justify-content:center;opacity:0;transform:scale(0);transition:all var(--transition-fast)}.rules-section .section-content[data-v-6f814e5e]{padding:var(--spacing-md)}.rules-content[data-v-6f814e5e]{display:flex;flex-direction:column;gap:var(--spacing-md)}.rules-card[data-v-6f814e5e]{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);overflow:hidden;transition:all var(--transition-fast)}.rules-card .card-header[data-v-6f814e5e]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border-bottom:1px solid var(--border-color)}.rules-card .card-header .card-title[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-sm);font-size:var(--font-sm);font-weight:600;color:var(--text-color)}.rules-card .card-header .card-title .card-icon[data-v-6f814e5e]{font-size:16px}.rules-card .card-header .card-title .required-mark[data-v-6f814e5e]{color:var(--error-color);font-size:var(--font-xs);font-weight:600;padding:2px 6px;background:var(--error-light);border-radius:var(--radius-xs)}.rules-card .card-header .card-title .optional-mark[data-v-6f814e5e]{font-size:var(--font-xs);color:var(--text-disabled);font-weight:400}.rules-card .card-header .field-count[data-v-6f814e5e]{font-size:var(--font-xs);color:var(--text-secondary);background:var(--bg-color);padding:2px 8px;border-radius:var(--radius-sm)}.rules-card .card-body[data-v-6f814e5e]{padding:var(--spacing-md)}.rules-card .card-desc[data-v-6f814e5e]{display:flex;align-items:flex-start;gap:var(--spacing-sm);margin:0 0 var(--spacing-sm);font-size:var(--font-sm);color:var(--text-secondary);line-height:1.5}.rules-card .card-desc .desc-icon[data-v-6f814e5e]{flex-shrink:0;font-size:14px}.rules-card .card-hint[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-sm);margin:0 0 var(--spacing-md);padding:var(--spacing-sm) var(--spacing-md);font-size:var(--font-sm);color:var(--info-color);background:var(--info-light);border-radius:var(--radius-sm);border-left:3px solid var(--info-color)}.rules-card .card-hint strong[data-v-6f814e5e]{color:var(--primary-color)}.preset-fields[data-v-6f814e5e]{margin-bottom:var(--spacing-md)}.preset-fields .preset-label[data-v-6f814e5e]{display:block;font-size:var(--font-sm);color:var(--text-secondary);margin-bottom:var(--spacing-xs)}.preset-fields .preset-tags[data-v-6f814e5e]{display:flex;flex-wrap:wrap;gap:var(--spacing-xs)}.preset-tag[data-v-6f814e5e]{display:inline-flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-tertiary);border:1px dashed var(--border-color);border-radius:var(--radius-sm);font-size:var(--font-sm);color:var(--text-secondary);cursor:pointer;transition:all var(--transition-fast)}.preset-tag[data-v-6f814e5e]:hover{background:var(--primary-light);border-color:var(--primary-color);border-style:solid;color:var(--primary-color)}.preset-tag .tag-icon[data-v-6f814e5e]{font-size:var(--font-sm);font-weight:700}.selected-fields[data-v-6f814e5e]{min-height:48px;padding:var(--spacing-sm);background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-sm);margin-bottom:var(--spacing-md)}.selected-fields.has-fields[data-v-6f814e5e]{background:var(--success-light);border-color:var(--success-color)}.selected-fields .empty-hint[data-v-6f814e5e]{display:block;text-align:center;color:var(--text-disabled);font-size:var(--font-sm);padding:var(--spacing-sm)}.field-tags[data-v-6f814e5e]{display:flex;flex-wrap:wrap;gap:var(--spacing-xs)}.field-tag[data-v-6f814e5e]{display:inline-flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:var(--primary-color);color:#fff;border-radius:var(--radius-sm);font-size:var(--font-sm);font-weight:500;animation:tagAppear-6f814e5e .2s ease-out;animation-delay:calc(var(--tag-index)*.03s)}.field-tag .tag-text[data-v-6f814e5e]{white-space:nowrap}.field-tag .tag-remove[data-v-6f814e5e]{background:hsla(0,0%,100%,.2);border:none;color:#fff;width:18px;height:18px;border-radius:50%;font-size:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all var(--transition-fast)}.field-tag .tag-remove[data-v-6f814e5e]:hover{background:hsla(0,0%,100%,.4)}@keyframes tagAppear-6f814e5e{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}.add-field-row[data-v-6f814e5e]{display:flex;gap:var(--spacing-sm)}.add-field-row .add-field-input[data-v-6f814e5e]{flex:1;padding:var(--spacing-sm) var(--spacing-md);border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:var(--font-sm);color:var(--text-color);background:var(--bg-secondary)}.add-field-row .add-field-input[data-v-6f814e5e]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px var(--primary-light)}.add-field-row .add-field-input[data-v-6f814e5e]::placeholder{color:var(--text-disabled)}.add-field-row .add-field-btn[data-v-6f814e5e]{padding:var(--spacing-sm) var(--spacing-md);background:var(--primary-color);color:#fff;border:none;border-radius:var(--radius-sm);font-size:var(--font-sm);font-weight:500;cursor:pointer;transition:all var(--transition-fast)}.add-field-row .add-field-btn[data-v-6f814e5e]:hover:not(:disabled){background:var(--primary-hover)}.add-field-row .add-field-btn[data-v-6f814e5e]:disabled{opacity:.5;cursor:not-allowed}.rule-items[data-v-6f814e5e]{min-height:40px;margin-bottom:var(--spacing-md)}.rule-items[data-v-6f814e5e]:empty,.rule-items[data-v-6f814e5e]:not(.has-items){display:none}.rule-list[data-v-6f814e5e]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.rule-item[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-xs);background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-sm);animation:ruleSlideIn-6f814e5e .2s ease-out}.rule-item .rule-number[data-v-6f814e5e]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:var(--primary-light);color:var(--primary-color);border-radius:50%;font-size:var(--font-sm);font-weight:600;flex-shrink:0}.rule-item .rule-input[data-v-6f814e5e]{flex:1;padding:var(--spacing-xs) var(--spacing-sm);border:1px solid rgba(0,0,0,0);border-radius:var(--radius-sm);font-size:var(--font-sm);color:var(--text-color);background:rgba(0,0,0,0);transition:all var(--transition-fast)}.rule-item .rule-input[data-v-6f814e5e]:focus{outline:none;background:var(--bg-secondary);border-color:var(--primary-color)}.rule-item .rule-input[data-v-6f814e5e]::placeholder{color:var(--text-disabled)}.rule-item .rule-remove[data-v-6f814e5e]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--text-disabled);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast);flex-shrink:0;font-size:14px}.rule-item .rule-remove[data-v-6f814e5e]:hover{background:var(--error-light);color:var(--error-color)}@keyframes ruleSlideIn-6f814e5e{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}.add-rule-btn[data-v-6f814e5e]{display:inline-flex;align-items:center;justify-content:center;gap:var(--spacing-xs);padding:var(--spacing-sm) var(--spacing-md);background:rgba(0,0,0,0);border:1px dashed var(--border-color);border-radius:var(--radius-sm);color:var(--text-secondary);font-size:var(--font-sm);cursor:pointer;transition:all var(--transition-fast);width:100%}.add-rule-btn[data-v-6f814e5e]:hover{background:var(--primary-light);border-color:var(--primary-color);border-style:solid;color:var(--primary-color)}.add-rule-btn .btn-icon[data-v-6f814e5e]{font-size:16px;font-weight:700}.tag-enter-active[data-v-6f814e5e],.tag-leave-active[data-v-6f814e5e]{transition:all .2s ease}.tag-enter-from[data-v-6f814e5e]{opacity:0;transform:scale(0.8)}.tag-leave-to[data-v-6f814e5e]{opacity:0;transform:scale(0.8) translateX(-10px)}.tag-move[data-v-6f814e5e]{transition:transform .2s ease}.rule-enter-active[data-v-6f814e5e],.rule-leave-active[data-v-6f814e5e]{transition:all .2s ease}.rule-enter-from[data-v-6f814e5e]{opacity:0;transform:translateX(-20px)}.rule-leave-to[data-v-6f814e5e]{opacity:0;transform:translateX(20px)}.rule-move[data-v-6f814e5e]{transition:transform .2s ease}.panel-footer[data-v-6f814e5e]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-xs) var(--spacing-md);background:var(--bg-tertiary);border-top:1px solid var(--border-color);flex-shrink:0;gap:var(--spacing-sm);flex-wrap:wrap}.panel-footer .footer-left[data-v-6f814e5e],.panel-footer .footer-right[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-xs);flex-wrap:wrap}.btn[data-v-6f814e5e]{display:inline-flex;align-items:center;justify-content:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);border:none;border-radius:var(--radius-sm);font-size:var(--font-sm);font-weight:500;cursor:pointer;transition:all var(--transition-fast);white-space:nowrap}.btn[data-v-6f814e5e]:disabled{opacity:.5;cursor:not-allowed}.btn .btn-icon[data-v-6f814e5e]{font-size:14px;flex-shrink:0}.btn .btn-text[data-v-6f814e5e]{white-space:nowrap}.btn-primary[data-v-6f814e5e]{background:linear-gradient(135deg,var(--primary-color),var(--primary-hover));color:#fff}.btn-primary[data-v-6f814e5e]:hover:not(:disabled){filter:brightness(1.1)}.btn-outline-primary[data-v-6f814e5e]{background:rgba(0,0,0,0);color:var(--primary-color);border:1px solid var(--primary-color)}.btn-outline-primary[data-v-6f814e5e]:hover:not(:disabled){background:var(--primary-light)}.btn-secondary[data-v-6f814e5e]{background:var(--bg-secondary);color:var(--text-color);border:1px solid var(--border-color)}.btn-secondary[data-v-6f814e5e]:hover:not(:disabled){background:var(--bg-hover)}.btn-loading[data-v-6f814e5e]{display:flex;align-items:center;gap:4px}.btn-loading .loading-dot[data-v-6f814e5e]{width:6px;height:6px;background:currentColor;border-radius:50%;animation:loadingPulse-6f814e5e 1.4s ease-in-out infinite}.btn-loading .loading-dot[data-v-6f814e5e]:nth-child(1){animation-delay:0s}.btn-loading .loading-dot[data-v-6f814e5e]:nth-child(2){animation-delay:.2s}.btn-loading .loading-dot[data-v-6f814e5e]:nth-child(3){animation-delay:.4s}@keyframes loadingPulse-6f814e5e{0%,80%,100%{opacity:.4;transform:scale(0.8)}40%{opacity:1;transform:scale(1)}}.validation-errors[data-v-6f814e5e]{position:absolute;bottom:80px;left:var(--spacing-md);right:var(--spacing-md);padding:var(--spacing-md);background:var(--error-light);border:1px solid var(--error-color);border-radius:var(--radius-md);box-shadow:var(--shadow-md);z-index:10}.validation-errors .error-header[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-xs);font-size:var(--font-sm);font-weight:600;color:var(--error-color);margin-bottom:var(--spacing-sm)}.validation-errors .error-header .error-icon[data-v-6f814e5e]{font-size:16px}.validation-errors .error-header .error-close[data-v-6f814e5e]{margin-left:auto;background:none;border:none;color:var(--error-color);cursor:pointer;font-size:14px;padding:2px;opacity:.7}.validation-errors .error-header .error-close[data-v-6f814e5e]:hover{opacity:1}.validation-errors .error-list[data-v-6f814e5e]{margin:0;padding-left:var(--spacing-lg)}.validation-errors .error-list li[data-v-6f814e5e]{font-size:var(--font-sm);color:var(--error-color);line-height:1.6}.prompt-preview-overlay[data-v-6f814e5e]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:10030;padding:var(--spacing-md);overflow-y:auto}.prompt-preview-modal[data-v-6f814e5e]{width:100%;max-width:800px;max-height:calc(100vh - 32px);max-height:calc(100dvh - 32px);background:var(--bg-secondary);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);display:flex;flex-direction:column;overflow:hidden;margin:auto}.prompt-preview-modal .modal-header[data-v-6f814e5e]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md) var(--spacing-lg);background:linear-gradient(135deg,var(--primary-color),var(--primary-hover));color:#fff}.prompt-preview-modal .modal-header .modal-title[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-sm)}.prompt-preview-modal .modal-header .modal-title .modal-icon[data-v-6f814e5e]{font-size:20px}.prompt-preview-modal .modal-header .modal-title h3[data-v-6f814e5e]{margin:0;font-size:var(--font-lg);font-weight:600}.prompt-preview-modal .modal-header .modal-close[data-v-6f814e5e]{background:hsla(0,0%,100%,.2);border:none;color:#fff;width:32px;height:32px;border-radius:var(--radius-sm);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all var(--transition-fast)}.prompt-preview-modal .modal-header .modal-close[data-v-6f814e5e]:hover{background:hsla(0,0%,100%,.3)}.prompt-preview-modal .modal-body[data-v-6f814e5e]{flex:1;padding:var(--spacing-md);overflow-y:auto;display:flex;flex-direction:column;gap:var(--spacing-sm);min-height:0}.prompt-preview-modal .modal-body .prompt-info[data-v-6f814e5e]{display:flex;align-items:flex-start;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);background:var(--info-light);border:1px solid var(--info-color);border-radius:var(--radius-sm);color:var(--info-color);font-size:var(--font-sm);flex-shrink:0}.prompt-preview-modal .modal-body .prompt-info .info-icon[data-v-6f814e5e]{flex-shrink:0;font-size:16px}.prompt-preview-modal .modal-body .prompt-info .info-text[data-v-6f814e5e]{line-height:1.5}.prompt-preview-modal .modal-body .prompt-content-wrapper[data-v-6f814e5e]{flex:1;min-height:150px;display:flex;flex-direction:column}.prompt-preview-modal .modal-body .prompt-textarea[data-v-6f814e5e]{width:100%;flex:1;min-height:150px;padding:var(--spacing-md);border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:var(--font-sm);font-family:"Consolas","Monaco",monospace;line-height:1.6;color:var(--text-color);background:var(--bg-color);resize:vertical}.prompt-preview-modal .modal-body .prompt-textarea[data-v-6f814e5e]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px var(--primary-light)}.prompt-preview-modal .modal-body .prompt-stats[data-v-6f814e5e]{display:flex;gap:var(--spacing-lg);padding-top:var(--spacing-sm);border-top:1px solid var(--border-light);flex-shrink:0}.prompt-preview-modal .modal-body .prompt-stats .stat-item[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-xs);font-size:var(--font-sm);color:var(--text-secondary)}.prompt-preview-modal .modal-body .prompt-stats .stat-item .stat-icon[data-v-6f814e5e]{font-size:14px}.prompt-preview-modal .modal-footer[data-v-6f814e5e]{display:flex;align-items:center;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border-top:1px solid var(--border-color);flex-shrink:0}@media (max-height:600px){.prompt-preview-overlay[data-v-6f814e5e]{padding:var(--spacing-xs);align-items:flex-start}.prompt-preview-modal[data-v-6f814e5e]{max-height:calc(100vh - 16px);max-height:calc(100dvh - 16px);border-radius:var(--radius-md)}.prompt-preview-modal .modal-header[data-v-6f814e5e]{padding:var(--spacing-sm) var(--spacing-md)}.prompt-preview-modal .modal-header .modal-title h3[data-v-6f814e5e]{font-size:var(--font-md)}.prompt-preview-modal .modal-body[data-v-6f814e5e]{padding:var(--spacing-sm)}.prompt-preview-modal .modal-body .prompt-content-wrapper[data-v-6f814e5e]{min-height:100px}.prompt-preview-modal .modal-body .prompt-textarea[data-v-6f814e5e]{min-height:100px;padding:var(--spacing-sm);font-size:var(--font-xs)}.prompt-preview-modal .modal-footer[data-v-6f814e5e]{padding:var(--spacing-xs) var(--spacing-sm)}.prompt-preview-modal .modal-footer .btn[data-v-6f814e5e]{padding:var(--spacing-xs) var(--spacing-sm);font-size:var(--font-xs)}}@media (max-height:400px){.prompt-preview-modal[data-v-6f814e5e]{max-height:calc(100vh - 8px);max-height:calc(100dvh - 8px)}.prompt-preview-modal .modal-header[data-v-6f814e5e]{padding:var(--spacing-xs) var(--spacing-sm)}.prompt-preview-modal .modal-header .modal-close[data-v-6f814e5e]{width:24px;height:24px;font-size:12px}.prompt-preview-modal .modal-body[data-v-6f814e5e]{padding:var(--spacing-xs);gap:var(--spacing-xs)}.prompt-preview-modal .modal-body .prompt-info[data-v-6f814e5e]{padding:var(--spacing-xs);font-size:var(--font-xs)}.prompt-preview-modal .modal-body .prompt-content-wrapper[data-v-6f814e5e]{min-height:80px}.prompt-preview-modal .modal-body .prompt-textarea[data-v-6f814e5e]{min-height:80px}.prompt-preview-modal .modal-body .prompt-stats[data-v-6f814e5e]{padding-top:var(--spacing-xs);gap:var(--spacing-sm)}.prompt-preview-modal .modal-body .prompt-stats .stat-item[data-v-6f814e5e]{font-size:var(--font-xs)}}.slide-enter-active[data-v-6f814e5e],.slide-leave-active[data-v-6f814e5e]{transition:all .3s ease}.slide-enter-from[data-v-6f814e5e],.slide-leave-to[data-v-6f814e5e]{opacity:0;max-height:0;overflow:hidden}.slide-enter-to[data-v-6f814e5e],.slide-leave-from[data-v-6f814e5e]{opacity:1;max-height:500px}.slide-up-enter-active[data-v-6f814e5e],.slide-up-leave-active[data-v-6f814e5e]{transition:all .3s ease}.slide-up-enter-from[data-v-6f814e5e],.slide-up-leave-to[data-v-6f814e5e]{opacity:0;transform:translateY(20px)}.modal-enter-active[data-v-6f814e5e],.modal-leave-active[data-v-6f814e5e]{transition:all .3s ease}.modal-enter-from[data-v-6f814e5e],.modal-leave-to[data-v-6f814e5e]{opacity:0}.modal-enter-from .prompt-preview-modal[data-v-6f814e5e],.modal-leave-to .prompt-preview-modal[data-v-6f814e5e]{transform:scale(0.9) translateY(20px)}@media (max-width:768px){.prompt-preview-modal[data-v-6f814e5e]{max-height:95vh;margin:var(--spacing-sm)}.form-row-2col[data-v-6f814e5e]{grid-template-columns:1fr}}@media (max-width:480px){.panel-body[data-v-6f814e5e]{padding:var(--spacing-sm)}.section-content[data-v-6f814e5e]{padding:var(--spacing-sm)}.panel-footer[data-v-6f814e5e]{padding:var(--spacing-xs) var(--spacing-sm);gap:var(--spacing-xs);justify-content:center}.panel-footer .footer-left[data-v-6f814e5e],.panel-footer .footer-right[data-v-6f814e5e]{gap:var(--spacing-xs)}.btn[data-v-6f814e5e]{padding:var(--spacing-xs) var(--spacing-sm);font-size:var(--font-xs)}.btn .btn-icon[data-v-6f814e5e]{font-size:12px}.scene-type-selector[data-v-6f814e5e]{grid-template-columns:repeat(auto-fill,minmax(70px,1fr))}}@media (max-width:360px){.panel-footer[data-v-6f814e5e]{flex-direction:column;padding:var(--spacing-xs);gap:var(--spacing-xs)}.panel-footer .footer-left[data-v-6f814e5e],.panel-footer .footer-right[data-v-6f814e5e]{width:100%;justify-content:center}.btn[data-v-6f814e5e]{padding:var(--spacing-xs);font-size:var(--font-xs)}.btn .btn-icon[data-v-6f814e5e]{font-size:11px}}.header-actions[data-v-6f814e5e]{margin-left:auto}.preset-btn[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:hsla(0,0%,100%,.2);border:1px solid hsla(0,0%,100%,.3);border-radius:var(--radius-sm);color:#fff;font-size:var(--font-sm);cursor:pointer;transition:all var(--transition-fast)}.preset-btn[data-v-6f814e5e]:hover{background:hsla(0,0%,100%,.3);border-color:hsla(0,0%,100%,.5)}.preset-btn .preset-icon[data-v-6f814e5e]{font-size:14px}.preset-btn .preset-text[data-v-6f814e5e]{font-weight:500}.preset-btn .preset-count[data-v-6f814e5e]{background:hsla(0,0%,100%,.3);padding:1px 6px;border-radius:var(--radius-xs);font-size:var(--font-xs);font-weight:600}.btn-success[data-v-6f814e5e]{background:linear-gradient(135deg,var(--success-color),#28a745);color:#fff}.btn-success[data-v-6f814e5e]:hover:not(:disabled){filter:brightness(1.1)}.btn-danger[data-v-6f814e5e]{background:linear-gradient(135deg,var(--error-color),#dc3545);color:#fff}.btn-danger[data-v-6f814e5e]:hover:not(:disabled){filter:brightness(1.1)}.preset-panel-overlay[data-v-6f814e5e],.save-preset-overlay[data-v-6f814e5e],.delete-confirm-overlay[data-v-6f814e5e]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:10030;padding:var(--spacing-md);overflow-y:auto}.preset-panel-modal[data-v-6f814e5e]{width:100%;max-width:600px;max-height:calc(100vh - 32px);max-height:calc(100dvh - 32px);background:var(--bg-secondary);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);display:flex;flex-direction:column;overflow:hidden;margin:auto}.save-preset-modal[data-v-6f814e5e],.delete-confirm-modal[data-v-6f814e5e]{width:100%;max-width:400px;background:var(--bg-secondary);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);display:flex;flex-direction:column;overflow:hidden;margin:auto}.preset-info[data-v-6f814e5e]{display:flex;align-items:flex-start;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);background:var(--info-light);border:1px solid var(--info-color);border-radius:var(--radius-sm);color:var(--info-color);font-size:var(--font-sm);margin-bottom:var(--spacing-md)}.preset-info .info-icon[data-v-6f814e5e]{flex-shrink:0;font-size:16px}.preset-info .info-text[data-v-6f814e5e]{line-height:1.5}.preset-list[data-v-6f814e5e]{display:flex;flex-direction:column;gap:var(--spacing-md);max-height:400px;overflow-y:auto}.preset-group[data-v-6f814e5e]{background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-md);overflow:hidden}.preset-group .group-header[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border-bottom:1px solid var(--border-color)}.preset-group .group-header .group-icon[data-v-6f814e5e]{font-size:14px}.preset-group .group-header .group-title[data-v-6f814e5e]{font-size:var(--font-sm);font-weight:600;color:var(--text-color)}.preset-group .group-header .group-count[data-v-6f814e5e]{margin-left:auto;background:var(--primary-light);color:var(--primary-color);padding:2px 8px;border-radius:var(--radius-xs);font-size:var(--font-xs);font-weight:600}.preset-group .group-items[data-v-6f814e5e]{padding:var(--spacing-sm);display:flex;flex-direction:column;gap:var(--spacing-xs)}.preset-group .group-empty[data-v-6f814e5e]{display:flex;flex-direction:column;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-lg);color:var(--text-disabled)}.preset-group .group-empty .empty-icon[data-v-6f814e5e]{font-size:32px;opacity:.5}.preset-group .group-empty .empty-text[data-v-6f814e5e]{font-size:var(--font-sm);text-align:center}.preset-item[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast)}.preset-item[data-v-6f814e5e]:hover{border-color:var(--primary-color);background:var(--primary-light)}.preset-item.active[data-v-6f814e5e]{border-color:var(--primary-color);background:var(--primary-light)}.preset-item.active .preset-item-name[data-v-6f814e5e]{color:var(--primary-color)}.preset-item .preset-item-icon[data-v-6f814e5e]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--bg-tertiary);border-radius:var(--radius-sm);font-size:20px;flex-shrink:0}.preset-item .preset-item-content[data-v-6f814e5e]{flex:1;min-width:0}.preset-item .preset-item-content .preset-item-name[data-v-6f814e5e]{font-size:var(--font-sm);font-weight:600;color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.preset-item .preset-item-content .preset-item-desc[data-v-6f814e5e]{font-size:var(--font-xs);color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px}.preset-item .preset-item-content .preset-item-meta[data-v-6f814e5e]{display:flex;gap:var(--spacing-sm);margin-top:4px}.preset-item .preset-item-content .preset-item-meta .meta-date[data-v-6f814e5e]{font-size:var(--font-xs);color:var(--text-disabled)}.preset-item .preset-item-badge[data-v-6f814e5e]{padding:2px 8px;border-radius:var(--radius-xs);font-size:var(--font-xs);font-weight:600;flex-shrink:0}.preset-item .preset-item-badge.builtin[data-v-6f814e5e]{background:var(--info-light);color:var(--info-color)}.preset-item .preset-item-actions[data-v-6f814e5e]{display:flex;gap:var(--spacing-xs);flex-shrink:0}.preset-item .preset-item-actions .action-btn[data-v-6f814e5e]{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:14px;cursor:pointer;transition:all var(--transition-fast)}.preset-item .preset-item-actions .action-btn[data-v-6f814e5e]:hover{background:var(--bg-hover);border-color:var(--primary-color)}.preset-item .preset-item-actions .action-btn.danger[data-v-6f814e5e]:hover{background:var(--error-light);border-color:var(--error-color)}.error-message[data-v-6f814e5e]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);background:var(--error-light);border:1px solid var(--error-color);border-radius:var(--radius-sm);color:var(--error-color);font-size:var(--font-sm);margin-top:var(--spacing-sm)}.error-message .error-icon[data-v-6f814e5e]{flex-shrink:0;font-size:14px}.confirm-text[data-v-6f814e5e]{font-size:var(--font-sm);color:var(--text-color);line-height:1.6;margin:0;text-align:center;padding:var(--spacing-md)}.modal-header.danger[data-v-6f814e5e]{background:linear-gradient(135deg,var(--error-color),#dc3545)}@media (max-width:480px){.preset-panel-modal[data-v-6f814e5e]{max-width:100%;margin:var(--spacing-sm)}.preset-item[data-v-6f814e5e]{flex-wrap:wrap}.preset-item .preset-item-actions[data-v-6f814e5e]{width:100%;justify-content:flex-end;margin-top:var(--spacing-xs);padding-top:var(--spacing-xs);border-top:1px solid var(--border-light)}.preset-btn .preset-text[data-v-6f814e5e]{display:none}}
.main-content[data-v-37c016ce]{flex:1;display:flex;flex-direction:column;overflow:hidden;min-height:0;background:var(--bg-color)}.game-text-container[data-v-37c016ce]{flex:1;display:flex;flex-direction:column;overflow:hidden;padding:var(--spacing-md)}.processing-state[data-v-37c016ce]{flex:1;display:flex;align-items:center;justify-content:center}.thinking-panel[data-v-37c016ce]{text-align:center;padding:var(--spacing-xl)}.thinking-animation[data-v-37c016ce]{display:flex;justify-content:center;gap:8px;margin-bottom:var(--spacing-md)}.thinking-animation .thinking-dot[data-v-37c016ce]{width:12px;height:12px;background:var(--primary-color);border-radius:50%;animation:thinkingPulse-37c016ce 1.4s ease-in-out infinite}.thinking-animation .thinking-dot[data-v-37c016ce]:nth-child(1){animation-delay:0s}.thinking-animation .thinking-dot[data-v-37c016ce]:nth-child(2){animation-delay:.2s}.thinking-animation .thinking-dot[data-v-37c016ce]:nth-child(3){animation-delay:.4s}@keyframes thinkingPulse-37c016ce{0%,80%,100%{transform:scale(0.6);opacity:.5}40%{transform:scale(1);opacity:1}}.thinking-text[data-v-37c016ce]{font-size:var(--font-md);color:var(--text-secondary);margin:0}.content-display[data-v-37c016ce]{flex:1;display:flex;flex-direction:column;overflow-y:auto;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md)}.content-header[data-v-37c016ce]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-sm) var(--spacing-md);border-bottom:1px solid var(--border-color);background:var(--bg-tertiary);flex-shrink:0}.content-meta[data-v-37c016ce]{display:flex;align-items:center;gap:var(--spacing-md)}.content-meta .meta-item[data-v-37c016ce]{display:flex;align-items:center;gap:var(--spacing-xs);font-size:var(--font-xs);color:var(--text-disabled)}.content-meta .meta-item .meta-icon[data-v-37c016ce]{font-size:12px}.content-meta .streaming-badge[data-v-37c016ce]{color:var(--primary-color)}.content-meta .streaming-badge .streaming-dot[data-v-37c016ce]{display:inline-block;width:6px;height:6px;background:var(--primary-color);border-radius:50%;animation:streamingBlink-37c016ce 1s ease-in-out infinite}.version-badge .version-tag[data-v-37c016ce]{display:inline-block;padding:2px 8px;font-size:10px;font-family:monospace;font-weight:500;color:var(--text-disabled);background:var(--bg-color);border:1px solid var(--border-color);border-radius:3px;white-space:nowrap}@keyframes streamingBlink-37c016ce{0%,100%{opacity:1}50%{opacity:.3}}.game-text[data-v-37c016ce]{flex:1;padding:var(--spacing-lg);overflow-y:auto}.game-text[data-v-37c016ce] .content-block-renderer{font-size:var(--font-md);line-height:1.8;color:var(--text-color)}[data-v-37c016ce] .variable-changes-panel{margin-top:auto;border-radius:0;border-left:none;border-right:none;border-bottom:none}@media (max-width:768px){.game-text-container[data-v-37c016ce]{padding:var(--spacing-sm)}.content-header[data-v-37c016ce]{flex-direction:row;justify-content:space-between;align-items:center;padding:var(--spacing-xs) var(--spacing-sm)}.content-meta[data-v-37c016ce]{gap:var(--spacing-sm)}.content-meta .meta-item[data-v-37c016ce]{font-size:11px}.version-badge .version-tag[data-v-37c016ce]{padding:1px 6px;font-size:9px}.game-text[data-v-37c016ce]{padding:var(--spacing-md)}.text-content[data-v-37c016ce]{font-size:var(--font-sm)}}
.bottom-bar[data-v-1712b424]{display:flex;flex-direction:column;gap:0;padding:0;background:var(--bg-secondary);border-top:1px solid var(--border-color);flex-shrink:0;position:relative;z-index:50}.history-panel[data-v-1712b424]{background:var(--bg-color);border-bottom:1px solid var(--border-color);max-height:300px;display:flex;flex-direction:column}.history-header[data-v-1712b424]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-secondary);border-bottom:1px solid var(--border-color)}.history-header .history-title[data-v-1712b424]{font-size:var(--font-sm);font-weight:500;color:var(--text-color)}.history-header .history-count[data-v-1712b424]{font-size:var(--font-xs);color:var(--text-secondary);background:var(--bg-tertiary);padding:2px 8px;border-radius:var(--radius-sm)}.history-header .history-actions[data-v-1712b424]{margin-left:auto;display:flex;gap:var(--spacing-xs)}.history-header .history-clear-btn[data-v-1712b424],.history-header .history-close-btn[data-v-1712b424]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;border-radius:var(--radius-xs);cursor:pointer;font-size:12px;color:var(--text-secondary)}.history-header .history-clear-btn[data-v-1712b424]:hover,.history-header .history-close-btn[data-v-1712b424]:hover{background:var(--bg-tertiary);color:var(--text-color)}.history-header .history-clear-btn[data-v-1712b424]:hover{color:var(--error-color)}.history-search[data-v-1712b424]{padding:var(--spacing-xs) var(--spacing-md);border-bottom:1px solid var(--border-color)}.history-search .history-search-input[data-v-1712b424]{width:100%;padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-color);font-size:var(--font-xs);outline:none}.history-search .history-search-input[data-v-1712b424]:focus{border-color:var(--primary-color)}.history-search .history-search-input[data-v-1712b424]::placeholder{color:var(--text-disabled)}.history-list[data-v-1712b424]{flex:1;overflow-y:auto;padding:var(--spacing-xs) 0}.history-item[data-v-1712b424]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-xs) var(--spacing-md);cursor:pointer;transition:background var(--transition-fast)}.history-item[data-v-1712b424]:hover{background:var(--bg-secondary)}.history-item:hover .history-delete-btn[data-v-1712b424]{opacity:1}.history-item.is-active[data-v-1712b424]{background:rgba(var(--primary-color-rgb),0.1);border-left:3px solid var(--primary-color);padding-left:calc(var(--spacing-md) - 3px)}.history-item .history-content[data-v-1712b424]{flex:1;font-size:var(--font-xs);color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.history-item .history-time[data-v-1712b424]{font-size:10px;color:var(--text-disabled);flex-shrink:0}.history-item .history-delete-btn[data-v-1712b424]{width:20px;height:20px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;border-radius:var(--radius-xs);cursor:pointer;font-size:10px;color:var(--text-secondary);opacity:0;transition:all var(--transition-fast)}.history-item .history-delete-btn[data-v-1712b424]:hover{background:rgba(var(--error-color-rgb),0.1);color:var(--error-color)}.history-empty[data-v-1712b424]{padding:var(--spacing-lg);text-align:center;color:var(--text-disabled);font-size:var(--font-xs)}.input-area[data-v-1712b424]{flex:1;min-width:0;display:flex;flex-direction:column;gap:var(--spacing-xs);padding:var(--spacing-sm) var(--spacing-md)}.input-container[data-v-1712b424]{display:flex;align-items:flex-end;gap:var(--spacing-sm);background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-md);padding:var(--spacing-xs);transition:border-color var(--transition-fast),box-shadow var(--transition-fast)}.input-container[data-v-1712b424]:focus-within{border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(var(--primary-color-rgb),0.1)}.input-container.is-loading[data-v-1712b424]{opacity:.7;border-color:var(--border-color)}.input-container.has-error[data-v-1712b424]{border-color:var(--error-color)}.history-toggle-btn[data-v-1712b424]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:1px solid var(--border-color);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast);flex-shrink:0}.history-toggle-btn .history-icon[data-v-1712b424]{font-size:16px}.history-toggle-btn[data-v-1712b424]:hover{background:var(--bg-secondary);border-color:var(--primary-color)}.history-toggle-btn.is-active[data-v-1712b424]{background:rgba(var(--primary-color-rgb),0.1);border-color:var(--primary-color)}.history-toggle-btn[data-v-1712b424]:not(.has-history){opacity:.5}.history-toggle-btn[data-v-1712b424]:not(.has-history):hover{opacity:.7}.message-input[data-v-1712b424]{flex:1;min-height:36px;max-height:120px;padding:var(--spacing-xs) var(--spacing-sm);background:rgba(0,0,0,0);border:none;color:var(--text-color);font-size:var(--font-sm);line-height:1.5;resize:none;outline:none}.message-input[data-v-1712b424]::placeholder{color:var(--text-disabled)}.message-input[data-v-1712b424]:disabled{opacity:.6;cursor:not-allowed}.send-btn[data-v-1712b424]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--primary-color);border:none;border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast);flex-shrink:0}.send-btn .send-icon[data-v-1712b424],.send-btn .loading-icon[data-v-1712b424]{font-size:16px}.send-btn[data-v-1712b424]:hover:not(:disabled){background:var(--primary-hover);transform:scale(1.05)}.send-btn[data-v-1712b424]:active:not(:disabled){transform:scale(0.95)}.send-btn[data-v-1712b424]:disabled{background:var(--bg-tertiary);cursor:not-allowed;opacity:.6}.send-btn.is-loading[data-v-1712b424]{animation:pulse-1712b424 1.5s infinite}@keyframes pulse-1712b424{0%,100%{opacity:1}50%{opacity:.6}}.navigation-hint[data-v-1712b424]{display:flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:rgba(var(--primary-color-rgb),0.1);border-radius:var(--radius-sm);font-size:var(--font-xs);color:var(--primary-color)}.navigation-hint .hint-icon[data-v-1712b424]{font-size:12px}.navigation-hint .hint-text[data-v-1712b424]{flex:1}.navigation-hint .hint-cancel[data-v-1712b424]{width:16px;height:16px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;border-radius:var(--radius-xs);cursor:pointer;font-size:10px;color:var(--primary-color)}.navigation-hint .hint-cancel[data-v-1712b424]:hover{background:rgba(var(--primary-color-rgb),0.2)}.error-message[data-v-1712b424]{display:flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:rgba(var(--error-color-rgb),0.1);border-radius:var(--radius-sm);color:var(--error-color);font-size:var(--font-xs)}.error-message .error-icon[data-v-1712b424]{flex-shrink:0}.error-message .error-text[data-v-1712b424]{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.error-message .error-dismiss[data-v-1712b424]{width:20px;height:20px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--error-color);cursor:pointer;border-radius:var(--radius-xs)}.error-message .error-dismiss[data-v-1712b424]:hover{background:rgba(var(--error-color-rgb),0.2)}.slide-up-enter-active[data-v-1712b424],.slide-up-leave-active[data-v-1712b424]{transition:all .2s ease}.slide-up-enter-from[data-v-1712b424],.slide-up-leave-to[data-v-1712b424]{opacity:0;max-height:0;transform:translateY(10px)}.slide-up-enter-to[data-v-1712b424],.slide-up-leave-from[data-v-1712b424]{opacity:1;max-height:300px;transform:translateY(0)}@media (max-width:768px){.bottom-bar[data-v-1712b424]{flex-direction:column}.input-area[data-v-1712b424]{padding:var(--spacing-sm);padding-bottom:calc(var(--spacing-sm) + env(safe-area-inset-bottom,0px))}.input-container[data-v-1712b424]{padding:var(--spacing-sm)}.message-input[data-v-1712b424]{font-size:16px}.send-btn[data-v-1712b424],.history-toggle-btn[data-v-1712b424]{width:44px;height:44px}.send-btn .send-icon[data-v-1712b424],.send-btn .loading-icon[data-v-1712b424],.send-btn .history-icon[data-v-1712b424],.history-toggle-btn .send-icon[data-v-1712b424],.history-toggle-btn .loading-icon[data-v-1712b424],.history-toggle-btn .history-icon[data-v-1712b424]{font-size:18px}.history-panel[data-v-1712b424]{max-height:250px}}
.sidebar[data-v-75b31306]{display:flex;flex-direction:column;width:280px;height:100%;background:var(--bg-secondary);border-left:1px solid var(--border-color);transition:width var(--transition-normal),transform var(--transition-normal);flex-shrink:0;position:relative;overflow:hidden}.sidebar.is-collapsed[data-v-75b31306]{width:60px}.sidebar.is-collapsed .nav-item[data-v-75b31306]{justify-content:center;padding:var(--spacing-md)}.mobile-close-btn[data-v-75b31306]{display:none;position:absolute;right:var(--spacing-sm);top:var(--spacing-sm);width:36px;height:36px;align-items:center;justify-content:center;background:var(--bg-hover);border:1px solid var(--border-color);border-radius:var(--radius-sm);cursor:pointer;z-index:11;transition:all var(--transition-fast)}.mobile-close-btn .close-icon[data-v-75b31306]{font-size:18px;color:var(--text-secondary)}.mobile-close-btn[data-v-75b31306]:hover{background:var(--bg-tertiary)}.mobile-close-btn:hover .close-icon[data-v-75b31306]{color:var(--text-color)}.collapse-btn[data-v-75b31306]{position:absolute;left:-12px;top:50%;transform:translateY(-50%);width:24px;height:48px;display:flex;align-items:center;justify-content:center;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-sm) 0 0 var(--radius-sm);cursor:pointer;z-index:10;transition:all var(--transition-fast)}.collapse-btn .collapse-icon[data-v-75b31306]{font-size:10px;color:var(--text-secondary)}.collapse-btn[data-v-75b31306]:hover{background:var(--bg-hover);border-color:var(--border-hover)}.collapse-btn:hover .collapse-icon[data-v-75b31306]{color:var(--text-color)}.nav-menu[data-v-75b31306]{padding:var(--spacing-sm);flex-shrink:0}.nav-item[data-v-75b31306]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);margin-bottom:var(--spacing-xs);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast);position:relative}.nav-item .nav-icon[data-v-75b31306]{font-size:16px;flex-shrink:0}.nav-item .nav-label[data-v-75b31306]{font-size:var(--font-sm);color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.nav-item .lite-tag[data-v-75b31306]{margin-left:auto;padding:1px 4px;font-size:9px;font-weight:500;background:var(--warning-light);color:var(--warning-color);border-radius:3px;opacity:.8}.nav-item[data-v-75b31306]:hover{background:var(--bg-hover)}.nav-item:hover .nav-label[data-v-75b31306]{color:var(--text-highlight)}.nav-item.is-active[data-v-75b31306]{background:var(--primary-light);border-left:3px solid var(--primary-color)}.nav-item.is-active .nav-label[data-v-75b31306]{color:var(--primary-color);font-weight:600}.nav-item.is-disabled[data-v-75b31306]{opacity:.5;cursor:not-allowed}.info-panels[data-v-75b31306]{flex:1;overflow-y:auto;padding:var(--spacing-sm);display:flex;flex-direction:column;gap:var(--spacing-sm)}.info-panel[data-v-75b31306]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);overflow:hidden}.panel-header[data-v-75b31306]{display:flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-tertiary);border-bottom:1px solid var(--border-light)}.panel-header .panel-icon[data-v-75b31306]{font-size:14px}.panel-header .panel-title[data-v-75b31306]{font-size:var(--font-xs);font-weight:600;color:var(--text-color)}.panel-header .panel-count[data-v-75b31306]{margin-left:auto;min-width:18px;height:18px;display:flex;align-items:center;justify-content:center;padding:0 5px;background:var(--primary-light);color:var(--primary-color);font-size:10px;font-weight:600;border-radius:9px}.panel-body[data-v-75b31306]{padding:var(--spacing-xs);max-height:150px;overflow-y:auto}.settings-panel .panel-body[data-v-75b31306]{padding:var(--spacing-sm)}.setting-item[data-v-75b31306]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-xs) 0}.setting-label[data-v-75b31306]{display:flex;align-items:center;gap:var(--spacing-xs)}.setting-label .setting-icon[data-v-75b31306]{font-size:14px}.setting-label .setting-text[data-v-75b31306]{font-size:var(--font-sm);color:var(--text-color)}.setting-hint[data-v-75b31306]{font-size:10px;color:var(--text-muted);margin-top:2px;padding-left:22px}.toggle-switch[data-v-75b31306]{position:relative;display:inline-block;width:40px;height:20px;cursor:pointer}.toggle-switch input[data-v-75b31306]{opacity:0;width:0;height:0}.toggle-switch input:checked+.toggle-slider[data-v-75b31306]{background:var(--primary-color)}.toggle-switch input:checked+.toggle-slider[data-v-75b31306]::before{transform:translateX(20px)}.toggle-switch .toggle-slider[data-v-75b31306]{position:absolute;top:0;left:0;right:0;bottom:0;background:var(--bg-tertiary);border-radius:20px;transition:all var(--transition-fast)}.toggle-switch .toggle-slider[data-v-75b31306]::before{content:"";position:absolute;left:2px;bottom:2px;width:16px;height:16px;background:#fff;border-radius:50%;transition:all var(--transition-fast);box-shadow:0 1px 3px rgba(0,0,0,.2)}.lite-info-panel[data-v-75b31306]{background:var(--warning-light);border:1px solid var(--warning-color)}.lite-notice[data-v-75b31306]{text-align:center;padding:var(--spacing-xs)}.lite-notice p[data-v-75b31306]{margin:0;font-size:var(--font-xs);color:var(--text-color)}.lite-notice p.lite-detail[data-v-75b31306]{font-size:10px;color:var(--text-secondary);margin-top:2px}.sidebar-footer[data-v-75b31306]{padding:var(--spacing-sm);border-top:1px solid var(--border-light);flex-shrink:0}.mobile-settings[data-v-75b31306]{display:none}.divider[data-v-75b31306]{height:1px;background:var(--border-light);margin:var(--spacing-xs) 0}.footer-item[data-v-75b31306]{margin-bottom:var(--spacing-xs)}.footer-item[data-v-75b31306]:last-child{margin-bottom:0}.footer-item .nav-label[data-v-75b31306]{color:var(--text-secondary)}.footer-item:hover .nav-label[data-v-75b31306]{color:var(--text-color)}.footer-item.highlight-item[data-v-75b31306]{background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.2);border-radius:var(--radius-sm);margin-bottom:var(--spacing-xs)}.footer-item.highlight-item .nav-label[data-v-75b31306]{color:var(--primary-color);font-weight:500}.footer-item.highlight-item[data-v-75b31306]:hover{background:rgba(99,102,241,.2);border-color:rgba(99,102,241,.4)}.footer-item.highlight-item.secondary[data-v-75b31306]{background:rgba(59,130,246,.08);border:1px solid rgba(59,130,246,.15)}.footer-item.highlight-item.secondary .nav-label[data-v-75b31306]{color:#3b82f6;font-weight:500}.footer-item.highlight-item.secondary[data-v-75b31306]:hover{background:rgba(59,130,246,.15);border-color:rgba(59,130,246,.3)}.footer-item.highlight-item.dev-tool[data-v-75b31306]{background:rgba(245,158,11,.08);border:1px solid rgba(245,158,11,.15)}.footer-item.highlight-item.dev-tool .nav-label[data-v-75b31306]{color:#f59e0b;font-weight:500}.footer-item.highlight-item.dev-tool[data-v-75b31306]:hover{background:rgba(245,158,11,.15);border-color:rgba(245,158,11,.3)}.footer-item.debug-item[data-v-75b31306]{border-top:1px dashed var(--border-light);padding-top:var(--spacing-sm);margin-top:var(--spacing-sm)}.footer-item.debug-item .nav-icon[data-v-75b31306]{opacity:.7}.footer-item.debug-item .nav-label[data-v-75b31306]{color:var(--text-muted);font-size:11px}.footer-item.debug-item:hover .nav-icon[data-v-75b31306]{opacity:1}.footer-item.debug-item:hover .nav-label[data-v-75b31306]{color:var(--text-secondary)}@media (max-width:768px){.sidebar[data-v-75b31306]{position:fixed;right:8px;top:50%;transform:translateY(-50%) translateX(calc(100% + 16px));bottom:auto;width:auto;min-width:150px;max-width:200px;height:auto;max-height:80vh;z-index:100;box-shadow:var(--shadow-lg);transition:transform var(--transition-normal);border:1px solid var(--border-color);border-radius:var(--radius-md);padding:var(--spacing-xs) 0}.sidebar.is-visible[data-v-75b31306]{transform:translateY(-50%) translateX(0)}.sidebar.is-collapsed[data-v-75b31306]{width:auto;min-width:150px;max-width:200px}.sidebar.is-collapsed .nav-item[data-v-75b31306]{justify-content:flex-start;padding:var(--spacing-xs) var(--spacing-sm)}.sidebar.is-collapsed .nav-label[data-v-75b31306],.sidebar.is-collapsed .lite-tag[data-v-75b31306]{display:inline}.desktop-only[data-v-75b31306]{display:none !important}.mobile-settings[data-v-75b31306]{display:block;padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-tertiary);border-radius:var(--radius-xs);margin:0 var(--spacing-xs) var(--spacing-xs)}.mobile-setting-item[data-v-75b31306]{display:flex;align-items:center;gap:var(--spacing-xs)}.mobile-setting-item .setting-icon[data-v-75b31306]{font-size:12px}.mobile-setting-item .setting-text[data-v-75b31306]{font-size:11px;color:var(--text-color);flex:1}.toggle-switch.small[data-v-75b31306]{width:32px;height:16px}.toggle-switch.small .toggle-slider[data-v-75b31306]::before{width:12px;height:12px;left:2px;bottom:2px}.toggle-switch.small input:checked+.toggle-slider[data-v-75b31306]::before{transform:translateX(16px)}.mobile-close-btn[data-v-75b31306]{display:flex;position:relative;right:auto;top:auto;width:28px;height:28px;margin:var(--spacing-xs) auto var(--spacing-xs)}.mobile-close-btn .close-icon[data-v-75b31306]{font-size:14px}.collapse-btn[data-v-75b31306]{display:none}.nav-menu[data-v-75b31306]{padding:var(--spacing-xs);padding-top:0}.nav-item[data-v-75b31306]{padding:var(--spacing-xs) var(--spacing-sm);margin-bottom:2px}.nav-item .nav-icon[data-v-75b31306]{font-size:14px}.nav-item .nav-label[data-v-75b31306]{font-size:var(--font-xs);white-space:nowrap}.nav-item .lite-tag[data-v-75b31306]{font-size:8px;padding:1px 3px}.sidebar-footer[data-v-75b31306]{padding:var(--spacing-xs);border-top:none}.footer-item[data-v-75b31306]{padding:var(--spacing-xs) var(--spacing-sm);margin-bottom:2px}.footer-item .nav-icon[data-v-75b31306]{font-size:12px}.footer-item .nav-label[data-v-75b31306]{font-size:11px;white-space:nowrap}.footer-item.highlight-item[data-v-75b31306]{padding:var(--spacing-xs) var(--spacing-sm)}.footer-item.highlight-item.secondary[data-v-75b31306]{background:rgba(59,130,246,.12);border-color:rgba(59,130,246,.25)}.footer-item.debug-item[data-v-75b31306]{padding-top:var(--spacing-xs);margin-top:var(--spacing-xs)}.divider[data-v-75b31306]{margin:2px 0}}@media (max-width:480px){.sidebar[data-v-75b31306]{right:4px;min-width:130px;max-width:170px;max-height:75vh;border-radius:var(--radius-sm)}.mobile-settings[data-v-75b31306]{padding:var(--spacing-xs);margin:0 var(--spacing-xs) var(--spacing-xs)}.mobile-setting-item .setting-icon[data-v-75b31306]{font-size:11px}.mobile-setting-item .setting-text[data-v-75b31306]{font-size:10px}.toggle-switch.small[data-v-75b31306]{width:28px;height:14px}.toggle-switch.small .toggle-slider[data-v-75b31306]::before{width:10px;height:10px;left:2px;bottom:2px}.toggle-switch.small input:checked+.toggle-slider[data-v-75b31306]::before{transform:translateX(14px)}.nav-item[data-v-75b31306]{padding:var(--spacing-xs) var(--spacing-xs)}.nav-item .nav-icon[data-v-75b31306]{font-size:13px}.nav-item .nav-label[data-v-75b31306]{font-size:11px}.footer-item .nav-icon[data-v-75b31306]{font-size:11px}.footer-item .nav-label[data-v-75b31306]{font-size:10px}.footer-item.highlight-item[data-v-75b31306]{padding:var(--spacing-xs)}.footer-item.highlight-item.secondary .nav-icon[data-v-75b31306]{font-size:12px}}
.schema-field[data-v-7e8ff355]{display:flex;flex-direction:column;gap:6px;padding:8px 10px;background:var(--bg-secondary);border-radius:6px;border:1px solid var(--border-color)}.field-label[data-v-7e8ff355]{font-size:11px;font-weight:500;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.3px}.field-value[data-v-7e8ff355]{font-size:14px;color:var(--text-color);line-height:1.4}.value-text[data-v-7e8ff355]{word-break:break-word}.text-content[data-v-7e8ff355]{margin:0;white-space:pre-wrap;line-height:1.6}.enum-badge[data-v-7e8ff355]{display:inline-block;padding:3px 10px;background:var(--primary-light);color:var(--primary-color);border-radius:4px;font-size:12px;font-weight:500}.tags-container[data-v-7e8ff355]{display:flex;flex-wrap:wrap;gap:4px}.tag[data-v-7e8ff355]{display:inline-block;padding:3px 10px;background:var(--bg-tertiary);color:var(--text-color);border-radius:12px;font-size:12px;border:1px solid var(--border-color)}.empty-tags[data-v-7e8ff355]{color:var(--text-disabled);font-style:italic;font-size:13px}.boolean-value[data-v-7e8ff355]{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:4px;font-size:13px;font-weight:500}.boolean-value .boolean-icon[data-v-7e8ff355]{font-size:12px}.boolean-value.is-true[data-v-7e8ff355]{background:var(--success-light);color:var(--success-color)}.boolean-value.is-false[data-v-7e8ff355]{background:var(--bg-tertiary);color:var(--text-secondary)}.field-type-text .field-value[data-v-7e8ff355]{font-size:13px}.field-type-number .value-text[data-v-7e8ff355]{font-family:"SF Mono",Monaco,Consolas,monospace;font-weight:500}
.roster-panel[data-v-4c76020e]{display:flex;flex-direction:column;height:100%;background:var(--bg-secondary);border-radius:8px;overflow:hidden;color:var(--text-color)}.panel-header[data-v-4c76020e]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border-color);background:var(--bg-tertiary)}.panel-header .header-left[data-v-4c76020e]{display:flex;align-items:center;gap:10px}.panel-header .header-left .panel-icon[data-v-4c76020e]{font-size:20px}.panel-header .header-left h2[data-v-4c76020e]{margin:0;font-size:18px;font-weight:600;color:var(--text-color)}.panel-header .header-right[data-v-4c76020e]{display:flex;align-items:center;gap:12px}.panel-header .header-right .entry-count[data-v-4c76020e]{font-size:14px;color:var(--text-secondary);background:var(--bg-secondary);padding:4px 10px;border-radius:12px}.panel-header .header-right .close-btn[data-v-4c76020e]{background:none;border:none;font-size:18px;cursor:pointer;padding:4px 8px;color:var(--text-secondary);border-radius:4px;transition:all .2s}.panel-header .header-right .close-btn[data-v-4c76020e]:hover{background:var(--bg-hover);color:var(--text-color)}.panel-header .version-badge[data-v-4c76020e]{font-size:10px;padding:2px 6px;background:var(--primary-light);color:var(--primary-color);border-radius:4px;font-weight:600;text-transform:uppercase}.panel-main[data-v-4c76020e]{display:flex;flex:1;overflow:hidden}.category-sidebar[data-v-4c76020e]{width:160px;min-width:160px;background:var(--bg-tertiary);border-right:1px solid var(--border-color);display:flex;flex-direction:column}.category-sidebar .sidebar-header[data-v-4c76020e]{padding:12px;border-bottom:1px solid var(--border-color)}.category-sidebar .sidebar-header .sidebar-title[data-v-4c76020e]{font-size:13px;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.5px}.category-sidebar .category-list[data-v-4c76020e]{flex:1;overflow-y:auto;padding:8px}.category-sidebar .category-item[data-v-4c76020e]{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;margin-bottom:4px;border-radius:6px;cursor:pointer;transition:all .2s;background:rgba(0,0,0,0)}.category-sidebar .category-item .category-name[data-v-4c76020e]{font-size:13px;color:var(--text-color)}.category-sidebar .category-item .category-count[data-v-4c76020e]{font-size:12px;color:var(--text-secondary);background:var(--bg-secondary);padding:2px 8px;border-radius:10px}.category-sidebar .category-item[data-v-4c76020e]:hover{background:var(--bg-hover)}.category-sidebar .category-item.active[data-v-4c76020e]{background:var(--primary-light)}.category-sidebar .category-item.active .category-name[data-v-4c76020e]{color:var(--primary-color);font-weight:600}.category-sidebar .category-item.active .category-count[data-v-4c76020e]{background:var(--primary-color);color:#fff}.panel-body[data-v-4c76020e]{flex:1;overflow-y:auto;padding:16px;background:var(--bg-color)}.state-container[data-v-4c76020e]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;height:100%}.state-container .state-icon[data-v-4c76020e]{font-size:48px;margin-bottom:16px}.state-container p[data-v-4c76020e]{margin:0 0 8px 0;color:var(--text-secondary);font-size:15px}.state-container .empty-hint[data-v-4c76020e]{font-size:13px;color:var(--text-disabled)}.state-container .empty-hint code[data-v-4c76020e]{background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;font-family:monospace;color:var(--text-color)}.state-container .retry-btn[data-v-4c76020e]{margin-top:16px;padding:8px 20px;background:var(--primary-color);color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:14px;transition:background .2s}.state-container .retry-btn[data-v-4c76020e]:hover{background:var(--primary-hover)}.content-area[data-v-4c76020e]{display:flex;flex-direction:column;gap:16px}.group-header[data-v-4c76020e]{display:flex;align-items:center;justify-content:space-between;padding-bottom:12px;border-bottom:2px solid var(--primary-color)}.group-header .group-title[data-v-4c76020e]{margin:0;font-size:18px;color:var(--text-color)}.group-header .group-count[data-v-4c76020e]{font-size:14px;color:var(--text-secondary)}.entry-table[data-v-4c76020e]{background:var(--bg-secondary);border-radius:8px;border:1px solid var(--border-color);overflow:hidden}.table-header[data-v-4c76020e]{display:flex;align-items:center;padding:12px 16px;background:var(--bg-tertiary);border-bottom:1px solid var(--border-color);font-size:13px;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.3px}.table-body[data-v-4c76020e]{max-height:calc(100vh - 320px);overflow-y:auto}.table-row[data-v-4c76020e]{border-bottom:1px solid var(--border-color)}.table-row[data-v-4c76020e]:last-child{border-bottom:none}.table-row.is-expanded[data-v-4c76020e]{background:var(--bg-color)}.row-main[data-v-4c76020e]{display:flex;align-items:center;padding:12px 16px;cursor:pointer;transition:background .2s}.row-main[data-v-4c76020e]:hover{background:var(--bg-hover)}.col-name[data-v-4c76020e]{flex:2;display:flex;align-items:center;gap:12px;min-width:150px}.col-name .person-avatar[data-v-4c76020e]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--primary-light);color:var(--primary-color);border-radius:50%;font-size:14px;font-weight:600}.col-name .person-name[data-v-4c76020e]{font-weight:500;color:var(--text-color)}.col-summary[data-v-4c76020e]{flex:1;min-width:100px}.col-summary .summary-value[data-v-4c76020e]{font-size:13px;color:var(--text-secondary)}.col-action[data-v-4c76020e]{width:80px;text-align:right}.col-action .expand-btn[data-v-4c76020e]{font-size:12px;color:var(--primary-color);cursor:pointer}.col-action .expand-btn[data-v-4c76020e]:hover{text-decoration:underline}.row-details[data-v-4c76020e]{padding:0 16px 16px 16px}.details-content[data-v-4c76020e]{background:var(--bg-tertiary);border-radius:8px;padding:16px}.detail-section[data-v-4c76020e]{margin-bottom:20px}.detail-section[data-v-4c76020e]:last-child{margin-bottom:0}.detail-section .section-title[data-v-4c76020e]{margin:0 0 12px 0;font-size:14px;font-weight:600;color:var(--primary-color);padding-bottom:8px;border-bottom:1px solid var(--border-color)}.field-grid[data-v-4c76020e]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px 16px}@media (max-width:768px){.panel-main[data-v-4c76020e]{flex-direction:column}.category-sidebar[data-v-4c76020e]{width:100%;min-width:auto;flex-direction:row;border-right:none;border-bottom:1px solid var(--border-color)}.category-sidebar .sidebar-header[data-v-4c76020e]{display:none}.category-sidebar .category-list[data-v-4c76020e]{display:flex;flex-wrap:nowrap;overflow-x:auto;padding:8px;gap:8px}.category-sidebar .category-item[data-v-4c76020e]{flex-shrink:0;margin-bottom:0}.table-header[data-v-4c76020e]{display:none}.row-main[data-v-4c76020e]{flex-wrap:wrap;gap:8px}.col-name[data-v-4c76020e]{flex:1 1 100%}.col-summary[data-v-4c76020e]{flex:0 0 auto}.col-action[data-v-4c76020e]{flex:0 0 auto;width:auto}.field-grid[data-v-4c76020e]{grid-template-columns:1fr}}
.tree-node[data-v-644583f3]{margin:8px 0}.node-header[data-v-644583f3]{display:flex;align-items:center;gap:8px;cursor:pointer;padding:4px 8px;border-radius:var(--radius-sm,4px)}.node-header[data-v-644583f3]:hover{background:var(--bg-hover)}.expand-icon[data-v-644583f3],.expand-placeholder[data-v-644583f3]{width:16px;font-size:10px;color:var(--text-secondary);flex-shrink:0}.node-title[data-v-644583f3]{font-weight:600;color:var(--text-color)}.node-content[data-v-644583f3]{margin-top:8px;padding-left:24px;color:var(--text-color);line-height:1.8;text-align:justify;white-space:pre-wrap}.node-children[data-v-644583f3]{margin-left:16px;padding-left:8px;border-left:2px solid var(--border-color)}.depth-0 .node-title[data-v-644583f3]{font-size:20px;color:var(--primary-color)}.depth-1 .node-title[data-v-644583f3]{font-size:17px;color:var(--text-color)}.depth-2 .node-title[data-v-644583f3]{font-size:15px;color:var(--text-color)}.depth-3 .node-title[data-v-644583f3]{font-size:14px;color:var(--text-secondary)}.depth-4 .node-title[data-v-644583f3],.depth-5 .node-title[data-v-644583f3]{font-size:13px;color:var(--text-secondary)}
.document-panel[data-v-40ace65a]{display:flex;flex-direction:column;height:100%;background:var(--bg-secondary);border-radius:8px;overflow:hidden;color:var(--text-color)}.panel-header[data-v-40ace65a]{display:flex;align-items:center;padding:12px 16px;border-bottom:1px solid var(--border-color);background:var(--bg-tertiary)}.panel-header h2[data-v-40ace65a]{margin:0;font-size:18px;flex:1;color:var(--text-color)}.panel-header .doc-count[data-v-40ace65a]{margin-right:16px;font-size:14px;color:var(--text-secondary)}.panel-header .close-btn[data-v-40ace65a]{background:none;border:none;font-size:18px;cursor:pointer;padding:4px 8px;color:var(--text-secondary)}.panel-header .close-btn[data-v-40ace65a]:hover{color:var(--text-color)}.panel-main[data-v-40ace65a]{display:flex;flex:1;overflow:hidden}.document-sidebar[data-v-40ace65a]{width:220px;min-width:220px;background:var(--bg-tertiary);border-right:1px solid var(--border-color);display:flex;flex-direction:column;transition:width .25s ease,min-width .25s ease}.document-sidebar.collapsed[data-v-40ace65a]{width:50px;min-width:50px}.sidebar-header[data-v-40ace65a]{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border-color);background:var(--bg-secondary)}.sidebar-header .sidebar-title[data-v-40ace65a]{font-size:13px;font-weight:600;color:var(--text-color)}.sidebar-header .toggle-btn[data-v-40ace65a]{background:none;border:none;font-size:12px;cursor:pointer;padding:4px 6px;color:var(--text-secondary);border-radius:4px;transition:background .2s}.sidebar-header .toggle-btn[data-v-40ace65a]:hover{background:var(--bg-hover);color:var(--text-color)}.document-list[data-v-40ace65a]{flex:1;overflow-y:auto;padding:8px}.doc-item[data-v-40ace65a]{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;margin-bottom:6px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:6px;cursor:pointer;transition:all .2s ease}.doc-item .doc-icon[data-v-40ace65a]{font-size:16px;flex-shrink:0;margin-top:2px}.doc-item .doc-info[data-v-40ace65a]{flex:1;min-width:0;display:flex;flex-direction:column;gap:4px}.doc-item .doc-title[data-v-40ace65a]{font-size:13px;font-weight:500;color:var(--text-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.doc-item .doc-desc[data-v-40ace65a]{font-size:11px;color:var(--text-secondary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.doc-item[data-v-40ace65a]:hover{background:var(--bg-hover);border-color:var(--primary-color)}.doc-item.active[data-v-40ace65a]{background:var(--primary-light);border-color:var(--primary-color)}.doc-item.active .doc-title[data-v-40ace65a]{color:var(--primary-color);font-weight:600}.sidebar-empty[data-v-40ace65a]{padding:20px;text-align:center;color:var(--text-secondary);font-size:12px}.collapsed-list[data-v-40ace65a]{flex:1;overflow-y:auto;padding:8px 4px;display:flex;flex-direction:column;align-items:center;gap:6px}.collapsed-item[data-v-40ace65a]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:6px;cursor:pointer;font-size:16px;transition:all .2s ease}.collapsed-item[data-v-40ace65a]:hover{background:var(--bg-hover);border-color:var(--primary-color)}.collapsed-item.active[data-v-40ace65a]{background:var(--primary-light);border-color:var(--primary-color)}.panel-body[data-v-40ace65a]{flex:1;overflow-y:auto;padding:16px;background:var(--bg-color)}.loading-state[data-v-40ace65a],.error-state[data-v-40ace65a],.empty-state[data-v-40ace65a]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;color:var(--text-secondary);height:100%}.loading-state button[data-v-40ace65a],.error-state button[data-v-40ace65a],.empty-state button[data-v-40ace65a]{margin-top:16px;padding:8px 16px;background:var(--primary-color);color:#fff;border:none;border-radius:4px;cursor:pointer}.loading-state button[data-v-40ace65a]:hover,.error-state button[data-v-40ace65a]:hover,.empty-state button[data-v-40ace65a]:hover{background:var(--primary-hover)}.loading-state .empty-hint[data-v-40ace65a],.error-state .empty-hint[data-v-40ace65a],.empty-state .empty-hint[data-v-40ace65a]{font-size:12px;margin-top:8px;color:var(--text-disabled)}.loading-state .empty-hint code[data-v-40ace65a],.error-state .empty-hint code[data-v-40ace65a],.empty-state .empty-hint code[data-v-40ace65a]{background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;font-family:monospace;color:var(--text-color)}.document-content[data-v-40ace65a]{padding:8px}.current-doc-header[data-v-40ace65a]{display:flex;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid var(--primary-color)}.current-doc-header .current-doc-title[data-v-40ace65a]{margin:0;font-size:20px;color:var(--text-color);flex:1}.current-doc-header .section-count[data-v-40ace65a]{font-size:14px;color:var(--text-secondary);background:var(--bg-tertiary);padding:4px 10px;border-radius:12px}.document-description[data-v-40ace65a]{margin-bottom:24px;padding:16px;background:var(--bg-tertiary);border-radius:8px;color:var(--text-secondary);line-height:1.6;font-style:italic;border-left:4px solid var(--primary-color)}@media (max-width:768px){.panel-header[data-v-40ace65a]{padding:10px 12px}.panel-header h2[data-v-40ace65a]{font-size:16px}.panel-header .doc-count[data-v-40ace65a]{font-size:12px}.document-sidebar[data-v-40ace65a]{width:180px;min-width:180px}.document-sidebar.collapsed[data-v-40ace65a]{width:44px;min-width:44px}.sidebar-header[data-v-40ace65a]{padding:8px 10px}.sidebar-header .sidebar-title[data-v-40ace65a]{font-size:12px}.doc-item[data-v-40ace65a]{padding:8px 10px}.doc-item .doc-title[data-v-40ace65a]{font-size:12px}.doc-item .doc-desc[data-v-40ace65a]{font-size:10px}.panel-body[data-v-40ace65a]{padding:12px}.current-doc-header .current-doc-title[data-v-40ace65a]{font-size:18px}.current-doc-header .section-count[data-v-40ace65a]{font-size:12px;padding:3px 8px}}@media (max-width:480px){.document-sidebar[data-v-40ace65a]{width:44px;min-width:44px}.document-sidebar[data-v-40ace65a]:not(.collapsed){position:absolute;left:0;top:0;bottom:0;width:200px;min-width:200px;z-index:10;box-shadow:2px 0 8px rgba(0,0,0,.15)}.panel-main[data-v-40ace65a]{position:relative}.collapsed-item[data-v-40ace65a]{width:32px;height:32px;font-size:14px}}
.form-field[data-v-c036bca0]{display:flex;flex-direction:column;gap:8px}.form-field.has-error .text-input[data-v-c036bca0],.form-field.has-error .textarea-input[data-v-c036bca0],.form-field.has-error .number-input[data-v-c036bca0],.form-field.has-error .date-input[data-v-c036bca0],.form-field.has-error .datetime-input[data-v-c036bca0],.form-field.has-error .select-input[data-v-c036bca0]{border-color:var(--error-color,#ef4444)}.field-label[data-v-c036bca0]{font-size:14px;font-weight:500;color:var(--text-color)}.field-label .required-mark[data-v-c036bca0]{color:var(--error-color,#ef4444);margin-left:2px}.readonly-value[data-v-c036bca0]{padding:10px 12px;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:6px;color:var(--text-secondary);font-size:14px}.text-input[data-v-c036bca0],.textarea-input[data-v-c036bca0],.number-input[data-v-c036bca0],.date-input[data-v-c036bca0],.datetime-input[data-v-c036bca0],.select-input[data-v-c036bca0]{padding:10px 12px;background:var(--bg-color);border:1px solid var(--border-color);border-radius:6px;color:var(--text-color);font-size:14px;transition:border-color .2s,box-shadow .2s}.text-input[data-v-c036bca0]:focus,.textarea-input[data-v-c036bca0]:focus,.number-input[data-v-c036bca0]:focus,.date-input[data-v-c036bca0]:focus,.datetime-input[data-v-c036bca0]:focus,.select-input[data-v-c036bca0]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px var(--primary-light)}.text-input[data-v-c036bca0]::placeholder,.textarea-input[data-v-c036bca0]::placeholder,.number-input[data-v-c036bca0]::placeholder,.date-input[data-v-c036bca0]::placeholder,.datetime-input[data-v-c036bca0]::placeholder,.select-input[data-v-c036bca0]::placeholder{color:var(--text-disabled)}.textarea-input[data-v-c036bca0]{resize:vertical;min-height:100px}.number-input[data-v-c036bca0]{width:150px}.char-count[data-v-c036bca0]{font-size:12px;color:var(--text-disabled);text-align:right}.radio-group[data-v-c036bca0]{display:flex;flex-wrap:wrap;gap:16px}.radio-option[data-v-c036bca0],.checkbox-option[data-v-c036bca0]{display:flex;align-items:center;gap:8px;cursor:pointer}.radio-option input[type=radio][data-v-c036bca0],.radio-option input[type=checkbox][data-v-c036bca0],.checkbox-option input[type=radio][data-v-c036bca0],.checkbox-option input[type=checkbox][data-v-c036bca0]{width:18px;height:18px;cursor:pointer;accent-color:var(--primary-color)}.radio-option .radio-label[data-v-c036bca0],.radio-option .checkbox-label[data-v-c036bca0],.checkbox-option .radio-label[data-v-c036bca0],.checkbox-option .checkbox-label[data-v-c036bca0]{font-size:14px;color:var(--text-color)}.table-input[data-v-c036bca0]{border:1px solid var(--border-color);border-radius:8px;overflow:hidden}.data-table[data-v-c036bca0]{width:100%;border-collapse:collapse}.data-table th[data-v-c036bca0],.data-table td[data-v-c036bca0]{padding:10px 12px;text-align:left;border-bottom:1px solid var(--border-color)}.data-table th[data-v-c036bca0]{background:var(--bg-tertiary);font-size:13px;font-weight:500;color:var(--text-secondary)}.data-table th .required-mark[data-v-c036bca0]{color:var(--error-color,#ef4444)}.data-table td[data-v-c036bca0]{background:var(--bg-color)}.data-table .action-col[data-v-c036bca0]{width:60px;text-align:center}.table-cell-input[data-v-c036bca0],.table-cell-select[data-v-c036bca0]{width:100%;padding:6px 8px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;color:var(--text-color);font-size:13px}.table-cell-input[data-v-c036bca0]:focus,.table-cell-select[data-v-c036bca0]:focus{outline:none;border-color:var(--primary-color)}.remove-row-btn[data-v-c036bca0]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:var(--error-light,rgba(239,68,68,0.1));border:none;border-radius:4px;color:var(--error-color,#ef4444);cursor:pointer;font-size:12px;transition:all .2s}.remove-row-btn[data-v-c036bca0]:hover{background:var(--error-color,#ef4444);color:#fff}.add-row-btn[data-v-c036bca0]{width:100%;padding:10px;background:var(--bg-tertiary);border:none;border-top:1px solid var(--border-color);color:var(--primary-color);cursor:pointer;font-size:13px;font-weight:500;transition:background .2s}.add-row-btn[data-v-c036bca0]:hover{background:var(--bg-hover)}.help-text[data-v-c036bca0]{font-size:12px;color:var(--text-secondary)}.error-text[data-v-c036bca0]{font-size:12px;color:var(--error-color,#ef4444)}
.confirm-dialog-overlay[data-v-61be8e67]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;background:rgba(0,0,0,.5);backdrop-filter:blur(2px);display:flex;align-items:center;justify-content:center;z-index:10010 !important;padding:var(--spacing-md,16px)}.confirm-dialog[data-v-61be8e67]{background:var(--bg-secondary,#ffffff);border-radius:var(--radius-lg,8px);box-shadow:var(--shadow-lg,0 10px 20px rgba(0,0,0,0.12));max-width:420px;width:100%;overflow:hidden;animation:dialog-enter-61be8e67 .2s ease-out}.confirm-dialog.type-info[data-v-61be8e67]{--dialog-accent:var(--info-color,#1c71d8);--dialog-accent-light:var(--info-light,rgba(28,113,216,0.1))}.confirm-dialog.type-warning[data-v-61be8e67]{--dialog-accent:var(--warning-color,#e5a50a);--dialog-accent-light:var(--warning-light,rgba(229,165,10,0.1))}.confirm-dialog.type-danger[data-v-61be8e67]{--dialog-accent:var(--error-color,#c01c28);--dialog-accent-light:var(--error-light,rgba(192,28,40,0.1))}.confirm-dialog.type-success[data-v-61be8e67]{--dialog-accent:var(--success-color,#26a269);--dialog-accent-light:var(--success-light,rgba(38,162,105,0.1))}.dialog-header[data-v-61be8e67]{display:flex;align-items:center;gap:var(--spacing-sm,8px);padding:var(--spacing-lg,24px) var(--spacing-lg,24px) var(--spacing-sm,8px)}.dialog-icon[data-v-61be8e67]{font-size:28px;line-height:1;flex-shrink:0}.dialog-title[data-v-61be8e67]{margin:0;font-size:var(--font-lg,17px);font-weight:600;color:var(--text-color,#2e3436)}.dialog-body[data-v-61be8e67]{padding:var(--spacing-sm,8px) var(--spacing-lg,24px) var(--spacing-lg,24px)}.dialog-message[data-v-61be8e67]{margin:0;font-size:var(--font-md,15px);color:var(--text-secondary,#5e5c64);line-height:1.6;word-break:break-word}.dialog-footer[data-v-61be8e67]{display:flex;justify-content:flex-end;gap:var(--spacing-sm,8px);padding:var(--spacing-md,16px) var(--spacing-lg,24px);background:var(--bg-tertiary,#f6f5f4);border-top:1px solid var(--border-light,#e5e5e5)}.btn[data-v-61be8e67]{display:inline-flex;align-items:center;justify-content:center;gap:var(--spacing-xs,4px);padding:var(--spacing-sm,8px) var(--spacing-lg,24px);font-size:var(--font-sm,13px);font-weight:500;border-radius:var(--radius-md,6px);border:none;cursor:pointer;transition:all var(--transition-fast,0.1s ease);min-width:80px}.btn[data-v-61be8e67]:disabled{opacity:.6;cursor:not-allowed}.btn-cancel[data-v-61be8e67]{background:var(--bg-color,#f6f5f4);color:var(--text-color,#2e3436);border:1px solid var(--border-color,#c0bfbc)}.btn-cancel[data-v-61be8e67]:hover:not(:disabled){background:var(--bg-hover,#f0f0f0);border-color:var(--border-hover,#9a9996)}.btn-cancel[data-v-61be8e67]:active:not(:disabled){background:var(--bg-tertiary,#deddda)}.btn-confirm[data-v-61be8e67]{background:var(--dialog-accent,var(--primary-color,#1a5fb4));color:#fff}.btn-confirm[data-v-61be8e67]:hover:not(:disabled){filter:brightness(1.1)}.btn-confirm[data-v-61be8e67]:active:not(:disabled){filter:brightness(0.95)}.btn-confirm.btn-info[data-v-61be8e67]{background:var(--info-color,#1c71d8)}.btn-confirm.btn-warning[data-v-61be8e67]{background:var(--warning-color,#e5a50a);color:var(--text-highlight,#000)}.btn-confirm.btn-danger[data-v-61be8e67]{background:var(--error-color,#c01c28)}.btn-confirm.btn-success[data-v-61be8e67]{background:var(--success-color,#26a269)}.loading-spinner[data-v-61be8e67]{width:14px;height:14px;border:2px solid hsla(0,0%,100%,.3);border-top-color:#fff;border-radius:50%;animation:spin-61be8e67 .8s linear infinite}@keyframes spin-61be8e67{to{transform:rotate(360deg)}}@keyframes dialog-enter-61be8e67{from{opacity:0;transform:scale(0.95) translateY(-10px)}to{opacity:1;transform:scale(1) translateY(0)}}.confirm-dialog-enter-active[data-v-61be8e67],.confirm-dialog-leave-active[data-v-61be8e67]{transition:opacity .2s ease}.confirm-dialog-enter-from[data-v-61be8e67],.confirm-dialog-leave-to[data-v-61be8e67]{opacity:0}.confirm-dialog-enter-active .confirm-dialog[data-v-61be8e67]{animation:dialog-enter-61be8e67 .2s ease-out}.confirm-dialog-leave-active .confirm-dialog[data-v-61be8e67]{animation:dialog-enter-61be8e67 .15s ease-in reverse}@media (max-width:480px){.confirm-dialog[data-v-61be8e67]{max-width:calc(100vw - 32px)}.dialog-footer[data-v-61be8e67]{flex-direction:column-reverse}.btn[data-v-61be8e67]{width:100%}}:root.dark-theme .confirm-dialog[data-v-61be8e67]{background:var(--bg-secondary,#2d2d2d);box-shadow:0 10px 30px rgba(0,0,0,.4)}:root.dark-theme .dialog-title[data-v-61be8e67]{color:var(--text-color,#f5f5f5)}:root.dark-theme .dialog-message[data-v-61be8e67]{color:var(--text-secondary,#b0b0b0)}:root.dark-theme .dialog-footer[data-v-61be8e67]{background:var(--bg-tertiary,#3d3d3d);border-top-color:var(--border-color,#4d4d4d)}:root.dark-theme .btn-cancel[data-v-61be8e67]{background:var(--bg-color,#1e1e1e);color:var(--text-color,#f5f5f5);border-color:var(--border-color,#4d4d4d)}:root.dark-theme .btn-cancel[data-v-61be8e67]:hover:not(:disabled){background:var(--bg-hover,#3d3d3d)}
.records-viewer[data-v-5799a0c8]{display:flex;flex-direction:column;height:100%;background:var(--bg-color)}.viewer-header[data-v-5799a0c8]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--bg-tertiary);border-bottom:1px solid var(--border-color)}.viewer-header .header-left[data-v-5799a0c8]{display:flex;align-items:center;gap:10px}.viewer-header .header-left .viewer-icon[data-v-5799a0c8]{font-size:18px}.viewer-header .header-left h3[data-v-5799a0c8]{margin:0;font-size:16px;font-weight:600;color:var(--text-color)}.viewer-header .header-left .record-count[data-v-5799a0c8]{font-size:12px;color:var(--text-secondary);background:var(--bg-secondary);padding:2px 8px;border-radius:10px}.viewer-header .header-right[data-v-5799a0c8]{display:flex;align-items:center;gap:8px}.viewer-header .header-right .quick-approve-all-btn[data-v-5799a0c8]{display:flex;align-items:center;gap:6px;padding:6px 12px;background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;border:none;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s ease}.viewer-header .header-right .quick-approve-all-btn .btn-icon[data-v-5799a0c8]{font-size:14px}.viewer-header .header-right .quick-approve-all-btn .pending-badge[data-v-5799a0c8]{background:hsla(0,0%,100%,.3);padding:1px 6px;border-radius:8px;font-size:11px}.viewer-header .header-right .quick-approve-all-btn[data-v-5799a0c8]:hover:not(:disabled){background:linear-gradient(135deg,#d97706,#b45309);transform:translateY(-1px);box-shadow:0 2px 8px rgba(245,158,11,.4)}.viewer-header .header-right .quick-approve-all-btn[data-v-5799a0c8]:disabled{opacity:.6;cursor:not-allowed}.viewer-header .header-right .delete-all-btn[data-v-5799a0c8]{display:flex;align-items:center;gap:6px;padding:6px 12px;background:rgba(0,0,0,0);color:var(--error-color,#ef4444);border:1px solid var(--error-color,#ef4444);border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s ease}.viewer-header .header-right .delete-all-btn .btn-icon[data-v-5799a0c8]{font-size:14px}.viewer-header .header-right .delete-all-btn[data-v-5799a0c8]:hover:not(:disabled){background:var(--error-color,#ef4444);color:#fff;transform:translateY(-1px);box-shadow:0 2px 8px rgba(239,68,68,.4)}.viewer-header .header-right .delete-all-btn[data-v-5799a0c8]:disabled{opacity:.6;cursor:not-allowed}.viewer-header .header-right .close-btn[data-v-5799a0c8]{background:none;border:none;font-size:16px;cursor:pointer;padding:4px 8px;color:var(--text-secondary);border-radius:4px;transition:all .2s}.viewer-header .header-right .close-btn[data-v-5799a0c8]:hover{background:var(--bg-hover);color:var(--text-color)}.filter-bar[data-v-5799a0c8]{display:flex;align-items:center;gap:16px;padding:12px 16px;background:var(--bg-secondary);border-bottom:1px solid var(--border-color)}.filter-bar .filter-item[data-v-5799a0c8]{display:flex;align-items:center;gap:8px}.filter-bar .filter-item label[data-v-5799a0c8]{font-size:13px;color:var(--text-secondary);white-space:nowrap}.filter-bar .filter-item .filter-select[data-v-5799a0c8]{padding:6px 10px;border:1px solid var(--border-color);border-radius:6px;background:var(--bg-color);color:var(--text-color);font-size:13px;cursor:pointer}.filter-bar .filter-item .filter-select[data-v-5799a0c8]:focus{outline:none;border-color:var(--primary-color)}.filter-bar .search-item[data-v-5799a0c8]{flex:1;position:relative}.filter-bar .search-item .search-input[data-v-5799a0c8]{width:100%;padding:6px 10px 6px 30px;border:1px solid var(--border-color);border-radius:6px;background:var(--bg-color);color:var(--text-color);font-size:13px}.filter-bar .search-item .search-input[data-v-5799a0c8]::placeholder{color:var(--text-disabled)}.filter-bar .search-item .search-input[data-v-5799a0c8]:focus{outline:none;border-color:var(--primary-color)}.filter-bar .search-item .search-icon[data-v-5799a0c8]{position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:14px;opacity:.5}.records-list[data-v-5799a0c8]{flex:1;overflow-y:auto;padding:16px}.record-card[data-v-5799a0c8]{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:8px;margin-bottom:12px;cursor:pointer;transition:all .2s ease}.record-card[data-v-5799a0c8]:hover{border-color:var(--primary-color);box-shadow:0 2px 8px rgba(0,0,0,.1)}.record-card.status-approved[data-v-5799a0c8]{border-left:4px solid var(--success-color,#22c55e)}.record-card.status-rejected[data-v-5799a0c8]{border-left:4px solid var(--error-color,#ef4444)}.record-card.status-pending[data-v-5799a0c8]{border-left:4px solid var(--warning-color,#f59e0b)}.card-header[data-v-5799a0c8]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border-color)}.card-header .card-title[data-v-5799a0c8]{display:flex;align-items:center;gap:12px}.card-header .card-title .app-id[data-v-5799a0c8]{font-size:14px;font-weight:600;color:var(--text-color);font-family:monospace}.card-header .card-title .form-type[data-v-5799a0c8]{font-size:12px;color:var(--text-secondary);background:var(--bg-tertiary);padding:2px 8px;border-radius:4px}.card-header .status-badge[data-v-5799a0c8]{font-size:12px;padding:4px 10px;border-radius:12px;font-weight:500}.card-header .status-badge.status-approved[data-v-5799a0c8]{background:rgba(34,197,94,.15);color:var(--success-color,#22c55e)}.card-header .status-badge.status-rejected[data-v-5799a0c8]{background:rgba(239,68,68,.15);color:var(--error-color,#ef4444)}.card-header .status-badge.status-pending[data-v-5799a0c8]{background:rgba(245,158,11,.15);color:var(--warning-color,#f59e0b)}.card-header .status-badge.status-default[data-v-5799a0c8]{background:var(--bg-tertiary);color:var(--text-secondary)}.card-summary[data-v-5799a0c8]{padding:12px 16px}.card-summary .summary-row[data-v-5799a0c8]{display:flex;align-items:center;margin-bottom:6px}.card-summary .summary-row[data-v-5799a0c8]:last-child{margin-bottom:0}.card-summary .summary-row .summary-label[data-v-5799a0c8]{font-size:13px;color:var(--text-secondary);min-width:60px}.card-summary .summary-row .summary-value[data-v-5799a0c8]{font-size:13px;color:var(--text-color)}.card-summary .summary-row .summary-dept[data-v-5799a0c8]{font-size:12px;color:var(--text-secondary);margin-left:4px}.card-details[data-v-5799a0c8]{padding:0 16px 12px}.card-details .details-divider[data-v-5799a0c8]{height:1px;background:var(--border-color);margin-bottom:12px}.card-details .detail-row[data-v-5799a0c8]{display:flex;margin-bottom:8px}.card-details .detail-row[data-v-5799a0c8]:last-child{margin-bottom:0}.card-details .detail-row .detail-label[data-v-5799a0c8]{font-size:12px;color:var(--text-secondary);min-width:80px;flex-shrink:0}.card-details .detail-row .detail-value[data-v-5799a0c8]{font-size:12px;color:var(--text-color);word-break:break-all}.card-details .detail-row.full-summary[data-v-5799a0c8]{flex-direction:column;gap:4px;margin-top:8px;padding-top:8px;border-top:1px dashed var(--border-color)}.card-details .detail-row.full-summary .detail-value[data-v-5799a0c8]{background:var(--bg-tertiary);padding:8px;border-radius:4px;font-family:monospace;font-size:11px;line-height:1.5}.card-actions[data-v-5799a0c8]{margin-top:12px;padding-top:12px;border-top:1px solid var(--border-color);display:flex;justify-content:flex-end;gap:8px}.card-actions .quick-approve-btn[data-v-5799a0c8]{display:flex;align-items:center;gap:6px;padding:8px 16px;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;border:none;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s ease}.card-actions .quick-approve-btn .btn-icon[data-v-5799a0c8]{font-size:14px}.card-actions .quick-approve-btn[data-v-5799a0c8]:hover:not(:disabled){background:linear-gradient(135deg,#16a34a,#15803d);transform:translateY(-1px);box-shadow:0 2px 8px rgba(34,197,94,.4)}.card-actions .quick-approve-btn[data-v-5799a0c8]:disabled{opacity:.6;cursor:not-allowed}.card-actions .delete-btn[data-v-5799a0c8]{display:flex;align-items:center;gap:6px;padding:8px 16px;background:var(--bg-tertiary);color:var(--error-color,#ef4444);border:1px solid var(--error-color,#ef4444);border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s ease}.card-actions .delete-btn .btn-icon[data-v-5799a0c8]{font-size:14px}.card-actions .delete-btn[data-v-5799a0c8]:hover:not(:disabled){background:var(--error-color,#ef4444);color:#fff;transform:translateY(-1px);box-shadow:0 2px 8px rgba(239,68,68,.4)}.card-actions .delete-btn[data-v-5799a0c8]:disabled{opacity:.6;cursor:not-allowed}.expand-indicator[data-v-5799a0c8]{padding:8px 16px;text-align:center;border-top:1px solid var(--border-color);background:var(--bg-tertiary);border-radius:0 0 8px 8px}.expand-indicator span[data-v-5799a0c8]{font-size:12px;color:var(--text-secondary)}.empty-state[data-v-5799a0c8]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;color:var(--text-secondary)}.empty-state .empty-icon[data-v-5799a0c8]{font-size:48px;margin-bottom:16px}.empty-state p[data-v-5799a0c8]{margin:0;font-size:14px}.result-toast[data-v-5799a0c8]{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:8px;padding:12px 20px;border-radius:8px;font-size:14px;font-weight:500;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:1000}.result-toast.success[data-v-5799a0c8]{background:var(--success-color,#22c55e);color:#fff}.result-toast.error[data-v-5799a0c8]{background:var(--error-color,#ef4444);color:#fff}.result-toast .toast-icon[data-v-5799a0c8]{font-size:16px}.result-toast-enter-active[data-v-5799a0c8],.result-toast-leave-active[data-v-5799a0c8]{transition:all .3s ease}.result-toast-enter-from[data-v-5799a0c8],.result-toast-leave-to[data-v-5799a0c8]{opacity:0;transform:translateX(-50%) translateY(20px)}@media (max-width:768px){.filter-bar[data-v-5799a0c8]{flex-direction:column;align-items:stretch}.filter-bar .filter-item[data-v-5799a0c8]{width:100%}.filter-bar .filter-item .filter-select[data-v-5799a0c8]{flex:1}.card-header[data-v-5799a0c8]{flex-direction:column;align-items:flex-start;gap:8px}}
.form-panel[data-v-a02a6064]{display:flex;flex-direction:column;height:100%;background:var(--bg-secondary);border-radius:8px;overflow:hidden;color:var(--text-color)}.panel-header[data-v-a02a6064]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border-color);background:var(--bg-tertiary)}.panel-header .header-left[data-v-a02a6064]{display:flex;align-items:center;gap:10px}.panel-header .header-left .panel-icon[data-v-a02a6064]{font-size:20px}.panel-header .header-left h2[data-v-a02a6064]{margin:0;font-size:18px;font-weight:600;color:var(--text-color)}.panel-header .header-center[data-v-a02a6064]{flex:1;display:flex;justify-content:center}.panel-header .view-toggle[data-v-a02a6064]{display:flex;background:var(--bg-secondary);border-radius:8px;padding:4px;gap:4px}.panel-header .view-toggle .toggle-btn[data-v-a02a6064]{display:flex;align-items:center;gap:6px;padding:8px 16px;border:none;background:rgba(0,0,0,0);border-radius:6px;cursor:pointer;font-size:13px;color:var(--text-secondary);transition:all .2s ease}.panel-header .view-toggle .toggle-btn .btn-icon[data-v-a02a6064]{font-size:14px}.panel-header .view-toggle .toggle-btn .btn-text[data-v-a02a6064]{font-weight:500}.panel-header .view-toggle .toggle-btn .record-badge[data-v-a02a6064]{background:var(--primary-color);color:#fff;font-size:11px;padding:2px 6px;border-radius:10px;min-width:18px;text-align:center}.panel-header .view-toggle .toggle-btn[data-v-a02a6064]:hover{background:var(--bg-hover);color:var(--text-color)}.panel-header .view-toggle .toggle-btn.active[data-v-a02a6064]{background:var(--primary-color);color:#fff}.panel-header .view-toggle .toggle-btn.active .record-badge[data-v-a02a6064]{background:hsla(0,0%,100%,.3)}.panel-header .header-right[data-v-a02a6064]{display:flex;align-items:center;gap:12px}.panel-header .header-right .form-count[data-v-a02a6064]{font-size:14px;color:var(--text-secondary);background:var(--bg-secondary);padding:4px 10px;border-radius:12px}.panel-header .header-right .close-btn[data-v-a02a6064]{background:none;border:none;font-size:18px;cursor:pointer;padding:4px 8px;color:var(--text-secondary);border-radius:4px;transition:all .2s}.panel-header .header-right .close-btn[data-v-a02a6064]:hover{background:var(--bg-hover);color:var(--text-color)}.panel-main[data-v-a02a6064]{display:flex;flex:1;overflow:hidden}.form-sidebar[data-v-a02a6064]{width:220px;min-width:220px;background:var(--bg-tertiary);border-right:1px solid var(--border-color);display:flex;flex-direction:column;transition:width .25s ease,min-width .25s ease}.form-sidebar.collapsed[data-v-a02a6064]{width:50px;min-width:50px}.sidebar-header[data-v-a02a6064]{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border-color);background:var(--bg-secondary)}.sidebar-header .sidebar-title[data-v-a02a6064]{font-size:13px;font-weight:600;color:var(--text-color)}.sidebar-header .toggle-btn[data-v-a02a6064]{background:none;border:none;font-size:12px;cursor:pointer;padding:4px 6px;color:var(--text-secondary);border-radius:4px;transition:background .2s}.sidebar-header .toggle-btn[data-v-a02a6064]:hover{background:var(--bg-hover);color:var(--text-color)}.form-list[data-v-a02a6064]{flex:1;overflow-y:auto;padding:8px}.form-item[data-v-a02a6064]{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;margin-bottom:6px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:6px;cursor:pointer;transition:all .2s ease}.form-item .form-icon[data-v-a02a6064]{font-size:16px;flex-shrink:0;margin-top:2px}.form-item .form-info[data-v-a02a6064]{flex:1;min-width:0;display:flex;flex-direction:column;gap:4px}.form-item .form-title[data-v-a02a6064]{font-size:13px;font-weight:500;color:var(--text-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.form-item .form-desc[data-v-a02a6064]{font-size:11px;color:var(--text-secondary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.form-item[data-v-a02a6064]:hover{background:var(--bg-hover);border-color:var(--primary-color)}.form-item.active[data-v-a02a6064]{background:var(--primary-light);border-color:var(--primary-color)}.form-item.active .form-title[data-v-a02a6064]{color:var(--primary-color);font-weight:600}.sidebar-empty[data-v-a02a6064]{padding:20px;text-align:center;color:var(--text-secondary);font-size:12px}.collapsed-list[data-v-a02a6064]{flex:1;overflow-y:auto;padding:8px 4px;display:flex;flex-direction:column;align-items:center;gap:6px}.collapsed-item[data-v-a02a6064]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:6px;cursor:pointer;font-size:16px;transition:all .2s ease}.collapsed-item[data-v-a02a6064]:hover{background:var(--bg-hover);border-color:var(--primary-color)}.collapsed-item.active[data-v-a02a6064]{background:var(--primary-light);border-color:var(--primary-color)}.panel-body[data-v-a02a6064]{flex:1;overflow-y:auto;padding:16px;background:var(--bg-color)}.state-container[data-v-a02a6064]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;height:100%}.state-container .state-icon[data-v-a02a6064]{font-size:48px;margin-bottom:16px}.state-container p[data-v-a02a6064]{margin:0 0 8px 0;color:var(--text-secondary);font-size:15px}.state-container .empty-hint[data-v-a02a6064]{font-size:13px;color:var(--text-disabled)}.state-container .empty-hint code[data-v-a02a6064]{background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;font-family:monospace;color:var(--text-color)}.state-container .retry-btn[data-v-a02a6064]{margin-top:16px;padding:8px 20px;background:var(--primary-color);color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:14px;transition:background .2s}.state-container .retry-btn[data-v-a02a6064]:hover{background:var(--primary-hover)}.form-content[data-v-a02a6064]{max-width:800px;margin:0 auto}.form-header[data-v-a02a6064]{margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid var(--primary-color)}.form-header .form-header-top[data-v-a02a6064]{display:flex;align-items:flex-start;justify-content:space-between;gap:16px}.form-header .form-title-section[data-v-a02a6064]{flex:1}.form-header .form-title[data-v-a02a6064]{margin:0 0 8px 0;font-size:20px;color:var(--text-color)}.form-header .form-description[data-v-a02a6064]{display:block;font-size:14px;color:var(--text-secondary)}.form-header .form-header-actions[data-v-a02a6064]{flex-shrink:0}.form-header .auto-fill-btn[data-v-a02a6064]{display:flex;align-items:center;gap:6px;padding:8px 16px;background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;border:none;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px rgba(139,92,246,.3)}.form-header .auto-fill-btn .btn-icon[data-v-a02a6064]{font-size:14px}.form-header .auto-fill-btn .btn-text[data-v-a02a6064]{white-space:nowrap}.form-header .auto-fill-btn[data-v-a02a6064]:hover:not(:disabled){background:linear-gradient(135deg,#7c3aed,#6d28d9);transform:translateY(-1px);box-shadow:0 4px 8px rgba(139,92,246,.4)}.form-header .auto-fill-btn[data-v-a02a6064]:active:not(:disabled){transform:translateY(0);box-shadow:0 2px 4px rgba(139,92,246,.3)}.form-header .auto-fill-btn[data-v-a02a6064]:disabled{opacity:.6;cursor:not-allowed}.workflow-hint[data-v-a02a6064]{display:flex;align-items:center;flex-wrap:wrap;gap:8px;padding:12px 16px;background:var(--bg-tertiary);border-radius:8px;margin-bottom:24px;font-size:13px}.workflow-hint .workflow-label[data-v-a02a6064]{color:var(--text-secondary);font-weight:500}.workflow-hint .workflow-step[data-v-a02a6064]{color:var(--text-color);background:var(--bg-secondary);padding:4px 10px;border-radius:12px}.workflow-hint .workflow-arrow[data-v-a02a6064]{color:var(--text-disabled);margin:0 4px}.form-fields[data-v-a02a6064]{display:flex;flex-direction:column;gap:16px;margin-bottom:24px}.form-actions[data-v-a02a6064]{display:flex;justify-content:flex-end;gap:12px;padding-top:16px;border-top:1px solid var(--border-color)}.form-actions .reset-btn[data-v-a02a6064]{padding:10px 24px;background:var(--bg-tertiary);color:var(--text-color);border:1px solid var(--border-color);border-radius:6px;cursor:pointer;font-size:14px;transition:all .2s}.form-actions .reset-btn[data-v-a02a6064]:hover:not(:disabled){background:var(--bg-hover)}.form-actions .reset-btn[data-v-a02a6064]:disabled{opacity:.5;cursor:not-allowed}.form-actions .submit-btn[data-v-a02a6064]{padding:10px 32px;background:var(--primary-color);color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;transition:all .2s}.form-actions .submit-btn[data-v-a02a6064]:hover:not(:disabled){background:var(--primary-hover)}.form-actions .submit-btn[data-v-a02a6064]:disabled{opacity:.6;cursor:not-allowed}.submit-success[data-v-a02a6064]{display:flex;align-items:center;justify-content:center;gap:8px;padding:16px;margin-top:16px;background:var(--success-light,rgba(34,197,94,0.1));border:1px solid var(--success-color,#22c55e);border-radius:8px;color:var(--success-color,#22c55e);font-size:14px}.submit-success .success-icon[data-v-a02a6064]{font-size:18px}@media (max-width:768px){.panel-header[data-v-a02a6064]{flex-wrap:wrap;gap:8px}.panel-header .header-center[data-v-a02a6064]{order:3;width:100%;justify-content:center}.panel-header .view-toggle[data-v-a02a6064]{width:100%}.panel-header .view-toggle .toggle-btn[data-v-a02a6064]{flex:1;justify-content:center}.form-sidebar[data-v-a02a6064]{width:180px;min-width:180px}.form-sidebar.collapsed[data-v-a02a6064]{width:44px;min-width:44px}.form-content[data-v-a02a6064]{max-width:100%}.form-actions[data-v-a02a6064]{flex-direction:column}.form-actions .reset-btn[data-v-a02a6064],.form-actions .submit-btn[data-v-a02a6064]{width:100%}}
.history-text-panel[data-v-9256f22a]{display:flex;flex-direction:column;width:100%;height:100%;background:var(--bg-secondary);border-radius:var(--radius-md);overflow:hidden}.panel-header[data-v-9256f22a]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:linear-gradient(135deg,#3b82f6 0%,#1d4ed8 100%);color:#fff;flex-shrink:0}.header-left[data-v-9256f22a]{display:flex;align-items:center;gap:10px}.panel-icon[data-v-9256f22a]{font-size:20px}.panel-title[data-v-9256f22a]{margin:0;font-size:16px;font-weight:600}.text-count[data-v-9256f22a]{padding:3px 10px;font-size:11px;font-weight:500;background:hsla(0,0%,100%,.2);border-radius:10px}.header-actions[data-v-9256f22a]{display:flex;align-items:center;gap:8px}.btn-refresh[data-v-9256f22a],.btn-close[data-v-9256f22a]{width:30px;height:30px;display:flex;align-items:center;justify-content:center;background:hsla(0,0%,100%,.1);border:none;color:#fff;font-size:14px;cursor:pointer;border-radius:4px;transition:all .2s ease}.btn-refresh[data-v-9256f22a]:hover:not(:disabled),.btn-close[data-v-9256f22a]:hover:not(:disabled){background:hsla(0,0%,100%,.25)}.btn-refresh[data-v-9256f22a]:disabled,.btn-close[data-v-9256f22a]:disabled{opacity:.4;cursor:not-allowed}.search-bar[data-v-9256f22a]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border-bottom:1px solid var(--border-color);flex-shrink:0}.search-input[data-v-9256f22a]{flex:1;padding:8px 12px;background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:var(--font-sm);color:var(--text-color);outline:none;transition:border-color var(--transition-fast)}.search-input[data-v-9256f22a]:focus{border-color:var(--primary-color)}.search-input[data-v-9256f22a]::placeholder{color:var(--text-muted)}.search-result-count[data-v-9256f22a]{font-size:var(--font-xs);color:var(--text-secondary);white-space:nowrap}.panel-body[data-v-9256f22a]{flex:1;overflow-y:auto;min-height:0}.panel-body[data-v-9256f22a]::-webkit-scrollbar{width:6px}.panel-body[data-v-9256f22a]::-webkit-scrollbar-track{background:var(--bg-tertiary)}.panel-body[data-v-9256f22a]::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:3px}.panel-body[data-v-9256f22a]::-webkit-scrollbar-thumb:hover{background:var(--border-hover)}.state-container[data-v-9256f22a]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 40px;gap:var(--spacing-md)}.state-icon[data-v-9256f22a]{font-size:48px;opacity:.4}.state-text[data-v-9256f22a]{font-size:var(--font-md);color:var(--text-secondary)}.state-hint[data-v-9256f22a]{margin:0;font-size:var(--font-sm);color:var(--text-muted)}.loading-spinner[data-v-9256f22a]{animation:spin-9256f22a 1s linear infinite}@keyframes spin-9256f22a{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.error-icon[data-v-9256f22a]{color:var(--error-color)}.error-state .state-text[data-v-9256f22a]{color:var(--error-color)}.text-list[data-v-9256f22a]{padding:var(--spacing-sm)}.text-item[data-v-9256f22a]{margin-bottom:var(--spacing-sm);background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-sm);overflow:hidden;transition:all var(--transition-fast)}.text-item[data-v-9256f22a]:hover{border-color:var(--border-hover)}.text-item.is-expanded[data-v-9256f22a]{border-color:var(--primary-color);box-shadow:0 2px 8px rgba(59,130,246,.15)}.text-header[data-v-9256f22a]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-sm) var(--spacing-md);cursor:pointer;transition:background var(--transition-fast)}.text-header[data-v-9256f22a]:hover{background:var(--bg-hover)}.text-meta[data-v-9256f22a]{display:flex;align-items:center;gap:var(--spacing-sm);flex:1;min-width:0}.text-number[data-v-9256f22a]{font-size:var(--font-xs);font-weight:600;color:var(--primary-color);padding:2px 6px;background:var(--primary-light);border-radius:var(--radius-xs);flex-shrink:0}.text-preview[data-v-9256f22a]{font-size:var(--font-sm);color:var(--text-secondary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.expand-icon[data-v-9256f22a]{font-size:10px;color:var(--text-muted);flex-shrink:0}.text-content[data-v-9256f22a]{padding:var(--spacing-md);border-top:1px solid var(--border-color);background:var(--bg-tertiary)}.content-body[data-v-9256f22a]{font-size:var(--font-sm);line-height:1.8;color:var(--text-color);white-space:pre-wrap;word-break:break-word}.content-actions[data-v-9256f22a]{display:flex;justify-content:flex-end;margin-top:var(--spacing-md);padding-top:var(--spacing-sm);border-top:1px solid var(--border-light)}.btn-action[data-v-9256f22a]{padding:4px 10px;font-size:var(--font-xs);background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-xs);color:var(--text-secondary);cursor:pointer;transition:all var(--transition-fast)}.btn-action[data-v-9256f22a]:hover{background:var(--bg-hover);border-color:var(--border-hover);color:var(--text-color)}.panel-footer[data-v-9256f22a]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border-top:1px solid var(--border-color);flex-shrink:0}.footer-info .info-text[data-v-9256f22a]{font-size:var(--font-xs);color:var(--text-muted)}.footer-actions[data-v-9256f22a]{display:flex;gap:var(--spacing-xs)}.btn[data-v-9256f22a]{padding:6px 12px;border:none;border-radius:var(--radius-sm);font-size:var(--font-xs);font-weight:500;cursor:pointer;transition:all var(--transition-fast)}.btn[data-v-9256f22a]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[data-v-9256f22a]{background:var(--bg-color);color:var(--text-secondary);border:1px solid var(--border-color)}.btn-secondary[data-v-9256f22a]:hover:not(:disabled){background:var(--bg-hover);border-color:var(--border-hover);color:var(--text-color)}@media (max-width:768px){.history-text-panel[data-v-9256f22a]{border-radius:var(--radius-sm)}.panel-header[data-v-9256f22a]{padding:10px 12px}.header-left[data-v-9256f22a]{gap:6px}.panel-icon[data-v-9256f22a]{font-size:16px}.panel-title[data-v-9256f22a]{font-size:14px}.text-count[data-v-9256f22a]{padding:2px 8px;font-size:10px}.btn-refresh[data-v-9256f22a],.btn-close[data-v-9256f22a]{width:26px;height:26px;font-size:12px}.search-bar[data-v-9256f22a]{padding:var(--spacing-xs) var(--spacing-sm)}.search-input[data-v-9256f22a]{padding:6px 10px;font-size:12px}.search-result-count[data-v-9256f22a]{font-size:10px}.text-list[data-v-9256f22a]{padding:var(--spacing-xs)}.text-item[data-v-9256f22a]{margin-bottom:var(--spacing-xs)}.text-header[data-v-9256f22a]{padding:var(--spacing-xs) var(--spacing-sm)}.text-number[data-v-9256f22a]{font-size:10px;padding:1px 4px}.text-preview[data-v-9256f22a]{font-size:11px}.text-content[data-v-9256f22a]{padding:var(--spacing-sm)}.content-body[data-v-9256f22a]{font-size:12px;line-height:1.6}.panel-footer[data-v-9256f22a]{flex-direction:column;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm)}.footer-actions[data-v-9256f22a]{width:100%;justify-content:center}.btn[data-v-9256f22a]{padding:5px 10px;font-size:11px}.state-container[data-v-9256f22a]{padding:40px 20px}.state-icon[data-v-9256f22a]{font-size:36px}.state-text[data-v-9256f22a]{font-size:13px}}@media (max-width:480px){.panel-header[data-v-9256f22a]{padding:8px 10px}.header-left[data-v-9256f22a]{gap:4px}.panel-icon[data-v-9256f22a]{font-size:14px}.panel-title[data-v-9256f22a]{font-size:13px}.text-count[data-v-9256f22a]{display:none}.header-actions[data-v-9256f22a]{gap:4px}.btn-refresh[data-v-9256f22a],.btn-close[data-v-9256f22a]{width:24px;height:24px;font-size:11px}.search-bar[data-v-9256f22a]{padding:4px 8px}.search-input[data-v-9256f22a]{padding:5px 8px;font-size:11px}.text-list[data-v-9256f22a]{padding:4px}.text-header[data-v-9256f22a]{padding:6px 8px}.text-meta[data-v-9256f22a]{gap:4px}.text-number[data-v-9256f22a]{font-size:9px}.text-preview[data-v-9256f22a]{font-size:10px}.expand-icon[data-v-9256f22a]{font-size:8px}.text-content[data-v-9256f22a]{padding:8px}.content-body[data-v-9256f22a]{font-size:11px;line-height:1.5}.content-actions[data-v-9256f22a]{margin-top:8px;padding-top:6px}.btn-action[data-v-9256f22a]{padding:3px 8px;font-size:10px}.panel-footer[data-v-9256f22a]{padding:6px 8px}.footer-info .info-text[data-v-9256f22a]{font-size:10px}.footer-actions .btn[data-v-9256f22a]{padding:4px 8px;font-size:10px}.state-container[data-v-9256f22a]{padding:30px 15px}.state-icon[data-v-9256f22a]{font-size:32px}.state-text[data-v-9256f22a]{font-size:12px}.state-hint[data-v-9256f22a]{font-size:11px}}
.changelog-panel[data-v-64d33b34]{display:flex;flex-direction:column;height:100%;background:var(--bg-secondary);overflow:hidden}.panel-header[data-v-64d33b34]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md) var(--spacing-lg);background:var(--bg-tertiary);border-bottom:1px solid var(--border-color);flex-shrink:0}.header-left[data-v-64d33b34]{display:flex;align-items:center;gap:var(--spacing-sm)}.header-icon[data-v-64d33b34]{font-size:20px}.header-title[data-v-64d33b34]{margin:0;font-size:var(--font-lg);font-weight:600;color:var(--text-color)}.header-right[data-v-64d33b34]{display:flex;align-items:center;gap:var(--spacing-xs)}.btn-refresh[data-v-64d33b34],.btn-close[data-v-64d33b34]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:rgba(0,0,0,0);border:1px solid var(--border-color);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast);font-size:16px;color:var(--text-secondary)}.btn-refresh[data-v-64d33b34]:hover:not(:disabled),.btn-close[data-v-64d33b34]:hover:not(:disabled){background:var(--bg-hover);color:var(--text-color);border-color:var(--border-hover)}.btn-refresh[data-v-64d33b34]:disabled,.btn-close[data-v-64d33b34]:disabled{opacity:.5;cursor:not-allowed}.refresh-icon[data-v-64d33b34]{display:inline-block;transition:transform .3s ease}.refresh-icon.spinning[data-v-64d33b34]{animation:spin-64d33b34 1s linear infinite}@keyframes spin-64d33b34{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.panel-body[data-v-64d33b34]{flex:1;overflow-y:auto;padding:var(--spacing-lg)}.loading-state[data-v-64d33b34]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:var(--spacing-md);color:var(--text-secondary)}.loading-state .loading-spinner[data-v-64d33b34]{width:40px;height:40px;border:3px solid var(--border-color);border-top-color:var(--primary-color);border-radius:50%;animation:spin-64d33b34 .8s linear infinite}.loading-state p[data-v-64d33b34]{margin:0;font-size:var(--font-sm)}.error-state[data-v-64d33b34]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:var(--spacing-sm);text-align:center}.error-state .error-icon[data-v-64d33b34]{font-size:40px}.error-state .error-message[data-v-64d33b34]{margin:0;color:var(--error-color);font-size:var(--font-sm)}.error-state .btn-retry[data-v-64d33b34]{padding:var(--spacing-xs) var(--spacing-md);background:var(--primary-color);color:#fff;border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:var(--font-sm);transition:background var(--transition-fast)}.error-state .btn-retry[data-v-64d33b34]:hover{background:var(--primary-hover)}.changelog-content[data-v-64d33b34]{line-height:1.6;color:var(--text-color)}.changelog-content[data-v-64d33b34] .md-h2{font-size:var(--font-xl);font-weight:700;color:var(--text-color);margin:0 0 var(--spacing-lg);padding-bottom:var(--spacing-sm);border-bottom:2px solid var(--primary-color)}.changelog-content[data-v-64d33b34] .md-h3{font-size:var(--font-lg);font-weight:600;color:var(--text-color);margin:var(--spacing-lg) 0 var(--spacing-md);padding-left:var(--spacing-sm);border-left:3px solid var(--primary-color)}.changelog-content[data-v-64d33b34] .md-h4{font-size:var(--font-md);font-weight:600;color:var(--text-secondary);margin:var(--spacing-md) 0 var(--spacing-sm)}.changelog-content[data-v-64d33b34] .md-p{margin:var(--spacing-sm) 0;font-size:var(--font-sm)}.changelog-content[data-v-64d33b34] .md-quote{margin:var(--spacing-md) 0;padding:var(--spacing-sm) var(--spacing-md);background:rgba(99,102,241,.1);border-left:3px solid var(--primary-color);border-radius:0 var(--radius-sm) var(--radius-sm) 0;font-size:var(--font-sm);color:var(--text-secondary)}.changelog-content[data-v-64d33b34] .md-ul,.changelog-content[data-v-64d33b34] .md-ol{margin:var(--spacing-sm) 0;padding-left:var(--spacing-lg)}.changelog-content[data-v-64d33b34] .md-li,.changelog-content[data-v-64d33b34] .md-li-ordered{margin:var(--spacing-xs) 0;font-size:var(--font-sm)}.changelog-content[data-v-64d33b34] .md-hr{margin:var(--spacing-lg) 0;border:none;border-top:1px solid var(--border-color)}.changelog-content[data-v-64d33b34] .code-block{margin:var(--spacing-md) 0;padding:var(--spacing-md);background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:var(--radius-sm);overflow-x:auto}.changelog-content[data-v-64d33b34] .code-block code{font-family:"Consolas","Monaco",monospace;font-size:var(--font-xs);line-height:1.5;white-space:pre}.changelog-content[data-v-64d33b34] .inline-code{padding:1px 4px;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:3px;font-family:"Consolas","Monaco",monospace;font-size:.9em;color:var(--primary-color)}.changelog-content[data-v-64d33b34] a{color:var(--primary-color);text-decoration:none}.changelog-content[data-v-64d33b34] a:hover{text-decoration:underline}.changelog-content[data-v-64d33b34] strong{font-weight:600;color:var(--text-color)}.changelog-content[data-v-64d33b34] .version-highlight{padding:1px 6px;background:rgba(99,102,241,.15);color:var(--primary-color);border-radius:3px;font-weight:600;font-family:monospace}.changelog-content[data-v-64d33b34] .emoji-success{color:var(--success-color)}.changelog-content[data-v-64d33b34] .emoji-error{color:var(--error-color)}.changelog-content[data-v-64d33b34] .emoji-warning{color:var(--warning-color)}.changelog-content[data-v-64d33b34] .emoji-alert{color:var(--error-color)}.panel-footer[data-v-64d33b34]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-sm) var(--spacing-lg);background:var(--bg-tertiary);border-top:1px solid var(--border-color);flex-shrink:0}.footer-info .update-time[data-v-64d33b34]{font-size:var(--font-xs);color:var(--text-muted)}.footer-actions[data-v-64d33b34]{display:flex;gap:var(--spacing-sm)}.btn-clear-cache[data-v-64d33b34]{display:flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:rgba(0,0,0,0);border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:var(--font-xs);color:var(--text-secondary);cursor:pointer;transition:all var(--transition-fast)}.btn-clear-cache[data-v-64d33b34]:hover:not(:disabled){background:rgba(239,68,68,.1);color:var(--error-color);border-color:var(--error-color)}.btn-clear-cache[data-v-64d33b34]:disabled{opacity:.5;cursor:not-allowed}.btn-clear-cache .cache-icon[data-v-64d33b34]{font-size:14px}.btn-github[data-v-64d33b34]{display:flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:rgba(0,0,0,0);border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:var(--font-xs);color:var(--text-secondary);text-decoration:none;transition:all var(--transition-fast)}.btn-github[data-v-64d33b34]:hover{background:var(--bg-hover);color:var(--text-color);border-color:var(--border-hover)}.btn-github .github-icon[data-v-64d33b34]{font-size:14px}.cache-status[data-v-64d33b34]{color:var(--success-color);font-size:var(--font-xs);margin-left:var(--spacing-sm);animation:fadeIn-64d33b34 .3s ease}@keyframes fadeIn-64d33b34{from{opacity:0}to{opacity:1}}.cache-dialog-overlay[data-v-64d33b34]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000;animation:fadeIn-64d33b34 .2s ease}.cache-dialog[data-v-64d33b34]{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);width:90%;max-width:400px;box-shadow:0 10px 40px rgba(0,0,0,.3);animation:slideUp-64d33b34 .3s ease}@keyframes slideUp-64d33b34{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.dialog-header[data-v-64d33b34]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md) var(--spacing-lg);border-bottom:1px solid var(--border-color)}.dialog-header .dialog-icon[data-v-64d33b34]{font-size:20px}.dialog-header h4[data-v-64d33b34]{margin:0;font-size:var(--font-md);font-weight:600;color:var(--text-color)}.dialog-body[data-v-64d33b34]{padding:var(--spacing-lg)}.dialog-body>p[data-v-64d33b34]{margin:0 0 var(--spacing-md);font-size:var(--font-sm);color:var(--text-secondary)}.cache-options[data-v-64d33b34]{display:flex;flex-direction:column;gap:var(--spacing-sm)}.cache-option[data-v-64d33b34]{display:flex;align-items:flex-start;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast)}.cache-option[data-v-64d33b34]:hover{border-color:var(--primary-color)}.cache-option input[type=checkbox][data-v-64d33b34]{margin-top:2px;cursor:pointer;accent-color:var(--primary-color)}.cache-option .option-text[data-v-64d33b34]{display:flex;flex-direction:column;gap:2px}.cache-option .option-text strong[data-v-64d33b34]{font-size:var(--font-sm);color:var(--text-color)}.cache-option .option-text small[data-v-64d33b34]{font-size:var(--font-xs);color:var(--text-muted);line-height:1.4}.dialog-footer[data-v-64d33b34]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-md) var(--spacing-lg);border-top:1px solid var(--border-color)}.btn-cancel[data-v-64d33b34]{padding:var(--spacing-xs) var(--spacing-md);background:rgba(0,0,0,0);border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:var(--font-sm);color:var(--text-secondary);cursor:pointer;transition:all var(--transition-fast)}.btn-cancel[data-v-64d33b34]:hover{background:var(--bg-hover);color:var(--text-color)}.btn-confirm[data-v-64d33b34]{padding:var(--spacing-xs) var(--spacing-md);background:var(--primary-color);border:none;border-radius:var(--radius-sm);font-size:var(--font-sm);color:#fff;cursor:pointer;transition:all var(--transition-fast)}.btn-confirm[data-v-64d33b34]:hover:not(:disabled){background:var(--primary-hover)}.btn-confirm[data-v-64d33b34]:disabled{opacity:.5;cursor:not-allowed}@media (max-width:768px){.panel-header[data-v-64d33b34]{padding:var(--spacing-sm) var(--spacing-md)}.header-title[data-v-64d33b34]{font-size:var(--font-md)}.panel-body[data-v-64d33b34]{padding:var(--spacing-md)}.changelog-content[data-v-64d33b34] .md-h2{font-size:var(--font-lg)}.changelog-content[data-v-64d33b34] .md-h3{font-size:var(--font-md)}.changelog-content[data-v-64d33b34] .code-block{padding:var(--spacing-sm)}.changelog-content[data-v-64d33b34] .code-block code{font-size:11px}.panel-footer[data-v-64d33b34]{padding:var(--spacing-xs) var(--spacing-md);flex-wrap:wrap;gap:var(--spacing-xs)}.footer-info[data-v-64d33b34]{width:100%;margin-bottom:var(--spacing-xs)}.footer-actions[data-v-64d33b34]{width:100%;justify-content:flex-end}.cache-dialog[data-v-64d33b34]{width:95%;margin:var(--spacing-md)}.dialog-body[data-v-64d33b34]{padding:var(--spacing-md)}.dialog-footer[data-v-64d33b34]{padding:var(--spacing-sm) var(--spacing-md)}}
.tree-item[data-v-78809202]{font-family:"SF Mono","Fira Code","Consolas",monospace;font-size:13px;line-height:1.4}.item-row[data-v-78809202]{display:flex;align-items:center;gap:4px;padding:3px 8px;padding-right:16px;min-height:26px;cursor:default;border-radius:4px;transition:background .1s}.item-row[data-v-78809202]:hover{background:var(--vm-bg-hover,var(--bg-hover,#f0f0f0))}.tree-item.is-match>.item-row[data-v-78809202]{background:rgba(255,235,59,.15)}.toggle-btn[data-v-78809202]{display:flex;align-items:center;justify-content:center;width:16px;height:16px;flex-shrink:0;cursor:pointer;color:var(--vm-text-muted,var(--text-disabled,#9a9996));transition:color .1s}.toggle-btn svg[data-v-78809202]{width:12px;height:12px}.toggle-btn[data-v-78809202]:hover{color:var(--vm-text-primary,var(--text-color,#2e3436))}.toggle-placeholder[data-v-78809202]{width:16px;flex-shrink:0}.item-key[data-v-78809202]{color:var(--vm-text-primary,var(--text-color,#2e3436));font-weight:500;flex-shrink:0}.item-key.is-meta[data-v-78809202]{color:var(--vm-text-muted,var(--text-disabled,#9a9996));font-style:italic}.separator[data-v-78809202]{color:var(--vm-text-muted,var(--text-disabled,#9a9996));margin:0 4px;flex-shrink:0}.item-value[data-v-78809202]{flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.item-value.type-string[data-v-78809202]{color:#b35000}.item-value.type-number[data-v-78809202]{color:#2e7d32}.item-value.type-boolean[data-v-78809202]{color:#0d47a1}.item-value.type-array[data-v-78809202]{color:#7b1fa2;font-style:italic}.item-value.type-object[data-v-78809202]{color:#6d5600;font-style:italic}.item-value.type-null[data-v-78809202],.item-value.type-undefined[data-v-78809202]{color:#616161;font-style:italic}:root.dark-theme .item-value.type-string[data-v-78809202]{color:#e9a178}:root.dark-theme .item-value.type-number[data-v-78809202]{color:#b8d7a3}:root.dark-theme .item-value.type-boolean[data-v-78809202]{color:#7eb8da}:root.dark-theme .item-value.type-array[data-v-78809202]{color:#c792ea}:root.dark-theme .item-value.type-object[data-v-78809202]{color:#dcdcaa}:root.dark-theme .item-value.type-null[data-v-78809202],:root.dark-theme .item-value.type-undefined[data-v-78809202]{color:#9e9e9e}.children-hint[data-v-78809202]{color:var(--vm-text-muted,var(--text-disabled,#9a9996));font-size:11px;margin-left:4px}.inline-editor[data-v-78809202]{display:flex;align-items:center;gap:6px;flex:1}.edit-input[data-v-78809202],.edit-select[data-v-78809202]{flex:1;min-width:120px;max-width:400px;padding:2px 8px;background:var(--vm-bg-tertiary,var(--bg-tertiary,#deddda));border:1px solid var(--vm-accent-color,var(--primary-color,#1a5fb4));border-radius:4px;font-family:"SF Mono","Fira Code","Consolas",monospace;font-size:13px;color:var(--vm-text-primary,var(--text-color,#2e3436));outline:none}.edit-select[data-v-78809202]{cursor:pointer}.edit-actions[data-v-78809202]{display:flex;gap:4px}.btn-edit-save[data-v-78809202],.btn-edit-cancel[data-v-78809202]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:all .1s}.btn-edit-save[data-v-78809202]{background:var(--vm-success-color,var(--success-color,#26a269));color:#fff}.btn-edit-save[data-v-78809202]:hover{filter:brightness(0.9)}.btn-edit-cancel[data-v-78809202]{background:var(--vm-bg-tertiary,var(--bg-tertiary,#deddda));color:var(--vm-text-secondary,var(--text-secondary,#5e5c64))}.btn-edit-cancel[data-v-78809202]:hover{background:var(--vm-bg-hover,var(--bg-hover,#f0f0f0));color:var(--vm-text-primary,var(--text-color,#2e3436))}.item-actions[data-v-78809202]{display:flex;gap:2px;margin-left:auto;flex-shrink:0}.action-btn[data-v-78809202]{display:flex;align-items:center;justify-content:center;width:22px;height:22px;background:rgba(0,0,0,0);border:none;border-radius:4px;color:var(--vm-text-muted,var(--text-disabled,#9a9996));cursor:pointer;transition:all .1s}.action-btn svg[data-v-78809202]{width:13px;height:13px}.action-btn[data-v-78809202]:hover{background:var(--vm-bg-hover,var(--bg-hover,#f0f0f0));color:var(--vm-text-primary,var(--text-color,#2e3436))}.action-btn.action-delete[data-v-78809202]:hover{background:rgba(192,28,40,.15);color:var(--vm-danger-color,var(--danger-color,#c01c28))}.item-children[data-v-78809202]{border-left:1px solid var(--vm-border-color,var(--border-color,#c0bfbc));margin-left:15px}
.variable-manager-panel[data-v-2eea0e48]{--vm-bg-primary:var(--bg-color,#f6f5f4);--vm-bg-secondary:var(--bg-secondary,#ffffff);--vm-bg-tertiary:var(--bg-tertiary,#deddda);--vm-bg-hover:var(--bg-hover,#f0f0f0);--vm-border-color:var(--border-color,#c0bfbc);--vm-border-light:var(--border-light,#e5e5e5);--vm-text-primary:var(--text-color,#2e3436);--vm-text-secondary:var(--text-secondary,#5e5c64);--vm-text-muted:var(--text-disabled,#9a9996);--vm-accent-color:var(--primary-color,#1a5fb4);--vm-accent-hover:var(--primary-hover,#3584e4);--vm-success-color:var(--success-color,#26a269);--vm-danger-color:var(--danger-color,#c01c28);display:flex;flex-direction:column;height:100%;background:var(--vm-bg-primary);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;font-size:14px;color:var(--vm-text-primary);overflow:hidden;-webkit-font-smoothing:antialiased}.panel-header[data-v-2eea0e48]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--vm-bg-secondary);border-bottom:1px solid var(--vm-border-color);flex-shrink:0}.header-left[data-v-2eea0e48]{display:flex;align-items:center;gap:10px}.header-title[data-v-2eea0e48]{font-size:16px;font-weight:600;letter-spacing:.3px}.status-dot[data-v-2eea0e48]{width:8px;height:8px;border-radius:50%;background:var(--vm-danger-color)}.status-dot.connected[data-v-2eea0e48]{background:var(--vm-success-color)}.header-actions[data-v-2eea0e48]{display:flex;align-items:center;gap:8px}.btn-text[data-v-2eea0e48]{display:flex;align-items:center;gap:4px;padding:6px 12px;background:var(--vm-accent-color);border:none;border-radius:6px;color:#fff;font-size:13px;font-weight:500;cursor:pointer;transition:background .15s}.btn-text[data-v-2eea0e48]:hover{background:var(--vm-accent-hover)}.btn-text .btn-icon[data-v-2eea0e48]{font-size:16px;font-weight:600}.btn-icon-only[data-v-2eea0e48]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:rgba(0,0,0,0);border:1px solid var(--vm-border-color);border-radius:6px;color:var(--vm-text-secondary);cursor:pointer;transition:all .15s}.btn-icon-only svg[data-v-2eea0e48]{width:18px;height:18px}.btn-icon-only[data-v-2eea0e48]:hover{background:var(--vm-bg-hover);color:var(--vm-text-primary);border-color:var(--vm-border-light)}.btn-icon-only[data-v-2eea0e48]:disabled{opacity:.5;cursor:not-allowed}.btn-icon-only.loading .icon-refresh[data-v-2eea0e48]{animation:spin-2eea0e48 1s linear infinite}.btn-icon-only.btn-close[data-v-2eea0e48]:hover{background:rgba(192,28,40,.15);border-color:var(--vm-danger-color);color:var(--vm-danger-color)}@keyframes spin-2eea0e48{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.toolbar[data-v-2eea0e48]{display:flex;align-items:center;gap:12px;padding:10px 16px;background:var(--vm-bg-secondary);border-bottom:1px solid var(--vm-border-color);flex-shrink:0}.search-box[data-v-2eea0e48]{flex:1;display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--vm-bg-tertiary);border:1px solid var(--vm-border-color);border-radius:8px;transition:border-color .15s}.search-box[data-v-2eea0e48]:focus-within{border-color:var(--vm-accent-color)}.search-box .search-icon[data-v-2eea0e48]{width:16px;height:16px;color:var(--vm-text-muted);flex-shrink:0}.search-box .search-input[data-v-2eea0e48]{flex:1;background:rgba(0,0,0,0);border:none;font-size:14px;color:var(--vm-text-primary);outline:none}.search-box .search-input[data-v-2eea0e48]::placeholder{color:var(--vm-text-muted)}.search-box .btn-clear[data-v-2eea0e48]{display:flex;align-items:center;justify-content:center;width:20px;height:20px;background:rgba(0,0,0,0);border:none;color:var(--vm-text-muted);cursor:pointer;padding:0}.search-box .btn-clear svg[data-v-2eea0e48]{width:14px;height:14px}.search-box .btn-clear[data-v-2eea0e48]:hover{color:var(--vm-text-primary)}.view-options[data-v-2eea0e48]{display:flex;align-items:center}.option-toggle[data-v-2eea0e48]{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--vm-text-secondary);cursor:pointer}.option-toggle input[type=checkbox][data-v-2eea0e48]{width:14px;height:14px;accent-color:var(--vm-accent-color)}.option-toggle[data-v-2eea0e48]:hover{color:var(--vm-text-primary)}.main-content[data-v-2eea0e48]{flex:1;overflow-y:auto;min-height:0}.main-content[data-v-2eea0e48]::-webkit-scrollbar{width:8px}.main-content[data-v-2eea0e48]::-webkit-scrollbar-thumb{background:var(--vm-border-color);border-radius:4px}.main-content[data-v-2eea0e48]::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.state-container[data-v-2eea0e48]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;gap:16px}.state-icon[data-v-2eea0e48]{width:64px;height:64px;color:var(--vm-text-muted)}.state-text[data-v-2eea0e48]{font-size:15px;color:var(--vm-text-secondary)}.loading-spinner[data-v-2eea0e48]{width:36px;height:36px;border:3px solid var(--vm-border-color);border-top-color:var(--vm-accent-color);border-radius:50%;animation:spin-2eea0e48 .8s linear infinite}.tree-view[data-v-2eea0e48]{padding:8px 0}.tree-root[data-v-2eea0e48]{font-family:"SF Mono","Fira Code","Consolas",monospace;font-size:13px;line-height:1.6}.status-bar[data-v-2eea0e48]{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;background:var(--vm-bg-secondary);border-top:1px solid var(--vm-border-color);flex-shrink:0}.stat-item[data-v-2eea0e48]{font-size:12px;color:var(--vm-text-muted)}.modal-overlay[data-v-2eea0e48]{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(2px)}.modal-dialog[data-v-2eea0e48]{background:var(--vm-bg-primary);border:1px solid var(--vm-border-color);border-radius:12px;width:420px;max-width:calc(100% - 32px);box-shadow:var(--shadow-lg,0 20px 60px rgba(0,0,0,0.4))}.modal-header[data-v-2eea0e48]{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--vm-border-color)}.modal-header h3[data-v-2eea0e48]{margin:0;font-size:16px;font-weight:600}.btn-close-modal[data-v-2eea0e48]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;background:rgba(0,0,0,0);border:none;border-radius:6px;color:var(--vm-text-secondary);cursor:pointer}.btn-close-modal svg[data-v-2eea0e48]{width:16px;height:16px}.btn-close-modal[data-v-2eea0e48]:hover{background:var(--vm-bg-hover);color:var(--vm-text-primary)}.modal-body[data-v-2eea0e48]{padding:20px}.modal-footer[data-v-2eea0e48]{display:flex;justify-content:flex-end;gap:10px;padding:16px 20px;border-top:1px solid var(--vm-border-color)}.form-group[data-v-2eea0e48]{margin-bottom:20px}.form-group[data-v-2eea0e48]:last-child{margin-bottom:0}.form-label[data-v-2eea0e48]{display:block;margin-bottom:8px;font-size:13px;font-weight:500;color:var(--vm-text-secondary)}.path-input-group[data-v-2eea0e48]{display:flex;align-items:center;gap:4px}.path-input-group .path-prefix[data-v-2eea0e48]{font-family:"SF Mono","Fira Code","Consolas",monospace;font-size:13px;color:var(--vm-text-muted);white-space:nowrap}.form-input[data-v-2eea0e48]{flex:1;width:100%;padding:10px 12px;background:var(--vm-bg-tertiary);border:1px solid var(--vm-border-color);border-radius:8px;font-size:14px;color:var(--vm-text-primary);outline:none;transition:border-color .15s}.form-input[data-v-2eea0e48]:focus{border-color:var(--vm-accent-color)}.form-input[data-v-2eea0e48]::placeholder{color:var(--vm-text-muted)}.type-selector[data-v-2eea0e48]{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}.type-option[data-v-2eea0e48]{display:flex;flex-direction:column;align-items:center;gap:4px;padding:12px 8px;background:var(--vm-bg-tertiary);border:1px solid var(--vm-border-color);border-radius:8px;cursor:pointer;transition:all .15s}.type-option .type-icon[data-v-2eea0e48]{font-family:"SF Mono","Fira Code","Consolas",monospace;font-size:16px;font-weight:600}.type-option .type-name[data-v-2eea0e48]{font-size:11px;color:var(--vm-text-secondary)}.type-option[data-v-2eea0e48]:hover{background:var(--vm-bg-hover);border-color:var(--vm-border-light)}.type-option.active[data-v-2eea0e48]{border-width:2px}.type-option.active.type-string[data-v-2eea0e48]{border-color:#b35000}.type-option.active.type-string .type-icon[data-v-2eea0e48]{color:#b35000}.type-option.active.type-number[data-v-2eea0e48]{border-color:#2e7d32}.type-option.active.type-number .type-icon[data-v-2eea0e48]{color:#2e7d32}.type-option.active.type-boolean[data-v-2eea0e48]{border-color:#0d47a1}.type-option.active.type-boolean .type-icon[data-v-2eea0e48]{color:#0d47a1}.type-option.active.type-object[data-v-2eea0e48]{border-color:#6d5600}.type-option.active.type-object .type-icon[data-v-2eea0e48]{color:#6d5600}.type-option.active.type-array[data-v-2eea0e48]{border-color:#7b1fa2}.type-option.active.type-array .type-icon[data-v-2eea0e48]{color:#7b1fa2}.type-option.active.type-null[data-v-2eea0e48]{border-color:#616161}.type-option.active.type-null .type-icon[data-v-2eea0e48]{color:#616161}.boolean-toggle[data-v-2eea0e48]{display:flex;gap:10px}.bool-btn[data-v-2eea0e48]{flex:1;padding:10px;background:var(--vm-bg-tertiary);border:1px solid var(--vm-border-color);border-radius:8px;font-size:14px;font-weight:500;color:var(--vm-text-secondary);cursor:pointer;transition:all .15s}.bool-btn[data-v-2eea0e48]:hover{background:var(--vm-bg-hover);border-color:var(--vm-border-light)}.bool-btn.active[data-v-2eea0e48]{background:rgba(13,71,161,.15);border-color:#0d47a1;color:#0d47a1}.btn-primary[data-v-2eea0e48]{padding:10px 20px;background:var(--vm-accent-color);border:none;border-radius:8px;font-size:14px;font-weight:500;color:#fff;cursor:pointer;transition:background .15s}.btn-primary[data-v-2eea0e48]:hover:not(:disabled){background:var(--vm-accent-hover)}.btn-primary[data-v-2eea0e48]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[data-v-2eea0e48]{padding:10px 20px;background:rgba(0,0,0,0);border:1px solid var(--vm-border-color);border-radius:8px;font-size:14px;font-weight:500;color:var(--vm-text-secondary);cursor:pointer;transition:all .15s}.btn-secondary[data-v-2eea0e48]:hover{background:var(--vm-bg-hover);color:var(--vm-text-primary)}
.review-dialog-overlay[data-v-dbd9312c]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:10020 !important;padding:var(--spacing-md,16px)}.review-dialog[data-v-dbd9312c]{background:var(--bg-secondary,#ffffff);border-radius:var(--radius-lg,12px);box-shadow:0 20px 40px rgba(0,0,0,.2);max-width:700px;width:100%;max-height:85vh;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;animation:dialog-enter-dbd9312c .25s ease-out}.review-dialog.has-errors[data-v-dbd9312c]{border:2px solid var(--warning-color,#e5a50a)}.dialog-header[data-v-dbd9312c]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-lg,20px);background:var(--bg-tertiary,#f6f5f4);border-bottom:1px solid var(--border-color,#e0e0e0)}.header-left[data-v-dbd9312c]{display:flex;align-items:center;gap:var(--spacing-sm,8px)}.header-icon[data-v-dbd9312c]{font-size:24px}.header-title[data-v-dbd9312c]{margin:0;font-size:var(--font-lg,18px);font-weight:600;color:var(--text-color,#2e3436)}.header-status[data-v-dbd9312c]{display:flex;align-items:center}.status-badge[data-v-dbd9312c]{padding:4px 12px;border-radius:16px;font-size:var(--font-sm,13px);font-weight:500}.status-badge.status-passed[data-v-dbd9312c]{background:var(--success-light,rgba(38,162,105,0.15));color:var(--success-color,#26a269)}.status-badge.status-failed[data-v-dbd9312c]{background:var(--warning-light,rgba(229,165,10,0.15));color:var(--warning-dark,#b58900)}.status-badge.status-pending[data-v-dbd9312c]{background:var(--bg-hover,#e0e0e0);color:var(--text-secondary,#666)}.review-summary[data-v-dbd9312c]{display:flex;flex-wrap:wrap;gap:var(--spacing-sm,8px);padding:var(--spacing-md,16px) var(--spacing-lg,20px);background:var(--bg-color,#fff);border-bottom:1px solid var(--border-light,#f0f0f0)}.summary-item[data-v-dbd9312c]{display:flex;align-items:center;gap:6px;padding:6px 12px;background:var(--bg-tertiary,#f5f5f5);border-radius:var(--radius-sm,4px);font-size:var(--font-sm,13px)}.tag-icon[data-v-dbd9312c]{font-size:12px;width:16px;height:16px;display:flex;align-items:center;justify-content:center;border-radius:50%}.tag-icon.tag-ok[data-v-dbd9312c]{background:var(--success-color,#26a269);color:#fff}.tag-icon.tag-missing[data-v-dbd9312c]{background:var(--text-disabled,#999);color:#fff}.tag-icon.tag-error[data-v-dbd9312c]{background:var(--error-color,#c01c28);color:#fff}.tag-name[data-v-dbd9312c]{font-weight:500;color:var(--text-color,#333)}.tag-status[data-v-dbd9312c]{color:var(--text-secondary,#666)}.issues-section[data-v-dbd9312c]{padding:var(--spacing-md,16px) var(--spacing-lg,20px);background:var(--warning-light,rgba(229,165,10,0.08));border-bottom:1px solid var(--border-light,#f0f0f0)}.section-title[data-v-dbd9312c]{display:flex;align-items:center;gap:var(--spacing-sm,8px);font-size:var(--font-md,14px);font-weight:600;color:var(--text-color,#333);margin-bottom:var(--spacing-sm,8px)}.section-icon[data-v-dbd9312c]{font-size:16px}.issues-list[data-v-dbd9312c]{display:flex;flex-direction:column;gap:6px}.issue-item[data-v-dbd9312c]{display:flex;align-items:flex-start;gap:8px;padding:8px 12px;border-radius:var(--radius-sm,4px);font-size:var(--font-sm,13px)}.issue-item.issue-error[data-v-dbd9312c]{background:var(--error-light,rgba(192,28,40,0.1));color:var(--error-color,#c01c28)}.issue-item.issue-warning[data-v-dbd9312c]{background:var(--warning-light,rgba(229,165,10,0.1));color:var(--warning-dark,#b58900)}.issue-item.issue-info[data-v-dbd9312c]{background:var(--info-light,rgba(28,113,216,0.1));color:var(--info-color,#1c71d8)}.issue-icon[data-v-dbd9312c]{flex-shrink:0}.issue-message[data-v-dbd9312c]{line-height:1.4}.variables-section[data-v-dbd9312c]{padding:var(--spacing-md,16px) var(--spacing-lg,20px);background:var(--bg-color,#fff);border-bottom:1px solid var(--border-light,#f0f0f0)}.variables-list[data-v-dbd9312c]{display:flex;flex-direction:column;gap:4px;max-height:150px;overflow-y:auto}.variable-item[data-v-dbd9312c]{display:flex;align-items:center;gap:8px;padding:6px 10px;background:var(--bg-tertiary,#f5f5f5);border-radius:var(--radius-sm,4px);font-family:monospace;font-size:var(--font-xs,12px)}.var-path[data-v-dbd9312c]{color:var(--primary-color,#6366f1);font-weight:500}.var-op[data-v-dbd9312c]{color:var(--text-secondary,#666)}.var-value[data-v-dbd9312c]{color:var(--success-color,#26a269)}.more-hint[data-v-dbd9312c]{text-align:center;padding:8px;color:var(--text-secondary,#666);font-size:var(--font-xs,12px)}.content-section[data-v-dbd9312c]{flex:1;display:flex;flex-direction:column;min-height:200px;overflow:hidden}.section-header[data-v-dbd9312c]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md,16px) var(--spacing-lg,20px);background:var(--bg-tertiary,#f6f5f4);border-bottom:1px solid var(--border-light,#f0f0f0)}.section-actions[data-v-dbd9312c]{display:flex;gap:var(--spacing-sm,8px)}.btn-toggle[data-v-dbd9312c]{padding:4px 10px;font-size:var(--font-xs,12px);background:var(--bg-color,#fff);border:1px solid var(--border-color,#ccc);border-radius:var(--radius-sm,4px);cursor:pointer;transition:all .15s}.btn-toggle[data-v-dbd9312c]:hover{background:var(--bg-hover,#f0f0f0)}.content-preview[data-v-dbd9312c]{flex:1;overflow-y:auto;padding:var(--spacing-md,16px) var(--spacing-lg,20px);background:var(--bg-color,#fff)}.raw-content[data-v-dbd9312c]{margin:0;white-space:pre-wrap;word-break:break-word;font-family:monospace;font-size:var(--font-sm,13px);line-height:1.6;color:var(--text-color,#333)}.parsed-content[data-v-dbd9312c]{font-size:var(--font-md,15px);line-height:1.8;color:var(--text-color,#333)}.parsed-content[data-v-dbd9312c] .empty-hint{color:var(--text-disabled,#999);text-align:center;padding:var(--spacing-lg,20px)}.dialog-footer[data-v-dbd9312c]{display:flex;justify-content:space-between;gap:var(--spacing-md,16px);padding:var(--spacing-lg,20px);background:var(--bg-tertiary,#f6f5f4);border-top:1px solid var(--border-color,#e0e0e0)}.btn[data-v-dbd9312c]{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 24px;font-size:var(--font-md,14px);font-weight:500;border-radius:var(--radius-md,6px);border:none;cursor:pointer;transition:all .15s}.btn[data-v-dbd9312c]:disabled{opacity:.6;cursor:not-allowed}.btn-icon[data-v-dbd9312c]{font-size:16px}.btn-rollback[data-v-dbd9312c]{background:var(--bg-color,#fff);color:var(--error-color,#c01c28);border:1px solid var(--error-color,#c01c28)}.btn-rollback[data-v-dbd9312c]:hover:not(:disabled){background:var(--error-light,rgba(192,28,40,0.1))}.btn-confirm[data-v-dbd9312c]{background:var(--success-color,#26a269);color:#fff;flex:1;max-width:200px}.btn-confirm[data-v-dbd9312c]:hover:not(:disabled){filter:brightness(1.1)}.btn-confirm.btn-warning[data-v-dbd9312c]{background:var(--warning-color,#e5a50a);color:var(--text-highlight,#000)}.loading-spinner[data-v-dbd9312c]{width:16px;height:16px;border:2px solid hsla(0,0%,100%,.3);border-top-color:#fff;border-radius:50%;animation:spin-dbd9312c .8s linear infinite}@keyframes spin-dbd9312c{to{transform:rotate(360deg)}}@keyframes dialog-enter-dbd9312c{from{opacity:0;transform:scale(0.95) translateY(-20px)}to{opacity:1;transform:scale(1) translateY(0)}}.review-dialog-enter-active[data-v-dbd9312c],.review-dialog-leave-active[data-v-dbd9312c]{transition:opacity .2s ease}.review-dialog-enter-from[data-v-dbd9312c],.review-dialog-leave-to[data-v-dbd9312c]{opacity:0}.review-dialog-enter-active .review-dialog[data-v-dbd9312c]{animation:dialog-enter-dbd9312c .25s ease-out}.review-dialog-leave-active .review-dialog[data-v-dbd9312c]{animation:dialog-enter-dbd9312c .2s ease-in reverse}@media (max-width:600px){.review-dialog-overlay[data-v-dbd9312c]{padding:var(--spacing-xs,8px);align-items:flex-start}.review-dialog[data-v-dbd9312c]{max-height:calc(100vh - 16px);max-width:calc(100vw - 16px);margin:0}.dialog-header[data-v-dbd9312c]{flex-direction:column;gap:var(--spacing-sm,8px);align-items:flex-start;position:sticky;top:0;z-index:10}.dialog-footer[data-v-dbd9312c]{flex-direction:column-reverse;position:sticky;bottom:0;z-index:10}.btn[data-v-dbd9312c]{width:100%;max-width:none}.review-summary[data-v-dbd9312c]{flex-direction:column}.content-section[data-v-dbd9312c]{min-height:150px}.content-preview[data-v-dbd9312c]{max-height:200px}}@media (max-height:600px){.review-dialog-overlay[data-v-dbd9312c]{padding:var(--spacing-xs,8px);align-items:flex-start}.review-dialog[data-v-dbd9312c]{max-height:calc(100vh - 16px)}.dialog-header[data-v-dbd9312c]{padding:var(--spacing-sm,12px) var(--spacing-md,16px);position:sticky;top:0;z-index:10}.dialog-footer[data-v-dbd9312c]{padding:var(--spacing-sm,12px) var(--spacing-md,16px);position:sticky;bottom:0;z-index:10}.content-section[data-v-dbd9312c]{min-height:100px}.content-preview[data-v-dbd9312c]{max-height:150px}.variables-list[data-v-dbd9312c]{max-height:100px}}@media (max-height:400px){.review-dialog[data-v-dbd9312c]{max-height:calc(100vh - 8px)}.dialog-header[data-v-dbd9312c],.dialog-footer[data-v-dbd9312c]{padding:var(--spacing-xs,8px) var(--spacing-sm,12px)}.header-icon[data-v-dbd9312c]{font-size:18px}.header-title[data-v-dbd9312c]{font-size:var(--font-md,14px)}.btn[data-v-dbd9312c]{padding:8px 16px;font-size:var(--font-sm,13px)}.review-summary[data-v-dbd9312c]{padding:var(--spacing-xs,8px) var(--spacing-sm,12px)}.issues-section[data-v-dbd9312c],.variables-section[data-v-dbd9312c]{padding:var(--spacing-xs,8px) var(--spacing-sm,12px)}.content-preview[data-v-dbd9312c]{max-height:100px;padding:var(--spacing-xs,8px) var(--spacing-sm,12px)}}:root.dark-theme .review-dialog[data-v-dbd9312c]{background:var(--bg-secondary,#2d2d2d);box-shadow:0 20px 40px rgba(0,0,0,.5)}:root.dark-theme .dialog-header[data-v-dbd9312c],:root.dark-theme .section-header[data-v-dbd9312c],:root.dark-theme .dialog-footer[data-v-dbd9312c]{background:var(--bg-tertiary,#3d3d3d);border-color:var(--border-color,#4d4d4d)}:root.dark-theme .header-title[data-v-dbd9312c],:root.dark-theme .section-title[data-v-dbd9312c]{color:var(--text-color,#f5f5f5)}:root.dark-theme .content-preview[data-v-dbd9312c]{background:var(--bg-color,#1e1e1e)}:root.dark-theme .raw-content[data-v-dbd9312c],:root.dark-theme .parsed-content[data-v-dbd9312c]{color:var(--text-color,#e0e0e0)}:root.dark-theme .btn-toggle[data-v-dbd9312c]{background:var(--bg-color,#1e1e1e);border-color:var(--border-color,#4d4d4d);color:var(--text-color,#e0e0e0)}:root.dark-theme .btn-toggle[data-v-dbd9312c]:hover{background:var(--bg-hover,#3d3d3d)}:root.dark-theme .btn-rollback[data-v-dbd9312c]{background:rgba(0,0,0,0)}
.auto-save-settings[data-v-1d1dfdc8]{padding:var(--spacing-sm)}.settings-title[data-v-1d1dfdc8]{margin:0 0 var(--spacing-md) 0;font-size:var(--font-md);font-weight:600;color:var(--text-color);border-bottom:1px solid var(--border-light);padding-bottom:var(--spacing-sm)}.setting-item[data-v-1d1dfdc8]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:var(--radius-md);margin-bottom:var(--spacing-sm);transition:all var(--transition-fast)}.setting-item[data-v-1d1dfdc8]:hover:not(.disabled){border-color:var(--border-hover)}.setting-item.disabled[data-v-1d1dfdc8]{opacity:.5;background:var(--bg-tertiary)}.setting-info[data-v-1d1dfdc8]{flex:1;margin-right:var(--spacing-md)}.setting-label[data-v-1d1dfdc8]{font-size:var(--font-sm);font-weight:500;color:var(--text-color);margin-bottom:var(--spacing-xs)}.setting-desc[data-v-1d1dfdc8]{font-size:var(--font-xs);color:var(--text-secondary);line-height:1.5}.setting-control[data-v-1d1dfdc8]{display:flex;align-items:center;gap:var(--spacing-sm)}.number-input[data-v-1d1dfdc8],.text-input[data-v-1d1dfdc8]{padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-color);font-size:var(--font-sm);transition:all var(--transition-fast)}.number-input[data-v-1d1dfdc8]:focus,.text-input[data-v-1d1dfdc8]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px var(--primary-light)}.number-input[data-v-1d1dfdc8]:disabled,.text-input[data-v-1d1dfdc8]:disabled{opacity:.5;cursor:not-allowed;background:var(--bg-tertiary)}.number-input[data-v-1d1dfdc8]{width:80px;text-align:center}.text-input[data-v-1d1dfdc8]{width:120px}.unit[data-v-1d1dfdc8]{font-size:var(--font-xs);color:var(--text-secondary)}.toggle-switch[data-v-1d1dfdc8]{position:relative;display:inline-block;width:48px;height:26px}.toggle-switch input[data-v-1d1dfdc8]{opacity:0;width:0;height:0}.toggle-switch input:checked+.toggle-slider[data-v-1d1dfdc8]{background:var(--primary-color)}.toggle-switch input:checked+.toggle-slider[data-v-1d1dfdc8]::before{transform:translateX(22px)}.toggle-switch input:disabled+.toggle-slider[data-v-1d1dfdc8]{opacity:.5;cursor:not-allowed}.toggle-slider[data-v-1d1dfdc8]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:var(--bg-tertiary);border-radius:26px;transition:all var(--transition-normal);border:1px solid var(--border-color)}.toggle-slider[data-v-1d1dfdc8]::before{position:absolute;content:"";height:20px;width:20px;left:2px;bottom:2px;background:#fff;border-radius:50%;transition:all var(--transition-normal);box-shadow:var(--shadow-sm)}.setting-actions[data-v-1d1dfdc8]{display:flex;justify-content:flex-end;margin-top:var(--spacing-md);padding-top:var(--spacing-md);border-top:1px solid var(--border-light)}.status-section[data-v-1d1dfdc8]{margin-top:var(--spacing-lg);padding:var(--spacing-md);background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:var(--radius-md)}.status-title[data-v-1d1dfdc8]{margin:0 0 var(--spacing-sm) 0;font-size:var(--font-sm);font-weight:600;color:var(--text-color)}.status-items[data-v-1d1dfdc8]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.status-item[data-v-1d1dfdc8]{display:flex;align-items:center;gap:var(--spacing-sm);font-size:var(--font-sm)}.status-label[data-v-1d1dfdc8]{color:var(--text-secondary)}.status-value[data-v-1d1dfdc8]{color:var(--text-color);font-weight:500}.status-value.active[data-v-1d1dfdc8]{color:var(--success-color)}.info-section[data-v-1d1dfdc8]{margin-top:var(--spacing-md);padding:var(--spacing-md);background:var(--info-light);border:1px solid var(--info-color);border-radius:var(--radius-md)}.info-title[data-v-1d1dfdc8]{margin:0 0 var(--spacing-sm) 0;font-size:var(--font-sm);font-weight:600;color:var(--info-color)}.info-list[data-v-1d1dfdc8]{margin:0;padding-left:var(--spacing-lg);font-size:var(--font-xs);color:var(--text-secondary);line-height:1.8}.info-list li[data-v-1d1dfdc8]{margin-bottom:var(--spacing-xs)}.btn[data-v-1d1dfdc8]{display:inline-flex;align-items:center;justify-content:center;padding:var(--spacing-sm) var(--spacing-md);border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:var(--font-sm);font-weight:500;transition:all var(--transition-fast)}.btn.btn-secondary[data-v-1d1dfdc8]{background:var(--bg-secondary);color:var(--text-color);border:1px solid var(--border-color)}.btn.btn-secondary[data-v-1d1dfdc8]:hover{background:var(--bg-hover);border-color:var(--border-hover)}@media (max-width:768px){.setting-item[data-v-1d1dfdc8]{flex-direction:column;align-items:flex-start;gap:var(--spacing-sm)}.setting-info[data-v-1d1dfdc8]{margin-right:0}.setting-control[data-v-1d1dfdc8]{width:100%;justify-content:flex-end}}
.save-manager[data-v-63e5f2b9]{display:flex;flex-direction:column;height:100%;background:var(--bg-secondary);color:var(--text-color);border-radius:var(--radius-lg);overflow:hidden}.save-header[data-v-63e5f2b9]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background:var(--bg-tertiary);border-bottom:1px solid var(--border-color)}.save-title[data-v-63e5f2b9]{margin:0;font-size:var(--font-lg);font-weight:600;display:flex;align-items:center;gap:var(--spacing-sm);color:var(--text-color)}.save-title .icon[data-v-63e5f2b9]{font-size:var(--font-xl)}.header-actions[data-v-63e5f2b9]{display:flex;gap:var(--spacing-xs)}.save-stats[data-v-63e5f2b9]{display:flex;gap:var(--spacing-lg);padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-color);border-bottom:1px solid var(--border-light)}.stat-item[data-v-63e5f2b9]{display:flex;flex-direction:column;align-items:center;gap:2px}.stat-item .stat-label[data-v-63e5f2b9]{font-size:var(--font-xs);color:var(--text-secondary)}.stat-item .stat-value[data-v-63e5f2b9]{font-size:var(--font-lg);font-weight:600;color:var(--primary-color)}.tab-bar[data-v-63e5f2b9]{display:flex;background:var(--bg-secondary);border-bottom:1px solid var(--border-color)}.tab-btn[data-v-63e5f2b9]{flex:1;padding:var(--spacing-sm) var(--spacing-md);background:rgba(0,0,0,0);border:none;border-bottom:2px solid rgba(0,0,0,0);color:var(--text-secondary);font-size:var(--font-sm);cursor:pointer;transition:all var(--transition-fast)}.tab-btn[data-v-63e5f2b9]:hover{background:var(--bg-hover);color:var(--text-color)}.tab-btn.active[data-v-63e5f2b9]{color:var(--primary-color);border-bottom-color:var(--primary-color);background:var(--primary-light);font-weight:500}.save-content[data-v-63e5f2b9]{flex:1;overflow-y:auto;padding:var(--spacing-md);background:var(--bg-color)}.save-list-container[data-v-63e5f2b9]{display:flex;flex-direction:column;gap:var(--spacing-md)}.create-save-section[data-v-63e5f2b9]{display:flex;gap:var(--spacing-sm)}.save-name-input[data-v-63e5f2b9]{flex:1;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-color);font-size:var(--font-sm);transition:border-color var(--transition-fast)}.save-name-input[data-v-63e5f2b9]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px var(--primary-light)}.save-name-input[data-v-63e5f2b9]::placeholder{color:var(--text-disabled)}.auto-save-actions[data-v-63e5f2b9]{display:flex;gap:var(--spacing-sm)}.save-list[data-v-63e5f2b9]{display:flex;flex-direction:column;gap:var(--spacing-sm)}.save-item[data-v-63e5f2b9]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:var(--radius-md);transition:all var(--transition-fast)}.save-item[data-v-63e5f2b9]:hover{border-color:var(--primary-color);box-shadow:var(--shadow-sm)}.save-item.active[data-v-63e5f2b9]{border-color:var(--primary-color);background:var(--primary-light)}.save-item.auto-save[data-v-63e5f2b9]{border-left:3px solid var(--warning-color)}.save-info[data-v-63e5f2b9]{flex:1;min-width:0}.save-name[data-v-63e5f2b9]{font-weight:500;font-size:var(--font-sm);margin-bottom:var(--spacing-xs);display:flex;align-items:center;gap:var(--spacing-sm);color:var(--text-color)}.auto-badge[data-v-63e5f2b9]{font-size:10px;padding:2px 6px;background:var(--warning-color);color:var(--text-highlight);border-radius:var(--radius-xs);font-weight:500}.save-time[data-v-63e5f2b9]{font-size:var(--font-xs);color:var(--text-secondary);display:flex;flex-wrap:wrap;gap:var(--spacing-sm)}.save-source[data-v-63e5f2b9]{color:var(--primary-color)}.save-actions[data-v-63e5f2b9]{display:flex;gap:var(--spacing-xs)}.empty-state[data-v-63e5f2b9]{text-align:center;padding:var(--spacing-xxl) var(--spacing-lg);color:var(--text-secondary)}.empty-state p[data-v-63e5f2b9]{margin:0}.empty-state .hint[data-v-63e5f2b9]{font-size:var(--font-xs);margin-top:var(--spacing-sm);color:var(--text-disabled)}.save-footer[data-v-63e5f2b9]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border-top:1px solid var(--border-color)}.footer-left[data-v-63e5f2b9],.footer-right[data-v-63e5f2b9]{display:flex;gap:var(--spacing-sm)}.import-btn[data-v-63e5f2b9]{cursor:pointer}.error-message[data-v-63e5f2b9]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-sm) var(--spacing-md);background:var(--error-light);color:var(--error-color);border-top:1px solid var(--error-color);font-size:var(--font-sm)}.btn-close[data-v-63e5f2b9]{background:none;border:none;color:inherit;font-size:var(--font-lg);cursor:pointer;padding:var(--spacing-xs);border-radius:var(--radius-xs);transition:background var(--transition-fast)}.btn-close[data-v-63e5f2b9]:hover{background:rgba(0,0,0,.1)}.btn[data-v-63e5f2b9]{display:inline-flex;align-items:center;justify-content:center;padding:var(--spacing-sm) var(--spacing-md);border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:var(--font-sm);font-weight:500;transition:all var(--transition-fast)}.btn[data-v-63e5f2b9]:disabled{opacity:.5;cursor:not-allowed}.btn.btn-primary[data-v-63e5f2b9]{background:var(--primary-color);color:#fff}.btn.btn-primary[data-v-63e5f2b9]:hover:not(:disabled){background:var(--primary-hover)}.btn.btn-primary[data-v-63e5f2b9]:active:not(:disabled){background:var(--primary-active)}.btn.btn-secondary[data-v-63e5f2b9]{background:var(--bg-secondary);color:var(--text-color);border:1px solid var(--border-color)}.btn.btn-secondary[data-v-63e5f2b9]:hover:not(:disabled){background:var(--bg-hover);border-color:var(--border-hover)}.btn.btn-danger[data-v-63e5f2b9]{background:var(--error-color);color:#fff}.btn.btn-danger[data-v-63e5f2b9]:hover:not(:disabled){background:var(--error-hover)}.btn.btn-sm[data-v-63e5f2b9]{padding:var(--spacing-xs) var(--spacing-sm);font-size:var(--font-xs)}.btn.btn-icon[data-v-63e5f2b9]{padding:var(--spacing-xs) var(--spacing-sm);background:rgba(0,0,0,0);color:var(--text-secondary)}.btn.btn-icon[data-v-63e5f2b9]:hover:not(:disabled){background:var(--bg-hover);color:var(--text-color)}.spinning[data-v-63e5f2b9]{display:inline-block;animation:spin-63e5f2b9 1s linear infinite}@keyframes spin-63e5f2b9{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.confirm-overlay[data-v-63e5f2b9]{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);backdrop-filter:blur(2px);display:flex;justify-content:center;align-items:center;z-index:var(--z-modal)}.confirm-dialog[data-v-63e5f2b9]{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:var(--spacing-lg);min-width:300px;max-width:400px;box-shadow:var(--shadow-lg)}.confirm-title[data-v-63e5f2b9]{font-size:var(--font-lg);font-weight:600;margin-bottom:var(--spacing-sm);color:var(--text-color)}.confirm-message[data-v-63e5f2b9]{color:var(--text-secondary);margin-bottom:var(--spacing-lg);line-height:1.6;font-size:var(--font-sm)}.confirm-actions[data-v-63e5f2b9]{display:flex;justify-content:flex-end;gap:var(--spacing-sm)}@media (max-width:768px){.save-stats[data-v-63e5f2b9]{justify-content:space-around}.save-item[data-v-63e5f2b9]{flex-direction:column;align-items:flex-start;gap:var(--spacing-sm)}.save-actions[data-v-63e5f2b9]{width:100%;justify-content:flex-end}.save-footer[data-v-63e5f2b9]{flex-direction:column;gap:var(--spacing-sm)}.footer-left[data-v-63e5f2b9],.footer-right[data-v-63e5f2b9]{width:100%;justify-content:center}}
.context-manager-panel[data-v-71562640]{display:flex;flex-direction:column;height:100%;background:var(--bg-secondary);color:var(--text-color)}.panel-header[data-v-71562640]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md) var(--spacing-lg);border-bottom:1px solid var(--border-color);flex-shrink:0}.panel-header h3[data-v-71562640]{margin:0;font-size:var(--font-lg);display:flex;align-items:center;gap:var(--spacing-sm)}.btn-close[data-v-71562640]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--text-secondary);font-size:var(--font-lg);cursor:pointer;border-radius:var(--radius-sm);transition:all var(--transition-fast)}.btn-close[data-v-71562640]:hover{background:var(--bg-hover);color:var(--text-color)}.panel-body[data-v-71562640]{flex:1;overflow-y:auto;padding:var(--spacing-md);display:flex;flex-direction:column;gap:var(--spacing-md)}.section-title[data-v-71562640]{font-size:var(--font-sm);font-weight:600;color:var(--text-color);margin-bottom:var(--spacing-sm);display:flex;align-items:center;gap:var(--spacing-xs)}.stats-section[data-v-71562640]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);padding:var(--spacing-md)}.stats-grid[data-v-71562640]{display:grid;grid-template-columns:repeat(2,1fr);gap:var(--spacing-sm)}.stat-item[data-v-71562640]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-secondary);border-radius:var(--radius-xs)}.stat-item .stat-label[data-v-71562640]{font-size:var(--font-xs);color:var(--text-secondary)}.stat-item .stat-value[data-v-71562640]{font-size:var(--font-sm);font-weight:600;color:var(--primary-color)}.last-update[data-v-71562640]{margin-top:var(--spacing-sm);font-size:10px;color:var(--text-muted);text-align:right}.enable-section[data-v-71562640]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);padding:var(--spacing-md)}.enable-row[data-v-71562640]{display:flex;justify-content:space-between;align-items:center;margin-top:var(--spacing-sm)}.enable-label[data-v-71562640]{font-size:var(--font-sm);color:var(--text-color)}.toggle-switch[data-v-71562640]{position:relative;display:inline-block;width:44px;height:22px}.toggle-switch input[data-v-71562640]{opacity:0;width:0;height:0}.toggle-slider[data-v-71562640]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--bg-tertiary,#555);transition:.3s;border-radius:22px}.toggle-slider[data-v-71562640]:before{position:absolute;content:"";height:16px;width:16px;left:3px;bottom:3px;background-color:#fff;transition:.3s;border-radius:50%}input:checked+.toggle-slider[data-v-71562640]{background-color:var(--success-color,#4ade80)}input:disabled+.toggle-slider[data-v-71562640]{opacity:.5;cursor:not-allowed}input:checked+.toggle-slider[data-v-71562640]:before{transform:translateX(22px)}.enable-status[data-v-71562640]{margin-top:var(--spacing-sm);padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--radius-xs);font-size:var(--font-xs);text-align:center}.enable-status.enabled[data-v-71562640]{background:rgba(74,222,128,.1);color:var(--success-color,#4ade80)}.enable-status.disabled[data-v-71562640]{background:rgba(251,191,36,.1);color:var(--warning-color,#fbbf24)}.mode-section[data-v-71562640]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);padding:var(--spacing-md)}.mode-selector[data-v-71562640]{display:flex;gap:var(--spacing-sm)}.mode-option[data-v-71562640]{flex:1;display:flex;align-items:center;justify-content:center;gap:var(--spacing-xs);padding:var(--spacing-sm);background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast);font-size:var(--font-sm)}.mode-option input[data-v-71562640]{display:none}.mode-option[data-v-71562640]:hover:not(.disabled){border-color:var(--primary-color)}.mode-option.active[data-v-71562640]{background:var(--primary-light);border-color:var(--primary-color);color:var(--primary-color);font-weight:500}.mode-option.disabled[data-v-71562640]{opacity:.5;cursor:not-allowed}.config-section[data-v-71562640]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);padding:var(--spacing-md)}.config-item[data-v-71562640]{margin-bottom:var(--spacing-md)}.config-item[data-v-71562640]:last-child{margin-bottom:0}.config-item label[data-v-71562640]{display:block;font-size:var(--font-sm);color:var(--text-color);margin-bottom:var(--spacing-xs)}.config-control[data-v-71562640]{display:flex;gap:var(--spacing-xs)}.config-input[data-v-71562640]{flex:1;padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-color);font-size:var(--font-sm)}.config-input[data-v-71562640]:focus{outline:none;border-color:var(--primary-color)}.btn-apply[data-v-71562640]{padding:var(--spacing-xs) var(--spacing-md);background:var(--primary-color);color:#fff;border:none;border-radius:var(--radius-sm);font-size:var(--font-xs);cursor:pointer;transition:all var(--transition-fast)}.btn-apply[data-v-71562640]:hover:not(:disabled){background:var(--primary-hover)}.btn-apply[data-v-71562640]:disabled{opacity:.5;cursor:not-allowed}.config-hint[data-v-71562640]{display:block;margin-top:4px;font-size:10px;color:var(--text-muted)}.actions-section[data-v-71562640]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);padding:var(--spacing-md)}.action-buttons[data-v-71562640]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.btn[data-v-71562640]{padding:var(--spacing-sm) var(--spacing-md);border:none;border-radius:var(--radius-sm);font-size:var(--font-sm);cursor:pointer;transition:all var(--transition-fast)}.btn[data-v-71562640]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[data-v-71562640]{background:var(--primary-color);color:#fff}.btn-primary[data-v-71562640]:hover:not(:disabled){background:var(--primary-hover)}.btn-secondary[data-v-71562640]{background:var(--bg-secondary);color:var(--text-color);border:1px solid var(--border-color)}.btn-secondary[data-v-71562640]:hover:not(:disabled){background:var(--bg-hover)}.btn-danger[data-v-71562640]{background:var(--error-color);color:#fff}.btn-danger[data-v-71562640]:hover:not(:disabled){opacity:.9}.btn-danger-outline[data-v-71562640]{background:rgba(0,0,0,0);color:var(--error-color);border:1px solid var(--error-color)}.btn-danger-outline[data-v-71562640]:hover:not(:disabled){background:rgba(244,67,54,.1)}.error-message[data-v-71562640]{padding:var(--spacing-sm) var(--spacing-md);background:rgba(244,67,54,.1);border:1px solid var(--error-color);border-radius:var(--radius-sm);color:var(--error-color);font-size:var(--font-sm)}
.placeholder-panel[data-v-382df8a8]{flex:1;display:flex;align-items:center;justify-content:center;background:var(--bg-color)}.placeholder-content[data-v-382df8a8]{text-align:center;padding:var(--spacing-xl)}.placeholder-content .placeholder-icon[data-v-382df8a8]{font-size:48px;margin-bottom:var(--spacing-md)}.placeholder-content h3[data-v-382df8a8]{margin:0 0 var(--spacing-sm);color:var(--text-color);font-size:var(--font-lg)}.placeholder-content p[data-v-382df8a8]{margin:0 0 var(--spacing-lg);color:var(--text-secondary);font-size:var(--font-sm)}.game-layout[data-v-382df8a8]{display:flex;flex-direction:column;width:100%;height:100%;background:var(--bg-color);overflow:hidden}.game-layout.is-fullscreen[data-v-382df8a8]{position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999}.main-area[data-v-382df8a8]{flex:1;display:flex;overflow:hidden;min-height:0}.modal-overlay[data-v-382df8a8]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:var(--z-modal);animation:fadeIn-382df8a8 .2s ease}@keyframes fadeIn-382df8a8{from{opacity:0}to{opacity:1}}.modal[data-v-382df8a8]{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);width:90%;max-width:480px;max-height:80vh;box-shadow:var(--shadow-lg);animation:slideUp-382df8a8 .3s ease;display:flex;flex-direction:column}@keyframes slideUp-382df8a8{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.modal-header[data-v-382df8a8]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md) var(--spacing-lg);border-bottom:1px solid var(--border-color);flex-shrink:0}.modal-header h3[data-v-382df8a8]{margin:0;font-size:var(--font-lg);color:var(--text-color);display:flex;align-items:center;gap:var(--spacing-sm)}.btn-close[data-v-382df8a8]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--text-secondary);font-size:var(--font-lg);cursor:pointer;border-radius:var(--radius-sm);transition:all var(--transition-fast)}.btn-close[data-v-382df8a8]:hover{background:var(--bg-hover);color:var(--text-color)}.modal-body[data-v-382df8a8]{padding:var(--spacing-lg);overflow-y:auto;flex:1}.modal-footer[data-v-382df8a8]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-md) var(--spacing-lg);border-top:1px solid var(--border-color);flex-shrink:0}.help-overlay[data-v-382df8a8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10004 !important}.help-overlay .help-modal[data-v-382df8a8]{width:90%;max-width:480px;max-height:60vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg)}.help-modal[data-v-382df8a8]{max-width:480px}.help-steps[data-v-382df8a8]{margin:0;padding-left:var(--spacing-lg);counter-reset:step-counter}.help-steps li[data-v-382df8a8]{font-size:var(--font-sm);color:var(--text-color);line-height:1.8;margin-bottom:var(--spacing-sm);padding-left:var(--spacing-xs)}.help-steps li[data-v-382df8a8]:last-child{margin-bottom:0}.help-steps li strong[data-v-382df8a8]{color:var(--primary-color);font-weight:600}.help-section[data-v-382df8a8]{margin-bottom:var(--spacing-lg)}.help-section[data-v-382df8a8]:last-child{margin-bottom:0}.help-section h4[data-v-382df8a8]{margin:0 0 var(--spacing-sm);font-size:var(--font-md);color:var(--text-color);display:flex;align-items:center;gap:var(--spacing-xs)}.help-section p[data-v-382df8a8]{margin:0;font-size:var(--font-sm);color:var(--text-secondary);line-height:1.6}.help-section ul[data-v-382df8a8]{margin:0;padding-left:var(--spacing-lg)}.help-section ul li[data-v-382df8a8]{font-size:var(--font-sm);color:var(--text-secondary);line-height:1.8}.help-section ul li strong[data-v-382df8a8]{color:var(--text-color)}.btn[data-v-382df8a8]{padding:var(--spacing-sm) var(--spacing-lg);border:none;border-radius:var(--radius-sm);font-size:var(--font-sm);font-weight:500;cursor:pointer;transition:all var(--transition-fast)}.btn[data-v-382df8a8]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[data-v-382df8a8]{background:var(--primary-color);color:#fff}.btn-primary[data-v-382df8a8]:hover:not(:disabled){background:var(--primary-hover)}.btn-primary[data-v-382df8a8]:active:not(:disabled){background:var(--primary-active)}.btn-secondary[data-v-382df8a8]{background:var(--bg-color);color:var(--text-color);border:1px solid var(--border-color)}.btn-secondary[data-v-382df8a8]:hover:not(:disabled){background:var(--bg-hover);border-color:var(--border-hover)}.fullscreen-modal[data-v-382df8a8]{padding:var(--spacing-lg);z-index:10000 !important}.fullscreen-modal .ai-filter-modal[data-v-382df8a8]{width:100%;max-width:1400px;height:90vh;max-height:none;display:flex;flex-direction:column}.context-manager-overlay[data-v-382df8a8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10001 !important}.context-manager-overlay .context-manager-modal[data-v-382df8a8]{width:90%;max-width:520px;max-height:85vh;height:auto;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg)}.context-manager-overlay .context-manager-modal .modal-body[data-v-382df8a8]{padding:0}.save-manager-overlay[data-v-382df8a8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10002 !important}.save-manager-overlay .save-manager-modal[data-v-382df8a8]{width:90%;max-width:600px;max-height:85vh;height:80vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);overflow:hidden}.history-text-overlay[data-v-382df8a8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10005 !important;padding:var(--spacing-md)}.history-text-overlay .history-text-modal[data-v-382df8a8]{width:100%;max-width:700px;max-height:85vh;height:80vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);overflow:hidden}.roster-overlay[data-v-382df8a8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10006 !important;padding:var(--spacing-md)}.roster-overlay .roster-modal[data-v-382df8a8]{width:100%;max-width:800px;max-height:85vh;height:80vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);overflow:hidden}.document-overlay[data-v-382df8a8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10007 !important;padding:var(--spacing-md)}.document-overlay .document-modal[data-v-382df8a8]{width:100%;max-width:800px;max-height:85vh;height:80vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);overflow:hidden}.form-overlay[data-v-382df8a8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10008 !important;padding:var(--spacing-md)}.form-overlay .form-modal[data-v-382df8a8]{width:100%;max-width:900px;max-height:90vh;height:85vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);overflow:hidden}.changelog-overlay[data-v-382df8a8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10008 !important;padding:var(--spacing-md)}.changelog-overlay .changelog-modal[data-v-382df8a8]{width:100%;max-width:700px;max-height:85vh;height:80vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);overflow:hidden}.variable-manager-overlay[data-v-382df8a8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10009 !important;padding:var(--spacing-md)}.variable-manager-overlay .variable-manager-modal[data-v-382df8a8]{width:100%;max-width:900px;max-height:90vh;height:85vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);overflow:hidden}.auto-save-indicator[data-v-382df8a8]{position:fixed;bottom:80px;right:20px;display:flex;align-items:center;gap:8px;padding:10px 16px;background:var(--bg-secondary);border:1px solid var(--success-color,#4caf50);border-radius:var(--radius-md);box-shadow:var(--shadow-md);opacity:0;transform:translateY(20px);transition:all .3s ease;z-index:9998}.auto-save-indicator.visible[data-v-382df8a8]{opacity:1;transform:translateY(0)}.auto-save-indicator .icon[data-v-382df8a8]{font-size:16px}.auto-save-indicator .text[data-v-382df8a8]{font-size:12px;color:var(--text-secondary);max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.sidebar-overlay[data-v-382df8a8]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.3);z-index:99;animation:fadeIn-382df8a8 .2s ease}.mobile-menu-fab[data-v-382df8a8]{position:fixed;right:12px;top:50%;transform:translateY(-50%);width:40px;height:40px;border-radius:var(--radius-sm);background:var(--primary-color);color:#fff;border:none;box-shadow:0 2px 8px rgba(99,102,241,.4);cursor:pointer;z-index:98;display:flex;align-items:center;justify-content:center;transition:all var(--transition-fast)}.mobile-menu-fab .fab-icon[data-v-382df8a8]{font-size:18px;line-height:1}.mobile-menu-fab[data-v-382df8a8]:hover{transform:translateY(-50%) scale(1.05);box-shadow:0 4px 12px rgba(99,102,241,.5)}.mobile-menu-fab[data-v-382df8a8]:active{transform:translateY(-50%) scale(0.95)}@media (max-width:480px){.mobile-menu-fab[data-v-382df8a8]{width:36px;height:36px;right:8px}.mobile-menu-fab .fab-icon[data-v-382df8a8]{font-size:16px}}@media (max-width:768px){.main-area[data-v-382df8a8]{position:relative}.modal[data-v-382df8a8]{width:95%;max-height:90vh}.fullscreen-modal[data-v-382df8a8]{padding:var(--spacing-sm)}.fullscreen-modal .ai-filter-modal[data-v-382df8a8]{height:95vh}.save-manager-overlay .save-manager-modal[data-v-382df8a8]{width:95%;height:90vh;max-height:90vh}.history-text-overlay[data-v-382df8a8]{padding:var(--spacing-sm)}.history-text-overlay .history-text-modal[data-v-382df8a8]{width:100%;height:85vh;max-height:90vh;border-radius:var(--radius-sm)}.auto-save-indicator[data-v-382df8a8]{bottom:100px;right:10px;left:10px}.auto-save-indicator .text[data-v-382df8a8]{max-width:none}.game-layout.sidebar-open .mobile-menu-fab[data-v-382df8a8]{opacity:0;pointer-events:none}}@media (max-width:480px){.history-text-overlay[data-v-382df8a8]{padding:var(--spacing-xs)}.history-text-overlay .history-text-modal[data-v-382df8a8]{height:90vh;max-height:95vh;border-radius:var(--radius-xs)}.save-manager-overlay[data-v-382df8a8]{padding:var(--spacing-xs)}.save-manager-overlay .save-manager-modal[data-v-382df8a8]{width:100%;height:92vh;max-height:95vh}.context-manager-overlay[data-v-382df8a8]{padding:var(--spacing-xs)}.context-manager-overlay .context-manager-modal[data-v-382df8a8]{width:100%;max-height:90vh}.help-overlay[data-v-382df8a8]{padding:var(--spacing-xs)}.help-overlay .help-modal[data-v-382df8a8]{width:100%;max-height:80vh}}
.error-boundary[data-v-7b143150]{display:flex;align-items:center;justify-content:center;min-height:200px;padding:var(--spacing-lg)}.error-content[data-v-7b143150]{max-width:500px;text-align:center;padding:var(--spacing-xl);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md)}.error-icon[data-v-7b143150]{font-size:48px;margin-bottom:var(--spacing-md)}.error-title[data-v-7b143150]{margin:0 0 var(--spacing-sm);color:var(--text-color);font-size:var(--font-lg);font-weight:600}.error-message[data-v-7b143150]{margin:0 0 var(--spacing-lg);color:var(--text-secondary);font-size:var(--font-sm);line-height:1.5}.error-actions[data-v-7b143150]{display:flex;justify-content:center;gap:var(--spacing-sm);margin-bottom:var(--spacing-md)}.error-details[data-v-7b143150]{text-align:left;margin-top:var(--spacing-md)}.error-details summary[data-v-7b143150]{cursor:pointer;color:var(--text-secondary);font-size:var(--font-xs);padding:var(--spacing-sm)}.error-details summary[data-v-7b143150]:hover{color:var(--text-color)}.error-details pre[data-v-7b143150]{margin-top:var(--spacing-sm);padding:var(--spacing-md);background:var(--bg-tertiary);border-radius:var(--radius-sm);font-size:var(--font-xs);color:var(--text-secondary);overflow-x:auto;white-space:pre-wrap;word-break:break-all;max-height:200px;overflow-y:auto}
#app-container[data-v-9c83b896]{width:100%;height:100%;display:flex;flex-direction:column;overflow:hidden;background:var(--bg-color)}.loading-container[data-v-9c83b896]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:var(--spacing-md);background:var(--bg-color)}.loading-spinner[data-v-9c83b896]{width:48px;height:48px;border:4px solid var(--border-color);border-top-color:var(--primary-color);border-radius:50%;animation:spin-9c83b896 .8s linear infinite}.loading-text[data-v-9c83b896]{color:var(--text-secondary);font-size:var(--font-md)}@keyframes spin-9c83b896{to{transform:rotate(360deg)}}
:root{--primary-color:#1a5fb4;--primary-hover:#3584e4;--primary-active:#154d93;--primary-light:rgba(26,95,180,0.1);--bg-color:#f6f5f4;--bg-secondary:#ffffff;--bg-tertiary:#deddda;--bg-panel:#ffffff;--bg-hover:#f0f0f0;--text-color:#2e3436;--text-secondary:#5e5c64;--text-disabled:#9a9996;--text-highlight:#000000;--border-color:#c0bfbc;--border-hover:#9a9996;--border-active:#77767b;--border-light:#e5e5e5;--success-color:#26a269;--success-hover:#2ec27e;--success-light:rgba(38,162,105,0.1);--warning-color:#e5a50a;--warning-hover:#f5c211;--warning-light:rgba(229,165,10,0.1);--error-color:#c01c28;--error-hover:#e01b24;--error-light:rgba(192,28,40,0.1);--danger-color:#c01c28;--danger-hover:#e01b24;--info-color:#1c71d8;--info-hover:#3584e4;--info-light:rgba(28,113,216,0.1);--office-header:#2c3e50;--office-sidebar:#34495e;--office-accent:#e74c3c;--office-gold:#d4af37;--office-stamp:#c0392b;--office-paper:#fffef5;--office-ink:#1a1a2e;--shadow-sm:0 1px 3px rgba(0,0,0,0.08);--shadow-md:0 4px 6px rgba(0,0,0,0.1);--shadow-lg:0 10px 20px rgba(0,0,0,0.12);--shadow-card:0 2px 8px rgba(0,0,0,0.06);--radius-xs:2px;--radius-sm:4px;--radius-md:6px;--radius-lg:8px;--spacing-xs:4px;--spacing-sm:8px;--spacing-md:16px;--spacing-lg:24px;--spacing-xl:32px;--spacing-xxl:48px;--font-xs:11px;--font-sm:13px;--font-md:15px;--font-lg:17px;--font-xl:20px;--font-2xl:24px;--handbook-bg:#fdfcf8;--handbook-text:#2c2c2c;--handbook-text-secondary:#5a5a5a;--handbook-text-muted:#8a8a8a;--handbook-accent:#1a4a7a;--handbook-divider:#b8b8b8;--handbook-border:#d4d0c8;--handbook-title-xl:22px;--handbook-title-lg:18px;--handbook-title-md:16px;--handbook-body:15px;--handbook-detail:14px;--handbook-sub-detail:13px;--handbook-line-height:2;--transition-fast:0.1s ease;--transition-normal:0.2s ease;--transition-slow:0.3s ease;--z-dropdown:100;--z-modal:200;--z-tooltip:300;--z-notification:400}:root.dark-theme{--primary-color:#3584e4;--primary-hover:#62a0ea;--primary-active:#1c71d8;--primary-light:rgba(53,132,228,0.15);--bg-color:#1e1e1e;--bg-secondary:#2d2d2d;--bg-tertiary:#3d3d3d;--bg-panel:#2d2d2d;--bg-hover:#3d3d3d;--text-color:#f5f5f5;--text-secondary:#b0b0b0;--text-disabled:#707070;--text-highlight:#ffffff;--border-color:#4d4d4d;--border-hover:#5d5d5d;--border-active:#6d6d6d;--border-light:#3d3d3d;--office-header:#1a1a2e;--office-sidebar:#252540;--office-paper:#2d2d3d;--shadow-sm:0 1px 3px rgba(0,0,0,0.3);--shadow-md:0 4px 6px rgba(0,0,0,0.4);--shadow-lg:0 10px 20px rgba(0,0,0,0.5);--shadow-card:0 2px 8px rgba(0,0,0,0.3);--handbook-bg:#1e1e24;--handbook-text:#e8e8e8;--handbook-text-secondary:#b0b0b0;--handbook-text-muted:#808080;--handbook-accent:#6ba3d6;--handbook-divider:#4a4a50;--handbook-border:#3a3a42}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:var(--bg-secondary);border-radius:var(--radius-xs)}::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:var(--radius-xs)}::-webkit-scrollbar-thumb:hover{background:var(--border-hover)}.btn{display:inline-flex;align-items:center;justify-content:center;padding:var(--spacing-sm) var(--spacing-md);border:1px solid rgba(0,0,0,0);border-radius:var(--radius-sm);font-size:var(--font-sm);font-weight:500;cursor:pointer;transition:all var(--transition-fast);gap:var(--spacing-xs);background:var(--bg-tertiary);color:var(--text-color)}.btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:var(--shadow-sm)}.btn:active:not(:disabled){transform:translateY(0)}.btn:disabled{opacity:.5;cursor:not-allowed}.btn:focus{outline:none;box-shadow:0 0 0 2px var(--primary-color)}.btn-primary{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}.btn-primary:hover:not(:disabled){background:var(--primary-hover);border-color:var(--primary-hover)}.btn-secondary{background:var(--bg-tertiary);color:var(--text-color);border-color:var(--border-color)}.btn-secondary:hover:not(:disabled){background:var(--border-color)}.btn-success{background:var(--success-color);color:#fff;border-color:var(--success-color)}.btn-success:hover:not(:disabled){background:var(--success-hover);border-color:var(--success-hover)}.btn-danger{background:var(--danger-color);color:#fff;border-color:var(--danger-color)}.btn-danger:hover:not(:disabled){background:var(--danger-hover);border-color:var(--danger-hover)}.btn-warning{background:var(--warning-color);color:#fff;border-color:var(--warning-color)}.btn-warning:hover:not(:disabled){background:var(--warning-hover);border-color:var(--warning-hover)}.btn-ghost{background:rgba(0,0,0,0);border-color:rgba(0,0,0,0);color:var(--text-secondary)}.btn-ghost:hover:not(:disabled){background:var(--bg-tertiary);color:var(--text-color)}.btn-sm{padding:var(--spacing-xs) var(--spacing-sm);font-size:var(--font-xs)}.btn-lg{padding:var(--spacing-md) var(--spacing-lg);font-size:var(--font-md)}.btn-icon{width:32px;height:32px;padding:0;border-radius:var(--radius-sm)}.input,.select,.textarea{width:100%;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-color);font-size:var(--font-sm);transition:border-color var(--transition-fast),box-shadow var(--transition-fast)}.input:focus,.select:focus,.textarea:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(74,159,74,.2)}.input::placeholder,.select::placeholder,.textarea::placeholder{color:var(--text-disabled)}.input:disabled,.select:disabled,.textarea:disabled{opacity:.5;cursor:not-allowed;background:var(--bg-secondary)}.textarea{min-height:80px;resize:vertical;line-height:1.5}.select{cursor:pointer;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a0a0a0' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:36px}.checkbox,.radio{display:inline-flex;align-items:center;gap:var(--spacing-sm);cursor:pointer;font-size:var(--font-sm);color:var(--text-color)}.checkbox input,.radio input{width:16px;height:16px;margin:0;cursor:pointer;accent-color:var(--primary-color)}.card{background:var(--bg-secondary);border-radius:var(--radius-md);padding:var(--spacing-md);border:1px solid var(--border-color)}.card-header{display:flex;align-items:center;justify-content:space-between;padding-bottom:var(--spacing-md);margin-bottom:var(--spacing-md);border-bottom:1px solid var(--border-color)}.card-header h3,.card-header h4{margin:0;color:var(--text-color);font-weight:600}.card-body{color:var(--text-secondary);line-height:1.6}.card-footer{display:flex;align-items:center;justify-content:flex-end;gap:var(--spacing-sm);padding-top:var(--spacing-md);margin-top:var(--spacing-md);border-top:1px solid var(--border-color)}.panel{background:var(--bg-panel);border:2px solid var(--border-color);border-radius:var(--radius-sm);box-shadow:var(--shadow-md)}.panel-header{background:var(--bg-tertiary);padding:var(--spacing-sm) var(--spacing-md);border-bottom:1px solid var(--border-color);font-weight:600;color:var(--text-color)}.panel-body{padding:var(--spacing-md)}.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:var(--radius-xs);font-size:var(--font-xs);font-weight:500}.badge-primary{background:rgba(74,159,74,.2);color:var(--primary-color)}.badge-success{background:rgba(92,184,92,.2);color:var(--success-color)}.badge-warning{background:rgba(240,173,78,.2);color:var(--warning-color)}.badge-danger{background:rgba(217,83,79,.2);color:var(--danger-color)}.badge-info{background:rgba(91,192,222,.2);color:var(--info-color)}.progress{width:100%;height:8px;background:var(--bg-tertiary);border-radius:var(--radius-xs);overflow:hidden}.progress-bar{height:100%;background:var(--primary-color);transition:width var(--transition-normal)}.progress-bar-success{background:var(--success-color)}.progress-bar-warning{background:var(--warning-color)}.progress-bar-danger{background:var(--danger-color)}.divider{height:1px;background:var(--border-color);margin:var(--spacing-md) 0}.divider-vertical{width:1px;height:100%;background:var(--border-color);margin:0 var(--spacing-md)}.text-center{text-align:center}.text-left{text-align:left}.text-right{text-align:right}.text-primary{color:var(--primary-color)}.text-secondary{color:var(--text-secondary)}.text-success{color:var(--success-color)}.text-warning{color:var(--warning-color)}.text-danger{color:var(--danger-color)}.text-info{color:var(--info-color)}.flex{display:flex}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.items-end{align-items:flex-end}.justify-start{justify-content:flex-start}.justify-center{justify-content:center}.justify-end{justify-content:flex-end}.justify-between{justify-content:space-between}.flex-1{flex:1}.gap-xs{gap:var(--spacing-xs)}.gap-sm{gap:var(--spacing-sm)}.gap-md{gap:var(--spacing-md)}.gap-lg{gap:var(--spacing-lg)}.w-full{width:100%}.h-full{height:100%}.w-auto{width:auto}.h-auto{height:auto}.m-0{margin:0}.p-0{padding:0}.mt-sm{margin-top:var(--spacing-sm)}.mt-md{margin-top:var(--spacing-md)}.mb-sm{margin-bottom:var(--spacing-sm)}.mb-md{margin-bottom:var(--spacing-md)}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{from{opacity:1}to{opacity:0}}@keyframes slideInUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes slideInDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}@keyframes spin{to{transform:rotate(360deg)}}.animate-fadeIn{animation:fadeIn var(--transition-normal)}.animate-slideInUp{animation:slideInUp var(--transition-normal)}.animate-slideInDown{animation:slideInDown var(--transition-normal)}.animate-pulse{animation:pulse 2s infinite}.animate-spin{animation:spin 1s linear infinite}.hidden{display:none !important}.visible{visibility:visible}.invisible{visibility:hidden}.overflow-hidden{overflow:hidden}.overflow-auto{overflow:auto}.overflow-scroll{overflow:scroll}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}:root{--cb-dialogue-color:#1a5fb4;--cb-dialogue-bg:rgba(26,95,180,0.05);--cb-dialogue-border:rgba(26,95,180,0.2);--cb-dialogue-icon:'ğŸ’¬';--cb-thought-color:#8b5cf6;--cb-thought-bg:rgba(139,92,246,0.05);--cb-thought-border:rgba(139,92,246,0.15);--cb-thought-icon:'ğŸ’­';--cb-scenery-color:#059669;--cb-scenery-bg:rgba(5,150,105,0.05);--cb-scenery-border:rgba(5,150,105,0.15);--cb-scenery-icon:'ğŸï¸';--cb-system-color:#dc2626;--cb-system-bg:rgba(220,38,38,0.08);--cb-system-border:#dc2626;--cb-system-icon:'âš ï¸';--cb-text-color:var(--text-color,#2e3436);--cb-transition:0.15s ease;--cb-radius-sm:4px;--cb-radius-md:6px;--cb-radius-lg:8px}:root.dark-theme,.dark-theme{--cb-dialogue-color:#60a5fa;--cb-dialogue-bg:rgba(96,165,250,0.1);--cb-dialogue-border:rgba(96,165,250,0.3);--cb-thought-color:#a78bfa;--cb-thought-bg:rgba(167,139,250,0.1);--cb-thought-border:rgba(167,139,250,0.2);--cb-scenery-color:#34d399;--cb-scenery-bg:rgba(52,211,153,0.1);--cb-scenery-border:rgba(52,211,153,0.2);--cb-system-color:#f87171;--cb-system-bg:rgba(248,113,113,0.15);--cb-system-border:#f87171;--cb-text-color:var(--text-color,#f5f5f5)}.content-block-renderer{font-size:var(--font-md,15px);line-height:1.8;color:var(--cb-text-color);word-wrap:break-word;overflow-wrap:break-word}.content-block{display:inline;transition:all var(--cb-transition)}.content-block__icon{margin-right:4px;font-size:.9em;vertical-align:middle;opacity:.8}.content-block__content{vertical-align:baseline}.content-block--text{color:var(--cb-text-color)}.content-block--dialogue{display:inline-block;position:relative;color:var(--cb-dialogue-color);background:var(--cb-dialogue-bg);border-left:3px solid var(--cb-dialogue-border);border-radius:0 var(--cb-radius-sm) var(--cb-radius-sm) 0;padding:6px 12px;margin:4px 2px}.content-block--dialogue::before{content:"ã€Œ";position:absolute;left:-2px;top:-4px;font-size:1.5em;color:var(--cb-dialogue-border);opacity:.4;font-weight:bold}.content-block--dialogue:hover{background:var(--cb-dialogue-bg);border-left-color:var(--cb-dialogue-color);transform:translateX(2px);box-shadow:-2px 2px 8px rgba(26,95,180,.15)}.content-block--thought{display:inline-block;color:var(--cb-thought-color);background:var(--cb-thought-bg);font-style:italic;padding:4px 10px;margin:2px;border-radius:var(--cb-radius-sm);position:relative}.content-block--thought::after{content:"";position:absolute;bottom:2px;left:10%;right:10%;height:2px;background:linear-gradient(90deg,transparent 0%,var(--cb-thought-border) 20%,var(--cb-thought-color) 50%,var(--cb-thought-border) 80%,transparent 100%);opacity:.3;border-radius:1px}.content-block--thought .content-block__icon{animation:thoughtBubble 2s ease-in-out infinite}.content-block--thought:hover{background:rgba(139,92,246,.1)}.content-block--thought:hover::after{opacity:.5}@keyframes thoughtBubble{0%,100%{transform:translateY(0);opacity:.8}50%{transform:translateY(-2px);opacity:1}}.content-block--scenery{display:block;color:var(--cb-scenery-color);background:var(--cb-scenery-bg);border:1px dashed var(--cb-scenery-border);border-radius:var(--cb-radius-md);padding:12px 16px;margin:10px 0;line-height:1.9;position:relative}.content-block--scenery::before,.content-block--scenery::after{content:"";position:absolute;width:12px;height:12px;border:2px solid var(--cb-scenery-border);opacity:.4}.content-block--scenery::before{top:-1px;left:-1px;border-right:none;border-bottom:none;border-radius:var(--cb-radius-sm) 0 0 0}.content-block--scenery::after{bottom:-1px;right:-1px;border-left:none;border-top:none;border-radius:0 0 var(--cb-radius-sm) 0}.content-block--scenery:hover{border-style:solid;box-shadow:0 4px 12px rgba(5,150,105,.1)}.content-block--scenery:hover::before,.content-block--scenery:hover::after{opacity:.7}.content-block--scenery .content-block__content{display:block;text-indent:2em}.content-block--system{display:block;color:var(--cb-system-color);background:var(--cb-system-bg);border:2px solid var(--cb-system-border);border-radius:var(--cb-radius-lg);padding:14px 20px;margin:12px 0;text-align:center;font-weight:600;position:relative;overflow:hidden}.content-block--system::before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:repeating-linear-gradient(90deg,var(--cb-system-color),var(--cb-system-color) 10px,transparent 10px,transparent 20px);opacity:.3}.content-block--system .content-block__icon{font-size:1.2em;margin-right:8px;animation:systemPulse 1.5s ease-in-out infinite}.content-block--system:hover{transform:scale(1.01);box-shadow:0 4px 16px rgba(220,38,38,.2)}.content-block--system:hover::before{opacity:.5}@keyframes systemPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}.streaming-cursor{display:inline-block;color:var(--primary-color,#1a5fb4);font-weight:bold;animation:cursorBlink 1s step-end infinite;margin-left:2px}@keyframes cursorBlink{0%,50%{opacity:1}51%,100%{opacity:0}}.content-block--animated{animation:blockFadeIn .3s ease-out}@keyframes blockFadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}@media print{.content-block{background:none !important;border:none !important;padding:0 !important;margin:0 !important}.content-block::before,.content-block::after{display:none !important}.content-block--dialogue::before{display:inline !important;content:"ã€Œ" !important;position:static !important}.content-block--dialogue::after{content:"ã€" !important}.content-block--scenery::before{content:"ã€" !important}.content-block--scenery::after{content:"ã€‘" !important}.content-block--system{border:1px solid #000 !important;text-align:center}.streaming-cursor{display:none !important}}@media (max-width:768px){.content-block--dialogue{padding:4px 8px;margin:2px 1px}.content-block--dialogue::before{font-size:1.2em}.content-block--thought{padding:3px 8px}.content-block--scenery{padding:8px 12px;margin:8px 0}.content-block--scenery .content-block__content{text-indent:1em}.content-block--system{padding:10px 14px;margin:8px 0}}@media (prefers-reduced-motion:reduce){.content-block,.content-block--animated,.streaming-cursor,.content-block__icon{animation:none !important;transition:none !important}}@media (prefers-contrast:high){:root{--cb-dialogue-color:#0055cc;--cb-dialogue-bg:rgba(0,85,204,0.15);--cb-dialogue-border:#0055cc;--cb-thought-color:#6b21a8;--cb-thought-bg:rgba(107,33,168,0.15);--cb-scenery-color:#047857;--cb-scenery-bg:rgba(4,120,87,0.15);--cb-scenery-border:#047857;--cb-system-color:#b91c1c;--cb-system-bg:rgba(185,28,28,0.15);--cb-system-border:#b91c1c}.content-block{border-width:2px !important}}*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;font-family:"Microsoft YaHei",-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:var(--bg-color);color:var(--text-color);font-size:var(--font-md);line-height:1.5;overflow:hidden}#app{width:100%;height:100%;display:flex;flex-direction:column}.no-select{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}input,textarea,.selectable{user-select:text;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text}a{color:var(--primary-color);text-decoration:none;transition:color var(--transition-fast)}a:hover{color:var(--primary-hover);text-decoration:underline}ul,ol{list-style:none}img{max-width:100%;height:auto;vertical-align:middle}code,pre{font-family:"Consolas","Monaco","Courier New",monospace;background:var(--bg-tertiary);border-radius:var(--radius-xs)}code{padding:2px 6px;font-size:var(--font-sm)}pre{padding:var(--spacing-md);overflow-x:auto}pre code{padding:0;background:none}table{width:100%;border-collapse:collapse;background:var(--bg-secondary)}table th,table td{padding:var(--spacing-sm) var(--spacing-md);border:1px solid var(--border-color);text-align:left}table th{background:var(--bg-tertiary);font-weight:600;color:var(--text-color)}table tr:hover{background:var(--bg-tertiary)}:focus-visible{outline:2px solid var(--primary-color);outline-offset:2px}.loading-spinner{width:32px;height:32px;border:3px solid var(--border-color);border-top-color:var(--primary-color);border-radius:50%;animation:spin .8s linear infinite}.loading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:var(--spacing-md);min-height:200px}.loading-container p{color:var(--text-secondary);font-size:var(--font-sm)}.pixel-border{border:2px solid var(--border-color);box-shadow:inset 2px 2px 0 hsla(0,0%,100%,.1),inset -2px -2px 0 rgba(0,0,0,.2)}.mc-btn{display:inline-flex;align-items:center;justify-content:center;padding:var(--spacing-sm) var(--spacing-lg);background:linear-gradient(180deg,var(--bg-tertiary) 0%,var(--bg-secondary) 100%);border:2px solid var(--border-color);border-radius:0;color:var(--text-color);font-size:var(--font-sm);font-weight:500;cursor:pointer;transition:all var(--transition-fast);box-shadow:inset 1px 1px 0 hsla(0,0%,100%,.1),inset -1px -1px 0 rgba(0,0,0,.2)}.mc-btn:hover:not(:disabled){background:linear-gradient(180deg,var(--border-color) 0%,var(--bg-tertiary) 100%);border-color:var(--border-hover)}.mc-btn:active:not(:disabled){box-shadow:inset -1px -1px 0 hsla(0,0%,100%,.1),inset 1px 1px 0 rgba(0,0,0,.2)}.mc-btn:disabled{opacity:.5;cursor:not-allowed}.tooltip{position:absolute;padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:var(--font-xs);color:var(--text-color);white-space:nowrap;z-index:var(--z-tooltip);box-shadow:var(--shadow-md);pointer-events:none}.overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);z-index:var(--z-modal);display:flex;align-items:center;justify-content:center}.modal{background:var(--bg-secondary);border:2px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);max-width:90vw;max-height:90vh;overflow:auto}.modal-header{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);border-bottom:1px solid var(--border-color)}.modal-header h3{margin:0;font-weight:600;color:var(--text-color)}.modal-body{padding:var(--spacing-md)}.modal-footer{display:flex;align-items:center;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-md);border-top:1px solid var(--border-color)}

/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body></html>