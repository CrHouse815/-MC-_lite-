<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>MCæˆ¿å­</title><script type="module">import{createPinia as e,defineStore as t,storeToRefs as a}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';var n={772:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a}}},o={};const l=Vue,s={class:'top-bar'},r={class:'top-bar-left'},c={class:'status-item date-display'},i={class:'status-value'},u={class:'status-item period-display'},d={class:'status-item location-display'},m={class:'status-value location-value'},v={class:'status-text'},g={class:'top-bar-right'},p=['title'],f={class:'btn-icon'},y=['title'],h={class:'btn-icon'},S=(0,l.defineComponent)({__name:'TopBar',props:{connectionStatus:{default:'connected'},isFullscreen:{type:Boolean,default:!1},isDarkTheme:{type:Boolean,default:!1},gameDate:{default:''},gamePeriod:{default:''},gameLocation:{default:''}},emits:['toggle-fullscreen','toggle-theme'],setup(e){const t=e,a=(0,l.computed)(()=>{switch(t.connectionStatus){case'connected':return'åœ¨çº¿';case'connecting':return'è¿æ¥ä¸­...';case'disconnected':return'ç¦»çº¿';default:return'æœªçŸ¥'}}),n=(0,l.computed)(()=>t.gameDate||'ç­‰å¾…æ•°æ®...'),o=(0,l.computed)(()=>t.gamePeriod||'---'),S=(0,l.computed)(()=>t.gameLocation||'æœªçŸ¥åœ°ç‚¹'),E=(0,l.computed)(()=>{const e=t.gamePeriod||'';return e.includes('ä¸Šåˆ')||e.includes('æ—©')?'period-morning':e.includes('åˆä¼‘')||e.includes('ä¸­åˆ')?'period-noon':e.includes('ä¸‹åˆ')?'period-afternoon':e.includes('å‚æ™š')||e.includes('æ™š')?'period-evening':e.includes('åŠ ç­')||e.includes('å¤œ')||e.includes('æ·±å¤œ')?'period-night':'period-default'});return(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('header',s,[(0,l.createCommentVNode)(' å·¦ä¾§ï¼šæ¸¸æˆçŠ¶æ€ä¿¡æ¯ '),(0,l.createElementVNode)('div',r,[(0,l.createCommentVNode)(' æ—¥æœŸæ˜¾ç¤º '),(0,l.createElementVNode)('div',c,[t[2]||(t[2]=(0,l.createElementVNode)('span',{class:'status-icon'},'ğŸ“…',-1)),(0,l.createElementVNode)('span',i,(0,l.toDisplayString)(n.value),1)]),(0,l.createCommentVNode)(' æ—¶æ®µæ˜¾ç¤º '),(0,l.createElementVNode)('div',u,[t[3]||(t[3]=(0,l.createElementVNode)('span',{class:'status-icon'},'ğŸ•',-1)),(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['period-badge',E.value])},(0,l.toDisplayString)(o.value),3)]),(0,l.createCommentVNode)(' åœ°ç‚¹æ˜¾ç¤º '),(0,l.createElementVNode)('div',d,[t[4]||(t[4]=(0,l.createElementVNode)('span',{class:'status-icon'},'ğŸ“',-1)),(0,l.createElementVNode)('span',m,(0,l.toDisplayString)(S.value),1)]),(0,l.createCommentVNode)(' è¿æ¥çŠ¶æ€ '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['status-item connection-status',e.connectionStatus])},[t[5]||(t[5]=(0,l.createElementVNode)('span',{class:'status-dot'},null,-1)),(0,l.createElementVNode)('span',v,(0,l.toDisplayString)(a.value),1)],2)]),(0,l.createCommentVNode)(' ä¸­é—´ï¼šç•™ç©º '),t[6]||(t[6]=(0,l.createElementVNode)('div',{class:'top-bar-center'},null,-1)),(0,l.createCommentVNode)(' å³ä¾§ï¼šä¸»é¢˜åˆ‡æ¢ + å…¨å±æŒ‰é’® '),(0,l.createElementVNode)('div',g,[(0,l.createElementVNode)('button',{class:'tool-btn theme-btn',title:e.isDarkTheme?'åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼':'åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼',onClick:t[0]||(t[0]=t=>e.$emit('toggle-theme'))},[(0,l.createElementVNode)('span',f,(0,l.toDisplayString)(e.isDarkTheme?'â˜€ï¸':'ğŸŒ™'),1)],8,p),(0,l.createElementVNode)('button',{class:'tool-btn',title:e.isFullscreen?'é€€å‡ºå…¨å±':'å…¨å±æ˜¾ç¤º',onClick:t[1]||(t[1]=t=>e.$emit('toggle-fullscreen'))},[(0,l.createElementVNode)('span',h,(0,l.toDisplayString)(e.isFullscreen?'â¬œ':'â›¶'),1)],8,y)])]))}});var E=function e(t){var a=o[t];if(void 0!==a)return a.exports;var l=o[t]={exports:{}};return n[t](l,l.exports,e),l.exports}(772);const V=(0,E.A)(S,[['__scopeId','data-v-8d17daf4']]),b=['innerHTML'],N={key:0,class:'streaming-cursor'},w=(0,l.defineComponent)({__name:'ContentBlockRenderer',props:{content:{default:''},isStreaming:{type:Boolean,default:!1},theme:{default:'auto'}},setup(e,{expose:t}){const a=e,n=(0,l.computed)(()=>'dark'===a.theme||'light'!==a.theme&&('undefined'!=typeof document&&(document.documentElement.classList.contains('dark-theme')||document.body.classList.contains('dark-theme')||window.matchMedia?.('(prefers-color-scheme: dark)').matches))),o=(0,l.computed)(()=>{if(!a.content)return'';let e=function(e){const t={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'};return e.replace(/[&<>"]/g,e=>t[e]||e)}(a.content);return e=e.replace(/\n/g,'<br>'),e=e.replace(/ã€ã€([^ã€ã€‘]*)ã€‘ã€‘/g,(e,t)=>`<span class="block-system">ã€ã€${t}ã€‘ã€‘</span>`),e=e.replace(/ã€([^ã€ã€‘]+)ã€‘/g,(e,t)=>`<span class="block-scenery">ã€${t}ã€‘</span>`),e=e.replace(/ã€Œ([^ã€Œã€]+)ã€/g,(e,t)=>`<span class="block-dialogue">ã€Œ${t}ã€</span>`),e=e.replace(/\*([^*]+)\*/g,(e,t)=>`<span class="block-thought">*${t}*</span>`),e});return t({isDarkTheme:n}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['content-renderer',{'content-renderer--dark':n.value}])},[(0,l.createElementVNode)('span',{class:'content-text',innerHTML:o.value},null,8,b),e.isStreaming?((0,l.openBlock)(),(0,l.createElementBlock)('span',N,'â–Œ')):(0,l.createCommentVNode)('v-if',!0)],2))}}),C=(0,E.A)(w,[['__scopeId','data-v-17b96b08']]),k={class:'main-content'},A={class:'game-text-container'},M={key:0,class:'processing-state'},I={class:'content-header'},D={class:'content-meta'},B={key:0,class:'meta-item'},x={key:1,class:'meta-item streaming-badge'},T={class:'game-text'},R={key:0,class:'variable-changes'},L={class:'changes-title'},O={class:'changes-toggle'},U={key:0,class:'changes-list'},P={class:'change-path'},F={class:'change-value'},j=(0,l.defineComponent)({__name:'MainContent',props:{currentContent:{default:''},isProcessing:{type:Boolean,default:!1},isStreaming:{type:Boolean,default:!1},variableChanges:{default:()=>[]},lastUpdateTime:{default:''}},setup(e,{expose:t}){const a=e,n=(0,l.ref)(null),o=(0,l.ref)(!1),s={enabled:!0,showIcons:!0,enableAnimations:!0},r=e=>{console.log('[MainContent] å†…å®¹å—è¢«ç‚¹å‡»:',e.block.type,e.block.displayContent.substring(0,50))},c=e=>{e.success&&console.log('[MainContent] å†…å®¹è§£æå®Œæˆ:',{æ€»å—æ•°:e.statistics.totalBlocks,å„ç±»å‹:e.statistics.blockCounts,è€—æ—¶:e.statistics.parseTime.toFixed(2)+'ms'})},i=()=>{(0,l.nextTick)(()=>{n.value&&(n.value.scrollTop=n.value.scrollHeight)})};return(0,l.watch)(()=>a.currentContent,()=>{i()}),t({scrollToBottom:i}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('main',k,[(0,l.createCommentVNode)(' æ¸¸æˆæ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸ '),(0,l.createElementVNode)('div',A,[(0,l.createCommentVNode)(' AIæ­£åœ¨æ€è€ƒçŠ¶æ€ '),e.isProcessing&&!e.isStreaming?((0,l.openBlock)(),(0,l.createElementBlock)('div',M,[...t[1]||(t[1]=[(0,l.createStaticVNode)('<div class="thinking-panel" data-v-abcfde7c><div class="thinking-animation" data-v-abcfde7c><span class="thinking-dot" data-v-abcfde7c></span><span class="thinking-dot" data-v-abcfde7c></span><span class="thinking-dot" data-v-abcfde7c></span></div><p class="thinking-text" data-v-abcfde7c>AIæ­£åœ¨æ€è€ƒ...</p></div>',1)])])):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' ä¸»å†…å®¹æ˜¾ç¤º '),(0,l.createElementVNode)('div',{class:'content-display',ref_key:'contentRef',ref:n},[(0,l.createCommentVNode)(' å†…å®¹å¤´éƒ¨ '),(0,l.createElementVNode)('div',I,[(0,l.createElementVNode)('div',D,[e.lastUpdateTime?((0,l.openBlock)(),(0,l.createElementBlock)('span',B,[t[2]||(t[2]=(0,l.createElementVNode)('span',{class:'meta-icon'},'ğŸ•',-1)),(0,l.createTextVNode)(' '+(0,l.toDisplayString)(e.lastUpdateTime),1)])):(0,l.createCommentVNode)('v-if',!0),e.isStreaming?((0,l.openBlock)(),(0,l.createElementBlock)('span',x,[...t[3]||(t[3]=[(0,l.createElementVNode)('span',{class:'streaming-dot'},null,-1),(0,l.createTextVNode)(' æ­£åœ¨ç”Ÿæˆ... ',-1)])])):(0,l.createCommentVNode)('v-if',!0)])]),(0,l.createCommentVNode)(' ä¸»æ–‡æœ¬å†…å®¹ - ä½¿ç”¨å†…å®¹å—å·®å¼‚åŒ–æ¸²æŸ“ç»„ä»¶ '),(0,l.createElementVNode)('div',T,[(0,l.createVNode)(C,{content:e.currentContent,'is-streaming':e.isStreaming,config:s,theme:'auto',onBlockClick:r,onParsed:c},null,8,['content','is-streaming'])]),(0,l.createCommentVNode)(' å˜é‡å˜åŒ–æé†’ï¼ˆå‚è€ƒå½’å¢Ÿçš„è®¾è®¡ï¼‰ '),e.variableChanges.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',R,[(0,l.createElementVNode)('div',{class:'changes-header',onClick:t[0]||(t[0]=e=>o.value=!o.value)},[t[4]||(t[4]=(0,l.createElementVNode)('span',{class:'changes-icon'},'ğŸ“Š',-1)),(0,l.createElementVNode)('span',L,'å˜é‡å˜åŒ– ('+(0,l.toDisplayString)(e.variableChanges.length)+')',1),(0,l.createElementVNode)('span',O,(0,l.toDisplayString)(o.value?'â–¼':'â–¶'),1)]),o.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',U,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.variableChanges,(e,a)=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',{key:a,class:'change-item'},[(0,l.createElementVNode)('span',P,(0,l.toDisplayString)(e.path),1),t[5]||(t[5]=(0,l.createElementVNode)('span',{class:'change-arrow'},'â†’',-1)),(0,l.createElementVNode)('span',F,(0,l.toDisplayString)((n=e.newValue,null==n?'null':'object'==typeof n?JSON.stringify(n):String(n))),1)]);var n}),128))])):(0,l.createCommentVNode)('v-if',!0)])):(0,l.createCommentVNode)('v-if',!0)],512)],2112))])]))}}),H=(0,E.A)(j,[['__scopeId','data-v-abcfde7c']]),W={maxItems:50,storageKey:'mclite_input_history',autoSave:!0,deduplicate:!0};const G=(0,l.reactive)({visible:!1,title:'ç¡®è®¤',message:'',confirmText:'ç¡®è®¤',cancelText:'å–æ¶ˆ',type:'info',icon:'â“',showCancel:!0,isProcessing:!1});let J=null,Y=null;const K={info:'â„¹ï¸',warning:'âš ï¸',danger:'ğŸ—‘ï¸',success:'âœ…'},q=e=>new Promise(t=>{const a='string'==typeof e?{message:e}:e;G.title=a.title||'ç¡®è®¤',G.message=a.message,G.confirmText=a.confirmText||'ç¡®è®¤',G.cancelText=a.cancelText||'å–æ¶ˆ',G.type=a.type||'info',G.icon=a.icon||K[a.type||'info']||'â“',G.showCancel=!1!==a.showCancel,G.isProcessing=!1,G.visible=!0,J=t,Y=a.beforeConfirm||null}),X=async()=>{if(!G.isProcessing){if(Y){G.isProcessing=!0;try{if(!await Y())return void(G.isProcessing=!1)}catch(e){return console.error('[ConfirmDialog] beforeConfirm error:',e),void(G.isProcessing=!1)}}G.visible=!1,G.isProcessing=!1,J&&(J(!0),J=null),Y=null}},Q=()=>{G.isProcessing||(G.visible=!1,J&&(J(!1),J=null),Y=null)},Z=(e,t='å±é™©æ“ä½œ')=>q({title:t,message:e,type:'danger',confirmText:'ç¡®è®¤åˆ é™¤',cancelText:'å–æ¶ˆ',icon:'ğŸ—‘ï¸'}),ee=(e,t='è­¦å‘Š')=>q({title:t,message:e,type:'warning',confirmText:'ç»§ç»­',cancelText:'å–æ¶ˆ',icon:'âš ï¸'}),te=(e,t='æç¤º')=>q({title:t,message:e,type:'info',confirmText:'çŸ¥é“äº†',showCancel:!1,icon:'â„¹ï¸'});function ae(){return{state:(0,l.readonly)(G),confirm:q,confirmDanger:Z,confirmWarning:ee,confirmInfo:te,handleConfirm:X,handleCancel:Q}}const ne={class:'bottom-bar'},oe={key:0,class:'history-panel'},le={class:'history-header'},se={class:'history-count'},re={class:'history-actions'},ce={class:'history-search'},ie={class:'history-list'},ue=['onClick'],de={class:'history-content'},me={class:'history-time'},ve=['onClick'],ge={key:0,class:'history-empty'},pe={class:'input-area'},fe=['title'],ye=['placeholder','disabled'],he=['disabled','title'],Se={key:0,class:'loading-icon'},Ee={key:1,class:'send-icon'},Ve={key:0,class:'navigation-hint'},be={class:'hint-text'},Ne={key:1,class:'error-message'},we={class:'error-text'},Ce=(0,l.defineComponent)({__name:'BottomBar',props:{placeholder:{default:'è¾“å…¥ä½ æƒ³è¯´çš„è¯æˆ–æƒ³åšçš„äº‹...'},isLoading:{type:Boolean,default:!1},error:{default:null}},emits:['send','clearError'],setup(e,{expose:t,emit:a}){const n=e,o=a,{historyList:s,currentIndex:r,historyCount:c,hasHistory:i,isNavigating:u,addToHistory:d,navigateBack:m,navigateForward:v,resetNavigation:g,removeHistoryAt:p,clearHistory:f,searchHistory:y}=function(e={}){const t={...W,...e},a=(0,l.ref)([]),n=(0,l.ref)(-1),o=(0,l.ref)(''),s=(0,l.ref)(!1),r=(0,l.computed)(()=>a.value.length),c=(0,l.computed)(()=>a.value.length>0),i=(0,l.computed)(()=>n.value>=0),u=(0,l.computed)(()=>n.value<a.value.length-1),d=(0,l.computed)(()=>n.value>=0),m=(0,l.computed)(()=>n.value>=0&&n.value<a.value.length?a.value[n.value]:null),v=(0,l.computed)(()=>a.value.map(e=>e.content)),g=()=>{try{const e=localStorage.getItem(t.storageKey);if(e){const t=JSON.parse(e);Array.isArray(t)&&(a.value=t.map(e=>'string'==typeof e?{content:e,timestamp:Date.now()}:e),console.log('[useInputHistory] å·²åŠ è½½å†å²è®°å½•ï¼Œå…±',a.value.length,'æ¡'))}}catch(e){console.error('[useInputHistory] åŠ è½½å†å²è®°å½•å¤±è´¥:',e),a.value=[]}s.value=!0},p=()=>{try{localStorage.setItem(t.storageKey,JSON.stringify(a.value)),console.log('[useInputHistory] å†å²è®°å½•å·²ä¿å­˜')}catch(e){console.error('[useInputHistory] ä¿å­˜å†å²è®°å½•å¤±è´¥:',e)}},f=e=>c.value?(-1===n.value&&(o.value=e),n.value<a.value.length-1?(n.value++,a.value[n.value].content):null):null,y=()=>n.value<0?null:(n.value--,n.value>=0?a.value[n.value].content:o.value),h=()=>{n.value=-1,o.value=''},S=e=>e>=0&&e<a.value.length&&(a.value.splice(e,1),n.value>=e&&n.value>0&&n.value--,t.autoSave&&p(),!0);return(0,l.onMounted)(()=>{g()}),{historyList:a,currentIndex:n,tempInput:o,isInitialized:s,historyCount:r,hasHistory:c,isNavigating:i,canGoBack:u,canGoForward:d,currentHistoryItem:m,historyContents:v,addToHistory:e=>{if(!e||!e.trim())return;const n=e.trim();if(t.deduplicate){const e=a.value.findIndex(e=>e.content===n);e>=0&&a.value.splice(e,1)}a.value.unshift({content:n,timestamp:Date.now()}),a.value.length>t.maxItems&&(a.value=a.value.slice(0,t.maxItems)),h(),t.autoSave&&p(),console.log('[useInputHistory] æ–°è®°å½•å·²æ·»åŠ :',n.slice(0,50)+'...')},navigateBack:f,navigateForward:y,startNavigation:e=>{-1===n.value&&(o.value=e)},resetNavigation:h,handleKeyboardNavigation:(e,t)=>{if('ArrowUp'===e.key&&(!t.trim()||i.value)){const a=f(t);if(null!==a)return e.preventDefault(),a}if('ArrowDown'===e.key&&i.value){const t=y();if(null!==t)return e.preventDefault(),t}if('Escape'===e.key&&i.value){const t=o.value;return h(),e.preventDefault(),t}return null},getHistoryAt:e=>e>=0&&e<a.value.length?a.value[e]:null,removeHistoryAt:S,removeHistoryByContent:e=>{const t=a.value.findIndex(t=>t.content===e);return t>=0&&S(t)},clearHistory:()=>{a.value=[],h(),t.autoSave&&p(),console.log('[useInputHistory] å†å²è®°å½•å·²æ¸…ç©º')},searchHistory:e=>{if(!e||!e.trim())return a.value;const t=e.toLowerCase();return a.value.filter(e=>e.content.toLowerCase().includes(t))},loadFromStorage:g,saveToStorage:p,exportHistory:()=>JSON.stringify(a.value,null,2),importHistory:(e,n=!1)=>{try{const o=JSON.parse(e);if(!Array.isArray(o))throw new Error('æ— æ•ˆçš„å†å²è®°å½•æ ¼å¼');const l=o.map(e=>'string'==typeof e?{content:e,timestamp:Date.now()}:e);return n?(l.forEach(e=>{a.value.some(t=>t.content===e.content)||a.value.push(e)}),a.value.sort((e,t)=>t.timestamp-e.timestamp),a.value.length>t.maxItems&&(a.value=a.value.slice(0,t.maxItems))):a.value=l.slice(0,t.maxItems),t.autoSave&&p(),console.log('[useInputHistory] å†å²è®°å½•å·²å¯¼å…¥'),!0}catch(e){return console.error('[useInputHistory] å¯¼å…¥å†å²è®°å½•å¤±è´¥:',e),!1}},config:t}}(),h=(0,l.ref)(''),S=(0,l.ref)(null),E=(0,l.ref)(!1),V=(0,l.ref)(''),b=(0,l.computed)(()=>h.value.trim().length>0&&!n.isLoading),N=(0,l.computed)(()=>n.isLoading?'AIæ­£åœ¨æ€è€ƒä¸­ï¼Œè¯·ç¨å€™...':u.value?'ä½¿ç”¨ â†‘â†“ å¯¼èˆªå†å²ï¼ŒEsc å–æ¶ˆ':n.placeholder),w=(0,l.computed)(()=>V.value.trim()?y(V.value):s.value),C=()=>{if(!b.value)return;const e=h.value.trim();d(e),o('send',e),h.value='',E.value=!1,(0,l.nextTick)(()=>{S.value&&(S.value.style.height='auto')})},k=e=>{if('Enter'===e.key&&!e.shiftKey)return e.preventDefault(),void C();if('ArrowUp'===e.key&&A()){const t=m(h.value);null!==t&&(e.preventDefault(),h.value=t,(0,l.nextTick)(()=>{S.value&&(S.value.selectionStart=S.value.selectionEnd=h.value.length)}))}if('ArrowDown'===e.key&&u.value&&M()){const t=v();null!==t&&(e.preventDefault(),h.value=t,(0,l.nextTick)(()=>{S.value&&(S.value.selectionStart=S.value.selectionEnd=h.value.length)}))}'Escape'===e.key&&(u.value?(I(),e.preventDefault()):E.value&&(E.value=!1,e.preventDefault()))},A=()=>{if(!S.value)return!0;const e=S.value.selectionStart||0;return!h.value.substring(0,e).includes('\n')},M=()=>{if(!S.value)return!0;const e=S.value.selectionStart||0;return!h.value.substring(e).includes('\n')},I=()=>{g(),h.value=''},D=()=>{if(!S.value)return;S.value.style.height='auto';const e=S.value.scrollHeight;S.value.style.height=Math.min(e,120)+'px'},B=()=>{S.value?.focus()},x=()=>{E.value=!E.value,E.value&&(V.value='')},T=async()=>{await Z('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ','æ¸…ç©ºå†å²')&&(f(),V.value='')},R=e=>{const t=new Date(e),a=new Date,n=a.getTime()-e;return n<6e4?'åˆšåˆš':n<36e5?`${Math.floor(n/6e4)}åˆ†é’Ÿå‰`:n<864e5?`${Math.floor(n/36e5)}å°æ—¶å‰`:t.getFullYear()===a.getFullYear()?`${t.getMonth()+1}/${t.getDate()} ${t.getHours()}:${String(t.getMinutes()).padStart(2,'0')}`:`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`};return t({focus:B,clear:()=>{h.value='',g(),S.value&&(S.value.style.height='auto')},addToHistory:d,clearHistory:f}),(0,l.onMounted)(()=>{B()}),(0,l.watch)(h,(e,t)=>{if(u.value&&e!==t){const t=s.value[r.value];t&&e!==t.content&&g()}}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('footer',ne,[(0,l.createCommentVNode)(' å†å²è®°å½•é¢æ¿ '),(0,l.createVNode)(l.Transition,{name:'slide-up'},{default:(0,l.withCtx)(()=>[E.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',oe,[(0,l.createElementVNode)('div',le,[t[4]||(t[4]=(0,l.createElementVNode)('span',{class:'history-title'},'ğŸ“œ å†å²è¾“å…¥è®°å½•',-1)),(0,l.createElementVNode)('span',se,(0,l.toDisplayString)((0,l.unref)(c))+' æ¡',1),(0,l.createElementVNode)('div',re,[(0,l.unref)(i)?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'history-clear-btn',title:'æ¸…ç©ºå†å²',onClick:T},'ğŸ—‘ï¸')):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('button',{class:'history-close-btn',title:'å…³é—­',onClick:t[0]||(t[0]=e=>E.value=!1)},'âœ•')])]),(0,l.createCommentVNode)(' æœç´¢æ¡† '),(0,l.createElementVNode)('div',ce,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>V.value=e),type:'text',class:'history-search-input',placeholder:'æœç´¢å†å²è®°å½•...'},null,512),[[l.vModelText,V.value]])]),(0,l.createCommentVNode)(' å†å²è®°å½•åˆ—è¡¨ '),(0,l.createElementVNode)('div',ie,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(w.value,(e,t)=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.timestamp,class:(0,l.normalizeClass)(['history-item',{'is-active':t===(0,l.unref)(r)}]),onClick:t=>{return a=e.content,h.value=a,E.value=!1,g(),B(),void(0,l.nextTick)(()=>{D()});var a}},[(0,l.createElementVNode)('span',de,(0,l.toDisplayString)((a=e.content,n=80,a.length<=n?a:a.substring(0,n)+'...')),1),(0,l.createElementVNode)('span',me,(0,l.toDisplayString)(R(e.timestamp)),1),(0,l.createElementVNode)('button',{class:'history-delete-btn',title:'åˆ é™¤',onClick:(0,l.withModifiers)(e=>(e=>{p(e)})(t),['stop'])},'âœ•',8,ve)],10,ue);var a,n}),128)),0===w.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('div',ge,(0,l.toDisplayString)(V.value?'æœªæ‰¾åˆ°åŒ¹é…çš„è®°å½•':'æš‚æ— å†å²è®°å½•'),1)):(0,l.createCommentVNode)('v-if',!0)])])):(0,l.createCommentVNode)('v-if',!0)]),_:1}),(0,l.createCommentVNode)(' è¾“å…¥åŒºåŸŸ '),(0,l.createElementVNode)('div',pe,[(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['input-container',{'is-loading':e.isLoading,'has-error':!!e.error}])},[(0,l.createCommentVNode)(' å†å²è®°å½•æŒ‰é’® '),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['history-toggle-btn',{'has-history':(0,l.unref)(i),'is-active':E.value}]),title:(0,l.unref)(i)?`å†å²è®°å½• (${(0,l.unref)(c)})`:'æš‚æ— å†å²è®°å½•',onClick:x},[...t[5]||(t[5]=[(0,l.createElementVNode)('span',{class:'history-icon'},'ğŸ“œ',-1)])],10,fe),(0,l.withDirectives)((0,l.createElementVNode)('textarea',{ref_key:'inputRef',ref:S,'onUpdate:modelValue':t[2]||(t[2]=e=>h.value=e),class:'message-input',placeholder:N.value,disabled:e.isLoading,rows:'1',onKeydown:k,onInput:D},null,40,ye),[[l.vModelText,h.value]]),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['send-btn',{'is-loading':e.isLoading}]),disabled:!b.value,title:e.isLoading?'æ­£åœ¨ç”Ÿæˆ...':'å‘é€æ¶ˆæ¯ (Enter)',onClick:C},[e.isLoading?((0,l.openBlock)(),(0,l.createElementBlock)('span',Se,'â³')):((0,l.openBlock)(),(0,l.createElementBlock)('span',Ee,'ğŸ“¤'))],10,he)],2),(0,l.createCommentVNode)(' å†å²å¯¼èˆªæç¤º '),(0,l.unref)(u)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ve,[t[6]||(t[6]=(0,l.createElementVNode)('span',{class:'hint-icon'},'â¬†ï¸â¬‡ï¸',-1)),(0,l.createElementVNode)('span',be,(0,l.toDisplayString)((0,l.unref)(r)+1)+'/'+(0,l.toDisplayString)((0,l.unref)(c)),1),(0,l.createElementVNode)('button',{class:'hint-cancel',title:'å–æ¶ˆ (Esc)',onClick:I},'âœ•')])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' é”™è¯¯æç¤º '),e.error?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ne,[t[7]||(t[7]=(0,l.createElementVNode)('span',{class:'error-icon'},'âš ï¸',-1)),(0,l.createElementVNode)('span',we,(0,l.toDisplayString)(e.error),1),(0,l.createElementVNode)('button',{class:'error-dismiss',onClick:t[3]||(t[3]=t=>e.$emit('clearError'))},'âœ•')])):(0,l.createCommentVNode)('v-if',!0)])]))}}),ke=(0,E.A)(Ce,[['__scopeId','data-v-1712b424']]);function Ae(){try{if('undefined'!=typeof window&&window.Mvu)return window.Mvu}catch{}return null}const Me={isMvuAvailable(){const e=Ae();return!(!e||'function'!=typeof e.getMvuData)},getMvuData(e){try{const t=Ae();return t&&t.getMvuData(e||{type:'message',message_id:'latest'})||null}catch(e){return console.error('[MvuService] è·å–MVUæ•°æ®å¤±è´¥:',e),null}},getVariable(e,t){try{const a=Ae();if(!a)return t?.default_value;const n=this.getMvuData(t);return n?a.getMvuVariable(n,e,{category:'stat',default_value:t?.default_value}):t?.default_value}catch(e){return console.error('[MvuService] è·å–å˜é‡å¤±è´¥:',e),t?.default_value}},async setVariable(e,t,a){try{const n=Ae();if(!n)return console.error('[MvuService] è®¾ç½®å˜é‡å¤±è´¥: Mvu å¯¹è±¡ä¸å¯ç”¨'),!1;const o=this.getMvuData(a);if(!o)return console.error('[MvuService] è®¾ç½®å˜é‡å¤±è´¥: æ— æ³•è·å– MvuData'),!1;o.stat_data||(console.warn('[MvuService] stat_data ä¸ºç©ºï¼Œåˆå§‹åŒ–ä¸ºç©ºå¯¹è±¡'),o.stat_data={}),o.display_data||(o.display_data={}),console.log('[MvuService] å°è¯•è®¾ç½®å˜é‡:',{path:e,valueType:typeof t,valuePreview:'object'==typeof t?JSON.stringify(t).substring(0,100)+'...':t,stat_data_keys:Object.keys(o.stat_data||{})});let l=!1;try{l=await n.setMvuVariable(o,e,t,{reason:a?.reason,is_recursive:!0})}catch(e){console.warn('[MvuService] MVUåŸç”ŸAPIè°ƒç”¨å¼‚å¸¸:',e),l=!1}if(!l){console.log('[MvuService] MVUåŸç”ŸAPIå¤±è´¥ï¼Œå°è¯•ç›´æ¥è®¾ç½® stat_data...');try{o.stat_data||(console.warn('[MvuService] stat_data åœ¨ API è°ƒç”¨åå˜ä¸ºç©ºï¼Œé‡æ–°åˆå§‹åŒ–'),o.stat_data={});const n=e.split('.');if(n.length>1){let e=o.stat_data;for(let t=0;t<n.length-1;t++){const a=n[t];if(void 0===e[a]||null===e[a])console.log(`[MvuService] åˆ›å»ºä¸­é—´è·¯å¾„: ${n.slice(0,t+1).join('.')}`),e[a]={};else if('object'!=typeof e[a])return console.warn(`[MvuService] è·¯å¾„ "${n.slice(0,t+1).join('.')}" ä¸æ˜¯å¯¹è±¡ï¼Œæ— æ³•ç»§ç»­`),!1;e=e[a]}}this.setNestedValue(o.stat_data,e,t),o.display_data||(o.display_data={});const s=a?.reason?`æ–°å»º (${a.reason})`:'æ–°å»º';try{this.setNestedValue(o.display_data,e,s)}catch(e){console.warn('[MvuService] è®¾ç½® display_data å¤±è´¥:',e)}l=!0,console.log('[MvuService] ç›´æ¥è®¾ç½® stat_data æˆåŠŸ')}catch(e){console.error('[MvuService] ç›´æ¥è®¾ç½® stat_data å¤±è´¥:',e),l=!1}}if(l)try{await n.replaceMvuData(o,a||{type:'message',message_id:'latest'}),console.log('[MvuService] æ•°æ®å·²æ›¿æ¢ä¿å­˜')}catch(e){return console.error('[MvuService] æ›¿æ¢æ•°æ®å¤±è´¥:',e),!1}else console.error('[MvuService] å˜é‡è®¾ç½®å¤±è´¥');return l}catch(e){return console.error('[MvuService] è®¾ç½®å˜é‡å¤±è´¥:',e),!1}},setNestedValue(e,t,a){if(null==e)throw new Error(`[setNestedValue] ç›®æ ‡å¯¹è±¡ä¸º ${e}ï¼Œæ— æ³•è®¾ç½®è·¯å¾„ "${t}"`);if('object'!=typeof e)throw new Error(`[setNestedValue] ç›®æ ‡å¯¹è±¡ä¸æ˜¯å¯¹è±¡ç±»å‹ï¼Œæ— æ³•è®¾ç½®è·¯å¾„ "${t}"`);const n=t.split('.');let o=e;for(let e=0;e<n.length-1;e++){const t=n[e];if(null==o||'object'!=typeof o)throw new Error(`[setNestedValue] è·¯å¾„ "${n.slice(0,e).join('.')}" å¤„çš„å€¼ä¸æ˜¯å¯¹è±¡ï¼Œæ— æ³•ç»§ç»­è®¾ç½®`);t in o&&'object'==typeof o[t]&&null!==o[t]||(o[t]={}),o=o[t]}o[n[n.length-1]]=a},async setVariables(e,t){try{const a=Ae();if(!a)return!1;const n=this.getMvuData(t);if(!n)return!1;for(const[o,l]of Object.entries(e))await a.setMvuVariable(n,o,l,{reason:t?.reason,is_recursive:!1});return await a.replaceMvuData(n,t||{type:'message',message_id:'latest'}),!0}catch(e){return console.error('[MvuService] æ‰¹é‡è®¾ç½®å˜é‡å¤±è´¥:',e),!1}},getAllVariableKeys(e){try{const t=this.getMvuData(e);return t?Object.keys(t.stat_data||{}):[]}catch{return[]}},getEvents(){const e=Ae();return e?.events||null}},Ie=t('mvu',()=>{const e=(0,l.shallowRef)(null),t=(0,l.ref)(!1),a=(0,l.ref)(!1),n=(0,l.ref)(null),o=(0,l.ref)({type:'message',message_id:'latest'}),s=(0,l.ref)([]),r=(0,l.ref)([]),c=(0,l.ref)(!1),i=(0,l.ref)(!1),u=t=>{if(console.log('[MvuStore] å˜é‡æ›´æ–°å¼€å§‹'),t)try{e.value=JSON.parse(JSON.stringify(t))}catch(a){e.value=t}},d=(e,t,a,n)=>{console.log(`[MvuStore] å˜é‡æ›´æ–°: ${t}`,{oldValue:a,newValue:n}),s.value.forEach(e=>{if(t===e.path||t.startsWith(e.path+'.'))try{e.callback(a,n)}catch(t){console.error(`[MvuStore] å˜é‡ç›‘å¬å™¨å›è°ƒå¤±è´¥ (${e.path}):`,t)}})},m=['MC'],v=(e,t)=>t.split('.').reduce((e,t)=>e&&'object'==typeof e?e[t]:void 0,e),g=t=>{if(console.log('[MvuStore] å˜é‡æ›´æ–°ç»“æŸäº‹ä»¶è§¦å‘'),i.value)return void console.log('[MvuStore] æ­£åœ¨æ‰§è¡Œå†…éƒ¨æ›´æ–°ï¼Œè·³è¿‡äº‹ä»¶å¤„ç†ï¼ˆé¿å…æ•°æ®è¦†ç›–ï¼‰');const a=Me.getMvuData(o.value);if(!a)return void console.warn('[MvuStore] è·å–åˆ°çš„æœ€æ–°æ•°æ®ä¸ºç©ºï¼Œä¿æŒç°æœ‰æ•°æ®ä¸å˜');if(!((e,t)=>{if(!e?.stat_data)return!0;const a=Object.keys(e.stat_data),n=Object.keys(t.stat_data||{});if(a.length>0&&n.length<.5*a.length)return console.warn('[MvuStore] æ•°æ®éªŒè¯å¤±è´¥ï¼šé”®æ•°é‡å‡å°‘è¿‡å¤š',{oldCount:a.length,newCount:n.length}),!1;for(const a of m){const n=v(e.stat_data,a),o=v(t.stat_data||{},a);if(void 0!==n&&void 0===o)return console.warn('[MvuStore] æ•°æ®éªŒè¯å¤±è´¥ï¼šå…³é”®è·¯å¾„ä¸¢å¤±',a),!1}return!0})(e.value,a))return void console.warn('[MvuStore] æ•°æ®éªŒè¯å¤±è´¥ï¼Œä¿æŒç°æœ‰æ•°æ®ä¸å˜');const n=Object.keys(a.stat_data||{});try{e.value=JSON.parse(JSON.stringify(a)),console.log('[MvuStore] å·²ä» MVU API è·å–æœ€æ–°æ•°æ®ï¼Œstat_data é”®:',n)}catch(t){e.value=a}p()},p=()=>{e.value&&r.value.forEach(t=>{try{t(e.value)}catch(e){console.error('[MvuStore] æ›´æ–°ç»“æŸç›‘å¬å™¨å›è°ƒå¤±è´¥:',e)}})},f=(0,l.computed)(()=>e.value?.stat_data||{}),y=(0,l.computed)(()=>e.value?.display_data||{}),h=(0,l.computed)(()=>e.value?.delta_data||{}),S=(0,l.computed)(()=>e.value?.initialized_lorebooks||[]),E=(0,l.computed)(()=>e.value?Me.getAllVariableKeys(o.value):[]),V=()=>{if(c.value)return;const e=function(){try{if('undefined'!=typeof window&&'function'==typeof window.eventOn)return window.eventOn}catch{}return null}(),t=Me.getEvents();if(e&&t)try{e(t.VARIABLE_UPDATE_STARTED,u),e(t.SINGLE_VARIABLE_UPDATED,d),e(t.VARIABLE_UPDATE_ENDED,g),c.value=!0,console.log('[MvuStore] å·²æ³¨å†Œ MVU äº‹ä»¶ç›‘å¬')}catch(e){console.error('[MvuStore] æ³¨å†Œäº‹ä»¶ç›‘å¬å¤±è´¥:',e)}else console.warn('[MvuStore] æ— æ³•æ³¨å†Œäº‹ä»¶ç›‘å¬ï¼ševentOn æˆ– Mvu.events ä¸å¯ç”¨')},b=()=>{if(!c.value)return;const e=function(){try{if('undefined'!=typeof window&&'function'==typeof window.eventOff)return window.eventOff}catch{}return null}(),t=Me.getEvents();if(e&&t)try{e(t.VARIABLE_UPDATE_STARTED,u),e(t.SINGLE_VARIABLE_UPDATED,d),e(t.VARIABLE_UPDATE_ENDED,g),c.value=!1,console.log('[MvuStore] å·²å–æ¶ˆ MVU äº‹ä»¶ç›‘å¬')}catch(e){console.error('[MvuStore] å–æ¶ˆäº‹ä»¶ç›‘å¬å¤±è´¥:',e)}},N=async l=>{try{a.value=!0,n.value=null,l&&(o.value=l),console.log('[MvuStore] ç­‰å¾…MVUæ¡†æ¶åŠ è½½...');const s=await(async(e=3e3,t=100)=>{const a=Date.now();for(;Date.now()-a<e;){if(Me.isMvuAvailable())return!0;await new Promise(e=>setTimeout(e,t))}return Me.isMvuAvailable()})();if(t.value=s,!t.value)return console.warn('[MvuStore] MVUå˜é‡æ¡†æ¶æœªåŠ è½½ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®'),e.value={stat_data:{},display_data:{},delta_data:{},initialized_lorebooks:[]},void k();console.log('[MvuStore] MVUæ¡†æ¶å·²å°±ç»ªï¼Œå¼€å§‹åˆå§‹åŒ–...'),await A(),await M(),console.log('[MvuStore] åˆå§‹åŒ–å®Œæˆ')}catch(e){n.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥',console.error('[MvuStore] åˆå§‹åŒ–å¤±è´¥:',e),k()}finally{a.value=!1}};let w=0,C=null;const k=()=>{if(w>=3)return void console.warn('[MvuStore] å·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œåœæ­¢é‡è¯•');C&&clearTimeout(C),w++;const e=500*w;console.log(`[MvuStore] å°†åœ¨ ${e}ms åè¿›è¡Œç¬¬ ${w} æ¬¡é‡è¯•...`),C=setTimeout(async()=>{if(Me.isMvuAvailable()&&!t.value){console.log('[MvuStore] MVUæ¡†æ¶ç°åœ¨å¯ç”¨ï¼Œé‡æ–°åˆå§‹åŒ–...'),t.value=!0;try{await A(),await M(),console.log('[MvuStore] é‡è¯•åˆå§‹åŒ–æˆåŠŸ'),w=0}catch(e){console.error('[MvuStore] é‡è¯•åˆå§‹åŒ–å¤±è´¥:',e),k()}}else Me.isMvuAvailable()||(console.log('[MvuStore] MVUæ¡†æ¶ä»ä¸å¯ç”¨ï¼Œç»§ç»­ç­‰å¾…...'),k())},e)},A=async()=>{for(let e=0;e<3;e++){if(V(),c.value)return;console.log(`[MvuStore] äº‹ä»¶ç›‘å¬å™¨æ³¨å†Œå¤±è´¥ï¼Œé‡è¯• ${e+1}/3...`),await new Promise(e=>setTimeout(e,500))}console.warn('[MvuStore] äº‹ä»¶ç›‘å¬å™¨æ³¨å†Œæœ€ç»ˆå¤±è´¥ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨')},M=async()=>{let t=null;for(let a=0;a<3;a++){try{if(await I(),e.value&&e.value.stat_data)return;console.log(`[MvuStore] æ•°æ®åŠ è½½ä¸å®Œæ•´ï¼Œé‡è¯• ${a+1}/3...`)}catch(e){t=e instanceof Error?e:new Error(String(e)),console.warn(`[MvuStore] åŠ è½½æ•°æ®å¤±è´¥ï¼Œé‡è¯• ${a+1}/3:`,e)}await new Promise(e=>setTimeout(e,500))}if(t)throw t},I=async()=>{try{a.value=!0,n.value=null;const t=Me.getMvuData(o.value);e.value=t?JSON.parse(JSON.stringify(t)):null,console.log('[MvuStore] åŠ è½½MVUæ•°æ®å®Œæˆ:',{hasData:!!t,stat_data_keys:e.value?Object.keys(e.value.stat_data||{}):[],has_è§„ç« åˆ¶åº¦:void 0!==e.value?.stat_data?.['è§„ç« åˆ¶åº¦'],è§„ç« åˆ¶åº¦_type:e.value?.stat_data?.['è§„ç« åˆ¶åº¦']?typeof e.value.stat_data['è§„ç« åˆ¶åº¦']:'undefined',è§„ç« åˆ¶åº¦_keys:e.value?.stat_data?.['è§„ç« åˆ¶åº¦']?Object.keys(e.value.stat_data['è§„ç« åˆ¶åº¦']):[]})}catch(e){n.value=e instanceof Error?e.message:'åŠ è½½MVUæ•°æ®å¤±è´¥',console.error('[MvuStore] åŠ è½½MVUæ•°æ®å¤±è´¥:',e)}finally{a.value=!1}},D=(t,a)=>{try{const n=Me.getVariable(t,{...o.value,default_value:a});if(void 0!==n)return n;const l=t.split('.').reduce((e,t)=>e&&'object'==typeof e?e[t]:void 0,e.value?.stat_data);return void 0!==l?l:a}catch(e){return n.value=e instanceof Error?e.message:'è·å–å˜é‡å¤±è´¥',console.error(`[MvuStore] getVariable("${t}") å¤±è´¥:`,e),a}},B=async(e,t,a)=>{try{n.value=null;const l=await Me.setVariable(e,t,{...o.value,reason:a});return l&&await I(),l}catch(e){return n.value=e instanceof Error?e.message:'è®¾ç½®å˜é‡å¤±è´¥',!1}},x=e=>(r.value.push(e),()=>{const t=r.value.indexOf(e);t>-1&&r.value.splice(t,1)}),T=async(e=5e3,t=200)=>{const a=Date.now();let n=null;for(console.log('[MvuStore] ç­‰å¾… MVU æ•°æ®å‡†å¤‡å°±ç»ª...');Date.now()-a<e;){if(!Me.isMvuAvailable()){await new Promise(e=>setTimeout(e,t));continue}const e=Me.getMvuData(o.value),a=e?JSON.stringify(Object.keys(e.stat_data||{})):'null';if(e&&e.stat_data&&Object.keys(e.stat_data).length>0){if(a===n)return console.log('[MvuStore] MVU æ•°æ®å·²ç¨³å®šï¼Œé”®:',Object.keys(e.stat_data)),!0;n=a}await new Promise(e=>setTimeout(e,t))}return console.warn('[MvuStore] ç­‰å¾… MVU æ•°æ®è¶…æ—¶ï¼Œå°è¯•ç»§ç»­åˆå§‹åŒ–...'),Me.isMvuAvailable()},R=e=>{if(!e||'string'!=typeof e)return null;const t=[...e.matchAll(/<UpdateVariable>([\s\S]*?)<\/UpdateVariable>/gi)];return t.length>0?t[t.length-1][1].trim():null},L=e=>{const t=[];if(!e||'string'!=typeof e)return t;const a=e.split('\n');let n,o='',l=0,s=0,r=!1,c='';for(let e=0;e<a.length;e++){const i=a[e].trim();if(!i)continue;if(i.startsWith('//')){n=i.slice(2).trim();continue}o+=(o?'\n':'')+i;for(let e=0;e<i.length;e++){const t=i[e],a=e>0?i[e-1]:'';'"'!==t&&'\''!==t||'\\'===a?r||('{'===t?l++:'}'===t?l--:'['===t?s++:']'===t&&s--):r?t===c&&(r=!1):(r=!0,c=t)}const u=o.trim();if(0===l&&0===s&&(u.endsWith(');')||u.endsWith(')'))){const e=O(o,n);e&&t.push(e),o='',n=void 0,l=0,s=0,r=!1}}if(o.trim()){const e=O(o,n);e&&t.push(e)}return t},O=(e,t)=>{if(!e||'string'!=typeof e)return null;let a=e.trim();a.endsWith(';')&&(a=a.slice(0,-1).trim());const n=U(a);if(n>-1){const e=a.slice(n+2).trim();!t&&e&&(t=e),a=a.slice(0,n).trim()}if(!a)return null;const o=a.match(/^_\.(set|assign|add|remove)\s*\(\s*([\s\S]*)\s*\)$/i);if(o)return P(o[1].toLowerCase(),o[2],t);const l=a.match(/^(SET|ADD|SUB|MUL|DIV|APPEND|REMOVE|CLEAR|TOGGLE|INIT)\s*\(\s*([\s\S]*)\s*\)$/i);return l?F(l[1].toUpperCase(),l[2],t):(console.warn('[MvuStore] æ— æ³•è§£æå‘½ä»¤:',a.substring(0,100)+(a.length>100?'...':'')),null)},U=e=>{let t=!1,a='',n=-1;for(let o=0;o<e.length-1;o++){const l=e[o],s=e[o+1],r=o>0?e[o-1]:'';'"'!==l&&'\''!==l||'\\'===r?t||'/'!==l||'/'!==s||(n=o):t?l===a&&(t=!1):(t=!0,a=l)}return n},P=(e,t,a)=>{const n=j(t);if(n.length<1)return console.warn('[MvuStore] lodashå‘½ä»¤å‚æ•°ä¸è¶³:',e,t.substring(0,50)),null;const o='string'==typeof n[0]?n[0]:String(n[0]);switch(e){case'set':return{type:'SET',path:o,value:n.length>=3?n[2]:n[1],comment:a};case'assign':if(n.length<3)return console.warn('[MvuStore] _.assignéœ€è¦3ä¸ªå‚æ•°:',t.substring(0,50)),null;return{type:'SET',path:`${o}.${'string'==typeof n[1]?n[1]:String(n[1])}`,value:n[2],comment:a};case'add':{const e=n.length>=2?n[1]:1;return{type:'ADD',path:o,value:'number'==typeof e?e:parseFloat(e)||1,comment:a}}case'remove':return n.length>=2?{type:'REMOVE',path:o,value:n[1],comment:a}:{type:'CLEAR',path:o,comment:a};default:return console.warn('[MvuStore] æœªçŸ¥çš„lodashæ–¹æ³•:',e),null}},F=(e,t,a)=>{const n=j(t);if(n.length<1)return console.warn('[MvuStore] å‘½ä»¤å‚æ•°ä¸è¶³:',e),null;return{type:e,path:'string'==typeof n[0]?n[0]:String(n[0]),value:n.length>=2?n[1]:void 0,comment:a}},j=e=>{const t=[];let a='',n=0,o=0,l=!1,s='';const r=e.trim();for(let e=0;e<r.length;e++){const c=r[e],i=e>0?r[e-1]:'';if('"'!==c&&'\''!==c||'\\'===i)if(l)a+=c;else if('{'!==c)if('}'!==c)if('['!==c)if(']'!==c){if(','===c&&0===n&&0===o){const e=a.trim();e&&t.push(H(e)),a='';continue}a+=c}else o--,a+=c;else o++,a+=c;else n--,a+=c;else n++,a+=c;else l?c===s&&(l=!1):(l=!0,s=c),a+=c}const c=a.trim();return c&&t.push(H(c)),t},H=e=>{const t=e.trim();if(t){if('null'===t)return null;if('true'===t)return!0;if('false'===t)return!1;if(/^-?\d+(\.\d+)?$/.test(t))return parseFloat(t);if(t.startsWith('\'')&&t.endsWith('\'')||t.startsWith('"')&&t.endsWith('"'))return t.slice(1,-1);if(t.startsWith('{')&&t.endsWith('}')||t.startsWith('[')&&t.endsWith(']'))try{return JSON.parse(t)}catch{try{const e=t.replace(/'/g,'"');return JSON.parse(e)}catch{return console.warn('[MvuStore] JSONè§£æå¤±è´¥:',t.substring(0,100)),t}}return t}},W=async e=>{try{const{type:t,path:a,value:n}=e;let o,l;switch(console.log('[MvuStore] æ‰§è¡Œå‘½ä»¤:',{type:t,path:a,valueType:typeof n,valuePreview:'object'==typeof n?JSON.stringify(n).substring(0,200)+'...':n}),'SET'!==t&&'INIT'!==t&&(o=D(a)),t){case'SET':case'INIT':l=n;break;case'ADD':if('number'!=typeof o||'number'!=typeof n)return{success:!1,command:e,error:'ADDæ“ä½œéœ€è¦æ•°å€¼ç±»å‹'};l=o+n;break;case'SUB':if('number'!=typeof o||'number'!=typeof n)return{success:!1,command:e,error:'SUBæ“ä½œéœ€è¦æ•°å€¼ç±»å‹'};l=o-n;break;case'MUL':if('number'!=typeof o||'number'!=typeof n)return{success:!1,command:e,error:'MULæ“ä½œéœ€è¦æ•°å€¼ç±»å‹'};l=o*n;break;case'DIV':if('number'!=typeof o||'number'!=typeof n)return{success:!1,command:e,error:'DIVæ“ä½œéœ€è¦æ•°å€¼ç±»å‹'};if(0===n)return{success:!1,command:e,error:'DIVæ“ä½œä¸èƒ½é™¤ä»¥é›¶'};l=o/n;break;case'APPEND':if(Array.isArray(o))l=[...o,n];else{if('string'!=typeof o||'string'!=typeof n)return{success:!1,command:e,error:'APPENDæ“ä½œéœ€è¦æ•°ç»„æˆ–å­—ç¬¦ä¸²ç±»å‹'};l=o+n}break;case'REMOVE':if(!Array.isArray(o))return{success:!1,command:e,error:'REMOVEæ“ä½œéœ€è¦æ•°ç»„ç±»å‹'};l=o.filter(e=>e!==n);break;case'CLEAR':l=Array.isArray(o)?[]:'object'==typeof o&&null!==o?{}:'string'==typeof o?'':'number'==typeof o?0:null;break;case'TOGGLE':if('boolean'!=typeof o)return{success:!1,command:e,error:'TOGGLEæ“ä½œéœ€è¦å¸ƒå°”ç±»å‹'};l=!o;break;default:return{success:!1,command:e,error:`æœªçŸ¥çš„å‘½ä»¤ç±»å‹: ${t}`}}const s=await B(a,l,e.comment||`${t}æ“ä½œ`);return{success:s,command:e,oldValue:o,newValue:l,error:s?void 0:'è®¾ç½®å˜é‡å¤±è´¥'}}catch(t){return{success:!1,command:e,error:t instanceof Error?t.message:'æ‰§è¡Œå‘½ä»¤å¤±è´¥'}}};let G=0;return{mvuData:e,isMvuAvailable:t,isLoading:a,error:n,currentOptions:o,statData:f,displayData:y,deltaData:h,initializedLorebooks:S,allVariableKeys:E,initialize:N,loadMvuData:I,refresh:async()=>{await I()},getVariable:D,setVariable:B,setVariables:async(e,t)=>{try{n.value=null;const a=await Me.setVariables(e,{...o.value,reason:t});return a&&await I(),a}catch(e){return n.value=e instanceof Error?e.message:'æ‰¹é‡è®¾ç½®å˜é‡å¤±è´¥',!1}},updateVariable:async(e,t,a)=>{try{n.value=null;const o=t(D(e));return await B(e,o,a)}catch(e){return n.value=e instanceof Error?e.message:'æ›´æ–°å˜é‡å¤±è´¥',!1}},watchVariable:(e,t)=>{const a={path:e,callback:t};return s.value.push(a),()=>{const e=s.value.indexOf(a);e>-1&&s.value.splice(e,1)}},onUpdateEnd:x,switchOptions:async e=>{o.value=e,await I()},clearError:()=>{n.value=null},onChatSwitch:async()=>{console.log('[MvuStore] æ£€æµ‹åˆ°èŠå¤©åˆ‡æ¢ï¼Œé‡æ–°åˆå§‹åŒ–...'),e.value=null,n.value=null,a.value=!0,await T(),t.value&&await N(o.value),a.value=!1},destroy:()=>{b(),s.value=[],r.value=[]},registerEventListeners:V,unregisterEventListeners:b,extractUpdateVariableContent:R,parseCommand:e=>{const t=L(e);return t.length>0?t[0]:null},executeCommand:W,parseAndExecuteCommands:async t=>{const a=[];i.value=!0;try{const l=R(t);if(!l)return{success:!0,results:a,error:'æœªæ‰¾åˆ°UpdateVariableæ ‡ç­¾'};console.log('[MvuStore] æå–åˆ°UpdateVariableå†…å®¹ï¼Œé•¿åº¦:',l.length);const s=e.value?JSON.parse(JSON.stringify(e.value)):null,r=await(async t=>{const a=Ae();if(!a)return console.warn('[MvuStore] ensureBasicStructure: MVUå…¨å±€å¯¹è±¡ä¸å¯ç”¨'),!1;let l=t||e.value;l||(l=Me.getMvuData(o.value)),l||(console.log('[MvuStore] åˆ›å»ºæ–°çš„ MVU æ•°æ®ç»“æ„...'),l={stat_data:{},display_data:{},delta_data:{},initialized_lorebooks:[]}),l.stat_data||(l.stat_data={});const s=l.stat_data.MC;if(s&&'object'==typeof s&&Object.keys(s).length>0)return console.log('[MvuStore] MC å¯¹è±¡å·²å­˜åœ¨ï¼Œè·³è¿‡åˆå§‹åŒ–'),!0;if(!s||'object'!=typeof s){console.log('[MvuStore] åˆå§‹åŒ–ç©ºçš„ MC å¯¹è±¡...'),l.stat_data.MC={};try{return await a.replaceMvuData(l,o.value),e.value=JSON.parse(JSON.stringify(l)),console.log('[MvuStore] MC åŸºç¡€ç»“æ„åˆå§‹åŒ–å®Œæˆ'),!0}catch(e){return console.error('[MvuStore] ä¿å­˜ MC åŸºç¡€ç»“æ„å¤±è´¥:',e),n.value='åˆå§‹åŒ–åŸºç¡€ç»“æ„å¤±è´¥: '+(e instanceof Error?e.message:String(e)),!1}}return!0})(s);r||console.warn('[MvuStore] åŸºç¡€ç»“æ„åˆå§‹åŒ–å¤±è´¥ï¼Œå°è¯•ç»§ç»­æ‰§è¡Œå‘½ä»¤...');const c=e.value?JSON.parse(JSON.stringify(e.value)):null,i=Ae();if(i&&'function'==typeof i.parseMessage&&(console.log('[MvuStore] å°è¯•ä½¿ç”¨ MVU åŸç”Ÿ parseMessage è§£æ...'),c))try{const t=JSON.parse(JSON.stringify(c));console.log('[MvuStore] parseMessage ä½¿ç”¨çš„æ•°æ®ï¼Œstat_data é”®:',Object.keys(t.stat_data||{}));const a=await i.parseMessage(l,t);if(a){const n=Object.keys(a.stat_data||{}),l=Object.keys(t.stat_data||{});if(console.log('[MvuStore] parseMessage ç»“æœéªŒè¯:',{oldKeys:l.length,newKeys:n.length}),l.length>0&&0===n.length)throw console.warn('[MvuStore] parseMessage è¿”å›çš„æ•°æ®ä¸¢å¤±äº†æ‰€æœ‰é”®ï¼Œå°è¯•æ¢å¤...'),s&&(e.value=s),new Error('parseMessage è¿”å›æ•°æ®ä¸å®Œæ•´');return await i.replaceMvuData(a,o.value),e.value=JSON.parse(JSON.stringify(a)),console.log('[MvuStore] MVU parseMessage æ‰§è¡ŒæˆåŠŸï¼Œæœ¬åœ°ç¼“å­˜å·²æ›´æ–°'),console.log('[MvuStore] æ›´æ–°åçš„ stat_data é”®:',Object.keys(a.stat_data||{})),p(),{success:!0,results:[{success:!0,command:{type:'SET',path:'MVU_NATIVE',value:null}}],error:void 0}}console.log('[MvuStore] MVU parseMessage è¿”å› undefinedï¼Œå°è¯•è‡ªå®šä¹‰è§£æ...')}catch(e){console.warn('[MvuStore] MVU parseMessage å¤±è´¥ï¼Œå›é€€åˆ°è‡ªå®šä¹‰è§£æ:',e)}console.log('[MvuStore] ä½¿ç”¨è‡ªå®šä¹‰è§£æå™¨...');const u=L(l);console.log('[MvuStore] è§£æåˆ°',u.length,'æ¡å‘½ä»¤');for(const e of u){const t=await W(e);a.push(t),t.success?console.log(`[MvuStore] å‘½ä»¤æ‰§è¡ŒæˆåŠŸ: ${e.type}('${e.path}')`):console.warn(`[MvuStore] å‘½ä»¤æ‰§è¡Œå¤±è´¥: ${e.type}('${e.path}') - ${t.error}`)}const d=a.every(e=>e.success),m=a.filter(e=>e.success).length,v=a.length-m,g=Me.getMvuData(o.value);if(g){const t=Object.keys(g.stat_data||{});Object.keys(e.value?.stat_data||{}).length>0&&0===t.length?console.warn('[MvuStore] æœ€æ–°æ•°æ®ä¸¢å¤±äº†æ‰€æœ‰é”®ï¼Œä¿æŒç°æœ‰æ•°æ®ä¸å˜'):(e.value=JSON.parse(JSON.stringify(g)),console.log('[MvuStore] æœ¬åœ°ç¼“å­˜å·²åŒæ­¥ï¼Œstat_data é”®:',t))}return console.log(`[MvuStore] å‘½ä»¤æ‰§è¡Œå®Œæˆ: ${m}æˆåŠŸ, ${v}å¤±è´¥`),p(),{success:d,results:a,error:d?void 0:`${v}æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥`}}catch(e){console.error('[MvuStore] è§£ææ‰§è¡Œå‘½ä»¤å¤±è´¥:',e);try{await I()}catch(e){console.error('[MvuStore] åˆ·æ–°MVUæ•°æ®å¤±è´¥:',e)}return{success:!1,results:a,error:e instanceof Error?e.message:'è§£ææ‰§è¡Œå‘½ä»¤å¤±è´¥'}}finally{const e=()=>{G=Math.max(0,G-1),0===G&&(i.value=!1,console.log('[MvuStore] å†…éƒ¨æ›´æ–°æ ‡å¿—å·²æ¸…é™¤'))};let t=!1;const a=x(()=>{t||(t=!0,a(),e())});setTimeout(()=>{t||(a(),e(),console.log('[MvuStore] å†…éƒ¨æ›´æ–°æ ‡å¿—è¶…æ—¶æ¸…é™¤'))},500)}}}}),De=t('app',()=>{const e=(0,l.ref)({isFullscreen:!1,theme:'dark',language:'zh-CN',volume:1,isMuted:!1}),t=(0,l.ref)(!0),a=(0,l.ref)(!1),n=(0,l.ref)(null),o=(0,l.ref)([]),s=()=>{try{if('undefined'!=typeof window){const e=window.SillyTavern;if(e){if(e.chatId)return String(e.chatId);if('function'==typeof e.getCurrentChatId){const t=e.getCurrentChatId();if(t)return String(t)}}if('function'==typeof window.getContext){const e=window.getContext();if(e?.chatId)return String(e.chatId)}}return null}catch{return null}},r=async()=>{const e=s();if(e===n.value)return void console.log('[AppStore] èŠå¤©IDæœªå˜åŒ–ï¼Œè·³è¿‡åˆ‡æ¢å¤„ç†');console.log('[AppStore] æ£€æµ‹åˆ°èŠå¤©åˆ‡æ¢:',n.value,'->',e),n.value=e;const t=Ie();if(t.isMvuAvailable)try{await t.onChatSwitch(),console.log('[AppStore] MVU StoreèŠå¤©åˆ‡æ¢å¤„ç†å®Œæˆ')}catch(e){console.error('[AppStore] MVU StoreèŠå¤©åˆ‡æ¢å¤„ç†å¤±è´¥:',e)}for(const e of o.value)try{await e()}catch(e){console.error('[AppStore] èŠå¤©åˆ‡æ¢å›è°ƒæ‰§è¡Œå¤±è´¥:',e)}},c=(0,l.ref)(0);let i=null;const u=async(e=5e3,t=100)=>{const a=Date.now();for(console.log('[AppStore] ç­‰å¾…é…’é¦†ç¯å¢ƒå°±ç»ª...');Date.now()-a<e;){const e='function'==typeof window.eventOn,a=void 0!==window.Mvu,n='function'==typeof window.generate,o=void 0!==window.TavernHelper,l=s();if(e&&a&&n&&o&&!!l)return console.log('[AppStore] é…’é¦†ç¯å¢ƒå·²å°±ç»ª:',{eventOn:e,Mvu:a,generate:n,TavernHelper:o,chatId:l}),!0;await new Promise(e=>setTimeout(e,t))}return console.warn('[AppStore] ç­‰å¾…é…’é¦†ç¯å¢ƒè¶…æ—¶ï¼Œç»§ç»­åˆå§‹åŒ–ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨ï¼‰'),!1},d=async()=>{const e=Ie();if('undefined'!=typeof window)try{if(await e.initialize(),e.isMvuAvailable&&e.mvuData)return console.log('[AppStore] MVU Storeåˆå§‹åŒ–æˆåŠŸ'),void(c.value=0);e.isMvuAvailable||(console.warn('[AppStore] MVUæ¡†æ¶æš‚ä¸å¯ç”¨ï¼Œå°†å®‰æ’é‡è¯•...'),m())}catch(e){console.warn('[AppStore] MVUåˆå§‹åŒ–å¤±è´¥ï¼Œå°†å®‰æ’é‡è¯•:',e),m()}else console.log('[AppStore] éæµè§ˆå™¨ç¯å¢ƒï¼Œè·³è¿‡MVUåˆå§‹åŒ–')},m=()=>{if(c.value>=5)return console.error('[AppStore] MVUåˆå§‹åŒ–é‡è¯•å·²è¾¾æœ€å¤§æ¬¡æ•°ï¼Œæ”¾å¼ƒé‡è¯•'),void('undefined'!=typeof toastr&&toastr.warning('å˜é‡ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨ã€‚è¯·å°è¯•åˆ·æ–°é¡µé¢ã€‚','åˆå§‹åŒ–è­¦å‘Š',{timeOut:5e3}));i&&clearTimeout(i),c.value++;const e=1e3*c.value;console.log(`[AppStore] å°†åœ¨ ${e}ms åè¿›è¡Œç¬¬ ${c.value} æ¬¡MVUåˆå§‹åŒ–é‡è¯•...`),i=setTimeout(async()=>{const e=Ie();try{await e.initialize(),e.isMvuAvailable&&e.mvuData?(console.log('[AppStore] MVU Storeé‡è¯•åˆå§‹åŒ–æˆåŠŸ'),c.value=0,'undefined'!=typeof toastr&&toastr.success('å˜é‡ç³»ç»Ÿå·²å°±ç»ª','åˆå§‹åŒ–æˆåŠŸ',{timeOut:2e3})):m()}catch(e){console.warn(`[AppStore] ç¬¬ ${c.value} æ¬¡MVUåˆå§‹åŒ–é‡è¯•å¤±è´¥:`,e),m()}},e)};return{state:e,isInitialized:a,currentChatId:n,streamingEnabled:t,mvuInitRetryCount:c,initialize:async()=>{if(!a.value){console.log('[AppStore] æ­£åœ¨åˆå§‹åŒ–MCæˆ¿å­åº”ç”¨...');try{const a=localStorage.getItem('mc-app-theme');a&&(e.value.theme=a);const n=localStorage.getItem('mc-app-language');n&&(e.value.language=n);const o=localStorage.getItem('mc-app-volume');o&&(e.value.volume=parseFloat(o));const l=localStorage.getItem('mc-app-muted');l&&(e.value.isMuted='true'===l);const s=localStorage.getItem('mc-app-streaming');null!==s&&(t.value='true'===s)}catch(e){console.warn('[AppStore] åŠ è½½è®¾ç½®å¤±è´¥:',e)}n.value=s(),console.log('[AppStore] åˆå§‹èŠå¤©ID:',n.value),(()=>{try{if('undefined'==typeof window)return;if('function'==typeof window.eventOn)if(void 0!==window.iframe_events){const e=window.iframe_events;e.CHAT_CHANGED&&(window.eventOn(e.CHAT_CHANGED,r),console.log('[AppStore] å·²æ³¨å†ŒèŠå¤©åˆ‡æ¢äº‹ä»¶ç›‘å¬å™¨ (CHAT_CHANGED)'))}else window.eventOn('js_chat_changed',r),console.log('[AppStore] å·²æ³¨å†ŒèŠå¤©åˆ‡æ¢äº‹ä»¶ç›‘å¬å™¨ (js_chat_changed)');const e=window.SillyTavern;e?.eventSource?.on&&e.eventTypes?.CHAT_CHANGED&&(e.eventSource.on(e.eventTypes.CHAT_CHANGED,r),console.log('[AppStore] å·²é€šè¿‡SillyTavern.eventSourceæ³¨å†ŒèŠå¤©åˆ‡æ¢ç›‘å¬å™¨'))}catch(e){console.warn('[AppStore] è®¾ç½®èŠå¤©åˆ‡æ¢ç›‘å¬å™¨å¤±è´¥:',e)}})(),await u(),await d(),a.value=!0,console.log('[AppStore] MCæˆ¿å­åº”ç”¨åˆå§‹åŒ–å®Œæˆ')}},toggleFullscreen:()=>{e.value.isFullscreen=!e.value.isFullscreen},toggleTheme:()=>{e.value.theme='dark'===e.value.theme?'light':'dark',localStorage.setItem('mc-app-theme',e.value.theme),'light'===e.value.theme?document.documentElement.classList.add('light-theme'):document.documentElement.classList.remove('light-theme')},setTheme:t=>{e.value.theme=t,localStorage.setItem('mc-app-theme',t),'light'===t?document.documentElement.classList.add('light-theme'):document.documentElement.classList.remove('light-theme')},setLanguage:t=>{e.value.language=t,localStorage.setItem('mc-app-language',t)},setVolume:t=>{e.value.volume=Math.max(0,Math.min(1,t)),localStorage.setItem('mc-app-volume',String(e.value.volume))},toggleMute:()=>{e.value.isMuted=!e.value.isMuted,localStorage.setItem('mc-app-muted',String(e.value.isMuted))},setMuted:t=>{e.value.isMuted=t,localStorage.setItem('mc-app-muted',String(t))},toggleStreaming:()=>{t.value=!t.value,localStorage.setItem('mc-app-streaming',String(t.value)),console.log('[AppStore] æµå¼ä¼ è¾“:',t.value?'å¼€å¯':'å…³é—­')},setStreaming:e=>{t.value=e,localStorage.setItem('mc-app-streaming',String(e)),console.log('[AppStore] æµå¼ä¼ è¾“:',e?'å¼€å¯':'å…³é—­')},onChatSwitch:e=>(o.value.push(e),()=>{const t=o.value.indexOf(e);t>-1&&o.value.splice(t,1)}),handleChatSwitch:r,getCurrentChatId:s,retryMvuInitialization:async()=>{console.log('[AppStore] ç”¨æˆ·æ‰‹åŠ¨è§¦å‘MVUé‡æ–°åˆå§‹åŒ–...'),c.value=0;const e=Ie();try{return await e.initialize(),!(!e.isMvuAvailable||!e.mvuData)&&(console.log('[AppStore] MVU Storeæ‰‹åŠ¨é‡æ–°åˆå§‹åŒ–æˆåŠŸ'),!0)}catch(e){return console.error('[AppStore] MVU Storeæ‰‹åŠ¨é‡æ–°åˆå§‹åŒ–å¤±è´¥:',e),!1}}}}),Be=['title'],_e={class:'collapse-icon'},xe={class:'nav-menu'},Te=['onClick'],Re={class:'nav-icon'},Le={key:0,class:'nav-label'},$e={key:1,class:'lite-tag'},Oe={key:0,class:'info-panels desktop-only'},Ue={class:'info-panel settings-panel'},Pe={class:'panel-body'},ze={class:'setting-item'},Fe={class:'toggle-switch'},je=['checked'],He={class:'setting-hint'},We={class:'sidebar-footer'},Ge={class:'mobile-settings'},Je={class:'mobile-setting-item'},Ye={class:'toggle-switch small'},Ke=['checked'],qe={key:0,class:'nav-label'},Xe={key:0,class:'nav-label'},Qe={key:0,class:'nav-label'},Ze={key:0,class:'nav-label'},et=(0,l.defineComponent)({__name:'Sidebar',props:{activeMenu:{default:'workplace'},collapsed:{type:Boolean,default:!1},unreadNotifications:{default:0},mobileVisible:{type:Boolean,default:!1}},emits:['menu-change','update:collapsed','open-help','open-ai-filter','open-save-manager','open-context-manager','open-history-text','view-notice','close-mobile'],setup(e,{emit:t}){const a=e,n=t,o=(0,l.ref)(a.collapsed),s=De(),r=(0,l.computed)(()=>s.streamingEnabled),c=()=>{s.toggleStreaming()},i=(0,l.computed)(()=>[{id:'workplace',icon:'ğŸ–¥ï¸',label:'æˆ‘çš„å·¥ä½'},{id:'personnel',icon:'ğŸ‘¥',label:'äººäº‹ç³»ç»Ÿ',liteTag:!0},{id:'handbook',icon:'ğŸ“–',label:'æ–‡æ¡£æŸ¥çœ‹'}]),u=()=>{o.value=!o.value,n('update:collapsed',o.value)};return(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('aside',{class:(0,l.normalizeClass)(['sidebar',{'is-collapsed':o.value,'is-visible':e.mobileVisible}])},[(0,l.createCommentVNode)(' ç§»åŠ¨ç«¯å…³é—­æŒ‰é’® '),(0,l.createElementVNode)('button',{class:'mobile-close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close-mobile')),title:'å…³é—­èœå•'},[...t[5]||(t[5]=[(0,l.createElementVNode)('span',{class:'close-icon'},'âœ•',-1)])]),(0,l.createCommentVNode)(' æŠ˜å æŒ‰é’®ï¼ˆä»…æ¡Œé¢ç«¯æ˜¾ç¤ºï¼‰ '),(0,l.createElementVNode)('button',{class:'collapse-btn',onClick:u,title:o.value?'å±•å¼€èœå•':'æ”¶èµ·èœå•'},[(0,l.createElementVNode)('span',_e,(0,l.toDisplayString)(o.value?'â—€':'â–¶'),1)],8,Be),(0,l.createCommentVNode)(' å¯¼èˆªèœå• '),(0,l.createElementVNode)('nav',xe,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(i.value,t=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t.id,class:(0,l.normalizeClass)(['nav-item',{'is-active':e.activeMenu===t.id,'is-disabled':t.disabled}]),onClick:e=>{return o=t.id,void(t.disabled||(n('menu-change',o),a.mobileVisible&&n('close-mobile')));var o}},[(0,l.createElementVNode)('span',Re,(0,l.toDisplayString)(t.icon),1),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',Le,(0,l.toDisplayString)(t.label),1)),!o.value&&t.liteTag?((0,l.openBlock)(),(0,l.createElementBlock)('span',$e,'Lite')):(0,l.createCommentVNode)('v-if',!0)],10,Te))),128))]),(0,l.createCommentVNode)(' ä¿¡æ¯é¢æ¿åŒºåŸŸï¼ˆå±•å¼€æ—¶æ˜¾ç¤ºï¼Œæ¡Œé¢ç«¯ï¼‰ '),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('div',Oe,[(0,l.createCommentVNode)(' è®¾ç½®é¢æ¿ '),(0,l.createElementVNode)('div',Ue,[t[8]||(t[8]=(0,l.createElementVNode)('div',{class:'panel-header'},[(0,l.createElementVNode)('span',{class:'panel-icon'},'âš™ï¸'),(0,l.createElementVNode)('span',{class:'panel-title'},'è®¾ç½®')],-1)),(0,l.createElementVNode)('div',Pe,[(0,l.createCommentVNode)(' æµå¼ä¼ è¾“å¼€å…³ '),(0,l.createElementVNode)('div',ze,[t[7]||(t[7]=(0,l.createElementVNode)('div',{class:'setting-label'},[(0,l.createElementVNode)('span',{class:'setting-icon'},'ğŸ“¡'),(0,l.createElementVNode)('span',{class:'setting-text'},'æµå¼ä¼ è¾“')],-1)),(0,l.createElementVNode)('label',Fe,[(0,l.createElementVNode)('input',{type:'checkbox',checked:r.value,onChange:c},null,40,je),t[6]||(t[6]=(0,l.createElementVNode)('span',{class:'toggle-slider'},null,-1))])]),(0,l.createElementVNode)('div',He,(0,l.toDisplayString)(r.value?'å®æ—¶æ˜¾ç¤ºAIå›å¤':'ç­‰å¾…å®Œæ•´å›å¤'),1)])]),(0,l.createCommentVNode)(' Liteç‰ˆæœ¬æç¤º '),t[9]||(t[9]=(0,l.createStaticVNode)('<div class="info-panel lite-info-panel" data-v-71f49f12><div class="panel-header" data-v-71f49f12><span class="panel-icon" data-v-71f49f12>ğŸ’¡</span><span class="panel-title" data-v-71f49f12>Liteç‰ˆæœ¬</span></div><div class="panel-body" data-v-71f49f12><div class="lite-notice" data-v-71f49f12><p data-v-71f49f12>å½“å‰ä¸ºMCliteç®€åŒ–ç‰ˆ</p><p class="lite-detail" data-v-71f49f12>éƒ¨åˆ†åŠŸèƒ½å·²ç®€åŒ–æˆ–ç¦ç”¨</p></div></div></div>',1))])),(0,l.createCommentVNode)(' åº•éƒ¨å¿«æ·æ“ä½œ '),(0,l.createElementVNode)('div',We,[(0,l.createCommentVNode)(' ç§»åŠ¨ç«¯æµå¼ä¼ è¾“è®¾ç½®ï¼ˆç´§å‡‘ç‰ˆï¼‰ '),(0,l.createElementVNode)('div',Ge,[(0,l.createElementVNode)('div',Je,[t[11]||(t[11]=(0,l.createElementVNode)('span',{class:'setting-icon'},'ğŸ“¡',-1)),t[12]||(t[12]=(0,l.createElementVNode)('span',{class:'setting-text'},'æµå¼',-1)),(0,l.createElementVNode)('label',Ye,[(0,l.createElementVNode)('input',{type:'checkbox',checked:r.value,onChange:c},null,40,Ke),t[10]||(t[10]=(0,l.createElementVNode)('span',{class:'toggle-slider'},null,-1))])])]),t[17]||(t[17]=(0,l.createElementVNode)('div',{class:'divider'},null,-1)),(0,l.createCommentVNode)(' æ ¸å¿ƒåŠŸèƒ½æŒ‰é’® '),(0,l.createElementVNode)('div',{class:'nav-item footer-item highlight-item',onClick:t[1]||(t[1]=t=>e.$emit('open-save-manager'))},[t[13]||(t[13]=(0,l.createElementVNode)('span',{class:'nav-icon'},'ğŸ’¾',-1)),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',qe,'å­˜æ¡£ç®¡ç†'))]),(0,l.createElementVNode)('div',{class:'nav-item footer-item highlight-item',onClick:t[2]||(t[2]=t=>e.$emit('open-context-manager'))},[t[14]||(t[14]=(0,l.createElementVNode)('span',{class:'nav-icon'},'ğŸ“š',-1)),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',Xe,'ä¸Šä¸‹æ–‡ç®¡ç†'))]),(0,l.createElementVNode)('div',{class:'nav-item footer-item highlight-item secondary',onClick:t[3]||(t[3]=t=>e.$emit('open-history-text'))},[t[15]||(t[15]=(0,l.createElementVNode)('span',{class:'nav-icon'},'ğŸ“œ',-1)),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',Qe,'å†å²æ­£æ–‡'))]),t[18]||(t[18]=(0,l.createElementVNode)('div',{class:'divider'},null,-1)),(0,l.createElementVNode)('div',{class:'nav-item footer-item',onClick:t[4]||(t[4]=t=>e.$emit('open-help'))},[t[16]||(t[16]=(0,l.createElementVNode)('span',{class:'nav-icon'},'â“',-1)),o.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',Ze,'å¸®åŠ©è¯´æ˜'))]),(0,l.createCommentVNode)(' AIè¿‡æ»¤æµ‹è¯•æŒ‰é’®å·²éšè—ï¼ˆåŠŸèƒ½å·²ç¦ç”¨ï¼‰\r\n      <div class="nav-item footer-item debug-item" @click="$emit(\'open-ai-filter\')">\r\n        <span class="nav-icon">ğŸ”¬</span>\r\n        <span v-if="!isCollapsed" class="nav-label">AIè¿‡æ»¤æµ‹è¯•</span>\r\n      </div>\r\n      ')])],2))}}),tt=(0,E.A)(et,[['__scopeId','data-v-71f49f12']]),at='MC.èŠ±åå†Œ',nt={$meta:{extensible:!0,version:'2.0'},$schema:{primaryKey:'',displayField:'',groupByField:'',fields:{$meta:{extensible:!0}},groups:{$meta:{extensible:!0}}},entries:{$meta:{extensible:!0}}};function ot(e){return Object.keys(e).filter(e=>!('$meta'===e))}function lt(e){return ot(e.fields).map(t=>({id:t,...e.fields[t]})).sort((e,t)=>(e.order??999)-(t.order??999))}const st=t('roster',()=>{const e=Ie(),t=(0,l.ref)(!1),a=(0,l.ref)(!1),n=(0,l.ref)(null),o=(0,l.ref)(null),s=(0,l.computed)(()=>e.getVariable(at,nt)),r=(0,l.computed)(()=>s.value.$schema),c=(0,l.computed)(()=>{const e=s.value.entries||{},t={};for(const a of ot(e)){const n=e[a];n&&'object'==typeof n&&!('extensible'in n)&&(t[a]=n)}return t}),i=(0,l.computed)(()=>Object.values(c.value)),u=(0,l.computed)(()=>i.value.length),d=(0,l.computed)(()=>0===u.value),m=(0,l.computed)(()=>lt(r.value)),v=(0,l.computed)(()=>function(e){return ot(e.groups).map(t=>({id:t,...e.groups[t]})).sort((e,t)=>(e.order??999)-(t.order??999))}(r.value)),g=(0,l.computed)(()=>function(e){return lt(e).filter(e=>e.showInList)}(r.value)),p=(0,l.computed)(()=>function(e){return lt(e).filter(e=>e.showInSummary)}(r.value)),f=(0,l.computed)(()=>{const e=r.value.groupByField;if(!e)return{å…¨éƒ¨:i.value};const t={};for(const a of i.value){const n=String(a[e]||'æœªåˆ†ç»„');t[n]||(t[n]=[]),t[n].push(a)}return t}),y=(0,l.computed)(()=>Object.keys(f.value)),h=(0,l.computed)(()=>o.value?c.value[o.value]:null),S=e=>{const t=r.value.fields[e];return t&&'object'==typeof t&&'label'in t?t:void 0},E=e=>{const t=r.value.groups[e];return t&&'object'==typeof t&&'label'in t?t:void 0},V=e=>c.value[e];return{isInitialized:t,isLoading:a,error:n,selectedEntryId:o,roster:s,schema:r,entries:c,entriesArray:i,entryCount:u,isEmpty:d,fieldsSorted:m,groupsSorted:v,listFields:g,summaryFields:p,entriesByGroup:f,groupNames:y,selectedEntry:h,initialize:async()=>{if(!t.value)try{a.value=!0,e.isMvuAvailable||await e.initialize(),t.value=!0}catch(e){n.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥'}finally{a.value=!1}},refresh:async()=>await e.refresh(),selectEntry:e=>{o.value=e},getField:S,getGroup:E,getFieldsForGroup:e=>{const t=E(e);return t?t.fields.map(e=>{const t=S(e);return t?{id:e,...t}:null}).filter(e=>null!==e):[]},getEntry:V,getEntryDisplayValue:e=>{const t=r.value.displayField;return t?String(e[t]||''):''},getEntryPrimaryKey:e=>{const t=r.value.primaryKey;return t?String(e[t]||''):''},addEntry:async(t,a)=>{const n=`${at}.entries.${t}`;return await e.setVariable(n,a,'æ·»åŠ æ¡ç›®')},updateEntry:async(t,a)=>{const n=V(t);if(!n)return!1;const o=`${at}.entries.${t}`;return await e.setVariable(o,{...n,...a},'æ›´æ–°æ¡ç›®')},removeEntry:async t=>{const a={...c.value};return delete a[t],await e.setVariable(`${at}.entries`,a,'åˆ é™¤æ¡ç›®')},addField:async(t,a)=>{const n=`${at}.$schema.fields.${t}`;return await e.setVariable(n,a,'æ·»åŠ å­—æ®µ')},updateSchema:async t=>{const a=`${at}.$schema`;return await e.setVariable(a,{...r.value,...t},'æ›´æ–° Schema')}}}),rt={class:'field-label'},ct={class:'field-value'},it={key:0,class:'value-text'},ut={class:'text-content'},dt={class:'enum-badge'},mt={class:'tags-container'},vt={key:0,class:'empty-tags'},gt={class:'boolean-icon'},pt={class:'value-text'},ft=(0,l.defineComponent)({__name:'SchemaFieldRenderer',props:{field:{},value:{}},setup(e){const t=e,a=(0,l.computed)(()=>null===t.value||void 0===t.value?'-':'object'==typeof t.value?JSON.stringify(t.value):String(t.value)),n=(0,l.computed)(()=>Array.isArray(t.value)?t.value.map(String):[]);return(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['schema-field',`field-type-${e.field.type}`])},[(0,l.createElementVNode)('span',rt,(0,l.toDisplayString)(e.field.label),1),(0,l.createElementVNode)('div',ct,[(0,l.createCommentVNode)(' string / number '),'string'===e.field.type||'number'===e.field.type?((0,l.openBlock)(),(0,l.createElementBlock)('span',it,(0,l.toDisplayString)(a.value),1)):'text'===e.field.type?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' text (å¤šè¡Œæ–‡æœ¬) '),(0,l.createElementVNode)('p',ut,(0,l.toDisplayString)(a.value),1)],64)):'enum'===e.field.type?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' enum (æšä¸¾) '),(0,l.createElementVNode)('span',dt,(0,l.toDisplayString)(a.value),1)],64)):'tags'===e.field.type?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' tags (æ ‡ç­¾æ•°ç»„) '),(0,l.createElementVNode)('div',mt,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(n.value,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('span',{key:t,class:'tag'},(0,l.toDisplayString)(e),1))),128)),0===n.value.length?((0,l.openBlock)(),(0,l.createElementBlock)('span',vt,'æ— ')):(0,l.createCommentVNode)('v-if',!0)])],64)):'boolean'===e.field.type?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:4},[(0,l.createCommentVNode)(' boolean '),(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['boolean-value',e.value?'is-true':'is-false'])},[(0,l.createElementVNode)('span',gt,(0,l.toDisplayString)(e.value?'âœ“':'âœ—'),1),(0,l.createTextVNode)(' '+(0,l.toDisplayString)(e.value?'æ˜¯':'å¦'),1)],2)],64)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:5},[(0,l.createCommentVNode)(' æœªçŸ¥ç±»å‹ '),(0,l.createElementVNode)('span',pt,(0,l.toDisplayString)(a.value),1)],64))])],2))}}),yt=(0,E.A)(ft,[['__scopeId','data-v-7e8ff355']]),ht={class:'roster-panel'},St={class:'panel-header'},Et={class:'header-left'},Vt={class:'header-right'},bt={class:'entry-count'},Nt={class:'panel-main'},wt={class:'category-sidebar'},Ct={class:'category-list'},kt=['onClick'],At={class:'category-name'},Mt={class:'category-count'},It={class:'panel-body'},Dt={key:0,class:'state-container loading-state'},Bt={class:'state-container error-state'},_t={class:'content-area'},xt={class:'group-header'},Tt={class:'group-title'},Rt={class:'group-count'},Lt={class:'entry-table'},$t={class:'table-header'},Ot={class:'table-body'},Ut=['onClick'],Pt={class:'col-name'},zt={class:'person-avatar'},Ft={class:'person-name'},jt={class:'summary-value'},Ht={class:'col-action'},Wt={class:'expand-btn'},Gt={key:0,class:'row-details'},Jt={class:'details-content'},Yt={class:'section-title'},Kt={class:'field-grid'},qt=(0,l.defineComponent)({__name:'RosterPanel',emits:['close'],setup(e){const t=st(),{roster:n,isEmpty:o,entryCount:s,entriesByGroup:r,groupsSorted:c,summaryFields:i,selectedEntryId:u,isLoading:d,error:m}=a(t),{selectEntry:v,getEntryPrimaryKey:g,getEntryDisplayValue:p,getFieldsForGroup:f,refresh:y,initialize:h}=t,S=(0,l.ref)(null),E=(0,l.computed)(()=>S.value?r.value[S.value]||[]:Object.values(r.value).flat()),V=e=>{const t=p(e);return t?t.charAt(0):'?'},b=(e,t)=>null==e?'-':'tags'===t.type&&Array.isArray(e)?e.length>0?e.join(', '):'-':String(e);return(0,l.onMounted)(()=>{h();const e=Object.keys(r.value);e.length>0&&(S.value=e[0])}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',ht,[(0,l.createCommentVNode)(' é¡¶éƒ¨å¤´æ  '),(0,l.createElementVNode)('div',St,[(0,l.createElementVNode)('div',Et,[t[2]||(t[2]=(0,l.createElementVNode)('span',{class:'panel-icon'},'ğŸ‘¥',-1)),(0,l.createElementVNode)('h2',null,(0,l.toDisplayString)((0,l.unref)(n).$meta?.description||'èŠ±åå†Œ'),1)]),(0,l.createElementVNode)('div',Vt,[(0,l.createElementVNode)('span',bt,(0,l.toDisplayString)((0,l.unref)(s))+' äºº',1),(0,l.createElementVNode)('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close')),title:'å…³é—­'},'âœ•')])]),(0,l.createCommentVNode)(' ä¸»ä½“åŒºåŸŸ '),(0,l.createElementVNode)('div',Nt,[(0,l.createCommentVNode)(' å·¦ä¾§åˆ†ç±»å¯¼èˆª '),(0,l.createElementVNode)('aside',wt,[t[3]||(t[3]=(0,l.createElementVNode)('div',{class:'sidebar-header'},[(0,l.createElementVNode)('span',{class:'sidebar-title'},'åˆ†ç±»')],-1)),(0,l.createElementVNode)('div',Ct,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(r),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t,class:(0,l.normalizeClass)(['category-item',{active:S.value===t}]),onClick:e=>(e=>{S.value===e?S.value=null:S.value=e})(t)},[(0,l.createElementVNode)('span',At,(0,l.toDisplayString)(t),1),(0,l.createElementVNode)('span',Mt,(0,l.toDisplayString)(e.length),1)],10,kt))),128))])]),(0,l.createCommentVNode)(' å³ä¾§å†…å®¹åŒº '),(0,l.createElementVNode)('div',It,[(0,l.createCommentVNode)(' åŠ è½½çŠ¶æ€ '),(0,l.unref)(d)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Dt,[...t[4]||(t[4]=[(0,l.createElementVNode)('div',{class:'state-icon'},'â³',-1),(0,l.createElementVNode)('p',null,'åŠ è½½ä¸­...',-1)])])):(0,l.unref)(m)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' é”™è¯¯çŠ¶æ€ '),(0,l.createElementVNode)('div',Bt,[t[5]||(t[5]=(0,l.createElementVNode)('div',{class:'state-icon'},'âš ï¸',-1)),(0,l.createElementVNode)('p',null,(0,l.toDisplayString)((0,l.unref)(m)),1),(0,l.createElementVNode)('button',{class:'retry-btn',onClick:t[1]||(t[1]=(...e)=>(0,l.unref)(y)&&(0,l.unref)(y)(...e))},'é‡è¯•')])],2112)):(0,l.unref)(o)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' ç©ºçŠ¶æ€ '),t[6]||(t[6]=(0,l.createElementVNode)('div',{class:'state-container empty-state'},[(0,l.createElementVNode)('div',{class:'state-icon'},'ğŸ“­'),(0,l.createElementVNode)('p',null,'æš‚æ— äººå‘˜æ•°æ®'),(0,l.createElementVNode)('p',{class:'empty-hint'},[(0,l.createTextVNode)('æ•°æ®ä» '),(0,l.createElementVNode)('code',null,'MC.èŠ±åå†Œ'),(0,l.createTextVNode)(' å˜é‡ä¸­è¯»å–')])],-1))],2112)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' äººå‘˜åˆ—è¡¨ '),(0,l.createElementVNode)('div',_t,[(0,l.createCommentVNode)(' å½“å‰åˆ†ç»„æ ‡é¢˜ '),(0,l.createElementVNode)('div',xt,[(0,l.createElementVNode)('h3',Tt,(0,l.toDisplayString)(S.value||'å…¨éƒ¨äººå‘˜'),1),(0,l.createElementVNode)('span',Rt,'å…± '+(0,l.toDisplayString)(E.value.length)+' äºº',1)]),(0,l.createCommentVNode)(' æ¡ç›®è¡¨æ ¼ '),(0,l.createElementVNode)('div',Lt,[(0,l.createCommentVNode)(' è¡¨å¤´ '),(0,l.createElementVNode)('div',$t,[t[7]||(t[7]=(0,l.createElementVNode)('div',{class:'col-name'},'å§“å',-1)),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(i),e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:'col-summary'},(0,l.toDisplayString)(e.label),1))),128)),t[8]||(t[8]=(0,l.createElementVNode)('div',{class:'col-action'},'æ“ä½œ',-1))]),(0,l.createCommentVNode)(' è¡¨æ ¼å†…å®¹ '),(0,l.createElementVNode)('div',Ot,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(E.value,e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:(0,l.unref)(g)(e),class:(0,l.normalizeClass)(['table-row',{'is-expanded':(0,l.unref)(u)===(0,l.unref)(g)(e)}])},[(0,l.createCommentVNode)(' ä¸»è¡Œ '),(0,l.createElementVNode)('div',{class:'row-main',onClick:t=>{return a=(0,l.unref)(g)(e),void(u.value===a?v(null):v(a));var a}},[(0,l.createElementVNode)('div',Pt,[(0,l.createElementVNode)('span',zt,(0,l.toDisplayString)(V(e)),1),(0,l.createElementVNode)('span',Ft,(0,l.toDisplayString)((0,l.unref)(p)(e)),1)]),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(i),t=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t.id,class:'col-summary'},[(0,l.createElementVNode)('span',jt,(0,l.toDisplayString)(b(e[t.id],t)),1)]))),128)),(0,l.createElementVNode)('div',Ht,[(0,l.createElementVNode)('span',Wt,(0,l.toDisplayString)((0,l.unref)(u)===(0,l.unref)(g)(e)?'æ”¶èµ· â–²':'è¯¦æƒ… â–¼'),1)])],8,Ut),(0,l.createCommentVNode)(' å±•å¼€çš„è¯¦æƒ…é¢æ¿ '),(0,l.unref)(u)===(0,l.unref)(g)(e)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Gt,[(0,l.createElementVNode)('div',Jt,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(c),t=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:t.id,class:'detail-section'},[(0,l.createElementVNode)('h4',Yt,(0,l.toDisplayString)(t.label),1),(0,l.createElementVNode)('div',Kt,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(f)(t.id),t=>((0,l.openBlock)(),(0,l.createBlock)(yt,{key:t.id,field:t,value:e[t.id]},null,8,['field','value']))),128))])]))),128))])])):(0,l.createCommentVNode)('v-if',!0)],2))),128))])])])],2112))])])]))}}),Xt=(0,E.A)(qt,[['__scopeId','data-v-1bfc907d']]),Qt='MC.æ–‡æ¡£',Zt={$meta:{extensible:!0,version:'2.0',description:'å¤šæ–‡æ¡£ç®¡ç†å®¹å™¨'}},ea={title:'',description:'',order:0,sections:{$meta:{extensible:!0}}};function ta(e){return Object.keys(e).filter(e=>!('$meta'===e))}function aa(e){return ta(e).map(t=>({id:t,...e[t]})).sort((e,t)=>(e.order??999)-(t.order??999))}function na(e,t=0){const a=[];for(const n of aa(e))a.push({...n,depth:t}),n.children&&a.push(...na(n.children,t+1));return a}const oa=t('document',()=>{const e=Ie(),t=(0,l.ref)(!1),a=(0,l.ref)(!1),n=(0,l.ref)(null),o=(0,l.ref)(null),s=(0,l.ref)(0);let r=null;const c=(0,l.computed)(()=>{const t=s.value,a=e.getVariable(Qt,Zt);return console.log('[DocumentStore] è¯»å– MC.æ–‡æ¡£ å˜é‡ (version='+t+'):',{path:Qt,rawDataType:typeof a,rawDataKeys:a&&'object'==typeof a?Object.keys(a):[],hasData:null!=a}),function(e){if(!e||'object'!=typeof e)return!1;const t=e;return'string'==typeof t.title&&'object'==typeof t.sections&&null!==t.sections}(a)?(console.log('[DocumentStore] æ£€æµ‹åˆ°æ—§ç‰ˆå•æ–‡æ¡£ç»“æ„ï¼Œè¿›è¡Œè½¬æ¢'),{$meta:{extensible:!0,version:'2.0',description:'ä»æ—§ç‰ˆè½¬æ¢çš„æ–‡æ¡£å®¹å™¨'},default:{title:(n=a).title,description:n.description,order:0,sections:n.sections}}):a;var n}),i=(0,l.computed)(()=>{return ta(e=c.value).map(t=>({id:t,...e[t]})).sort((e,t)=>(e.order??999)-(t.order??999));var e}),u=(0,l.computed)(()=>i.value.length),d=(0,l.computed)(()=>0===u.value),m=(0,l.computed)(()=>{const e=o.value;if(console.log('[DocumentStore] effectiveDocId è®¡ç®—è¢«è§¦å‘, currentDocId:',e),e)return console.log('[DocumentStore] effectiveDocId è®¡ç®—: ä½¿ç”¨é€‰ä¸­çš„æ–‡æ¡£',e),e;const t=i.value;return t.length>0?(console.log('[DocumentStore] effectiveDocId è®¡ç®—: ä½¿ç”¨é»˜è®¤æ–‡æ¡£',t[0].id),t[0].id):null}),v=(0,l.computed)(()=>{const e=m.value;if(console.log('[DocumentStore] currentDocument è®¡ç®—, docId:',e),!e)return null;const t=c.value[e];return t&&'object'==typeof t&&'title'in t?(console.log('[DocumentStore] currentDocument æ‰¾åˆ°æ–‡æ¡£:',t.title),t):(console.log('[DocumentStore] currentDocument æœªæ‰¾åˆ°æ–‡æ¡£'),null)}),g=(0,l.computed)(()=>v.value?.title||''),p=(0,l.computed)(()=>v.value?.description||''),f=(0,l.computed)(()=>v.value?.sections||{$meta:{extensible:!0}}),y=(0,l.computed)(()=>aa(f.value)),h=(0,l.computed)(()=>na(f.value).length),S=(0,l.computed)(()=>0===h.value),E=(0,l.computed)(()=>na(f.value)),V=()=>m.value,b=e=>{const t=f.value[e];return t&&'object'==typeof t&&'title'in t?t:void 0};return{isInitialized:t,isLoading:a,error:n,currentDocId:o,documentsContainer:c,documentList:i,documentCount:u,hasNoDocuments:d,effectiveDocId:m,currentDocument:v,title:g,description:p,sections:f,sectionsSorted:y,sectionCount:h,isEmpty:S,flatSections:E,initialize:async()=>{if(!t.value)try{a.value=!0,e.isMvuAvailable||await e.initialize(),r||(r=e.onUpdateEnd(()=>{console.log('[DocumentStore] æ”¶åˆ° MVU æ›´æ–°ç»“æŸäº‹ä»¶ï¼Œé€’å¢ dataVersion'),s.value++})),i.value.length>0&&!o.value&&(o.value=i.value[0].id),t.value=!0}catch(e){n.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥'}finally{a.value=!1}},refresh:async()=>{await e.refresh(),s.value++},selectDocument:e=>{console.log('[DocumentStore] selectDocument è¢«è°ƒç”¨, docId:',e),console.log('[DocumentStore] å½“å‰ currentDocId:',o.value),console.log('[DocumentStore] documentsContainer keys:',Object.keys(c.value));const t=c.value[e];console.log('[DocumentStore] æŸ¥æ‰¾åˆ°çš„æ–‡æ¡£:',t?'å­˜åœ¨':'ä¸å­˜åœ¨',t),t&&'object'==typeof t&&'title'in t?(console.log('[DocumentStore] åˆ‡æ¢åˆ°æ–‡æ¡£:',e,'å½“å‰æ–‡æ¡£ID:',o.value),o.value!==e?(o.value=e,console.log('[DocumentStore] æ–‡æ¡£åˆ‡æ¢å®Œæˆï¼Œæ–°çš„æ–‡æ¡£ID:',o.value),console.log('[DocumentStore] effectiveDocId åº”è¯¥æ›´æ–°ä¸º:',m.value),console.log('[DocumentStore] currentDocument title:',v.value?.title)):console.log('[DocumentStore] æ–‡æ¡£IDæœªå˜åŒ–ï¼Œè·³è¿‡æ›´æ–°')):(console.warn('[DocumentStore] å°è¯•é€‰æ‹©ä¸å­˜åœ¨çš„æ–‡æ¡£:',e,'å¯ç”¨æ–‡æ¡£:',Object.keys(c.value)),console.warn('[DocumentStore] doc å†…å®¹:',JSON.stringify(t)))},getEffectiveDocId:V,getSection:b,getSectionChildren:e=>e.children?aa(e.children):[],addSection:async(t,a,n)=>{const o=V();if(!o)return!1;const l=n?`${Qt}.${o}.sections.${n}.children.${t}`:`${Qt}.${o}.sections.${t}`;return await e.setVariable(l,a,'æ·»åŠ èŠ‚ç‚¹')},updateSection:async(t,a,n)=>{const o=b(t);if(!o)return!1;const l=V();if(!l)return!1;const s=n?`${Qt}.${l}.sections.${n}.children.${t}`:`${Qt}.${l}.sections.${t}`;return await e.setVariable(s,{...o,...a},'æ›´æ–°èŠ‚ç‚¹')},removeSection:async(t,a)=>{const n=V();if(!n)return!1;const o=a?`${Qt}.${n}.sections.${a}.children`:`${Qt}.${n}.sections`,l={...e.getVariable(o,{})};return delete l[t],await e.setVariable(o,l,'åˆ é™¤èŠ‚ç‚¹')},updateTitle:async t=>{const a=V();return!!a&&await e.setVariable(`${Qt}.${a}.title`,t,'æ›´æ–°æ ‡é¢˜')},updateDescription:async t=>{const a=V();return!!a&&await e.setVariable(`${Qt}.${a}.description`,t,'æ›´æ–°æè¿°')},addDocument:async(t,a)=>await e.setVariable(`${Qt}.${t}`,a,'æ·»åŠ æ–‡æ¡£'),removeDocument:async t=>{const a={...e.getVariable(Qt,{})};if(delete a[t],o.value===t){const e=Object.keys(a).filter(e=>'$meta'!==e);o.value=e.length>0?e[0]:null}return await e.setVariable(Qt,a,'åˆ é™¤æ–‡æ¡£')},DEFAULT_DOCUMENT_ENTRY:ea,destroy:()=>{r&&(r(),r=null)},dataVersion:s}}),la={key:0,class:'expand-icon'},sa={key:1,class:'expand-placeholder'},ra={class:'node-title'},ca={key:0,class:'node-content'},ia={key:1,class:'node-children'},ua=(0,l.defineComponent)({__name:'TreeNodeRenderer',props:{section:{},depth:{default:0},defaultExpanded:{type:Boolean,default:!0}},setup(e){const t=e,a=(0,l.ref)(t.defaultExpanded),n=(0,l.computed)(()=>{if(!t.section.children)return!1;return Object.keys(t.section.children).filter(e=>'$meta'!==e).length>0}),o=(0,l.computed)(()=>t.section.children?aa(t.section.children):[]),s=()=>{n.value&&(a.value=!a.value)};return(e,t)=>{const r=(0,l.resolveComponent)('TreeNodeRenderer',!0);return(0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['tree-node',`depth-${e.depth}`])},[(0,l.createCommentVNode)(' èŠ‚ç‚¹æ ‡é¢˜ '),(0,l.createElementVNode)('div',{class:'node-header',onClick:s},[n.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',la,(0,l.toDisplayString)(a.value?'â–¼':'â–¶'),1)):((0,l.openBlock)(),(0,l.createElementBlock)('span',sa)),(0,l.createElementVNode)('span',ra,(0,l.toDisplayString)(e.section.title),1)]),(0,l.createCommentVNode)(' èŠ‚ç‚¹å†…å®¹ '),!e.section.content||!a.value&&n.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('div',ca,(0,l.toDisplayString)(e.section.content),1)),(0,l.createCommentVNode)(' å­èŠ‚ç‚¹ï¼ˆé€’å½’ï¼‰ '),n.value&&a.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',ia,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(o.value,t=>((0,l.openBlock)(),(0,l.createBlock)(r,{key:t.id,section:t,depth:e.depth+1,'default-expanded':e.defaultExpanded},null,8,['section','depth','default-expanded']))),128))])):(0,l.createCommentVNode)('v-if',!0)],2)}}}),da=(0,E.A)(ua,[['__scopeId','data-v-644583f3']]),ma={class:'panel-header'},va={class:'doc-count'},ga={class:'panel-main'},pa={class:'sidebar-header'},fa={key:0,class:'sidebar-title'},ya=['title'],ha={key:0,class:'document-list'},Sa=['onClick','onKeydown'],Ea={class:'doc-info'},Va={class:'doc-title'},ba={key:0,class:'doc-desc'},Na={key:1,class:'sidebar-empty'},wa={key:2,class:'collapsed-list'},Ca=['onClick','title','onKeydown'],ka={class:'panel-body'},Aa={key:0,class:'loading-state'},Ma={class:'error-state'},Ia={class:'document-content'},Da={class:'current-doc-header'},Ba={class:'current-doc-title'},_a={class:'section-count'},xa={key:0,class:'document-description'},Ta=(0,l.defineComponent)({__name:'DocumentPanel',emits:['close'],setup(e){const t=oa(),{documentList:n,documentCount:o,hasNoDocuments:s,currentDocId:r,isLoading:c,error:i}=a(t),{refresh:u,initialize:d,selectDocument:m}=t,v=(0,l.computed)(()=>t.effectiveDocId),g=(0,l.computed)(()=>t.title),p=(0,l.computed)(()=>t.description),f=(0,l.computed)(()=>t.isEmpty),y=(0,l.computed)(()=>t.sectionCount),h=(0,l.computed)(()=>t.sectionsSorted),S=(0,l.ref)(!1),E=()=>{S.value=!S.value},V=(e,t=30)=>e.length>t?e.slice(0,t)+'...':e,b=e=>v.value===e,N=e=>{console.log('[DocumentPanel] ç‚¹å‡»é€‰æ‹©æ–‡æ¡£:',e,'å½“å‰æœ‰æ•ˆæ–‡æ¡£:',v.value),console.log('[DocumentPanel] currentDocId.value:',r.value),console.log('[DocumentPanel] å¯ç”¨æ–‡æ¡£åˆ—è¡¨:',n.value.map(e=>e.id)),m(e),console.log('[DocumentPanel] é€‰æ‹©å currentDocId:',r.value),console.log('[DocumentPanel] é€‰æ‹©å effectiveDocId:',v.value),console.log('[DocumentPanel] é€‰æ‹©å title:',g.value)};return(0,l.watch)(r,(e,t)=>{console.log('[DocumentPanel] currentDocId å˜åŒ–:',t,'->',e)}),(0,l.watch)(v,(e,t)=>{console.log('[DocumentPanel] effectiveDocId å˜åŒ–:',t,'->',e)}),(0,l.watch)(g,(e,t)=>{console.log('[DocumentPanel] title å˜åŒ–:',t,'->',e)}),(0,l.watch)(h,e=>{console.log('[DocumentPanel] sectionsSorted å˜åŒ–, èŠ‚ç‚¹æ•°:',e.length)},{deep:!0}),(0,l.onMounted)(()=>{d()}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['document-panel',{'sidebar-collapsed':S.value}])},[(0,l.createCommentVNode)(' é¡¶éƒ¨å¤´æ  '),(0,l.createElementVNode)('div',ma,[t[2]||(t[2]=(0,l.createElementVNode)('h2',null,'ğŸ“„ æ–‡æ¡£æŸ¥çœ‹',-1)),(0,l.createElementVNode)('span',va,(0,l.toDisplayString)((0,l.unref)(o))+' ä»½æ–‡æ¡£',1),(0,l.createElementVNode)('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('close'))},'âœ•')]),(0,l.createElementVNode)('div',ga,[(0,l.createCommentVNode)(' å·¦ä¾§æ–‡æ¡£åˆ—è¡¨ä¾§æ  '),(0,l.createElementVNode)('aside',{class:(0,l.normalizeClass)(['document-sidebar',{collapsed:S.value}])},[(0,l.createElementVNode)('div',pa,[S.value?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',fa,'æ–‡æ¡£åˆ—è¡¨')),(0,l.createElementVNode)('button',{class:'toggle-btn',onClick:E,title:S.value?'å±•å¼€ä¾§æ ':'æ”¶èµ·ä¾§æ '},(0,l.toDisplayString)(S.value?'â–¶':'â—€'),9,ya)]),!S.value&&(0,l.unref)(o)>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',ha,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(n),e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['doc-item',{active:b(e.id)}]),onClick:(0,l.withModifiers)(t=>N(e.id),['stop','prevent']),role:'button',tabindex:'0',onKeydown:(0,l.withKeys)(t=>N(e.id),['enter'])},[t[3]||(t[3]=(0,l.createElementVNode)('span',{class:'doc-icon'},'ğŸ“–',-1)),(0,l.createElementVNode)('div',Ea,[(0,l.createElementVNode)('span',Va,(0,l.toDisplayString)(e.title||e.id),1),e.description?((0,l.openBlock)(),(0,l.createElementBlock)('span',ba,(0,l.toDisplayString)(V(e.description)),1)):(0,l.createCommentVNode)('v-if',!0)])],42,Sa))),128))])):(0,l.createCommentVNode)('v-if',!0),S.value||0!==(0,l.unref)(o)?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('div',Na,[...t[4]||(t[4]=[(0,l.createElementVNode)('span',null,'æš‚æ— æ–‡æ¡£',-1)])])),(0,l.createCommentVNode)(' æ”¶ç¼©çŠ¶æ€ä¸‹çš„å›¾æ ‡åˆ—è¡¨ '),S.value&&(0,l.unref)(o)>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',wa,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(n),e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['collapsed-item',{active:b(e.id)}]),onClick:(0,l.withModifiers)(t=>N(e.id),['stop','prevent']),title:e.title||e.id,role:'button',tabindex:'0',onKeydown:(0,l.withKeys)(t=>N(e.id),['enter'])},' ğŸ“– ',42,Ca))),128))])):(0,l.createCommentVNode)('v-if',!0)],2),(0,l.createCommentVNode)(' å³ä¾§æ–‡æ¡£å†…å®¹åŒº '),(0,l.createElementVNode)('div',ka,[(0,l.createCommentVNode)(' åŠ è½½çŠ¶æ€ '),(0,l.unref)(c)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Aa,[...t[5]||(t[5]=[(0,l.createElementVNode)('p',null,'åŠ è½½ä¸­...',-1)])])):(0,l.unref)(i)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' é”™è¯¯çŠ¶æ€ '),(0,l.createElementVNode)('div',Ma,[(0,l.createElementVNode)('p',null,(0,l.toDisplayString)((0,l.unref)(i)),1),(0,l.createElementVNode)('button',{onClick:t[1]||(t[1]=(...e)=>(0,l.unref)(u)&&(0,l.unref)(u)(...e))},'é‡è¯•')])],2112)):(0,l.unref)(s)?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' æ— æ–‡æ¡£çŠ¶æ€ '),t[6]||(t[6]=(0,l.createElementVNode)('div',{class:'empty-state'},[(0,l.createElementVNode)('p',null,'ğŸ“­ æš‚æ— æ–‡æ¡£'),(0,l.createElementVNode)('p',{class:'empty-hint'},[(0,l.createTextVNode)('æ–‡æ¡£æ•°æ®ä» '),(0,l.createElementVNode)('code',null,'MC.æ–‡æ¡£'),(0,l.createTextVNode)(' å˜é‡ä¸­è¯»å–')]),(0,l.createElementVNode)('p',{class:'empty-hint'},'AI ä¼šåœ¨æ¸¸æˆè¿›ç¨‹ä¸­è‡ªåŠ¨æ›´æ–°æ–‡æ¡£å†…å®¹')],-1))],2112)):f.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' å½“å‰æ–‡æ¡£ä¸ºç©º '),t[7]||(t[7]=(0,l.createElementVNode)('div',{class:'empty-state'},[(0,l.createElementVNode)('p',null,'ğŸ“ è¯¥æ–‡æ¡£æš‚æ— å†…å®¹')],-1))],2112)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:4},[(0,l.createCommentVNode)(' æ–‡æ¡£å†…å®¹ '),(0,l.createElementVNode)('div',Ia,[(0,l.createElementVNode)('div',Da,[(0,l.createElementVNode)('h3',Ba,(0,l.toDisplayString)(g.value),1),(0,l.createElementVNode)('span',_a,(0,l.toDisplayString)(y.value)+' èŠ‚',1)]),p.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',xa,(0,l.toDisplayString)(p.value),1)):(0,l.createCommentVNode)('v-if',!0),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(h.value,e=>((0,l.openBlock)(),(0,l.createBlock)(da,{key:e.id,section:e,depth:0},null,8,['section']))),128))])],2112))])])],2))}}),Ra=(0,E.A)(Ta,[['__scopeId','data-v-40ace65a']]),La={HISTORY_TEXT:'å†å²æ­£æ–‡',HISTORY_RECORD:'å†å²è®°å½•',SEGMENTED_TEXT:'åˆ†æ®µæ­£æ–‡',SMALL_SUMMARY:'å°æ€»ç»“',LARGE_SUMMARY:'å¤§æ€»ç»“'},$a={segmentCount:3,smallSummaryCount:25},Oa={[La.HISTORY_TEXT]:{name:La.HISTORY_TEXT,enabled:!1,depth:2,order:100,role:'system'},[La.HISTORY_RECORD]:{name:La.HISTORY_RECORD,enabled:!1,depth:2,order:99,role:'system'},[La.SEGMENTED_TEXT]:{name:La.SEGMENTED_TEXT,enabled:!0,depth:2,order:100,role:'system'},[La.SMALL_SUMMARY]:{name:La.SMALL_SUMMARY,enabled:!0,depth:4,order:90,role:'system'},[La.LARGE_SUMMARY]:{name:La.LARGE_SUMMARY,enabled:!0,depth:6,order:80,role:'system'}},Ua='\nâ€”â€”â€”â€”â€”â€”\n',Pa='\n\n---\n\n';class za{static extractHistoryRecordTag(e){if(!e||'string'!=typeof e)return null;const t=[...e.matchAll(/<å†å²è®°å½•>([\s\S]*?)<\/å†å²è®°å½•>/gi)];return t.length>0?t[t.length-1][1].trim():null}static extractGameTextTag(e){if(!e||'string'!=typeof e)return null;const t=[...e.matchAll(/<gametxt>([\s\S]*?)<\/gametxt>/gi)];if(t.length>0){return t[t.length-1][1].trim().replace(/<!--[\s\S]*?-->/g,'').trim()}return null}static KNOWN_FIELDS=['åºå·','æ—¥æœŸ','åœ°ç‚¹','æè¿°','æ ‡ç­¾','é‡è¦ä¿¡æ¯','è‡ªåŠ¨åŒ–ç³»ç»Ÿ'];static isFieldLine(e){const t=e.indexOf('|');if(-1===t)return null;const a=e.substring(0,t).trim();return this.KNOWN_FIELDS.includes(a)?a:null}static parseRecord(e){if(!e||'string'!=typeof e)return null;const t={_raw:e},a=e.split('\n');let n=null,o=[];const l=()=>{if(n&&o.length>0){const e=o.join('\n').trim();this.setFieldValue(t,n,e)}n=null,o=[]};for(const e of a){const t=e.trim(),a=this.isFieldLine(t);if(a){l(),n=a;const e=t.indexOf('|'),s=t.substring(e+1).trim();s&&o.push(s)}else n&&t&&o.push(t)}return l(),'number'!=typeof t.åºå·||isNaN(t.åºå·)?(console.warn('[HistoryRecordParser] è§£æå¤±è´¥ï¼šç¼ºå°‘æœ‰æ•ˆçš„åºå·å­—æ®µ'),null):{åºå·:t.åºå·,æ—¥æœŸ:t.æ—¥æœŸ||'',åœ°ç‚¹:t.åœ°ç‚¹||'',æè¿°:t.æè¿°||'',æ ‡ç­¾:t.æ ‡ç­¾||[],é‡è¦ä¿¡æ¯:t.é‡è¦ä¿¡æ¯||'',è‡ªåŠ¨åŒ–ç³»ç»Ÿ:t.è‡ªåŠ¨åŒ–ç³»ç»Ÿ||'',_raw:t._raw}}static setFieldValue(e,t,a){switch(t){case'åºå·':e.åºå·=parseInt(a,10);break;case'æ—¥æœŸ':e.æ—¥æœŸ=a;break;case'åœ°ç‚¹':e.åœ°ç‚¹=a;break;case'æè¿°':e.æè¿°=a;break;case'æ ‡ç­¾':e.æ ‡ç­¾=a.split('|').map(e=>e.trim()).filter(e=>e);break;case'é‡è¦ä¿¡æ¯':e.é‡è¦ä¿¡æ¯=a;break;case'è‡ªåŠ¨åŒ–ç³»ç»Ÿ':e.è‡ªåŠ¨åŒ–ç³»ç»Ÿ=a}}static parseRecords(e){if(!e||'string'!=typeof e)return[];const t=[],a=e.split(Ua).filter(e=>e.trim());for(const e of a){const a=this.parseRecord(e.trim());a&&t.push(a)}if(0===t.length){const a=/<å†å²è®°å½•>([\s\S]*?)<\/å†å²è®°å½•>/gi,n=[...e.matchAll(a)];for(const e of n){const a=this.parseRecord(e[1].trim());a&&t.push(a)}}return t.sort((e,t)=>e.åºå·-t.åºå·),t}static parseHistoryTexts(e){if(!e||'string'!=typeof e)return[];const t=[],a=e.split(Pa).filter(e=>e.trim());for(let e=0;e<a.length;e++){const n=a[e].trim().replace(/<!--[\s\S]*?-->/g,'').trim();n&&t.push({åºå·:e+1,å†…å®¹:n})}if(0===t.length){const a=/<gametxt>([\s\S]*?)<\/gametxt>/gi,n=[...e.matchAll(a)];for(let e=0;e<n.length;e++){const a=n[e][1].trim().replace(/<!--[\s\S]*?-->/g,'').trim();a&&t.push({åºå·:e+1,å†…å®¹:a})}}return t}static formatRecordFields(e,t){const a=[];for(const n of t){if('_raw'===n)continue;const t=e[n];null!=t&&''!==t&&('æ ‡ç­¾'===n&&Array.isArray(t)?t.length>0&&a.push(t.join('|')):'æ—¥æœŸ'===n||'æè¿°'===n?a.push(String(t)):'è‡ªåŠ¨åŒ–ç³»ç»Ÿ'===n?a.push(`è‡ªåŠ¨åŒ–ç³»ç»Ÿ|${t}`):a.push(String(t)))}return a.join(' ')}static formatSmallSummary(e){if(!e||0===e.length)return'';return e.map(e=>{const t=[];return e.æ—¥æœŸ&&t.push(e.æ—¥æœŸ),e.é‡è¦ä¿¡æ¯&&t.push(e.é‡è¦ä¿¡æ¯),e.è‡ªåŠ¨åŒ–ç³»ç»Ÿ&&t.push(`è‡ªåŠ¨åŒ–ç³»ç»Ÿ|${e.è‡ªåŠ¨åŒ–ç³»ç»Ÿ}`),t.join(' ')}).join(Ua)}static formatLargeSummary(e){if(!e||0===e.length)return'';return e.map(e=>{const t=[];return e.æ—¥æœŸ&&t.push(e.æ—¥æœŸ),e.æè¿°&&t.push(e.æè¿°),t.join(' ')}).join(Ua)}static formatSegmentedText(e){return e&&0!==e.length?e.map(e=>e.å†…å®¹).join(Pa):''}static serializeRecords(e){return e&&0!==e.length?e.map(e=>{const t=[];return t.push(`åºå·|${e.åºå·}`),e.æ—¥æœŸ&&t.push(`æ—¥æœŸ|${e.æ—¥æœŸ}`),e.åœ°ç‚¹&&t.push(`åœ°ç‚¹|${e.åœ°ç‚¹}`),e.æè¿°&&t.push(`æè¿°|${e.æè¿°}`),e.æ ‡ç­¾&&e.æ ‡ç­¾.length>0&&t.push(`æ ‡ç­¾|${e.æ ‡ç­¾.join('|')}`),e.é‡è¦ä¿¡æ¯&&t.push(`é‡è¦ä¿¡æ¯|${e.é‡è¦ä¿¡æ¯}`),e.è‡ªåŠ¨åŒ–ç³»ç»Ÿ&&t.push(`è‡ªåŠ¨åŒ–ç³»ç»Ÿ|${e.è‡ªåŠ¨åŒ–ç³»ç»Ÿ}`),t.join('\n')}).join(Ua):''}static serializeTexts(e){return e&&0!==e.length?e.map(e=>e.å†…å®¹).join(Pa):''}static getRecordCount(e){if(!e)return 0;const t=e.split(Ua).filter(e=>e.trim());if(t.length>0)return t.length;const a=e.match(/<å†å²è®°å½•>/gi);return a&&a.length>0?a.length:0}static getTextCount(e){if(!e)return 0;const t=e.split(Pa).filter(e=>e.trim());if(t.length>0)return t.length;const a=e.match(/<gametxt>/gi);return a&&a.length>0?a.length:0}static getLatestSequence(e){return e&&0!==e.length?Math.max(...e.map(e=>e.åºå·)):0}static appendRecord(e,t){return e&&e.trim()?`${e}${Ua}${t}`:t}static appendText(e,t){return e&&e.trim()?`${e}${Pa}${t}`:t}}const Fa=new class{lorebook='ã€MCæˆ¿å­ã€‘';initialized=!1;isAvailable(){return'function'==typeof getWorldbook&&'function'==typeof updateWorldbookWith}async initialize(e){try{if(e&&(this.lorebook=e),!this.isAvailable())return console.warn('[WorldbookService] ä¸–ç•Œä¹¦å…¨å±€APIä¸å¯ç”¨ï¼Œå¯èƒ½ä¸åœ¨é…’é¦†ç¯å¢ƒä¸­'),this.initialized=!0,!0;try{const e=await getWorldbook(this.lorebook);console.log(`[WorldbookService] ä¸–ç•Œä¹¦"${this.lorebook}"å·²å­˜åœ¨ï¼ŒåŒ…å«${e.length}ä¸ªæ¡ç›®`)}catch{console.log(`[WorldbookService] ä¸–ç•Œä¹¦"${this.lorebook}"ä¸å­˜åœ¨ï¼Œå°†åœ¨éœ€è¦æ—¶åˆ›å»º`)}return this.initialized=!0,console.log('[WorldbookService] åˆå§‹åŒ–å®Œæˆï¼Œä¸–ç•Œä¹¦:',this.lorebook),!0}catch(e){return console.error('[WorldbookService] åˆå§‹åŒ–å¤±è´¥:',e),!1}}async getEntry(e){try{if(!this.isAvailable())return console.warn('[WorldbookService] ä¸–ç•Œä¹¦APIä¸å¯ç”¨'),null;const t=await getWorldbook(this.lorebook);if(!t||!Array.isArray(t))return null;return t.find(t=>t.name===e)||null}catch(t){return console.error(`[WorldbookService] è·å–æ¡ç›®"${e}"å¤±è´¥:`,t),null}}async getEntryContent(e){const t=await this.getEntry(e);return t?.content||''}async setEntryContent(e,t){try{if(!this.isAvailable())return console.warn('[WorldbookService] ä¸–ç•Œä¹¦APIä¸å¯ç”¨'),!1;if(await this.getEntry(e))await updateWorldbookWith(this.lorebook,a=>a.map(a=>a.name===e?{...a,content:t}:a)),console.log(`[WorldbookService] æ›´æ–°æ¡ç›®"${e}"æˆåŠŸï¼Œå†…å®¹é•¿åº¦: ${t.length}`);else{const a=Oa[e]||{name:e,enabled:!0,depth:2,order:100,role:'system'};await this.createEntry(e,t,a),console.log(`[WorldbookService] åˆ›å»ºæ¡ç›®"${e}"æˆåŠŸï¼Œå†…å®¹é•¿åº¦: ${t.length}`)}return!0}catch(t){return console.error(`[WorldbookService] è®¾ç½®æ¡ç›®"${e}"å†…å®¹å¤±è´¥:`,t),!1}}async appendToEntry(e,t,a='\n'){try{const n=await this.getEntryContent(e),o=n?`${n}${a}${t}`:t;return await this.setEntryContent(e,o)}catch(t){return console.error(`[WorldbookService] è¿½åŠ å†…å®¹åˆ°"${e}"å¤±è´¥:`,t),!1}}async ensureWorldbookExists(){try{if(!this.isAvailable())return!1;try{return await getWorldbook(this.lorebook),!0}catch{return console.log(`[WorldbookService] æ‡’åˆ›å»ºä¸–ç•Œä¹¦"${this.lorebook}"`),await createWorldbook(this.lorebook,[]),!0}}catch(e){return console.error('[WorldbookService] ç¡®ä¿ä¸–ç•Œä¹¦å­˜åœ¨å¤±è´¥:',e),!1}}async createEntry(e,t,a){try{return this.isAvailable()?(await this.ensureWorldbookExists(),await createWorldbookEntries(this.lorebook,[{name:e,content:t,enabled:a.enabled,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:a.role,depth:a.depth,order:a.order},probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}}]),console.log(`[WorldbookService] åˆ›å»ºæ¡ç›®"${e}"æˆåŠŸ`),!0):(console.warn('[WorldbookService] ä¸–ç•Œä¹¦APIä¸å¯ç”¨'),!1)}catch(t){return console.error(`[WorldbookService] åˆ›å»ºæ¡ç›®"${e}"å¤±è´¥:`,t),!1}}async setEntryEnabled(e,t){try{if(!this.isAvailable())return!1;return await this.getEntry(e)?(await updateWorldbookWith(this.lorebook,a=>a.map(a=>a.name===e?{...a,enabled:t}:a)),console.log(`[WorldbookService] ${t?'å¯ç”¨':'ç¦ç”¨'}æ¡ç›®"${e}"`),!0):(console.warn(`[WorldbookService] æ¡ç›®"${e}"ä¸å­˜åœ¨`),!1)}catch(t){return console.error(`[WorldbookService] è®¾ç½®æ¡ç›®"${e}"å¯ç”¨çŠ¶æ€å¤±è´¥:`,t),!1}}async entryExists(e){return null!==await this.getEntry(e)}async ensureAllEntries(){try{const e=Object.values(La);for(const t of e){if(!await this.entryExists(t)){const e=Oa[t];e&&(await this.createEntry(t,'',e),console.log(`[WorldbookService] åˆ›å»ºç¼ºå¤±çš„æ¡ç›®: ${t}`))}}return!0}catch(e){return console.error('[WorldbookService] ç¡®ä¿æ¡ç›®å­˜åœ¨å¤±è´¥:',e),!1}}async switchToFullMode(){try{return await this.setEntryEnabled(La.HISTORY_TEXT,!0),await this.setEntryEnabled(La.HISTORY_RECORD,!0),await this.setEntryEnabled(La.SEGMENTED_TEXT,!1),await this.setEntryEnabled(La.SMALL_SUMMARY,!1),await this.setEntryEnabled(La.LARGE_SUMMARY,!1),console.log('[WorldbookService] å·²åˆ‡æ¢åˆ°å…¨é‡æ¨¡å¼'),!0}catch(e){return console.error('[WorldbookService] åˆ‡æ¢åˆ°å…¨é‡æ¨¡å¼å¤±è´¥:',e),!1}}async switchToSegmentedMode(){try{return await this.setEntryEnabled(La.HISTORY_TEXT,!1),await this.setEntryEnabled(La.HISTORY_RECORD,!1),await this.setEntryEnabled(La.SEGMENTED_TEXT,!0),await this.setEntryEnabled(La.SMALL_SUMMARY,!0),await this.setEntryEnabled(La.LARGE_SUMMARY,!0),console.log('[WorldbookService] å·²åˆ‡æ¢åˆ°åˆ†æ®µæ¨¡å¼'),!0}catch(e){return console.error('[WorldbookService] åˆ‡æ¢åˆ°åˆ†æ®µæ¨¡å¼å¤±è´¥:',e),!1}}async getContextSnapshot(){const e={};for(const t of Object.values(La))e[t]=await this.getEntryContent(t);return e}async restoreFromSnapshot(e){try{for(const[t,a]of Object.entries(e))await this.setEntryContent(t,a);return console.log('[WorldbookService] ä»å¿«ç…§æ¢å¤å®Œæˆ'),!0}catch(e){return console.error('[WorldbookService] ä»å¿«ç…§æ¢å¤å¤±è´¥:',e),!1}}async clearAllContextEntries(){try{for(const e of Object.values(La))await this.setEntryContent(e,'');return console.log('[WorldbookService] å·²æ¸…ç©ºæ‰€æœ‰ä¸Šä¸‹æ–‡æ¡ç›®'),!0}catch(e){return console.error('[WorldbookService] æ¸…ç©ºæ¡ç›®å¤±è´¥:',e),!1}}},ja={class:'history-text-panel'},Ha={class:'panel-header'},Wa={class:'header-left'},Ga={key:0,class:'text-count'},Ja={class:'header-actions'},Ya=['disabled'],Ka={class:'search-bar'},qa={key:0,class:'search-result-count'},Xa={class:'panel-body'},Qa={key:0,class:'state-container loading-state'},Za={class:'state-container error-state'},en={class:'state-text'},tn={class:'text-list'},an=['onClick'],nn={class:'text-meta'},on={class:'text-number'},ln={key:0,class:'text-preview'},sn={class:'expand-icon'},rn={key:0,class:'text-content'},cn=['innerHTML'],un={class:'content-actions'},dn=['onClick'],mn={key:0,class:'panel-footer'},vn={class:'footer-info'},gn={class:'info-text'},pn=(0,l.defineComponent)({__name:'HistoryTextPanel',emits:['close'],setup(e){const t=(0,l.ref)(!1),a=(0,l.ref)(null),n=(0,l.ref)([]),o=(0,l.ref)(''),s=(0,l.ref)(new Set),r=(0,l.computed)(()=>{if(!o.value.trim())return n.value;const e=o.value.toLowerCase();return n.value.filter(t=>t.å†…å®¹.toLowerCase().includes(e))}),c=async()=>{t.value=!0,a.value=null;try{await Fa.initialize();const e=await Fa.getEntryContent(La.HISTORY_TEXT);n.value=za.parseHistoryTexts(e),console.log('[HistoryTextPanel] å·²åŠ è½½',n.value.length,'æ¡å†å²æ­£æ–‡')}catch(e){console.error('[HistoryTextPanel] åŠ è½½å¤±è´¥:',e),a.value=e instanceof Error?e.message:'åŠ è½½å†å²æ­£æ–‡å¤±è´¥'}finally{t.value=!1}},i=()=>{},u=()=>{r.value.forEach(e=>{s.value.add(e.åºå·)})},d=()=>{s.value.clear()},m=e=>{const t=e.replace(/\n/g,' ').replace(/\s+/g,' ').trim();return t.length<=60?t:t.substring(0,60)+'...'};return(0,l.onMounted)(()=>{c()}),(e,v)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',ja,[(0,l.createCommentVNode)(' é¢æ¿å¤´éƒ¨ '),(0,l.createElementVNode)('div',Ha,[(0,l.createElementVNode)('div',Wa,[v[2]||(v[2]=(0,l.createElementVNode)('span',{class:'panel-icon'},'ğŸ“œ',-1)),v[3]||(v[3]=(0,l.createElementVNode)('h2',{class:'panel-title'},'å†å²æ­£æ–‡',-1)),n.value.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('span',Ga,' å…± '+(0,l.toDisplayString)(n.value.length)+' æ¡ ',1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',Ja,[(0,l.createElementVNode)('button',{class:'btn-refresh',onClick:c,disabled:t.value,title:'åˆ·æ–°'},'ğŸ”„',8,Ya),(0,l.createElementVNode)('button',{class:'btn-close',onClick:v[0]||(v[0]=t=>e.$emit('close'))},'âœ•')])]),(0,l.createCommentVNode)(' æœç´¢æ  '),(0,l.createElementVNode)('div',Ka,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':v[1]||(v[1]=e=>o.value=e),type:'text',class:'search-input',placeholder:'æœç´¢æ­£æ–‡å†…å®¹...',onInput:i},null,544),[[l.vModelText,o.value]]),o.value?((0,l.openBlock)(),(0,l.createElementBlock)('span',qa,' æ‰¾åˆ° '+(0,l.toDisplayString)(r.value.length)+' æ¡ ',1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' é¢æ¿ä¸»ä½“ '),(0,l.createElementVNode)('div',Xa,[(0,l.createCommentVNode)(' åŠ è½½çŠ¶æ€ '),t.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',Qa,[...v[4]||(v[4]=[(0,l.createElementVNode)('span',{class:'state-icon loading-spinner'},'â³',-1),(0,l.createElementVNode)('span',{class:'state-text'},'åŠ è½½ä¸­...',-1)])])):a.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' é”™è¯¯æç¤º '),(0,l.createElementVNode)('div',Za,[v[5]||(v[5]=(0,l.createElementVNode)('span',{class:'state-icon error-icon'},'âš ï¸',-1)),(0,l.createElementVNode)('span',en,(0,l.toDisplayString)(a.value),1),(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:c},'é‡æ–°åŠ è½½')])],2112)):0===n.value.length?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' ç©ºçŠ¶æ€ '),v[6]||(v[6]=(0,l.createElementVNode)('div',{class:'state-container empty-state'},[(0,l.createElementVNode)('span',{class:'state-icon'},'ğŸ“'),(0,l.createElementVNode)('span',{class:'state-text'},'æš‚æ— å†å²æ­£æ–‡'),(0,l.createElementVNode)('p',{class:'state-hint'},'å†å²æ­£æ–‡ä¼šåœ¨æ¸¸æˆè¿›è¡Œè¿‡ç¨‹ä¸­è‡ªåŠ¨è®°å½•')],-1))],2112)):0===r.value.length?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:3},[(0,l.createCommentVNode)(' æœç´¢æ— ç»“æœ '),v[7]||(v[7]=(0,l.createElementVNode)('div',{class:'state-container empty-state'},[(0,l.createElementVNode)('span',{class:'state-icon'},'ğŸ”'),(0,l.createElementVNode)('span',{class:'state-text'},'æœªæ‰¾åˆ°åŒ¹é…å†…å®¹'),(0,l.createElementVNode)('p',{class:'state-hint'},'å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯æœç´¢')],-1))],2112)):((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:4},[(0,l.createCommentVNode)(' å†å²æ­£æ–‡åˆ—è¡¨ '),(0,l.createElementVNode)('div',tn,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(r.value,(e,t)=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.åºå·,class:(0,l.normalizeClass)(['text-item',{'is-expanded':s.value.has(e.åºå·)}])},[(0,l.createCommentVNode)(' æ¡ç›®å¤´éƒ¨ '),(0,l.createElementVNode)('div',{class:'text-header',onClick:t=>{return a=e.åºå·,void(s.value.has(a)?s.value.delete(a):s.value.add(a));var a}},[(0,l.createElementVNode)('div',nn,[(0,l.createElementVNode)('span',on,'#'+(0,l.toDisplayString)(e.åºå·),1),s.value.has(e.åºå·)?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('span',ln,(0,l.toDisplayString)(m(e.å†…å®¹)),1))]),(0,l.createElementVNode)('span',sn,(0,l.toDisplayString)(s.value.has(e.åºå·)?'â–¼':'â–¶'),1)],8,an),(0,l.createCommentVNode)(' æ¡ç›®å†…å®¹ï¼ˆå±•å¼€æ—¶æ˜¾ç¤ºï¼‰ '),s.value.has(e.åºå·)?((0,l.openBlock)(),(0,l.createElementBlock)('div',rn,[(0,l.createElementVNode)('div',{class:'content-body',innerHTML:(a=e.å†…å®¹,a.replace(/\n/g,'<br>'))},null,8,cn),(0,l.createElementVNode)('div',un,[(0,l.createElementVNode)('button',{class:'btn-action',onClick:t=>(async e=>{try{await navigator.clipboard.writeText(e),'undefined'!=typeof toastr&&toastr.success('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')}catch(e){console.error('[HistoryTextPanel] å¤åˆ¶å¤±è´¥:',e),'undefined'!=typeof toastr&&toastr.error('å¤åˆ¶å¤±è´¥')}})(e.å†…å®¹),title:'å¤åˆ¶å†…å®¹'},'ğŸ“‹ å¤åˆ¶',8,dn)])])):(0,l.createCommentVNode)('v-if',!0)],2);var a}),128))])],2112))]),(0,l.createCommentVNode)(' åº•éƒ¨å·¥å…·æ  '),n.value.length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',mn,[(0,l.createElementVNode)('div',vn,[(0,l.createElementVNode)('span',gn,' æ˜¾ç¤º '+(0,l.toDisplayString)(r.value.length)+' / '+(0,l.toDisplayString)(n.value.length)+' æ¡ ',1)]),(0,l.createElementVNode)('div',{class:'footer-actions'},[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:u},'å…¨éƒ¨å±•å¼€'),(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:d},'å…¨éƒ¨æ”¶èµ·')])])):(0,l.createCommentVNode)('v-if',!0)]))}}),fn=(0,E.A)(pn,[['__scopeId','data-v-9256f22a']]);const yn=new class{state;initialized=!1;enabled=!1;constructor(){this.state={mode:'segmented',config:{...$a},historyRecords:[],historyTexts:[],segmentedContent:null,isProcessing:!1,lastUpdateTime:0,error:null}}isEnabled(){return this.enabled}enable(){this.enabled=!0,console.log('[ContextManager] ä¸Šä¸‹æ–‡ç®¡ç†åŠŸèƒ½å·²å¯ç”¨')}disable(){this.enabled=!1,console.log('[ContextManager] ä¸Šä¸‹æ–‡ç®¡ç†åŠŸèƒ½å·²ç¦ç”¨ï¼ˆå°†ä½¿ç”¨å¤–æŒ‚ä¸–ç•Œä¹¦ï¼‰')}setEnabled(e){this.enabled=e,console.log('[ContextManager] ä¸Šä¸‹æ–‡ç®¡ç†åŠŸèƒ½å·²'+(e?'å¯ç”¨':'ç¦ç”¨'))}async initialize(){try{return console.log('[ContextManager] æ­£åœ¨åˆå§‹åŒ–...'),this.enabled?(await Fa.initialize(),await this.loadFromWorldbook(),this.initialized=!0,console.log('[ContextManager] åˆå§‹åŒ–å®Œæˆ'),!0):(console.log('[ContextManager] ä¸Šä¸‹æ–‡ç®¡ç†åŠŸèƒ½å·²ç¦ç”¨ï¼Œè·³è¿‡åˆå§‹åŒ–ä¸–ç•Œä¹¦æœåŠ¡'),this.initialized=!0,!0)}catch(e){return console.error('[ContextManager] åˆå§‹åŒ–å¤±è´¥:',e),this.state.error=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥',!1}}async loadFromWorldbook(){if(this.enabled)try{const e=await Fa.getEntryContent(La.HISTORY_RECORD);this.state.historyRecords=za.parseRecords(e);const t=await Fa.getEntryContent(La.HISTORY_TEXT);this.state.historyTexts=za.parseHistoryTexts(t),console.log(`[ContextManager] å·²åŠ è½½ ${this.state.historyRecords.length} æ¡å†å²è®°å½•ï¼Œ${this.state.historyTexts.length} æ¡å†å²æ­£æ–‡`)}catch(e){console.error('[ContextManager] ä»ä¸–ç•Œä¹¦åŠ è½½æ•°æ®å¤±è´¥:',e)}else console.log('[ContextManager] åŠŸèƒ½å·²ç¦ç”¨ï¼Œè·³è¿‡ä»ä¸–ç•Œä¹¦åŠ è½½æ•°æ®')}getState(){return this.state}getConfig(){return{...this.state.config}}async setConfig(e){this.state.config={...this.state.config,...e},await this.regenerateSegments()}async setSegmentCount(e){await this.setConfig({segmentCount:Math.max(0,e)})}async setSmallSummaryCount(e){await this.setConfig({smallSummaryCount:Math.max(0,e)})}getMode(){return this.state.mode}async switchMode(e){e!==this.state.mode&&(this.state.mode=e,'full'===e?await Fa.switchToFullMode():(await Fa.switchToSegmentedMode(),await this.regenerateSegments()),console.log(`[ContextManager] å·²åˆ‡æ¢åˆ°${'full'===e?'å…¨é‡':'åˆ†æ®µ'}æ¨¡å¼`))}calculateRanges(e,t,a){const n={totalCount:e,segmentRange:null,smallSummaryRange:null,largeSummaryRange:null};if(0===e)return n;if(t>0&&e>0){const a=Math.max(1,e-t+1),o=e;n.segmentRange=[a,o]}const o=t>0?Math.max(0,e-t):e;if(a>0&&o>0){const e=Math.max(1,o-a+1);n.smallSummaryRange=[e,o]}const l=a>0&&n.smallSummaryRange?n.smallSummaryRange[0]-1:t>0&&n.segmentRange?n.segmentRange[0]-1:e;return l>=1&&(n.largeSummaryRange=[1,l]),n}generateSegmentedContent(){const{historyRecords:e,historyTexts:t,config:a}=this.state,{segmentCount:n,smallSummaryCount:o}=a,l=e.length,s=this.calculateRanges(l,n,o);let r='';if(s.segmentRange&&t.length>0){const[e,a]=s.segmentRange,n=t.slice(e-1,a);r=za.formatSegmentedText(n)}let c='';if(s.smallSummaryRange){const[t,a]=s.smallSummaryRange,n=e.slice(t-1,a);c=za.formatSmallSummary(n)}let i='';if(s.largeSummaryRange){const[t,a]=s.largeSummaryRange,n=e.slice(t-1,a);i=za.formatLargeSummary(n)}return{segmentedText:r,smallSummary:c,largeSummary:i,ranges:s}}async regenerateSegments(){if(!this.enabled)return console.log('[ContextManager] åŠŸèƒ½å·²ç¦ç”¨ï¼Œè·³è¿‡åˆ†æ®µç”Ÿæˆ'),!0;try{this.state.isProcessing=!0,this.state.error=null;if(!(this.state.historyRecords.length>0||this.state.historyTexts.length>0))return console.log('[ContextManager] æ²¡æœ‰å†å²æ•°æ®ï¼Œè·³è¿‡åˆ†æ®µç”Ÿæˆï¼ˆé¿å…è¦†ç›–ç°æœ‰ä¸–ç•Œä¹¦å†…å®¹ï¼‰'),!0;const e=this.generateSegmentedContent();return this.state.segmentedContent=e,e.segmentedText&&await Fa.setEntryContent(La.SEGMENTED_TEXT,e.segmentedText),e.smallSummary&&await Fa.setEntryContent(La.SMALL_SUMMARY,e.smallSummary),e.largeSummary&&await Fa.setEntryContent(La.LARGE_SUMMARY,e.largeSummary),this.state.lastUpdateTime=Date.now(),console.log('[ContextManager] åˆ†æ®µå†…å®¹å·²æ›´æ–°',{åˆ†æ®µæ­£æ–‡æ¡æ•°:e.ranges.segmentRange?e.ranges.segmentRange[1]-e.ranges.segmentRange[0]+1:0,å°æ€»ç»“æ¡æ•°:e.ranges.smallSummaryRange?e.ranges.smallSummaryRange[1]-e.ranges.smallSummaryRange[0]+1:0,å¤§æ€»ç»“æ¡æ•°:e.ranges.largeSummaryRange?e.ranges.largeSummaryRange[1]-e.ranges.largeSummaryRange[0]+1:0}),!0}catch(e){return console.error('[ContextManager] é‡æ–°ç”Ÿæˆåˆ†æ®µå¤±è´¥:',e),this.state.error=e instanceof Error?e.message:'ç”Ÿæˆåˆ†æ®µå¤±è´¥',!1}finally{this.state.isProcessing=!1}}async processAIResponse(e){if(!this.enabled)return console.log('[ContextManager] åŠŸèƒ½å·²ç¦ç”¨ï¼Œè·³è¿‡å¤„ç†AIå›å¤'),!1;try{this.state.isProcessing=!0,this.state.error=null;let t=!1;const a=za.extractGameTextTag(e);if(a){const e=await Fa.getEntryContent(La.HISTORY_TEXT),n=za.appendText(e,a);await Fa.setEntryContent(La.HISTORY_TEXT,n);const o=this.state.historyTexts.length+1;this.state.historyTexts.push({åºå·:o,å†…å®¹:a}),t=!0,console.log('[ContextManager] å·²è¿½åŠ å†å²æ­£æ–‡ï¼Œå½“å‰å…±',this.state.historyTexts.length,'æ¡')}const n=za.extractHistoryRecordTag(e);if(n){const e=za.parseRecord(n);if(e){const a=await Fa.getEntryContent(La.HISTORY_RECORD),o=za.appendRecord(a,n);await Fa.setEntryContent(La.HISTORY_RECORD,o),this.state.historyRecords.push(e),t=!0,console.log('[ContextManager] å·²è¿½åŠ å†å²è®°å½•ï¼Œå½“å‰å…±',this.state.historyRecords.length,'æ¡')}}return t&&'segmented'===this.state.mode&&await this.regenerateSegments(),this.state.lastUpdateTime=Date.now(),t}catch(e){return console.error('[ContextManager] å¤„ç†AIå›å¤å¤±è´¥:',e),this.state.error=e instanceof Error?e.message:'å¤„ç†AIå›å¤å¤±è´¥',!1}finally{this.state.isProcessing=!1}}getRecordCount(){return this.state.historyRecords.length}getTextCount(){return this.state.historyTexts.length}getLatestRecords(e){return this.state.historyRecords.slice(-e)}getLatestTexts(e){return this.state.historyTexts.slice(-e)}async clearAll(e=!1){if(!this.enabled&&!e)return console.log('[ContextManager] åŠŸèƒ½å·²ç¦ç”¨ï¼Œåªæ¸…ç©ºæœ¬åœ°çŠ¶æ€'),this.state.historyRecords=[],this.state.historyTexts=[],this.state.segmentedContent=null,this.state.lastUpdateTime=Date.now(),!0;try{return this.state.isProcessing=!0,(this.enabled||e)&&(Fa.isAvailable()?(await Fa.clearAllContextEntries(),console.log('[ContextManager] å·²æ¸…ç©ºä¸–ç•Œä¹¦æ¡ç›®')):console.warn('[ContextManager] ä¸–ç•Œä¹¦æœåŠ¡ä¸å¯ç”¨ï¼Œè·³è¿‡æ¸…ç©ºä¸–ç•Œä¹¦æ¡ç›®')),this.state.historyRecords=[],this.state.historyTexts=[],this.state.segmentedContent=null,this.state.lastUpdateTime=Date.now(),console.log('[ContextManager] å·²æ¸…ç©ºæ‰€æœ‰å†å²æ•°æ®'),!0}catch(e){return console.error('[ContextManager] æ¸…ç©ºæ•°æ®å¤±è´¥:',e),this.state.error=e instanceof Error?e.message:'æ¸…ç©ºæ•°æ®å¤±è´¥',!1}finally{this.state.isProcessing=!1}}async getSaveData(){const e=await Fa.getContextSnapshot();return{config:{...this.state.config},worldbookSnapshots:e,timestamp:Date.now()}}async restoreFromSaveData(e){try{return this.state.isProcessing=!0,this.state.config={...e.config},await Fa.restoreFromSnapshot(e.worldbookSnapshots),await this.loadFromWorldbook(),'segmented'===this.state.mode&&await this.regenerateSegments(),this.state.lastUpdateTime=Date.now(),console.log('[ContextManager] å·²ä»å­˜æ¡£æ¢å¤'),!0}catch(e){return console.error('[ContextManager] ä»å­˜æ¡£æ¢å¤å¤±è´¥:',e),this.state.error=e instanceof Error?e.message:'æ¢å¤å¤±è´¥',!1}finally{this.state.isProcessing=!1}}getStatistics(){const e=this.state.segmentedContent?.ranges||this.calculateRanges(this.state.historyRecords.length,this.state.config.segmentCount,this.state.config.smallSummaryCount);return{recordCount:this.state.historyRecords.length,textCount:this.state.historyTexts.length,segmentCount:e.segmentRange?e.segmentRange[1]-e.segmentRange[0]+1:0,smallSummaryCount:e.smallSummaryRange?e.smallSummaryRange[1]-e.smallSummaryRange[0]+1:0,largeSummaryCount:e.largeSummaryRange?e.largeSummaryRange[1]-e.largeSummaryRange[0]+1:0,mode:this.state.mode}}},hn={enabled:!0,saveOnAIResponse:!0,maxAutoSaves:10,autoSavePrefix:'[è‡ªåŠ¨]',debounceMs:1e3},Sn='saves',En='config',Vn='1.0.0',bn='mc_house_auto_save_config';const Nn=new class{db=null;initialized=!1;autoSaveConfig={...hn};autoSaveDebounceTimer=null;lastAutoSaveTime=0;onAutoSaveCallbacks=[];onLoadCompleteCallbacks=[];async initialize(){return!(!this.initialized||!this.db)||(this.loadAutoSaveConfig(),new Promise((e,t)=>{const a=indexedDB.open('MC_House_SaveDB',2);a.onerror=()=>{console.error('[SaveService] æ‰“å¼€æ•°æ®åº“å¤±è´¥:',a.error),t(a.error)},a.onsuccess=()=>{this.db=a.result,this.initialized=!0,console.log('[SaveService] æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ'),e(!0)},a.onupgradeneeded=e=>{const t=e.target.result,a=e.oldVersion;if(t.objectStoreNames.contains(Sn)){if(a<2){const t=e.target.transaction;if(t){const e=t.objectStore(Sn);e.indexNames.contains('isAutoSave')||e.createIndex('isAutoSave','isAutoSave',{unique:!1}),e.indexNames.contains('saveSource')||e.createIndex('saveSource','saveSource',{unique:!1})}}}else{const e=t.createObjectStore(Sn,{keyPath:'id'});e.createIndex('name','name',{unique:!1}),e.createIndex('createdAt','createdAt',{unique:!1}),e.createIndex('updatedAt','updatedAt',{unique:!1}),e.createIndex('isAutoSave','isAutoSave',{unique:!1}),e.createIndex('saveSource','saveSource',{unique:!1})}t.objectStoreNames.contains(En)||t.createObjectStore(En,{keyPath:'key'})}}))}generateId(e='save'){return`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}loadAutoSaveConfig(){try{const e=localStorage.getItem(bn);if(e){const t=JSON.parse(e);this.autoSaveConfig={...hn,...t}}}catch(e){console.warn('[SaveService] åŠ è½½è‡ªåŠ¨å­˜æ¡£é…ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:',e),this.autoSaveConfig={...hn}}}saveAutoSaveConfigToStorage(){try{localStorage.setItem(bn,JSON.stringify(this.autoSaveConfig))}catch(e){console.error('[SaveService] ä¿å­˜è‡ªåŠ¨å­˜æ¡£é…ç½®å¤±è´¥:',e)}}getAutoSaveConfig(){return{...this.autoSaveConfig}}updateAutoSaveConfig(e){this.autoSaveConfig={...this.autoSaveConfig,...e},this.saveAutoSaveConfigToStorage(),console.log('[SaveService] è‡ªåŠ¨å­˜æ¡£é…ç½®å·²æ›´æ–°:',this.autoSaveConfig)}resetAutoSaveConfig(){this.autoSaveConfig={...hn},this.saveAutoSaveConfigToStorage()}onAutoSave(e){return this.onAutoSaveCallbacks.push(e),()=>{const t=this.onAutoSaveCallbacks.indexOf(e);t>-1&&this.onAutoSaveCallbacks.splice(t,1)}}emitAutoSaveEvent(e,t){this.onAutoSaveCallbacks.forEach(a=>{try{a(e,t)}catch(e){console.error('[SaveService] è‡ªåŠ¨å­˜æ¡£å›è°ƒæ‰§è¡Œå¤±è´¥:',e)}})}onLoadComplete(e){return this.onLoadCompleteCallbacks.push(e),()=>{const t=this.onLoadCompleteCallbacks.indexOf(e);t>-1&&this.onLoadCompleteCallbacks.splice(t,1)}}emitLoadCompleteEvent(e){console.log('[SaveService] è§¦å‘å­˜æ¡£åŠ è½½å®Œæˆäº‹ä»¶ï¼Œé€šçŸ¥',this.onLoadCompleteCallbacks.length,'ä¸ªå›è°ƒ'),this.onLoadCompleteCallbacks.forEach(t=>{try{t(e)}catch(e){console.error('[SaveService] å­˜æ¡£åŠ è½½å®Œæˆå›è°ƒæ‰§è¡Œå¤±è´¥:',e)}})}getMvuData(){try{return'undefined'!=typeof window&&window.Mvu&&window.Mvu.getMvuData({type:'message',message_id:'latest'})||null}catch(e){return console.error('[SaveService] è·å–MVUæ•°æ®å¤±è´¥:',e),null}}async restoreMvuData(e){try{return!('undefined'==typeof window||!window.Mvu)&&(await window.Mvu.replaceMvuData(e,{type:'message',message_id:'latest'}),!0)}catch(e){return console.error('[SaveService] æ¢å¤MVUæ•°æ®å¤±è´¥:',e),!1}}aiContentDataProvider=null;aiContentDataRestorer=null;setAIContentDataProvider(e){this.aiContentDataProvider=e,console.log('[SaveService] AIå†…å®¹æ•°æ®æä¾›è€…å·²æ³¨å†Œ')}setAIContentDataRestorer(e){this.aiContentDataRestorer=e,console.log('[SaveService] AIå†…å®¹æ•°æ®æ¢å¤è€…å·²æ³¨å†Œ')}getAIContentData(){if(this.aiContentDataProvider)try{return this.aiContentDataProvider()}catch(e){console.error('[SaveService] è·å–AIå†…å®¹æ•°æ®å¤±è´¥:',e)}return null}async restoreAIContentData(e){if(this.aiContentDataRestorer&&e)try{return this.aiContentDataRestorer(e),await new Promise(e=>setTimeout(e,10)),console.log('[SaveService] AIå†…å®¹æ•°æ®å·²æ¢å¤'),!0}catch(e){console.error('[SaveService] æ¢å¤AIå†…å®¹æ•°æ®å¤±è´¥:',e)}return!1}async createSave(e,t){try{await this.initialize();const a=this.getMvuData(),n=await yn.getSaveData(),o=this.getAIContentData(),l={id:this.generateId(),name:e,createdAt:Date.now(),updatedAt:Date.now(),mvuData:a,contextData:n,aiContentData:o||void 0,version:Vn,customData:t};return await this.putSave(l),console.log('[SaveService] å­˜æ¡£åˆ›å»ºæˆåŠŸ:',l.id,o?'(å«AIå†…å®¹)':''),l}catch(e){return console.error('[SaveService] åˆ›å»ºå­˜æ¡£å¤±è´¥:',e),null}}async updateSave(e,t){try{await this.initialize();const a=await this.getSave(e);if(!a)return console.warn('[SaveService] å­˜æ¡£ä¸å­˜åœ¨:',e),!1;const n=this.getMvuData(),o=await yn.getSaveData(),l=this.getAIContentData(),s={...a,updatedAt:Date.now(),mvuData:n,contextData:o,aiContentData:l||a.aiContentData,customData:t||a.customData};return await this.putSave(s),console.log('[SaveService] å­˜æ¡£æ›´æ–°æˆåŠŸ:',e),!0}catch(e){return console.error('[SaveService] æ›´æ–°å­˜æ¡£å¤±è´¥:',e),!1}}async autoSaveOnAIResponse(e){if(!this.autoSaveConfig.enabled||!this.autoSaveConfig.saveOnAIResponse)return console.log('[SaveService] è‡ªåŠ¨å­˜æ¡£æœªå¯ç”¨'),null;const t=Date.now();if(t-this.lastAutoSaveTime<this.autoSaveConfig.debounceMs)return console.log('[SaveService] è‡ªåŠ¨å­˜æ¡£é˜²æŠ–ä¸­ï¼Œè·³è¿‡'),null;this.lastAutoSaveTime=t;try{console.log('[SaveService] å¼€å§‹AIå›å¤åè‡ªåŠ¨å­˜æ¡£...');const t=(new Date).toLocaleString('zh-CN',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}),a=`${this.autoSaveConfig.autoSavePrefix} ${t}`,n=await this.createAutoSave(a,'ai_response',e);return n&&(await this.cleanupAutoSaves(),this.emitAutoSaveEvent(n)),n}catch(e){const t=e instanceof Error?e.message:'è‡ªåŠ¨å­˜æ¡£å¤±è´¥';return console.error('[SaveService] AIå›å¤åè‡ªåŠ¨å­˜æ¡£å¤±è´¥:',e),this.emitAutoSaveEvent(null,t),null}}async createAutoSave(e,t='auto',a){try{await this.initialize();const n=this.getMvuData(),o=await yn.getSaveData(),l=this.getAIContentData(),s={id:this.generateId('auto'),name:e,createdAt:Date.now(),updatedAt:Date.now(),mvuData:n,contextData:o,aiContentData:l||void 0,version:Vn,isAutoSave:!0,saveSource:t,messageId:a};return await this.putSave(s),console.log('[SaveService] è‡ªåŠ¨å­˜æ¡£åˆ›å»ºæˆåŠŸ:',s.id,l?'(å«AIå†…å®¹)':''),s}catch(e){return console.error('[SaveService] åˆ›å»ºè‡ªåŠ¨å­˜æ¡£å¤±è´¥:',e),null}}async cleanupAutoSaves(){try{const e=await this.listAutoSaves();if(e.length<=this.autoSaveConfig.maxAutoSaves)return;const t=e.sort((e,t)=>t.updatedAt-e.updatedAt).slice(this.autoSaveConfig.maxAutoSaves);for(const e of t)await this.deleteSave(e.id),console.log('[SaveService] æ¸…ç†æ—§çš„è‡ªåŠ¨å­˜æ¡£:',e.id);console.log('[SaveService] è‡ªåŠ¨å­˜æ¡£æ¸…ç†å®Œæˆï¼Œåˆ é™¤äº†',t.length,'ä¸ªæ—§å­˜æ¡£')}catch(e){console.error('[SaveService] æ¸…ç†è‡ªåŠ¨å­˜æ¡£å¤±è´¥:',e)}}async listAutoSaves(){return(await this.listSaves()).filter(e=>!0===e.isAutoSave)}async listManualSaves(){return(await this.listSaves()).filter(e=>!0!==e.isAutoSave)}debouncedAutoSave(e){this.autoSaveDebounceTimer&&clearTimeout(this.autoSaveDebounceTimer),this.autoSaveDebounceTimer=setTimeout(async()=>{await this.autoSaveOnAIResponse(e)},this.autoSaveConfig.debounceMs)}cancelDebouncedAutoSave(){this.autoSaveDebounceTimer&&(clearTimeout(this.autoSaveDebounceTimer),this.autoSaveDebounceTimer=null)}async loadSave(e){try{await this.initialize();const t=await this.getSave(e);if(!t)return console.warn('[SaveService] å­˜æ¡£ä¸å­˜åœ¨:',e),!1;console.log('[SaveService] å¼€å§‹åŠ è½½å­˜æ¡£:',e);const a={mvu:!1,context:!1,aiContent:!1};if(t.mvuData)try{a.mvu=await this.restoreMvuData(t.mvuData),a.mvu?console.log('[SaveService] MVUæ•°æ®æ¢å¤æˆåŠŸï¼Œstat_dataé”®:',Object.keys(t.mvuData.stat_data||{})):console.warn('[SaveService] MVUæ•°æ®æ¢å¤å¤±è´¥')}catch(e){console.error('[SaveService] MVUæ•°æ®æ¢å¤å¼‚å¸¸:',e)}else a.mvu=!0;if(t.contextData)try{await yn.restoreFromSaveData(t.contextData),a.context=!0,console.log('[SaveService] ä¸Šä¸‹æ–‡ç®¡ç†æ•°æ®æ¢å¤æˆåŠŸ')}catch(e){console.error('[SaveService] ä¸Šä¸‹æ–‡ç®¡ç†æ•°æ®æ¢å¤å¼‚å¸¸:',e)}else a.context=!0;if(t.aiContentData)try{a.aiContent=await this.restoreAIContentData(t.aiContentData),console.log('[SaveService] AIå†…å®¹æ•°æ®æ¢å¤æˆåŠŸ')}catch(e){console.error('[SaveService] AIå†…å®¹æ•°æ®æ¢å¤å¼‚å¸¸:',e)}else a.aiContent=!0;await new Promise(e=>setTimeout(e,50));const n=a.mvu&&a.context&&a.aiContent;return console.log('[SaveService] å­˜æ¡£åŠ è½½å®Œæˆ:',{id:e,mvu:a.mvu?'æˆåŠŸ':'å¤±è´¥',context:a.context?'æˆåŠŸ':'å¤±è´¥',aiContent:a.aiContent?'æˆåŠŸ':'å¤±è´¥',overall:n?'å…¨éƒ¨æˆåŠŸ':'éƒ¨åˆ†å¤±è´¥'}),this.emitLoadCompleteEvent(t),n||'undefined'==typeof toastr||toastr.warning('éƒ¨åˆ†æ•°æ®æ¢å¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°','å­˜æ¡£åŠ è½½è­¦å‘Š',{timeOut:3e3}),n}catch(e){return console.error('[SaveService] åŠ è½½å­˜æ¡£å¤±è´¥:',e),!1}}async getSave(e){return this.db||await this.initialize(),this.db?new Promise((t,a)=>{const n=this.db.transaction([Sn],'readonly').objectStore(Sn).get(e);n.onerror=()=>a(n.error),n.onsuccess=()=>t(n.result||null)}):null}async putSave(e){if(this.db||await this.initialize(),!this.db)throw new Error('æ•°æ®åº“æœªåˆå§‹åŒ–');return new Promise((t,a)=>{const n=this.db.transaction([Sn],'readwrite').objectStore(Sn).put(e);n.onerror=()=>a(n.error),n.onsuccess=()=>t()})}async deleteSave(e){return this.db||await this.initialize(),!!this.db&&new Promise((t,a)=>{const n=this.db.transaction([Sn],'readwrite').objectStore(Sn).delete(e);n.onerror=()=>a(n.error),n.onsuccess=()=>{console.log('[SaveService] å­˜æ¡£åˆ é™¤æˆåŠŸ:',e),t(!0)}})}async listSaves(){return this.db||await this.initialize(),this.db?new Promise((e,t)=>{const a=this.db.transaction([Sn],'readonly').objectStore(Sn).getAll();a.onerror=()=>t(a.error),a.onsuccess=()=>{const t=a.result.map(e=>({id:e.id,name:e.name,createdAt:e.createdAt,updatedAt:e.updatedAt,version:e.version,isAutoSave:e.isAutoSave,saveSource:e.saveSource})).sort((e,t)=>t.updatedAt-e.updatedAt);e(t)}}):[]}async getSaveStats(){const e=await this.listSaves(),t=e.filter(e=>!e.isAutoSave),a=e.filter(e=>e.isAutoSave);return{total:e.length,manual:t.length,auto:a.length,oldestSave:e.length>0?e[e.length-1]:null,newestSave:e.length>0?e[0]:null}}async exportSave(e){try{const t=await this.getSave(e);return t?JSON.stringify(t,null,2):null}catch(e){return console.error('[SaveService] å¯¼å‡ºå­˜æ¡£å¤±è´¥:',e),null}}async importSave(e,t){try{await this.initialize();const a=JSON.parse(e);return a.id=this.generateId(),t&&(a.name=t),a.updatedAt=Date.now(),await this.putSave(a),console.log('[SaveService] å­˜æ¡£å¯¼å…¥æˆåŠŸ:',a.id),a}catch(e){return console.error('[SaveService] å¯¼å…¥å­˜æ¡£å¤±è´¥:',e),null}}async quickSave(){try{const e=await this.listSaves();if(e.length>0)return await this.updateSave(e[0].id);return null!==await this.createSave('å¿«é€Ÿå­˜æ¡£')}catch(e){return console.error('[SaveService] å¿«é€Ÿä¿å­˜å¤±è´¥:',e),!1}}async quickLoad(){try{const e=await this.listSaves();return 0===e.length?(console.warn('[SaveService] æ²¡æœ‰å¯åŠ è½½çš„å­˜æ¡£'),!1):await this.loadSave(e[0].id)}catch(e){return console.error('[SaveService] å¿«é€ŸåŠ è½½å¤±è´¥:',e),!1}}};function wn(){const e=(0,l.ref)(!1),t=(0,l.ref)(!1),a=(0,l.ref)(null),n=(0,l.ref)([]),o=(0,l.ref)(null),s=(0,l.ref)(Nn.getAutoSaveConfig()),r=(0,l.ref)({total:0,manual:0,auto:0,oldestSave:null,newestSave:null}),c=(0,l.ref)(null);let i=null,u=null;const d=(0,l.computed)(()=>n.value.filter(e=>!e.isAutoSave)),m=(0,l.computed)(()=>n.value.filter(e=>!0===e.isAutoSave)),v=(0,l.computed)(()=>n.value.length>0),g=(0,l.computed)(()=>s.value.enabled),p=async()=>{try{return t.value=!0,a.value=null,await Nn.initialize(),await f(),await y(),s.value=Nn.getAutoSaveConfig(),i=Nn.onAutoSave((e,t)=>{e?(c.value={id:e.id,name:e.name,createdAt:e.createdAt,updatedAt:e.updatedAt,version:e.version,isAutoSave:e.isAutoSave,saveSource:e.saveSource},f(),y(),console.log('[useSave] è‡ªåŠ¨å­˜æ¡£å®Œæˆ:',e.name)):t&&console.error('[useSave] è‡ªåŠ¨å­˜æ¡£å¤±è´¥:',t)}),u=Nn.onLoadComplete(async e=>{console.log('[useSave] å­˜æ¡£åŠ è½½å®Œæˆï¼Œé€šçŸ¥ mvuStore åˆ·æ–°æ•°æ®...');try{const e=Ie();await e.loadMvuData(),console.log('[useSave] mvuStore æ•°æ®å·²åˆ·æ–°ï¼Œstat_data é”®:',Object.keys(e.statData||{}))}catch(e){console.error('[useSave] åˆ·æ–° mvuStore æ•°æ®å¤±è´¥:',e)}}),e.value=!0,!0}catch(e){return a.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥',!1}finally{t.value=!1}},f=async()=>{try{n.value=await Nn.listSaves()}catch(e){console.error('[useSave] åˆ·æ–°åˆ—è¡¨å¤±è´¥:',e)}},y=async()=>{try{r.value=await Nn.getSaveStats()}catch(e){console.error('[useSave] åˆ·æ–°ç»Ÿè®¡å¤±è´¥:',e)}},h=async e=>{try{return t.value=!0,a.value=null,await Nn.exportSave(e)}catch(e){return a.value=e instanceof Error?e.message:'å¯¼å‡ºå­˜æ¡£å¤±è´¥',null}finally{t.value=!1}},S=async(e,n)=>{try{t.value=!0,a.value=null;const o=await Nn.importSave(e,n);return o&&await f(),o}catch(e){return a.value=e instanceof Error?e.message:'å¯¼å…¥å­˜æ¡£å¤±è´¥',null}finally{t.value=!1}},E=e=>{Nn.updateAutoSaveConfig(e),s.value=Nn.getAutoSaveConfig()};return(0,l.onMounted)(()=>{p()}),(0,l.onUnmounted)(()=>{i&&(i(),i=null),u&&(u(),u=null)}),{isInitialized:e,isProcessing:t,error:a,saveList:n,currentSave:o,autoSaveConfig:s,saveStats:r,lastAutoSave:c,manualSaveList:d,autoSaveList:m,hasSaves:v,isAutoSaveEnabled:g,initialize:p,refreshList:f,refreshStats:y,createSave:async(e,n)=>{try{t.value=!0,a.value=null;const l=await Nn.createSave(e,n);return l&&(await f(),o.value={id:l.id,name:l.name,createdAt:l.createdAt,updatedAt:l.updatedAt,version:l.version}),l}catch(e){return a.value=e instanceof Error?e.message:'åˆ›å»ºå­˜æ¡£å¤±è´¥',null}finally{t.value=!1}},updateSave:async(e,n)=>{try{t.value=!0,a.value=null;const o=await Nn.updateSave(e,n);return o&&await f(),o}catch(e){return a.value=e instanceof Error?e.message:'æ›´æ–°å­˜æ¡£å¤±è´¥',!1}finally{t.value=!1}},loadSave:async e=>{try{t.value=!0,a.value=null;const l=await Nn.loadSave(e);if(l){const t=n.value.find(t=>t.id===e);t&&(o.value=t)}return l}catch(e){return a.value=e instanceof Error?e.message:'åŠ è½½å­˜æ¡£å¤±è´¥',!1}finally{t.value=!1}},deleteSave:async e=>{try{t.value=!0,a.value=null;const n=await Nn.deleteSave(e);return n&&(await f(),o.value?.id===e&&(o.value=null)),n}catch(e){return a.value=e instanceof Error?e.message:'åˆ é™¤å­˜æ¡£å¤±è´¥',!1}finally{t.value=!1}},exportSave:h,importSave:S,quickSave:async()=>{try{t.value=!0,a.value=null;const e=await Nn.quickSave();return e&&await f(),e}catch(e){return a.value=e instanceof Error?e.message:'å¿«é€Ÿä¿å­˜å¤±è´¥',!1}finally{t.value=!1}},quickLoad:async()=>{try{t.value=!0,a.value=null;const e=await Nn.quickLoad();return e&&(await f(),n.value.length>0&&(o.value=n.value[0])),e}catch(e){return a.value=e instanceof Error?e.message:'å¿«é€ŸåŠ è½½å¤±è´¥',!1}finally{t.value=!1}},downloadSave:async(e,t)=>{try{const a=await h(e);if(!a)return;const o=n.value.find(t=>t.id===e),l=t||`${o?.name||'save'}_${(new Date).toISOString().slice(0,10)}.json`,s=new Blob([a],{type:'application/json'}),r=URL.createObjectURL(s),c=document.createElement('a');c.href=r,c.download=l,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r)}catch(e){a.value=e instanceof Error?e.message:'ä¸‹è½½å­˜æ¡£å¤±è´¥'}},uploadSave:async(e,n)=>{try{t.value=!0,a.value=null;const o=await e.text();return await S(o,n)}catch(e){return a.value=e instanceof Error?e.message:'ä¸Šä¼ å­˜æ¡£å¤±è´¥',null}finally{t.value=!1}},updateAutoSaveConfig:E,toggleAutoSave:()=>{E({enabled:!s.value.enabled})},toggleSaveOnAIResponse:()=>{E({saveOnAIResponse:!s.value.saveOnAIResponse})},setMaxAutoSaves:e=>{e>=1&&e<=50&&E({maxAutoSaves:e})},setAutoSavePrefix:e=>{E({autoSavePrefix:e||'[è‡ªåŠ¨]'})},resetAutoSaveConfig:()=>{Nn.resetAutoSaveConfig(),s.value=Nn.getAutoSaveConfig()},triggerAutoSave:async()=>{try{t.value=!0,a.value=null;const e=await Nn.autoSaveOnAIResponse();return e&&(await f(),await y()),e}catch(e){return a.value=e instanceof Error?e.message:'è‡ªåŠ¨å­˜æ¡£å¤±è´¥',null}finally{t.value=!1}},clearAllAutoSaves:async()=>{try{t.value=!0,a.value=null;const e=await Nn.listAutoSaves();for(const t of e)await Nn.deleteSave(t.id);return await f(),await y(),console.log('[useSave] å·²æ¸…ç†æ‰€æœ‰è‡ªåŠ¨å­˜æ¡£ï¼Œå…±',e.length,'ä¸ª'),!0}catch(e){return a.value=e instanceof Error?e.message:'æ¸…ç†è‡ªåŠ¨å­˜æ¡£å¤±è´¥',!1}finally{t.value=!1}},convertAutoSaveToManual:async(e,n)=>{try{t.value=!0,a.value=null;const o=await Nn.getSave(e);if(!o||!o.isAutoSave)return a.value='å­˜æ¡£ä¸å­˜åœ¨æˆ–ä¸æ˜¯è‡ªåŠ¨å­˜æ¡£',!1;const l=await Nn.exportSave(e);if(!l)return a.value='å¯¼å‡ºå­˜æ¡£å¤±è´¥',!1;return!!await Nn.importSave(l,n||o.name.replace(/^\[è‡ªåŠ¨\]\s*/,''))&&(await Nn.deleteSave(e),await f(),await y(),!0)}catch(e){return a.value=e instanceof Error?e.message:'è½¬æ¢å­˜æ¡£å¤±è´¥',!1}finally{t.value=!1}},service:Nn}}const Cn={class:'auto-save-settings'},kn={class:'setting-item'},An={class:'toggle-switch'},Mn=['checked'],In={class:'toggle-switch'},Dn=['checked','disabled'],Bn={class:'setting-control'},_n=['value','disabled'],xn={class:'setting-control'},Tn=['value','disabled'],Rn={class:'setting-control'},Ln=['value','disabled'],$n={class:'status-section'},On={class:'status-items'},Un={class:'status-item'},Pn={class:'status-item'},zn={key:0,class:'status-item'},Fn={class:'status-value'},jn=(0,l.defineComponent)({__name:'AutoSaveSettings',setup(e){const{autoSaveConfig:t,lastAutoSave:a,toggleAutoSave:n,toggleSaveOnAIResponse:o,setMaxAutoSaves:s,setAutoSavePrefix:r,updateAutoSaveConfig:c,resetAutoSaveConfig:i}=wn(),u=e=>{const t=e.target,a=parseInt(t.value,10);!isNaN(a)&&a>=1&&a<=50&&s(a)},d=e=>{const t=e.target;r(t.value)},m=e=>{const t=e.target,a=parseInt(t.value,10);!isNaN(a)&&a>=500&&a<=1e4&&c({debounceMs:a})},v=async()=>{await ee('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è‡ªåŠ¨å­˜æ¡£è®¾ç½®ä¸ºé»˜è®¤å€¼å—ï¼Ÿ','é‡ç½®è®¾ç½®')&&i()};return(e,s)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',Cn,[s[15]||(s[15]=(0,l.createElementVNode)('h4',{class:'settings-title'},'è‡ªåŠ¨å­˜æ¡£è®¾ç½®',-1)),(0,l.createCommentVNode)(' ä¸»å¼€å…³ '),(0,l.createElementVNode)('div',kn,[s[3]||(s[3]=(0,l.createElementVNode)('div',{class:'setting-info'},[(0,l.createElementVNode)('div',{class:'setting-label'},'å¯ç”¨è‡ªåŠ¨å­˜æ¡£'),(0,l.createElementVNode)('div',{class:'setting-desc'},'æ€»å¼€å…³ï¼Œå…³é—­åå°†ä¸ä¼šè‡ªåŠ¨åˆ›å»ºä»»ä½•å­˜æ¡£')],-1)),(0,l.createElementVNode)('label',An,[(0,l.createElementVNode)('input',{type:'checkbox',checked:(0,l.unref)(t).enabled,onChange:s[0]||(s[0]=(...e)=>(0,l.unref)(n)&&(0,l.unref)(n)(...e))},null,40,Mn),s[2]||(s[2]=(0,l.createElementVNode)('span',{class:'toggle-slider'},null,-1))])]),(0,l.createCommentVNode)(' AIå›å¤åè‡ªåŠ¨å­˜æ¡£ '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['setting-item',{disabled:!(0,l.unref)(t).enabled}])},[s[5]||(s[5]=(0,l.createElementVNode)('div',{class:'setting-info'},[(0,l.createElementVNode)('div',{class:'setting-label'},'AIå›å¤åè‡ªåŠ¨å­˜æ¡£'),(0,l.createElementVNode)('div',{class:'setting-desc'},'æ¯æ¬¡AIç”Ÿæˆå›å¤ç»“æŸåè‡ªåŠ¨åˆ›å»ºå­˜æ¡£')],-1)),(0,l.createElementVNode)('label',In,[(0,l.createElementVNode)('input',{type:'checkbox',checked:(0,l.unref)(t).saveOnAIResponse,disabled:!(0,l.unref)(t).enabled,onChange:s[1]||(s[1]=(...e)=>(0,l.unref)(o)&&(0,l.unref)(o)(...e))},null,40,Dn),s[4]||(s[4]=(0,l.createElementVNode)('span',{class:'toggle-slider'},null,-1))])],2),(0,l.createCommentVNode)(' æœ€å¤§è‡ªåŠ¨å­˜æ¡£æ•°é‡ '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['setting-item',{disabled:!(0,l.unref)(t).enabled}])},[s[7]||(s[7]=(0,l.createElementVNode)('div',{class:'setting-info'},[(0,l.createElementVNode)('div',{class:'setting-label'},'æœ€å¤§è‡ªåŠ¨å­˜æ¡£æ•°é‡'),(0,l.createElementVNode)('div',{class:'setting-desc'},'è¶…è¿‡æ­¤æ•°é‡æ—¶ä¼šè‡ªåŠ¨åˆ é™¤æœ€æ—§çš„è‡ªåŠ¨å­˜æ¡£')],-1)),(0,l.createElementVNode)('div',Bn,[(0,l.createElementVNode)('input',{type:'number',class:'number-input',value:(0,l.unref)(t).maxAutoSaves,disabled:!(0,l.unref)(t).enabled,min:'1',max:'50',onChange:u},null,40,_n),s[6]||(s[6]=(0,l.createElementVNode)('span',{class:'unit'},'ä¸ª',-1))])],2),(0,l.createCommentVNode)(' è‡ªåŠ¨å­˜æ¡£å‰ç¼€ '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['setting-item',{disabled:!(0,l.unref)(t).enabled}])},[s[8]||(s[8]=(0,l.createElementVNode)('div',{class:'setting-info'},[(0,l.createElementVNode)('div',{class:'setting-label'},'è‡ªåŠ¨å­˜æ¡£å‰ç¼€'),(0,l.createElementVNode)('div',{class:'setting-desc'},'è‡ªåŠ¨å­˜æ¡£åç§°çš„å‰ç¼€ï¼Œä¾¿äºåŒºåˆ†')],-1)),(0,l.createElementVNode)('div',xn,[(0,l.createElementVNode)('input',{type:'text',class:'text-input',value:(0,l.unref)(t).autoSavePrefix,disabled:!(0,l.unref)(t).enabled,placeholder:'[è‡ªåŠ¨]',onChange:d},null,40,Tn)])],2),(0,l.createCommentVNode)(' é˜²æŠ–é—´éš” '),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['setting-item',{disabled:!(0,l.unref)(t).enabled}])},[s[10]||(s[10]=(0,l.createElementVNode)('div',{class:'setting-info'},[(0,l.createElementVNode)('div',{class:'setting-label'},'é˜²æŠ–é—´éš”'),(0,l.createElementVNode)('div',{class:'setting-desc'},'ä¸¤æ¬¡è‡ªåŠ¨å­˜æ¡£ä¹‹é—´çš„æœ€å°é—´éš”æ—¶é—´')],-1)),(0,l.createElementVNode)('div',Rn,[(0,l.createElementVNode)('input',{type:'number',class:'number-input',value:(0,l.unref)(t).debounceMs,disabled:!(0,l.unref)(t).enabled,min:'500',max:'10000',step:'100',onChange:m},null,40,Ln),s[9]||(s[9]=(0,l.createElementVNode)('span',{class:'unit'},'æ¯«ç§’',-1))])],2),(0,l.createCommentVNode)(' é‡ç½®æŒ‰é’® '),(0,l.createElementVNode)('div',{class:'setting-actions'},[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:v},'é‡ç½®ä¸ºé»˜è®¤å€¼')]),(0,l.createCommentVNode)(' å½“å‰çŠ¶æ€ '),(0,l.createElementVNode)('div',$n,[s[14]||(s[14]=(0,l.createElementVNode)('h5',{class:'status-title'},'å½“å‰çŠ¶æ€',-1)),(0,l.createElementVNode)('div',On,[(0,l.createElementVNode)('div',Un,[s[11]||(s[11]=(0,l.createElementVNode)('span',{class:'status-label'},'è‡ªåŠ¨å­˜æ¡£:',-1)),(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['status-value',{active:(0,l.unref)(t).enabled}])},(0,l.toDisplayString)((0,l.unref)(t).enabled?'å·²å¯ç”¨':'å·²ç¦ç”¨'),3)]),(0,l.createElementVNode)('div',Pn,[s[12]||(s[12]=(0,l.createElementVNode)('span',{class:'status-label'},'AIå›å¤å­˜æ¡£:',-1)),(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)(['status-value',{active:(0,l.unref)(t).saveOnAIResponse&&(0,l.unref)(t).enabled}])},(0,l.toDisplayString)((0,l.unref)(t).saveOnAIResponse&&(0,l.unref)(t).enabled?'å·²å¯ç”¨':'å·²ç¦ç”¨'),3)]),(0,l.unref)(a)?((0,l.openBlock)(),(0,l.createElementBlock)('div',zn,[s[13]||(s[13]=(0,l.createElementVNode)('span',{class:'status-label'},'æœ€åå­˜æ¡£:',-1)),(0,l.createElementVNode)('span',Fn,(0,l.toDisplayString)((0,l.unref)(a).name),1)])):(0,l.createCommentVNode)('v-if',!0)])]),(0,l.createCommentVNode)(' è¯´æ˜ä¿¡æ¯ '),s[16]||(s[16]=(0,l.createElementVNode)('div',{class:'info-section'},[(0,l.createElementVNode)('h5',{class:'info-title'},'ğŸ’¡ è¯´æ˜'),(0,l.createElementVNode)('ul',{class:'info-list'},[(0,l.createElementVNode)('li',null,'è‡ªåŠ¨å­˜æ¡£ä¼šåœ¨æ¯æ¬¡AIå›å¤ç»“æŸåè‡ªåŠ¨åˆ›å»º'),(0,l.createElementVNode)('li',null,'è‡ªåŠ¨å­˜æ¡£ä¸æ‰‹åŠ¨å­˜æ¡£åˆ†å¼€ç®¡ç†ï¼Œäº’ä¸å½±å“'),(0,l.createElementVNode)('li',null,'è¶…å‡ºæ•°é‡é™åˆ¶æ—¶ï¼Œæœ€æ—§çš„è‡ªåŠ¨å­˜æ¡£ä¼šè¢«è‡ªåŠ¨åˆ é™¤'),(0,l.createElementVNode)('li',null,'å¯ä»¥å°†é‡è¦çš„è‡ªåŠ¨å­˜æ¡£è½¬æ¢ä¸ºæ‰‹åŠ¨å­˜æ¡£ä»¥æ°¸ä¹…ä¿ç•™')])],-1))]))}}),Hn=(0,E.A)(jn,[['__scopeId','data-v-1d1dfdc8']]),Wn={class:'save-manager'},Gn={class:'save-header'},Jn={class:'header-actions'},Yn=['disabled'],Kn={class:'save-stats'},qn={class:'stat-item'},Xn={class:'stat-value'},Qn={class:'stat-item'},Zn={class:'stat-value'},eo={class:'stat-item'},to={class:'stat-value'},ao={class:'tab-bar'},no={class:'save-content'},oo={key:0,class:'save-list-container'},lo={class:'create-save-section'},so=['disabled'],ro={key:0,class:'save-list'},co={class:'save-info'},io={class:'save-name'},uo={class:'save-time'},mo={class:'save-actions'},vo=['onClick','disabled'],go=['onClick','disabled'],po=['onClick','disabled'],fo=['onClick','disabled'],yo={key:1,class:'empty-state'},ho={class:'save-list-container'},So={class:'auto-save-actions'},Eo=['disabled'],Vo=['disabled'],bo={key:0,class:'save-list'},No={class:'save-info'},wo={class:'save-name'},Co={class:'save-time'},ko={key:0,class:'save-source'},Ao={class:'save-actions'},Mo=['onClick','disabled'],Io=['onClick','disabled'],Do=['onClick','disabled'],Bo={key:1,class:'empty-state'},_o={class:'settings-container'},xo={class:'save-footer'},To={class:'footer-left'},Ro=['disabled'],Lo=['disabled'],$o={class:'footer-right'},Oo={class:'import-btn btn btn-secondary'},Uo={key:0,class:'error-message'},Po={class:'confirm-dialog'},zo={class:'confirm-title'},Fo={class:'confirm-message'},jo=(0,l.defineComponent)({__name:'SaveManager',emits:['close','save-loaded','save-created'],setup(e,{emit:t}){const a=t,{isProcessing:n,error:o,saveList:s,currentSave:r,saveStats:c,manualSaveList:i,autoSaveList:u,hasSaves:d,refreshList:m,refreshStats:v,createSave:g,updateSave:p,loadSave:f,deleteSave:y,quickSave:h,quickLoad:S,downloadSave:E,uploadSave:V,triggerAutoSave:b,clearAllAutoSaves:N,convertAutoSaveToManual:w}=wn(),C=(0,l.ref)('manual'),k=(0,l.ref)(''),A=(0,l.ref)(!1),M=(0,l.ref)(''),I=(0,l.ref)('');let D=null;const B=e=>new Date(e).toLocaleString('zh-CN',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}),x=()=>{},T=(e,t,a)=>{M.value=e,I.value=t,D=a,A.value=!0},R=()=>{A.value=!1,D=null},L=()=>{D&&D(),A.value=!1,D=null},O=async()=>{if(!k.value.trim())return;const e=await g(k.value.trim());e&&(k.value='',a('save-created',e.id))},U=async e=>{T('è¯»å–å­˜æ¡£','ç¡®å®šè¦è¯»å–æ­¤å­˜æ¡£å—ï¼Ÿå½“å‰æœªä¿å­˜çš„è¿›åº¦å°†ä¸¢å¤±ã€‚',async()=>{await f(e)&&a('save-loaded',e)})},P=(e,t)=>{T('åˆ é™¤å­˜æ¡£',`ç¡®å®šè¦åˆ é™¤å­˜æ¡£"${t}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`,async()=>{await y(e)})},F=async e=>{const t=e.target,a=t.files?.[0];a&&(await V(a),t.value='')},j=async()=>{await h()},H=async()=>{T('å¿«é€ŸåŠ è½½','ç¡®å®šè¦åŠ è½½æœ€è¿‘çš„å­˜æ¡£å—ï¼Ÿå½“å‰æœªä¿å­˜çš„è¿›åº¦å°†ä¸¢å¤±ã€‚',async()=>{await S()})},W=async()=>{await b()},G=()=>{T('æ¸…ç©ºè‡ªåŠ¨å­˜æ¡£','ç¡®å®šè¦åˆ é™¤æ‰€æœ‰è‡ªåŠ¨å­˜æ¡£å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚',async()=>{await N()})};return(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',Wn,[(0,l.createCommentVNode)(' é¡¶éƒ¨æ ‡é¢˜æ  '),(0,l.createElementVNode)('div',Gn,[t[6]||(t[6]=(0,l.createElementVNode)('h3',{class:'save-title'},[(0,l.createElementVNode)('span',{class:'icon'},'ğŸ’¾'),(0,l.createTextVNode)(' å­˜æ¡£ç®¡ç† ')],-1)),(0,l.createElementVNode)('div',Jn,[(0,l.createElementVNode)('button',{class:'btn btn-icon',onClick:t[0]||(t[0]=(...e)=>(0,l.unref)(m)&&(0,l.unref)(m)(...e)),disabled:(0,l.unref)(n),title:'åˆ·æ–°'},[(0,l.createElementVNode)('span',{class:(0,l.normalizeClass)({spinning:(0,l.unref)(n)})},'ğŸ”„',2)],8,Yn),(0,l.createElementVNode)('button',{class:'btn btn-icon',onClick:t[1]||(t[1]=t=>e.$emit('close')),title:'å…³é—­'},'âœ–')])]),(0,l.createCommentVNode)(' å­˜æ¡£ç»Ÿè®¡ '),(0,l.createElementVNode)('div',Kn,[(0,l.createElementVNode)('div',qn,[t[7]||(t[7]=(0,l.createElementVNode)('span',{class:'stat-label'},'æ€»è®¡',-1)),(0,l.createElementVNode)('span',Xn,(0,l.toDisplayString)((0,l.unref)(c).total),1)]),(0,l.createElementVNode)('div',Qn,[t[8]||(t[8]=(0,l.createElementVNode)('span',{class:'stat-label'},'æ‰‹åŠ¨',-1)),(0,l.createElementVNode)('span',Zn,(0,l.toDisplayString)((0,l.unref)(c).manual),1)]),(0,l.createElementVNode)('div',eo,[t[9]||(t[9]=(0,l.createElementVNode)('span',{class:'stat-label'},'è‡ªåŠ¨',-1)),(0,l.createElementVNode)('span',to,(0,l.toDisplayString)((0,l.unref)(c).auto),1)])]),(0,l.createCommentVNode)(' æ ‡ç­¾é¡µåˆ‡æ¢ '),(0,l.createElementVNode)('div',ao,[(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['tab-btn',{active:'manual'===C.value}]),onClick:t[2]||(t[2]=e=>C.value='manual')},' æ‰‹åŠ¨å­˜æ¡£ ('+(0,l.toDisplayString)((0,l.unref)(i).length)+') ',3),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['tab-btn',{active:'auto'===C.value}]),onClick:t[3]||(t[3]=e=>C.value='auto')},' è‡ªåŠ¨å­˜æ¡£ ('+(0,l.toDisplayString)((0,l.unref)(u).length)+') ',3),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['tab-btn',{active:'settings'===C.value}]),onClick:t[4]||(t[4]=e=>C.value='settings')},' è®¾ç½® ',2)]),(0,l.createCommentVNode)(' å†…å®¹åŒºåŸŸ '),(0,l.createElementVNode)('div',no,[(0,l.createCommentVNode)(' æ‰‹åŠ¨å­˜æ¡£åˆ—è¡¨ '),'manual'===C.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',oo,[(0,l.createCommentVNode)(' åˆ›å»ºæ–°å­˜æ¡£ '),(0,l.createElementVNode)('div',lo,[(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>k.value=e),type:'text',class:'save-name-input',placeholder:'è¾“å…¥å­˜æ¡£åç§°...',onKeyup:(0,l.withKeys)(O,['enter'])},null,544),[[l.vModelText,k.value]]),(0,l.createElementVNode)('button',{class:'btn btn-primary',onClick:O,disabled:(0,l.unref)(n)||!k.value.trim()},' åˆ›å»ºå­˜æ¡£ ',8,so)]),(0,l.createCommentVNode)(' å­˜æ¡£åˆ—è¡¨ '),(0,l.unref)(i).length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',ro,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(i),e=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:(0,l.normalizeClass)(['save-item',{active:(0,l.unref)(r)?.id===e.id}])},[(0,l.createElementVNode)('div',co,[(0,l.createElementVNode)('div',io,(0,l.toDisplayString)(e.name),1),(0,l.createElementVNode)('div',uo,[(0,l.createElementVNode)('span',null,'åˆ›å»º: '+(0,l.toDisplayString)(B(e.createdAt)),1),(0,l.createElementVNode)('span',null,'æ›´æ–°: '+(0,l.toDisplayString)(B(e.updatedAt)),1)])]),(0,l.createElementVNode)('div',mo,[(0,l.createElementVNode)('button',{class:'btn btn-sm btn-primary',onClick:t=>U(e.id),disabled:(0,l.unref)(n),title:'è¯»å–'},' ğŸ“‚ ',8,vo),(0,l.createElementVNode)('button',{class:'btn btn-sm btn-secondary',onClick:t=>(async e=>{T('è¦†ç›–å­˜æ¡£','ç¡®å®šè¦è¦†ç›–æ­¤å­˜æ¡£å—ï¼ŸåŸæœ‰æ•°æ®å°†è¢«æ›¿æ¢ã€‚',async()=>{await p(e)})})(e.id),disabled:(0,l.unref)(n),title:'è¦†ç›–'},' ğŸ’¾ ',8,go),(0,l.createElementVNode)('button',{class:'btn btn-sm btn-secondary',onClick:t=>(async e=>{await E(e)})(e.id),disabled:(0,l.unref)(n),title:'å¯¼å‡º'},' ğŸ“¤ ',8,po),(0,l.createElementVNode)('button',{class:'btn btn-sm btn-danger',onClick:t=>P(e.id,e.name),disabled:(0,l.unref)(n),title:'åˆ é™¤'},' ğŸ—‘ï¸ ',8,fo)])],2))),128))])):((0,l.openBlock)(),(0,l.createElementBlock)('div',yo,[...t[10]||(t[10]=[(0,l.createElementVNode)('p',null,'æš‚æ— æ‰‹åŠ¨å­˜æ¡£',-1),(0,l.createElementVNode)('p',{class:'hint'},'åœ¨ä¸Šæ–¹è¾“å…¥åç§°åˆ›å»ºæ–°å­˜æ¡£',-1)])]))])):'auto'===C.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:1},[(0,l.createCommentVNode)(' è‡ªåŠ¨å­˜æ¡£åˆ—è¡¨ '),(0,l.createElementVNode)('div',ho,[(0,l.createCommentVNode)(' è‡ªåŠ¨å­˜æ¡£æ“ä½œ '),(0,l.createElementVNode)('div',So,[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:W,disabled:(0,l.unref)(n)},' ç«‹å³è‡ªåŠ¨å­˜æ¡£ ',8,Eo),(0,l.createElementVNode)('button',{class:'btn btn-danger',onClick:G,disabled:(0,l.unref)(n)||0===(0,l.unref)(u).length},' æ¸…ç©ºè‡ªåŠ¨å­˜æ¡£ ',8,Vo)]),(0,l.createCommentVNode)(' è‡ªåŠ¨å­˜æ¡£åˆ—è¡¨ '),(0,l.unref)(u).length>0?((0,l.openBlock)(),(0,l.createElementBlock)('div',bo,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(u),e=>{return(0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.id,class:'save-item auto-save'},[(0,l.createElementVNode)('div',No,[(0,l.createElementVNode)('div',wo,[t[11]||(t[11]=(0,l.createElementVNode)('span',{class:'auto-badge'},'è‡ªåŠ¨',-1)),(0,l.createTextVNode)(' '+(0,l.toDisplayString)(e.name),1)]),(0,l.createElementVNode)('div',Co,[(0,l.createElementVNode)('span',null,(0,l.toDisplayString)(B(e.updatedAt)),1),e.saveSource?((0,l.openBlock)(),(0,l.createElementBlock)('span',ko,' æ¥æº: '+(0,l.toDisplayString)((a=e.saveSource,{manual:'æ‰‹åŠ¨',auto:'è‡ªåŠ¨',ai_response:'AIå›å¤'}[a]||a)),1)):(0,l.createCommentVNode)('v-if',!0)])]),(0,l.createElementVNode)('div',Ao,[(0,l.createElementVNode)('button',{class:'btn btn-sm btn-primary',onClick:t=>U(e.id),disabled:(0,l.unref)(n),title:'è¯»å–'},' ğŸ“‚ ',8,Mo),(0,l.createElementVNode)('button',{class:'btn btn-sm btn-secondary',onClick:t=>(async e=>{T('è½¬ä¸ºæ‰‹åŠ¨å­˜æ¡£','ç¡®å®šè¦å°†æ­¤è‡ªåŠ¨å­˜æ¡£è½¬ä¸ºæ‰‹åŠ¨å­˜æ¡£å—ï¼Ÿ',async()=>{await w(e)})})(e.id),disabled:(0,l.unref)(n),title:'è½¬ä¸ºæ‰‹åŠ¨å­˜æ¡£'},' ğŸ“Œ ',8,Io),(0,l.createElementVNode)('button',{class:'btn btn-sm btn-danger',onClick:t=>P(e.id,e.name),disabled:(0,l.unref)(n),title:'åˆ é™¤'},' ğŸ—‘ï¸ ',8,Do)])]);var a}),128))])):((0,l.openBlock)(),(0,l.createElementBlock)('div',Bo,[...t[12]||(t[12]=[(0,l.createElementVNode)('p',null,'æš‚æ— è‡ªåŠ¨å­˜æ¡£',-1),(0,l.createElementVNode)('p',{class:'hint'},'AIå›å¤ç»“æŸåä¼šè‡ªåŠ¨åˆ›å»ºå­˜æ¡£',-1)])]))])],2112)):'settings'===C.value?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:2},[(0,l.createCommentVNode)(' è®¾ç½®é¢æ¿ '),(0,l.createElementVNode)('div',_o,[(0,l.createVNode)(Hn)])],2112)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' åº•éƒ¨æ“ä½œæ  '),(0,l.createElementVNode)('div',xo,[(0,l.createElementVNode)('div',To,[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:j,disabled:(0,l.unref)(n)},'å¿«é€Ÿä¿å­˜',8,Ro),(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:H,disabled:(0,l.unref)(n)||!(0,l.unref)(d)},' å¿«é€ŸåŠ è½½ ',8,Lo)]),(0,l.createElementVNode)('div',$o,[(0,l.createElementVNode)('label',Oo,[t[13]||(t[13]=(0,l.createTextVNode)(' å¯¼å…¥å­˜æ¡£ ',-1)),(0,l.createElementVNode)('input',{type:'file',accept:'.json',onChange:F,hidden:''},null,32)])])]),(0,l.createCommentVNode)(' é”™è¯¯æç¤º '),(0,l.unref)(o)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Uo,[(0,l.createTextVNode)((0,l.toDisplayString)((0,l.unref)(o))+' ',1),(0,l.createElementVNode)('button',{class:'btn-close',onClick:x},'Ã—')])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' ç¡®è®¤å¯¹è¯æ¡† '),A.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:1,class:'confirm-overlay',onClick:(0,l.withModifiers)(R,['self'])},[(0,l.createElementVNode)('div',Po,[(0,l.createElementVNode)('div',zo,(0,l.toDisplayString)(M.value),1),(0,l.createElementVNode)('div',Fo,(0,l.toDisplayString)(I.value),1),(0,l.createElementVNode)('div',{class:'confirm-actions'},[(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:R},'å–æ¶ˆ'),(0,l.createElementVNode)('button',{class:'btn btn-danger',onClick:L},'ç¡®è®¤')])])])):(0,l.createCommentVNode)('v-if',!0)]))}}),Ho=(0,E.A)(jo,[['__scopeId','data-v-63e5f2b9']]);const Wo={class:'context-manager-panel'},Go={class:'panel-header'},Jo={class:'panel-body'},Yo={class:'enable-section'},Ko={class:'enable-row'},qo={class:'toggle-switch'},Xo=['checked','disabled'],Qo={class:'stats-section'},Zo={class:'stats-grid'},el={class:'stat-item'},tl={class:'stat-value'},al={class:'stat-item'},nl={class:'stat-value'},ol={class:'stat-item'},ll={class:'stat-value'},sl={class:'stat-item'},rl={class:'stat-value'},cl={key:0,class:'last-update'},il={class:'mode-section'},ul={class:'mode-selector'},dl=['disabled'],ml=['disabled'],vl={class:'config-section'},gl={class:'config-item'},pl={class:'config-control'},fl=['disabled'],yl={class:'config-item'},hl={class:'config-control'},Sl=['disabled'],El={class:'actions-section'},Vl={class:'action-buttons'},bl=['disabled'],Nl={key:0},wl={key:1},Cl=['disabled'],kl=['disabled'],Al=['disabled'],Ml={key:0,class:'error-message'},Il=(0,l.defineComponent)({__name:'ContextManagerPanel',emits:['close'],setup(e){const{isProcessing:t,error:a,mode:n,config:o,statistics:s,formattedLastUpdateTime:r,isEnabled:c,refresh:i,setSegmentCount:u,setSmallSummaryCount:d,switchMode:m,regenerateSegments:v,clearAll:g,setEnabled:p}=function(){const e=(0,l.ref)(!1),t=(0,l.ref)(!1),a=(0,l.ref)(null),n=(0,l.ref)('segmented'),o=(0,l.ref)(!1),s=(0,l.ref)({segmentCount:3,smallSummaryCount:25}),r=(0,l.ref)({recordCount:0,textCount:0,segmentCount:0,smallSummaryCount:0,largeSummaryCount:0,mode:'segmented'}),c=(0,l.ref)([]),i=(0,l.ref)([]),u=(0,l.ref)(null),d=(0,l.ref)(0),m=(0,l.computed)(()=>r.value.recordCount>0),v=(0,l.computed)(()=>'segmented'===n.value),g=(0,l.computed)(()=>d.value?new Date(d.value).toLocaleString('zh-CN'):''),p=()=>{const e=yn.getState(),l=yn.getStatistics(),m=yn.getConfig();n.value=e.mode,s.value=m,r.value=l,t.value=e.isProcessing,a.value=e.error,d.value=e.lastUpdateTime,u.value=e.segmentedContent,o.value=yn.isEnabled(),c.value=yn.getLatestRecords(10),i.value=yn.getLatestTexts(5)};return(0,l.onMounted)(async()=>{console.log('[useContextManager] Composableå·²æŒ‚è½½'),p()}),{isInitialized:e,isProcessing:t,error:a,mode:n,config:s,statistics:r,latestRecords:c,latestTexts:i,segmentedContent:u,lastUpdateTime:d,isEnabled:o,hasRecords:m,isSegmentedMode:v,formattedLastUpdateTime:g,initialize:async()=>{try{t.value=!0,a.value=null;const n=await yn.initialize();return n&&(e.value=!0,p()),n}catch(e){return a.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥',!1}finally{t.value=!1}},refresh:async()=>{await yn.loadFromWorldbook(),p()},setSegmentCount:async e=>{try{return t.value=!0,a.value=null,await yn.setSegmentCount(e),p(),!0}catch(e){return a.value=e instanceof Error?e.message:'è®¾ç½®å¤±è´¥',!1}finally{t.value=!1}},setSmallSummaryCount:async e=>{try{return t.value=!0,a.value=null,await yn.setSmallSummaryCount(e),p(),!0}catch(e){return a.value=e instanceof Error?e.message:'è®¾ç½®å¤±è´¥',!1}finally{t.value=!1}},updateConfig:async e=>{try{return t.value=!0,a.value=null,await yn.setConfig(e),p(),!0}catch(e){return a.value=e instanceof Error?e.message:'æ›´æ–°é…ç½®å¤±è´¥',!1}finally{t.value=!1}},switchMode:async e=>{try{return t.value=!0,a.value=null,await yn.switchMode(e),p(),!0}catch(e){return a.value=e instanceof Error?e.message:'åˆ‡æ¢æ¨¡å¼å¤±è´¥',!1}finally{t.value=!1}},regenerateSegments:async()=>{try{t.value=!0,a.value=null;const e=await yn.regenerateSegments();return p(),e}catch(e){return a.value=e instanceof Error?e.message:'é‡æ–°ç”Ÿæˆå¤±è´¥',!1}finally{t.value=!1}},clearAll:async(e=!1)=>{try{t.value=!0,a.value=null;const n=await yn.clearAll(e);return p(),n}catch(e){return a.value=e instanceof Error?e.message:'æ¸…ç©ºå¤±è´¥',!1}finally{t.value=!1}},getSaveData:async()=>await yn.getSaveData(),restoreFromSaveData:async e=>{try{t.value=!0,a.value=null;const n=await yn.restoreFromSaveData(e);return p(),n}catch(e){return a.value=e instanceof Error?e.message:'æ¢å¤å¤±è´¥',!1}finally{t.value=!1}},syncState:p,setEnabled:async e=>{try{return t.value=!0,a.value=null,yn.setEnabled(e),e&&await yn.initialize(),p(),!0}catch(e){return a.value=e instanceof Error?e.message:'è®¾ç½®å¯ç”¨çŠ¶æ€å¤±è´¥',!1}finally{t.value=!1}},service:yn}}(),f=(0,l.reactive)({segmentCount:3,smallSummaryCount:25}),y=async()=>{await i(),'undefined'!=typeof toastr&&toastr.success('æ•°æ®å·²åˆ·æ–°')},h=async()=>{await u(f.segmentCount)&&'undefined'!=typeof toastr&&toastr.success('åˆ†æ®µæ•°é‡å·²æ›´æ–°')},S=async()=>{await d(f.smallSummaryCount)&&'undefined'!=typeof toastr&&toastr.success('å°æ€»ç»“èŒƒå›´å·²æ›´æ–°')},E=async()=>{await m(n.value)&&'undefined'!=typeof toastr&&toastr.success(`å·²åˆ‡æ¢åˆ°${'segmented'===n.value?'åˆ†æ®µ':'å®Œæ•´'}æ¨¡å¼`)},V=async()=>{await v()&&'undefined'!=typeof toastr&&toastr.success('åˆ†æ®µå·²é‡æ–°ç”Ÿæˆ')},b=async()=>{const e=c.value?'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä¸Šä¸‹æ–‡æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚':'åŠŸèƒ½æœªå¯ç”¨ï¼Œä»…æ¸…ç©ºæœ¬åœ°çŠ¶æ€ã€‚ç¡®å®šç»§ç»­å—ï¼Ÿ';if(!await Z(e,'æ¸…ç©ºæ•°æ®'))return;await g(!1)&&'undefined'!=typeof toastr&&toastr.success('æ•°æ®å·²æ¸…ç©º')},N=async()=>{if(!await Z('ç¡®å®šè¦å¼ºåˆ¶æ¸…ç©ºä¸–ç•Œä¹¦ä¸­çš„ä¸Šä¸‹æ–‡æ¡ç›®å—ï¼Ÿæ­¤æ“ä½œä¼šå½±å“ä¸–ç•Œä¹¦å†…å®¹ï¼Œä¸å¯æ¢å¤ï¼','å¼ºåˆ¶æ¸…ç©ºä¸–ç•Œä¹¦'))return;await g(!0)&&'undefined'!=typeof toastr&&toastr.success('ä¸–ç•Œä¹¦æ¡ç›®å·²æ¸…ç©º')},w=async e=>{const t=e.target;if(t.checked){if(await ee('å¯ç”¨åå°†ç”±æœ¬ç³»ç»Ÿç®¡ç†ä¸–ç•Œä¹¦æ¡ç›®ã€‚å¦‚æœæ‚¨ä½¿ç”¨å¤–æŒ‚çš„ä¸–ç•Œä¹¦æ¥æä¾›ä¸Šä¸‹æ–‡ï¼Œè¯·ä¿æŒç¦ç”¨çŠ¶æ€ã€‚ç¡®å®šå¯ç”¨å—ï¼Ÿ','å¯ç”¨ä¸Šä¸‹æ–‡ç®¡ç†')){await p(!0)&&'undefined'!=typeof toastr&&toastr.success('ä¸Šä¸‹æ–‡ç®¡ç†å·²å¯ç”¨')}else t.checked=!1}else{await p(!1)&&'undefined'!=typeof toastr&&toastr.info('ä¸Šä¸‹æ–‡ç®¡ç†å·²ç¦ç”¨')}};return(0,l.onMounted)(()=>{f.segmentCount=o.value.segmentCount,f.smallSummaryCount=o.value.smallSummaryCount}),(e,o)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',Wo,[(0,l.createCommentVNode)(' å¤´éƒ¨ '),(0,l.createElementVNode)('div',Go,[o[5]||(o[5]=(0,l.createElementVNode)('h3',null,'ğŸ“š ä¸Šä¸‹æ–‡ç®¡ç†',-1)),(0,l.createElementVNode)('button',{class:'btn-close',onClick:o[0]||(o[0]=t=>e.$emit('close'))},'âœ•')]),(0,l.createCommentVNode)(' å†…å®¹ '),(0,l.createElementVNode)('div',Jo,[(0,l.createCommentVNode)(' åŠŸèƒ½å¯ç”¨å¼€å…³ '),(0,l.createElementVNode)('div',Yo,[o[8]||(o[8]=(0,l.createElementVNode)('div',{class:'section-title'},'âš¡ åŠŸèƒ½å¼€å…³',-1)),(0,l.createElementVNode)('div',Ko,[o[7]||(o[7]=(0,l.createElementVNode)('span',{class:'enable-label'},'ä¸Šä¸‹æ–‡ç®¡ç†åŠŸèƒ½',-1)),(0,l.createElementVNode)('label',qo,[(0,l.createElementVNode)('input',{type:'checkbox',checked:(0,l.unref)(c),onChange:w,disabled:(0,l.unref)(t)},null,40,Xo),o[6]||(o[6]=(0,l.createElementVNode)('span',{class:'toggle-slider'},null,-1))])]),(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['enable-status',{enabled:(0,l.unref)(c),disabled:!(0,l.unref)(c)}])},(0,l.toDisplayString)((0,l.unref)(c)?'âœ… å·²å¯ç”¨ - æ­£åœ¨ç®¡ç†ä¸–ç•Œä¹¦':'âš ï¸ å·²ç¦ç”¨ - ä½¿ç”¨å¤–æŒ‚ä¸–ç•Œä¹¦'),3)]),(0,l.createCommentVNode)(' ç»Ÿè®¡ä¿¡æ¯ '),(0,l.createElementVNode)('div',Qo,[o[13]||(o[13]=(0,l.createElementVNode)('div',{class:'section-title'},'ğŸ“Š ç»Ÿè®¡ä¿¡æ¯',-1)),(0,l.createElementVNode)('div',Zo,[(0,l.createElementVNode)('div',el,[o[9]||(o[9]=(0,l.createElementVNode)('span',{class:'stat-label'},'å†å²è®°å½•',-1)),(0,l.createElementVNode)('span',tl,(0,l.toDisplayString)((0,l.unref)(s).recordCount),1)]),(0,l.createElementVNode)('div',al,[o[10]||(o[10]=(0,l.createElementVNode)('span',{class:'stat-label'},'å†å²æ­£æ–‡',-1)),(0,l.createElementVNode)('span',nl,(0,l.toDisplayString)((0,l.unref)(s).textCount),1)]),(0,l.createElementVNode)('div',ol,[o[11]||(o[11]=(0,l.createElementVNode)('span',{class:'stat-label'},'åˆ†æ®µæ­£æ–‡',-1)),(0,l.createElementVNode)('span',ll,(0,l.toDisplayString)((0,l.unref)(s).segmentCount),1)]),(0,l.createElementVNode)('div',sl,[o[12]||(o[12]=(0,l.createElementVNode)('span',{class:'stat-label'},'å°æ€»ç»“',-1)),(0,l.createElementVNode)('span',rl,(0,l.toDisplayString)((0,l.unref)(s).smallSummaryCount),1)])]),(0,l.unref)(r)?((0,l.openBlock)(),(0,l.createElementBlock)('div',cl,'æœ€åæ›´æ–°: '+(0,l.toDisplayString)((0,l.unref)(r)),1)):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' æ¨¡å¼åˆ‡æ¢ '),(0,l.createElementVNode)('div',il,[o[16]||(o[16]=(0,l.createElementVNode)('div',{class:'section-title'},'ğŸ›ï¸ æ¨¡å¼é…ç½®',-1)),(0,l.createElementVNode)('div',ul,[(0,l.createElementVNode)('label',{class:(0,l.normalizeClass)(['mode-option',{active:'segmented'===(0,l.unref)(n),disabled:!(0,l.unref)(c)}])},[(0,l.withDirectives)((0,l.createElementVNode)('input',{type:'radio','onUpdate:modelValue':o[1]||(o[1]=e=>(0,l.isRef)(n)?n.value=e:null),value:'segmented',onChange:E,disabled:!(0,l.unref)(c)},null,40,dl),[[l.vModelRadio,(0,l.unref)(n)]]),o[14]||(o[14]=(0,l.createElementVNode)('span',null,'åˆ†æ®µæ¨¡å¼',-1))],2),(0,l.createElementVNode)('label',{class:(0,l.normalizeClass)(['mode-option',{active:'full'===(0,l.unref)(n),disabled:!(0,l.unref)(c)}])},[(0,l.withDirectives)((0,l.createElementVNode)('input',{type:'radio','onUpdate:modelValue':o[2]||(o[2]=e=>(0,l.isRef)(n)?n.value=e:null),value:'full',onChange:E,disabled:!(0,l.unref)(c)},null,40,ml),[[l.vModelRadio,(0,l.unref)(n)]]),o[15]||(o[15]=(0,l.createElementVNode)('span',null,'å®Œæ•´æ¨¡å¼',-1))],2)])]),(0,l.createCommentVNode)(' é…ç½®é€‰é¡¹ '),(0,l.createElementVNode)('div',vl,[o[21]||(o[21]=(0,l.createElementVNode)('div',{class:'section-title'},'âš™ï¸ åˆ†æ®µé…ç½®',-1)),(0,l.createElementVNode)('div',gl,[o[17]||(o[17]=(0,l.createElementVNode)('label',null,'åˆ†æ®µæ­£æ–‡æ•°é‡',-1)),(0,l.createElementVNode)('div',pl,[(0,l.withDirectives)((0,l.createElementVNode)('input',{type:'number','onUpdate:modelValue':o[3]||(o[3]=e=>f.segmentCount=e),min:'0',max:'20',class:'config-input'},null,512),[[l.vModelText,f.segmentCount,void 0,{number:!0}]]),(0,l.createElementVNode)('button',{class:'btn-apply',onClick:h,disabled:(0,l.unref)(t)},'åº”ç”¨',8,fl)]),o[18]||(o[18]=(0,l.createElementVNode)('span',{class:'config-hint'},'è®¾ä¸º0åˆ™ä¸ä½¿ç”¨åˆ†æ®µæ­£æ–‡',-1))]),(0,l.createElementVNode)('div',yl,[o[19]||(o[19]=(0,l.createElementVNode)('label',null,'å°æ€»ç»“èŒƒå›´',-1)),(0,l.createElementVNode)('div',hl,[(0,l.withDirectives)((0,l.createElementVNode)('input',{type:'number','onUpdate:modelValue':o[4]||(o[4]=e=>f.smallSummaryCount=e),min:'0',max:'100',class:'config-input'},null,512),[[l.vModelText,f.smallSummaryCount,void 0,{number:!0}]]),(0,l.createElementVNode)('button',{class:'btn-apply',onClick:S,disabled:(0,l.unref)(t)},'åº”ç”¨',8,Sl)]),o[20]||(o[20]=(0,l.createElementVNode)('span',{class:'config-hint'},'è®¾ä¸º0åˆ™ä¸ä½¿ç”¨å°æ€»ç»“',-1))])]),(0,l.createCommentVNode)(' æ“ä½œæŒ‰é’® '),(0,l.createElementVNode)('div',El,[o[22]||(o[22]=(0,l.createElementVNode)('div',{class:'section-title'},'ğŸ”§ æ“ä½œ',-1)),(0,l.createElementVNode)('div',Vl,[(0,l.createElementVNode)('button',{class:'btn btn-primary',onClick:y,disabled:(0,l.unref)(t)},[(0,l.unref)(t)?((0,l.openBlock)(),(0,l.createElementBlock)('span',Nl,'å¤„ç†ä¸­...')):((0,l.openBlock)(),(0,l.createElementBlock)('span',wl,'ğŸ”„ åˆ·æ–°æ•°æ®'))],8,bl),(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:V,disabled:(0,l.unref)(t)||!(0,l.unref)(c)},' ğŸ”€ é‡æ–°åˆ†æ®µ ',8,Cl),(0,l.createElementVNode)('button',{class:'btn btn-danger',onClick:b,disabled:(0,l.unref)(t)},'ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰',8,kl),(0,l.unref)(c)?(0,l.createCommentVNode)('v-if',!0):((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'btn btn-danger-outline',onClick:N,disabled:(0,l.unref)(t)},' ğŸ—‘ï¸ å¼ºåˆ¶æ¸…ç©ºä¸–ç•Œä¹¦ ',8,Al))])]),(0,l.createCommentVNode)(' é”™è¯¯æç¤º '),(0,l.unref)(a)?((0,l.openBlock)(),(0,l.createElementBlock)('div',Ml,'âš ï¸ '+(0,l.toDisplayString)((0,l.unref)(a)),1)):(0,l.createCommentVNode)('v-if',!0)])]))}}),Dl=(0,E.A)(Il,[['__scopeId','data-v-71562640']]);function Bl(){const e=(0,l.ref)(''),t=(0,l.ref)(''),a=(0,l.ref)([]),n=(0,l.ref)(0),o=(0,l.ref)(!1),s=(0,l.ref)(!1),r=(0,l.ref)(null),c=(0,l.ref)(''),i=(0,l.ref)([]),u=(0,l.ref)(''),d=(0,l.ref)('idle'),m=(0,l.ref)(null),v=(0,l.ref)(!1),g=(0,l.ref)('standard');let p=null,f=null,y=!1;const h=(0,l.computed)(()=>!!e.value),S=(0,l.computed)(()=>a.value.length>1),E=()=>(new Date).toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'}),V=e=>{if(!e||'string'!=typeof e)return'';const t=[...e.matchAll(/<gametxt>([\s\S]*?)<\/gametxt>/gi)];if(t.length>0){return t[t.length-1][1].trim().replace(/<!--[\s\S]*?-->/g,'').trim()}return e},b=e=>{if(!e||'string'!=typeof e)return null;const t=[...e.matchAll(/<UpdateVariable>([\s\S]*?)<\/UpdateVariable>/gi)];return t.length>0?t[t.length-1][1].trim():null},N=(e,t=['gametxt'])=>{const a={isValid:!0,hasGameText:/<gametxt>[\s\S]*?<\/gametxt>/i.test(e),hasUpdateVariable:/<UpdateVariable>[\s\S]*?<\/UpdateVariable>/i.test(e),hasHistoryRecord:/<å†å²è®°å½•>[\s\S]*?<\/å†å²è®°å½•>/i.test(e),missingTags:[]};return t.includes('gametxt')&&!a.hasGameText&&a.missingTags.push('gametxt'),t.includes('UpdateVariable')&&!a.hasUpdateVariable&&a.missingTags.push('UpdateVariable'),t.includes('å†å²è®°å½•')&&!a.hasHistoryRecord&&a.missingTags.push('å†å²è®°å½•'),a.isValid=0===a.missingTags.length,a},w=async e=>{try{const t=Ie();if(i.value=[],!t.isMvuAvailable)return void console.log('[useAIInteraction] MVUä¸å¯ç”¨ï¼Œè·³è¿‡å˜é‡æ›´æ–°');if(!t.mvuData){console.warn('[useAIInteraction] MVUæ•°æ®æœªåŠ è½½ï¼Œå°è¯•åˆå§‹åŒ–...');try{await t.initialize({type:'message',message_id:'latest'}),console.log('[useAIInteraction] MVUåˆå§‹åŒ–æˆåŠŸ')}catch(e){return void console.error('[useAIInteraction] MVUåˆå§‹åŒ–å¤±è´¥:',e)}}if(!b(e))return void console.log('[useAIInteraction] æœªå‘ç°å˜é‡æ›´æ–°æŒ‡ä»¤');console.log('[useAIInteraction] å‘ç°å˜é‡æ›´æ–°æŒ‡ä»¤ï¼Œå¼€å§‹è§£ææ‰§è¡Œ...');const a=await t.parseAndExecuteCommands(e);a.success?(console.log('[useAIInteraction] å˜é‡æ›´æ–°æˆåŠŸï¼Œå…±æ‰§è¡Œ',a.results.length,'æ¡æŒ‡ä»¤'),a.results.forEach(e=>{e.success&&i.value.push({path:e.command.path,oldValue:e.oldValue,newValue:e.newValue,comment:e.command.comment})})):console.warn('[useAIInteraction] å˜é‡æ›´æ–°å¤±è´¥:',a.error)}catch(e){console.error('[useAIInteraction] è§£æå˜é‡æ›´æ–°å¤±è´¥:',e)}},C=async e=>{try{if(await yn.processAIResponse(e)){const e=yn.getStatistics();console.log('[useAIInteraction] ä¸Šä¸‹æ–‡å·²æ›´æ–°:',{å†å²è®°å½•æ•°:e.recordCount,å†å²æ­£æ–‡æ•°:e.textCount,åˆ†æ®µæ­£æ–‡æ•°:e.segmentCount,å°æ€»ç»“æ•°:e.smallSummaryCount,å¤§æ€»ç»“æ•°:e.largeSummaryCount})}}catch(e){console.error('[useAIInteraction] ä¸Šä¸‹æ–‡ç®¡ç†å¤„ç†å¤±è´¥:',e)}},k=async()=>{try{const e=Nn.getAutoSaveConfig();if(!e.enabled||!e.saveOnAIResponse)return void console.log('[useAIInteraction] è‡ªåŠ¨å­˜æ¡£æœªå¯ç”¨ï¼Œè·³è¿‡');let t;d.value='saving',console.log('[useAIInteraction] å¼€å§‹æ‰§è¡Œè‡ªåŠ¨å­˜æ¡£...'),'function'==typeof window.getLastMessageId&&(t=window.getLastMessageId());const a=await Nn.autoSaveOnAIResponse(t);a?(d.value='success',m.value=a.name,console.log('[useAIInteraction] è‡ªåŠ¨å­˜æ¡£æˆåŠŸ:',a.name),'undefined'!=typeof toastr&&toastr.info(`å·²è‡ªåŠ¨å­˜æ¡£: ${a.name}`,'è‡ªåŠ¨å­˜æ¡£',{timeOut:2e3})):d.value='idle'}catch(e){d.value='error',console.error('[useAIInteraction] è‡ªåŠ¨å­˜æ¡£å¤±è´¥:',e)}},A=async e=>{let t=[],a=!1;try{if(console.log('[useAIInteraction] ä¿å­˜AIå›å¤åˆ°é…’é¦†èŠå¤©è®°å½•ï¼ˆåŒå±‚åŒ–æ¨¡å¼ + é”™è¯¯æ¢å¤ï¼‰'),'function'!=typeof window.TavernHelper?.setChatMessages)return console.warn('[useAIInteraction] TavernHelperä¸å¯ç”¨'),!1;try{const e='function'==typeof window.getLastMessageId?window.getLastMessageId()??-1:-1;e>=0&&(t=await window.TavernHelper.getChatMessages(`0-${e}`),t&&t.length>0&&(t=JSON.parse(JSON.stringify(t)),a=!0,console.log('[useAIInteraction] å·²åˆ›å»ºæ¶ˆæ¯å¿«ç…§ï¼Œå…±',t.length,'æ¡æ¶ˆæ¯')))}catch(e){console.warn('[useAIInteraction] è·å–æ¶ˆæ¯å¿«ç…§å¤±è´¥ï¼Œç»§ç»­æ‰§è¡Œï¼ˆæ— å›æ»šèƒ½åŠ›ï¼‰:',e)}const n=await window.TavernHelper.getChatMessages('0');if(!n||0===n.length)throw new Error('æ¶ˆæ¯0ä¸å­˜åœ¨ï¼Œæ— æ³•ä¿å­˜AIå›å¤');const o=n[0];return o.message=e,await window.TavernHelper.setChatMessages([o],{refresh:'none'}),console.log('[useAIInteraction] AIå›å¤å·²ä¿å­˜åˆ°æ¶ˆæ¯0'),await M(),console.log('[useAIInteraction] åŒå±‚åŒ–ä¿å­˜æˆåŠŸ'),!0}catch(e){if(console.error('[useAIInteraction] ä¿å­˜AIå›å¤å¤±è´¥ï¼Œå°è¯•å›æ»š:',e),a&&t.length>0)try{await window.TavernHelper.setChatMessages(t,{refresh:'none'}),console.log('[useAIInteraction] å›æ»šæˆåŠŸï¼Œå·²æ¢å¤åŸå§‹æ¶ˆæ¯'),'undefined'!=typeof toastr&&toastr.warning('ä¿å­˜å¤±è´¥ï¼Œå·²å›æ»šåˆ°åŸå§‹çŠ¶æ€','åŒå±‚åŒ–é”™è¯¯',{timeOut:3e3})}catch(e){console.error('[useAIInteraction] å›æ»šå¤±è´¥:',e),'undefined'!=typeof toastr&&toastr.error('ä¿å­˜å¤±è´¥ä¸”æ— æ³•å›æ»šï¼Œæ¶ˆæ¯å¯èƒ½å·²æŸå','ä¸¥é‡é”™è¯¯',{timeOut:5e3})}return!1}},M=async()=>{let e=0;for(;e<3;)try{if('function'!=typeof window.getLastMessageId)return!0;const e=window.getLastMessageId?.()??-1;if(e<=0)return console.log('[useAIInteraction] æ— éœ€æ¸…ç†å¤šä½™æ¶ˆæ¯ï¼Œå½“å‰åªæœ‰æ¶ˆæ¯0'),!0;if('function'==typeof window.deleteChatMessages){const t=Array.from({length:e},(_,e)=>e+1);return console.log('[useAIInteraction] åˆ é™¤å¤šä½™æ¶ˆæ¯:',t),await window.deleteChatMessages(t,{refresh:'none'}),console.log('[useAIInteraction] å¤šä½™æ¶ˆæ¯å·²åˆ é™¤ï¼Œä¿æŒåŒå±‚åŒ–'),!0}return!0}catch(t){if(e++,console.warn(`[useAIInteraction] æ¸…ç†å¤šä½™æ¶ˆæ¯å¤±è´¥ (å°è¯• ${e}/3):`,t),e>=3)return console.error('[useAIInteraction] æ¸…ç†å¤šä½™æ¶ˆæ¯æœ€ç»ˆå¤±è´¥ï¼Œæ¶ˆæ¯å±‚çº§å¯èƒ½æ··ä¹±'),'undefined'!=typeof toastr&&toastr.warning('æ¶ˆæ¯æ¸…ç†å¤±è´¥ï¼Œå±‚çº§å¯èƒ½æ··ä¹±','åŒå±‚åŒ–è­¦å‘Š',{timeOut:3e3}),!1;await new Promise(t=>setTimeout(t,100*e))}return!1},I=async()=>{try{if('function'!=typeof window.TavernHelper?.getChatMessages)return!1;const e=await window.TavernHelper.getChatMessages();if(e&&e.length>0)for(let t=0;t<e.length;t++)if(!e[t].is_user)return e.splice(t,1),await window.TavernHelper.setChatMessages(e,{refresh:'none'}),!0;return!1}catch(e){return console.error('[useAIInteraction] åˆ é™¤é…’é¦†æ¶ˆæ¯å¤±è´¥:',e),!1}},D=async()=>{try{if('function'!=typeof window.getChatMessages)return console.warn('[useAIInteraction] getChatMessageså‡½æ•°ä¸å¯ç”¨'),!1;const o=window.getLastMessageId?.()??-1;if(o<0)return console.log('[useAIInteraction] é…’é¦†èŠå¤©è®°å½•ä¸ºç©º'),!1;const l=await window.getChatMessages(`0-${o}`,{role:'all',hide_state:'unhidden',include_swipes:!0});for(let o=l.length-1;o>=0;o--){const s=l[o];if('user'!==s.role){const o=s.swipes?.[s.swipe_id||0]||s.message||'',l=V(o);if(l)return e.value=l,a.value=s.swipes?s.swipes.map(e=>V(e)):[l],n.value=s.swipe_id||0,c.value=E(),t.value=o,console.log('[useAIInteraction] å·²åŠ è½½æœ€æ–°å†…å®¹ï¼Œå¹¶æ¢å¤lastAIResponseï¼Œé•¿åº¦:',o.length),!0}}return!1}catch(e){return console.error('[useAIInteraction] ä»é…’é¦†åŠ è½½å†…å®¹å¤±è´¥:',e),!1}},B=e=>{const a=Ie();let n,o={};try{if('undefined'!=typeof window&&window.Mvu){const e=window.Mvu;if('function'==typeof e.getMvuData){const t=e.getMvuData({type:'message',message_id:'latest'});t&&t.stat_data?(o=t.stat_data,console.log('[useAIInteraction] ä» MVU API è·å–åˆ°å˜é‡æ•°æ®ï¼Œé”®æ•°é‡:',Object.keys(o).length)):console.warn('[useAIInteraction] MVU API è¿”å›æ•°æ®ä¸ºç©º')}}0===Object.keys(o).length&&(a.mvuData?.stat_data?(o=a.mvuData.stat_data,console.log('[useAIInteraction] ä» store ç¼“å­˜è·å–å˜é‡æ•°æ®ï¼Œé”®æ•°é‡:',Object.keys(o).length)):console.warn('[useAIInteraction] store ç¼“å­˜ä¸­ä¹Ÿæ²¡æœ‰å˜é‡æ•°æ®')),0===Object.keys(o).length&&a.isMvuAvailable&&(console.log('[useAIInteraction] å°è¯•å¼ºåˆ¶åˆ·æ–° store...'),a.refresh().catch(e=>{console.error('[useAIInteraction] åˆ·æ–° store å¤±è´¥:',e)}),a.mvuData?.stat_data&&(o=a.mvuData.stat_data))}catch(e){console.error('[useAIInteraction] è·å– MVU æ•°æ®å¤±è´¥:',e)}try{n=JSON.stringify(o,null,2)}catch(e){console.error('[useAIInteraction] åºåˆ—åŒ–å˜é‡æ•°æ®å¤±è´¥:',e),n='{}'}let l='';l+=`<status_current_variables>\n${n}\n</status_current_variables>\n\n`,t.value&&(l+=`<last_ai_response>\n${t.value}\n</last_ai_response>\n\n`,console.log('[useAIInteraction] å·²æ³¨å…¥ä¸Šä¸€æ¬¡AIå›å¤ï¼Œé•¿åº¦:',t.value.length)),l+=e;const s=Object.keys(o);return console.log('[useAIInteraction] å·²æ„å»ºåŒ…å«å˜é‡æ•°æ®å’Œä¸Šä¸‹æ–‡çš„prompt:',{å˜é‡æ•°æ®å¤§å°:n.length+'å­—ç¬¦',é¡¶çº§é”®:s,MCé”®:o.MC?Object.keys(o.MC):'æ— MCå¯¹è±¡',ç”¨æˆ·è¾“å…¥é•¿åº¦:e.length+'å­—ç¬¦',ä¸Šä¸€æ¬¡AIå›å¤é•¿åº¦:t.value?t.value.length+'å­—ç¬¦':'æ— '}),l},x=()=>{try{return y?(console.log('[useAIInteraction] ç›‘å¬å™¨å·²å­˜åœ¨ï¼Œè·³è¿‡é‡å¤ç»‘å®š'),!0):(console.log('[useAIInteraction] è®¾ç½®AIäº‹ä»¶ç›‘å¬å™¨'),'function'!=typeof window.eventOn?(console.warn('[useAIInteraction] eventOnå‡½æ•°ä¸å¯ç”¨'),!1):(T(),p=(t,a)=>(t=>{if(!t)return;console.log('[useAIInteraction] æ”¶åˆ°æµå¼æ–‡æœ¬ï¼Œé•¿åº¦:',t.length);const a=V(t);a&&(s.value=!0,o.value=!1,e.value=a)})(t),f=(l,i)=>(async(l,i)=>{if(!l)return console.warn('[useAIInteraction] æ”¶åˆ°ç©ºçš„AIå›å¤'),o.value=!1,void(s.value=!1);console.log('[useAIInteraction] AIç”Ÿæˆç»“æŸï¼ŒID:',i),console.log('[useAIInteraction] AIå›å¤é•¿åº¦:',l.length);try{r.value=null;const i=N(l);i.isValid||(console.warn('[useAIInteraction] AIå“åº”æ ¼å¼ä¸å®Œæ•´:',i.missingTags),'undefined'!=typeof toastr&&toastr.warning(`AIå“åº”ç¼ºå°‘: ${i.missingTags.join(', ')}`,'æ ¼å¼è­¦å‘Š',{timeOut:3e3})),t.value=l,console.log('[useAIInteraction] å·²ä¿å­˜AIå›å¤ç”¨äºä¸‹æ¬¡ä¸Šä¸‹æ–‡æ³¨å…¥');const u=i.hasGameText?V(l):'';u?(window.__currentSwipeGeneration?(a.value.push(u),n.value=a.value.length-1,e.value=u,delete window.__currentSwipeGeneration,console.log('[useAIInteraction] æ–°swipeå·²æ·»åŠ ')):(e.value=u,a.value=[u],n.value=0,console.log('[useAIInteraction] å†…å®¹å·²æ›´æ–°')),c.value=E()):i.hasGameText||console.warn('[useAIInteraction] æœªæå–åˆ°æœ‰æ•ˆçš„æ˜¾ç¤ºæ–‡æœ¬ï¼ˆç¼ºå°‘gametxtæ ‡ç­¾ï¼‰'),i.hasUpdateVariable&&await w(l),await C(l),await A(l),await k(),o.value=!1,s.value=!1}catch(e){console.error('[useAIInteraction] å¤„ç†AIå›å¤å¤±è´¥:',e),r.value=e instanceof Error?e.message:'å¤„ç†AIå›å¤å¤±è´¥',o.value=!1,s.value=!1}})(l,i),void 0!==window.iframe_events?(window.eventOn(window.iframe_events.STREAM_TOKEN_RECEIVED_FULLY,p),window.eventOn(window.iframe_events.GENERATION_ENDED,f)):(window.eventOn('js_stream_token_received_fully',p),window.eventOn('js_generation_ended',f)),y=!0,console.log('[useAIInteraction] ç›‘å¬å™¨è®¾ç½®æˆåŠŸ'),!0))}catch(e){return console.error('[useAIInteraction] è®¾ç½®AIç›‘å¬å™¨å¤±è´¥:',e),!1}},T=()=>{try{if(!y&&!p&&!f)return;console.log('[useAIInteraction] æ¸…ç†AIäº‹ä»¶ç›‘å¬å™¨'),'function'==typeof window.eventRemoveListener&&(p&&(void 0!==window.iframe_events?window.eventRemoveListener(window.iframe_events.STREAM_TOKEN_RECEIVED_FULLY,p):window.eventRemoveListener('js_stream_token_received_fully',p)),f&&(void 0!==window.iframe_events?window.eventRemoveListener(window.iframe_events.GENERATION_ENDED,f):window.eventRemoveListener('js_generation_ended',f))),p=null,f=null,y=!1}catch(e){console.error('[useAIInteraction] æ¸…ç†AIç›‘å¬å™¨å¤±è´¥:',e)}},R=()=>e.value||0!==a.value.length||t.value?{currentContent:e.value,swipes:[...a.value],currentSwipeIndex:n.value,lastUserInput:u.value,lastUpdateTime:c.value,lastAIResponse:t.value}:null,L=o=>{console.log('[useAIInteraction] æ¢å¤AIå†…å®¹æ•°æ®'),e.value=o.currentContent||'',a.value=o.swipes||[],n.value=o.currentSwipeIndex||0,u.value=o.lastUserInput||'',c.value=o.lastUpdateTime||'',t.value=o.lastAIResponse||'',console.log('[useAIInteraction] AIå†…å®¹å·²æ¢å¤:',{contentLength:e.value.length,swipesCount:a.value.length,currentIndex:n.value,lastAIResponseLength:t.value.length})};(0,l.onMounted)(async()=>{console.log('[useAIInteraction] Composableå·²æŒ‚è½½'),x(),Nn.setAIContentDataProvider(R),Nn.setAIContentDataRestorer(L),await yn.initialize(),await O(),await D()});const O=async(e=3e3,t=100)=>{const a=Ie(),n=Date.now();for(;Date.now()-n<e;){if(a.isMvuAvailable&&a.mvuData?.stat_data)return void console.log('[useAIInteraction] MVU Store å·²å°±ç»ª');if(a.isLoading)await new Promise(e=>setTimeout(e,t));else{if(!a.isLoading&&!a.mvuData){console.log('[useAIInteraction] è§¦å‘ MVU Store åˆå§‹åŒ–...');try{await a.initialize()}catch(e){console.warn('[useAIInteraction] MVU Store åˆå§‹åŒ–å¤±è´¥:',e)}}await new Promise(e=>setTimeout(e,t))}}console.warn('[useAIInteraction] ç­‰å¾… MVU Store è¶…æ—¶ï¼Œç»§ç»­æ‰§è¡Œ')};return(0,l.onUnmounted)(()=>{console.log('[useAIInteraction] Composableæ­£åœ¨å¸è½½'),T()}),{currentContent:e,swipes:a,currentSwipeIndex:n,isProcessing:o,isStreaming:s,error:r,lastUpdateTime:c,variableChanges:i,lastAIResponse:t,hasContent:h,hasMultipleSwipes:S,sendMessageToAI:async t=>{if(!t.trim())return r.value='æ¶ˆæ¯ä¸èƒ½ä¸ºç©º',!1;try{if(console.log('[useAIInteraction] å‘é€æ¶ˆæ¯ç»™AIï¼ˆåŒå±‚åŒ–æ¨¡å¼ + ä¸»åŠ¨å˜é‡æ³¨å…¥ï¼‰:',t),u.value=t.trim(),e.value='',a.value=[],n.value=0,i.value=[],'function'!=typeof window.generate)throw new Error('generateå‡½æ•°ä¸å¯ç”¨ï¼Œè¯·ç¡®ä¿åœ¨é…’é¦†ç¯å¢ƒä¸­è¿è¡Œ');o.value=!0,r.value=null;const l=B(t.trim()),s=De().streamingEnabled;return console.log('[useAIInteraction] æµå¼ä¼ è¾“æ¨¡å¼:',s?'å¼€å¯':'å…³é—­'),await window.generate({user_input:l,should_stream:s,max_chat_history:0}),!0}catch(e){return console.error('[useAIInteraction] å‘é€æ¶ˆæ¯å¤±è´¥:',e),r.value=e instanceof Error?e.message:'å‘é€æ¶ˆæ¯å¤±è´¥',o.value=!1,!1}},regenerateAIResponse:async()=>{try{if(console.log('[useAIInteraction] é‡æ–°ç”ŸæˆAIå›å¤ï¼ˆä¸»åŠ¨å˜é‡æ³¨å…¥ï¼‰'),!u.value)return console.warn('[useAIInteraction] æ²¡æœ‰å¯é‡æ–°ç”Ÿæˆçš„ç”¨æˆ·è¾“å…¥'),!1;if('function'!=typeof window.generate)throw new Error('generateå‡½æ•°ä¸å¯ç”¨');await I(),e.value='',a.value=[],n.value=0,i.value=[],o.value=!0,r.value=null;const t=B(u.value),l=De().streamingEnabled;return await window.generate({user_input:t,should_stream:l,max_chat_history:0}),!0}catch(e){return console.error('[useAIInteraction] é‡æ–°ç”Ÿæˆå¤±è´¥:',e),r.value=e instanceof Error?e.message:'é‡æ–°ç”Ÿæˆå¤±è´¥',o.value=!1,!1}},generateSwipe:async()=>{try{if(console.log('[useAIInteraction] ç”Ÿæˆæ›´å¤šå›å¤ï¼ˆä¸»åŠ¨å˜é‡æ³¨å…¥ï¼‰'),!u.value)return console.warn('[useAIInteraction] æ²¡æœ‰å¯ç”Ÿæˆswipeçš„ç”¨æˆ·è¾“å…¥'),!1;if('function'!=typeof window.generate)throw new Error('generateå‡½æ•°ä¸å¯ç”¨');await I(),window.__currentSwipeGeneration=!0,o.value=!0,r.value=null;const e=B(u.value),t=De().streamingEnabled;return await window.generate({user_input:e,should_stream:t,max_chat_history:0}),!0}catch(e){return console.error('[useAIInteraction] ç”Ÿæˆswipeå¤±è´¥:',e),r.value=e instanceof Error?e.message:'ç”Ÿæˆswipeå¤±è´¥',o.value=!1,delete window.__currentSwipeGeneration,!1}},switchSwipe:t=>{if(a.value.length<=1)return;let o=n.value;o='prev'===t?o>0?o-1:a.value.length-1:o<a.value.length-1?o+1:0,n.value=o,e.value=a.value[o]},clearContent:async()=>{if(e.value='',a.value=[],n.value=0,i.value=[],u.value='',t.value='',r.value=null,c.value='','function'==typeof window.deleteChatMessages)try{const e=window.getLastMessageId?.()??-1;if(e>=0){const t=Array.from({length:e+1},(_,e)=>e);await window.deleteChatMessages(t,{refresh:'none'})}}catch(e){console.error('[useAIInteraction] æ¸…é™¤é…’é¦†èŠå¤©è®°å½•å¤±è´¥:',e)}},loadLatestFromTavern:D,setupAIListeners:x,cleanupAIListeners:T,extractGameText:V,extractUpdateVariableContent:b,buildPromptWithVariables:B,validateResponseFormat:N,contextManagerService:yn,autoSaveStatus:d,lastAutoSaveName:m,performAutoSave:k,triggerManualAutoSave:async()=>{try{let e;d.value='saving','function'==typeof window.getLastMessageId&&(e=window.getLastMessageId());const t=await Nn.createAutoSave(`[æ‰‹åŠ¨è§¦å‘] ${(new Date).toLocaleTimeString('zh-CN')}`,'auto',e);return t?(d.value='success',m.value=t.name,!0):(d.value='error',!1)}catch(e){return d.value='error',console.error('[useAIInteraction] æ‰‹åŠ¨è§¦å‘è‡ªåŠ¨å­˜æ¡£å¤±è´¥:',e),!1}},getAIContentData:R,restoreAIContentData:L,isMvuInterceptorEnabled:v,currentFilterPreset:g,initializeMvuInterceptor:()=>(console.log('[useAIInteraction] MVUæ‹¦æˆªå™¨å·²ç¦ç”¨ï¼Œè·³è¿‡åˆå§‹åŒ–'),!1),toggleMvuInterceptor:()=>(console.log('[useAIInteraction] MVUæ‹¦æˆªå™¨å·²ç¦ç”¨'),!1),enableMvuInterceptor:()=>{console.log('[useAIInteraction] MVUæ‹¦æˆªå™¨å·²ç¦ç”¨')},disableMvuInterceptor:()=>{console.log('[useAIInteraction] MVUæ‹¦æˆªå™¨å·²ç¦ç”¨')},setFilterPreset:e=>{console.log('[useAIInteraction] MVUæ‹¦æˆªå™¨å·²ç¦ç”¨ï¼Œæ— æ³•è®¾ç½®é¢„è®¾:',e)},getMvuInterceptorStats:()=>null,getAverageCompressionRatio:()=>0,mvuInterceptorService:null}}const _l={class:'main-area'},xl={class:'modal help-modal'},Tl={class:'modal-header'},Rl={class:'modal-footer'},Ll={class:'modal save-manager-modal'},$l={class:'modal context-manager-modal'},Ol={class:'modal history-text-modal'},Ul={class:'modal roster-modal'},Pl={class:'modal document-modal'},zl=(0,l.defineComponent)({__name:'GameLayout',setup(e){const{currentContent:t,isProcessing:a,isStreaming:n,error:o,lastUpdateTime:s,variableChanges:r,sendMessageToAI:c}=Bl(),{quickSave:i,quickLoad:u}=wn(),{statData:d,isMvuAvailable:m,getVariable:v,refresh:g,updateVersion:p,onUpdate:f,forceRefresh:y}=function(e){const t=Ie(),a=(0,l.ref)(0),n=(0,l.ref)('pending'),o=(0,l.ref)(null);let s=null,r=null,c=0;const i=async()=>{try{return n.value='initializing',o.value=null,await t.initialize(e),t.isMvuAvailable&&t.mvuData?(n.value='success',console.log('[useMVU] MVUåˆå§‹åŒ–æˆåŠŸ'),!0):t.isMvuAvailable?t.mvuData?(n.value='success',!0):(n.value='failed',o.value='MVUæ•°æ®ä¸ºç©º',console.warn('[useMVU] MVUæ•°æ®ä¸ºç©º'),!1):(n.value='failed',o.value='MVUæ¡†æ¶ä¸å¯ç”¨',console.warn('[useMVU] MVUæ¡†æ¶ä¸å¯ç”¨'),!1)}catch(e){return n.value='failed',o.value=e instanceof Error?e.message:'åˆå§‹åŒ–å¤±è´¥',console.error('[useMVU] MVUåˆå§‹åŒ–å¤±è´¥:',e),!1}},u=()=>{if(c>=3)return console.warn('[useMVU] å·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œåœæ­¢é‡è¯•'),void(n.value='failed');c++,n.value='retrying';const e=1e3*c;console.log(`[useMVU] å°†åœ¨ ${e}ms åè¿›è¡Œç¬¬ ${c} æ¬¡é‡è¯•...`),r=setTimeout(async()=>{!await i()&&c<3&&u()},e)};return(0,l.onMounted)(async()=>{console.log('[useMVU] onMounted, isMvuAvailable:',t.isMvuAvailable),t.isMvuAvailable&&t.mvuData?(console.log('[useMVU] Storeå·²åˆå§‹åŒ–ï¼Œè·³è¿‡åˆå§‹åŒ–'),n.value='success'):await i()||u(),s=t.onUpdateEnd(()=>{console.log('[useMVU] æ”¶åˆ°å˜é‡æ›´æ–°ç»“æŸäº‹ä»¶ï¼Œè§¦å‘åˆ·æ–°'),a.value++,'failed'!==n.value&&'retrying'!==n.value||(n.value='success',o.value=null,console.log('[useMVU] MVUå·²å°±ç»ªï¼ˆé€šè¿‡æ›´æ–°äº‹ä»¶ç¡®è®¤ï¼‰'))})}),(0,l.onUnmounted)(()=>{s&&(s(),s=null),r&&(clearTimeout(r),r=null)}),{mvuData:(0,l.computed)(()=>(a.value,t.mvuData)),statData:(0,l.computed)(()=>(a.value,t.statData)),displayData:(0,l.computed)(()=>(a.value,t.displayData)),deltaData:(0,l.computed)(()=>(a.value,t.deltaData)),isLoading:(0,l.computed)(()=>t.isLoading),error:(0,l.computed)(()=>t.error),isMvuAvailable:(0,l.computed)(()=>t.isMvuAvailable),updateVersion:a,initState:n,initError:o,refresh:t.refresh,forceRefresh:()=>(a.value++,t.refresh()),getVariable:t.getVariable,setVariable:t.setVariable,setVariables:t.setVariables,updateVariable:t.updateVariable,clearError:t.clearError,onUpdate:e=>t.onUpdateEnd(e),retryInitialize:async()=>(r&&(clearTimeout(r),r=null),c=0,await i())}}(),h=(0,l.computed)(()=>{p.value;return v('MC.ç³»ç»Ÿ.å½“å‰æ—¶é—´.æ—¥æœŸ','')}),S=(0,l.computed)(()=>{p.value;return v('MC.ç³»ç»Ÿ.å½“å‰æ—¶é—´.æ—¶æ®µ','')}),E=(0,l.computed)(()=>{p.value;return v('MC.ç³»ç»Ÿ.å½“å‰åœ°ç‚¹','')});(0,l.watch)([d,p],([e,t])=>{e&&console.log('[GameLayout] MVUæ•°æ®æ›´æ–° (v'+t+'):',{æ—¥æœŸ:v('MC.ç³»ç»Ÿ.å½“å‰æ—¶é—´.æ—¥æœŸ',''),æ—¶æ®µ:v('MC.ç³»ç»Ÿ.å½“å‰æ—¶é—´.æ—¶æ®µ',''),åœ°ç‚¹:v('MC.ç³»ç»Ÿ.å½“å‰åœ°ç‚¹','')})},{deep:!1,immediate:!1});const b=(0,l.ref)(!1),N=(0,l.ref)(!1),w=(0,l.ref)(!1),C=(0,l.ref)('connected'),k=(0,l.ref)(!1),A=(0,l.ref)('workplace'),M=(0,l.ref)(!1),I=(0,l.ref)(!1),D=(0,l.ref)(!1),B=(0,l.ref)(!1),x=(0,l.ref)(!1),T=(0,l.ref)(!1),R=(0,l.ref)(!1),L=(0,l.ref)(!1),O=()=>{document.fullscreenElement?(document.exitFullscreen?.(),b.value=!1):(document.documentElement.requestFullscreen?.(),b.value=!0)},U=()=>{b.value=!!document.fullscreenElement},P=e=>{'handbook'!==e?'personnel'!==e?(A.value=e,console.log('[GameLayout] åˆ‡æ¢åˆ°è§†å›¾:',e)):T.value=!0:R.value=!0},F=async e=>{console.log('[GameLayout] å‘é€æ¶ˆæ¯ç»™AI:',e);try{await c(e)}catch(e){console.error('[GameLayout] AIäº¤äº’é”™è¯¯:',e),'undefined'!=typeof toastr&&toastr.error('å‘é€æ¶ˆæ¯å¤±è´¥ï¼Œè¯·é‡è¯•')}},j=()=>{console.log('[GameLayout] æ¸…é™¤AIé”™è¯¯')},W=()=>{L.value=!L.value,L.value?document.documentElement.classList.add('dark-theme'):document.documentElement.classList.remove('dark-theme'),console.log('[GameLayout] ä¸»é¢˜åˆ‡æ¢:',L.value?'æ·±è‰²':'æµ…è‰²')},G=e=>{console.log('[GameLayout] å­˜æ¡£å·²åŠ è½½:',e),D.value=!1,'undefined'!=typeof toastr&&toastr.success('å­˜æ¡£å·²åŠ è½½')},J=e=>{console.log('[GameLayout] å­˜æ¡£å·²åˆ›å»º:',e),'undefined'!=typeof toastr&&toastr.success('å­˜æ¡£å·²åˆ›å»º')},Y=()=>{w.value=window.innerWidth<=768,w.value||(N.value=!1)},K=()=>{Y()};return(0,l.onMounted)(()=>{console.log('[GameLayout] MCliteå¸ƒå±€å·²åŠ è½½'),document.addEventListener('fullscreenchange',U),window.addEventListener('resize',K),Y(),console.log('[GameLayout] MVUå¯ç”¨çŠ¶æ€:',m.value)}),(0,l.onUnmounted)(()=>{document.removeEventListener('fullscreenchange',U),window.removeEventListener('resize',K)}),(e,c)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{class:(0,l.normalizeClass)(['game-layout',{'is-fullscreen':b.value,'sidebar-open':N.value}])},[(0,l.createCommentVNode)(' é¡¶éƒ¨çŠ¶æ€æ  '),(0,l.createVNode)(V,{'connection-status':C.value,'is-fullscreen':b.value,'is-dark-theme':L.value,'game-date':h.value,'game-period':S.value,'game-location':E.value,onToggleFullscreen:O,onToggleTheme:W},null,8,['connection-status','is-fullscreen','is-dark-theme','game-date','game-period','game-location']),(0,l.createCommentVNode)(' ä¸­é—´åŒºåŸŸï¼šä¸»å†…å®¹ + å³ä¾§å¯¼èˆª '),(0,l.createElementVNode)('div',_l,[(0,l.createCommentVNode)(' ä¸»å†…å®¹åŒºï¼ˆæ¸¸æˆæ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸï¼‰ '),(0,l.createVNode)(H,{ref:'mainContentRef','current-content':(0,l.unref)(t),'is-processing':(0,l.unref)(a),'is-streaming':(0,l.unref)(n),'variable-changes':(0,l.unref)(r),'last-update-time':(0,l.unref)(s)},null,8,['current-content','is-processing','is-streaming','variable-changes','last-update-time']),(0,l.createCommentVNode)(' å³ä¾§å¯¼èˆªæ  '),(0,l.createVNode)(tt,{ref:'sidebarRef','active-menu':A.value,collapsed:k.value,'mobile-visible':N.value,onMenuChange:P,'onUpdate:collapsed':c[0]||(c[0]=e=>k.value=e),onOpenHelp:c[1]||(c[1]=e=>M.value=!0),onOpenAiFilter:c[2]||(c[2]=e=>I.value=!0),onOpenSaveManager:c[3]||(c[3]=e=>D.value=!0),onOpenContextManager:c[4]||(c[4]=e=>B.value=!0),onOpenHistoryText:c[5]||(c[5]=e=>x.value=!0),onCloseMobile:c[6]||(c[6]=e=>N.value=!1)},null,8,['active-menu','collapsed','mobile-visible']),(0,l.createCommentVNode)(' ç§»åŠ¨ç«¯ä¾§è¾¹æ é®ç½© '),N.value&&w.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'sidebar-overlay',onClick:c[7]||(c[7]=e=>N.value=!1)})):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createCommentVNode)(' ç§»åŠ¨ç«¯æµ®åŠ¨èœå•æŒ‰é’® '),w.value&&!N.value?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'mobile-menu-fab',onClick:c[8]||(c[8]=e=>N.value=!0),title:'æ‰“å¼€èœå•'},[...c[22]||(c[22]=[(0,l.createElementVNode)('span',{class:'fab-icon'},'â˜°',-1)])])):(0,l.createCommentVNode)('v-if',!0),(0,l.createCommentVNode)(' åº•éƒ¨è¾“å…¥æ  '),(0,l.createVNode)(ke,{ref:'bottomBarRef','is-loading':(0,l.unref)(a),error:(0,l.unref)(o),onSend:F,onClearError:j},null,8,['is-loading','error']),(0,l.createCommentVNode)(' AIä¸Šä¸‹æ–‡è¿‡æ»¤æµ‹è¯•é¢æ¿ï¼ˆå·²ç¦ç”¨ï¼‰\n    <Teleport to="body">\n      <div v-if="showAIFilterPanel" class="modal-overlay fullscreen-modal" @click.self="showAIFilterPanel = false">\n        <div class="modal ai-filter-modal">\n          <AIContextFilterPanel @close="showAIFilterPanel = false" />\n        </div>\n      </div>\n    </Teleport>\n    '),(0,l.createCommentVNode)(' å¸®åŠ©å¼¹çª— '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[M.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal help-overlay',onClick:c[11]||(c[11]=(0,l.withModifiers)(e=>M.value=!1,['self']))},[(0,l.createElementVNode)('div',xl,[(0,l.createElementVNode)('div',Tl,[c[23]||(c[23]=(0,l.createElementVNode)('h3',null,'â“ å¸®åŠ©è¯´æ˜',-1)),(0,l.createElementVNode)('button',{class:'btn-close',onClick:c[9]||(c[9]=e=>M.value=!1)},'âœ•')]),c[24]||(c[24]=(0,l.createElementVNode)('div',{class:'modal-body'},[(0,l.createElementVNode)('div',{class:'help-section'},[(0,l.createElementVNode)('h4',null,'ğŸ“ å¦‚ä½•å¼€æ–°æ¡£ï¼Ÿ'),(0,l.createElementVNode)('ol',{class:'help-steps'},[(0,l.createElementVNode)('li',null,[(0,l.createTextVNode)('æ‰“å¼€'),(0,l.createElementVNode)('strong',null,'ä¸Šä¸‹æ–‡é¢æ¿'),(0,l.createTextVNode)('ï¼Œç‚¹å‡»"æ¸…ç©ºæ‰€æœ‰"æŒ‰é’®ï¼Œæ¸…ç†ä¸–ç•Œä¹¦å†…å®¹')]),(0,l.createElementVNode)('li',null,[(0,l.createTextVNode)('å¼€å¯'),(0,l.createElementVNode)('strong',null,'æ–°èŠå¤©')]),(0,l.createElementVNode)('li',null,[(0,l.createTextVNode)('æ‰“å¼€'),(0,l.createElementVNode)('strong',null,'å­˜æ¡£ç®¡ç†é¢æ¿'),(0,l.createTextVNode)(' - è®¾ç½® - ä¿®æ”¹'),(0,l.createElementVNode)('strong',null,'[è‡ªåŠ¨å­˜æ¡£]å‰ç¼€')]),(0,l.createElementVNode)('li',null,'æ­£å¸¸æ¸¸ç©å³å¯')])])],-1)),(0,l.createElementVNode)('div',Rl,[(0,l.createElementVNode)('button',{class:'btn btn-primary',onClick:c[10]||(c[10]=e=>M.value=!1)},'æˆ‘çŸ¥é“äº†')])])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' å­˜æ¡£ç®¡ç†é¢æ¿ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[D.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal save-manager-overlay',onClick:c[13]||(c[13]=(0,l.withModifiers)(e=>D.value=!1,['self']))},[(0,l.createElementVNode)('div',Ll,[(0,l.createVNode)(Ho,{onClose:c[12]||(c[12]=e=>D.value=!1),onSaveLoaded:G,onSaveCreated:J})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' ä¸Šä¸‹æ–‡ç®¡ç†é¢æ¿ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[B.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal context-manager-overlay',onClick:c[15]||(c[15]=(0,l.withModifiers)(e=>B.value=!1,['self']))},[(0,l.createElementVNode)('div',$l,[(0,l.createVNode)(Dl,{onClose:c[14]||(c[14]=e=>B.value=!1)})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' å†å²æ­£æ–‡é¢æ¿ - æ¨¡æ€æ¡†æ–¹å¼ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[x.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal history-text-overlay',onClick:c[17]||(c[17]=(0,l.withModifiers)(e=>x.value=!1,['self']))},[(0,l.createElementVNode)('div',Ol,[(0,l.createVNode)(fn,{onClose:c[16]||(c[16]=e=>x.value=!1)})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' MClite v2 èŠ±åå†Œé¢æ¿ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[T.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal roster-overlay',onClick:c[19]||(c[19]=(0,l.withModifiers)(e=>T.value=!1,['self']))},[(0,l.createElementVNode)('div',Ul,[(0,l.createVNode)(Xt,{onClose:c[18]||(c[18]=e=>T.value=!1)})])])):(0,l.createCommentVNode)('v-if',!0)])),(0,l.createCommentVNode)(' MClite v2 æ–‡æ¡£é¢æ¿ '),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:'body'},[R.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay fullscreen-modal document-overlay',onClick:c[21]||(c[21]=(0,l.withModifiers)(e=>R.value=!1,['self']))},[(0,l.createElementVNode)('div',Pl,[(0,l.createVNode)(Ra,{onClose:c[20]||(c[20]=e=>R.value=!1)})])])):(0,l.createCommentVNode)('v-if',!0)]))],2))}}),Fl=(0,E.A)(zl,[['__scopeId','data-v-4a22a9d8']]),jl={key:0,class:'error-boundary'},Hl={class:'error-content'},Wl={class:'error-message'},Gl={key:0,class:'error-details'},Jl=(0,l.defineComponent)({__name:'ErrorBoundary',props:{showDetails:{type:Boolean,default:!0},fallbackMessage:{default:'ç»„ä»¶åŠ è½½æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚'}},emits:['error','retry','dismiss'],setup(e,{expose:t,emit:a}){const n=e,o=a,s=(0,l.ref)(!1),r=(0,l.ref)(''),c=(0,l.ref)('');(0,l.onErrorCaptured)((e,t,a)=>(s.value=!0,r.value=e.message||n.fallbackMessage,n.showDetails&&(c.value=`\né”™è¯¯ç±»å‹: ${e.name}\né”™è¯¯ä¿¡æ¯: ${e.message}\nç»„ä»¶ä¿¡æ¯: ${a}\nå †æ ˆä¿¡æ¯:\n${e.stack||'æ— å †æ ˆä¿¡æ¯'}\n    `.trim()),console.error('[ErrorBoundary] æ•è·åˆ°é”™è¯¯:',e),console.error('[ErrorBoundary] ç»„ä»¶ä¿¡æ¯:',a),o('error',e,a),!1));const i=()=>{s.value=!1,r.value='',c.value='',o('retry')},u=()=>{s.value=!1,r.value='',c.value='',o('dismiss')};return t({reset:()=>{s.value=!1,r.value='',c.value=''},hasError:s}),(e,t)=>s.value?((0,l.openBlock)(),(0,l.createElementBlock)('div',jl,[(0,l.createElementVNode)('div',Hl,[t[1]||(t[1]=(0,l.createElementVNode)('div',{class:'error-icon'},'âš ï¸',-1)),t[2]||(t[2]=(0,l.createElementVNode)('h3',{class:'error-title'},'å‡ºç°äº†ä¸€äº›é—®é¢˜',-1)),(0,l.createElementVNode)('p',Wl,(0,l.toDisplayString)(r.value),1),(0,l.createElementVNode)('div',{class:'error-actions'},[(0,l.createElementVNode)('button',{class:'btn btn-primary',onClick:i},'é‡è¯•'),(0,l.createElementVNode)('button',{class:'btn btn-secondary',onClick:u},'å¿½ç•¥')]),c.value?((0,l.openBlock)(),(0,l.createElementBlock)('details',Gl,[t[0]||(t[0]=(0,l.createElementVNode)('summary',null,'æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯',-1)),(0,l.createElementVNode)('pre',null,(0,l.toDisplayString)(c.value),1)])):(0,l.createCommentVNode)('v-if',!0)])])):(0,l.renderSlot)(e.$slots,'default',{key:1})}}),Yl=(0,E.A)(Jl,[['__scopeId','data-v-7b143150']]),Kl={class:'dialog-header'},ql={class:'dialog-icon'},Xl={class:'dialog-title'},Ql={class:'dialog-body'},Zl={class:'dialog-message'},es={class:'dialog-footer'},ts=['disabled'],as=['disabled'],ns={key:0,class:'loading-spinner'},os=(0,l.defineComponent)({__name:'ConfirmDialog',setup(e){const{state:t,handleConfirm:a,handleCancel:n}=ae(),o=()=>{t.showCancel&&!t.isProcessing&&n()};return(e,s)=>((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,null,[(0,l.createCommentVNode)(' ç§»é™¤ Teleportï¼Œç›´æ¥åœ¨å½“å‰å®¹å™¨ä¸­æ¸²æŸ“ï¼Œä»¥æ”¯æŒå…¨å±æ¨¡å¼ '),(0,l.createVNode)(l.Transition,{name:'confirm-dialog'},{default:(0,l.withCtx)(()=>[(0,l.unref)(t).visible?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'confirm-dialog-overlay',onClick:(0,l.withModifiers)(o,['self'])},[(0,l.createElementVNode)('div',{class:(0,l.normalizeClass)(['confirm-dialog',[`type-${(0,l.unref)(t).type}`]]),role:'dialog','aria-modal':'true'},[(0,l.createCommentVNode)(' å¯¹è¯æ¡†å¤´éƒ¨ '),(0,l.createElementVNode)('div',Kl,[(0,l.createElementVNode)('span',ql,(0,l.toDisplayString)((0,l.unref)(t).icon),1),(0,l.createElementVNode)('h3',Xl,(0,l.toDisplayString)((0,l.unref)(t).title),1)]),(0,l.createCommentVNode)(' å¯¹è¯æ¡†å†…å®¹ '),(0,l.createElementVNode)('div',Ql,[(0,l.createElementVNode)('p',Zl,(0,l.toDisplayString)((0,l.unref)(t).message),1)]),(0,l.createCommentVNode)(' å¯¹è¯æ¡†åº•éƒ¨æŒ‰é’® '),(0,l.createElementVNode)('div',es,[(0,l.unref)(t).showCancel?((0,l.openBlock)(),(0,l.createElementBlock)('button',{key:0,class:'btn btn-cancel',disabled:(0,l.unref)(t).isProcessing,onClick:s[0]||(s[0]=(...e)=>(0,l.unref)(n)&&(0,l.unref)(n)(...e))},(0,l.toDisplayString)((0,l.unref)(t).cancelText),9,ts)):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('button',{class:(0,l.normalizeClass)(['btn btn-confirm',[`btn-${(0,l.unref)(t).type}`]]),disabled:(0,l.unref)(t).isProcessing,onClick:s[1]||(s[1]=(...e)=>(0,l.unref)(a)&&(0,l.unref)(a)(...e))},[(0,l.unref)(t).isProcessing?((0,l.openBlock)(),(0,l.createElementBlock)('span',ns)):(0,l.createCommentVNode)('v-if',!0),(0,l.createElementVNode)('span',null,(0,l.toDisplayString)((0,l.unref)(t).confirmText),1)],10,as)])],2)])):(0,l.createCommentVNode)('v-if',!0)]),_:1})],2112))}}),ls=(0,E.A)(os,[['__scopeId','data-v-61be8e67']]),ss=(0,l.defineComponent)({__name:'App',setup(e){const t=De(),a=(0,l.ref)(),n=(e,t)=>{console.error('[App] æ•è·åˆ°é”™è¯¯:',e),console.error('[App] ç»„ä»¶ä¿¡æ¯:',t),'undefined'!=typeof toastr&&toastr.error('åº”ç”¨å‘ç”Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•')},o=()=>{console.log('[App] ç”¨æˆ·ç‚¹å‡»é‡è¯•'),t.initialize()};return(0,l.onMounted)(async()=>{console.log('[App] MCæˆ¿å­åº”ç”¨å·²æŒ‚è½½');try{await t.initialize(),console.log('[App] åº”ç”¨çŠ¶æ€åˆå§‹åŒ–å®Œæˆ')}catch(e){console.error('[App] åˆå§‹åŒ–å¤±è´¥:',e)}}),(0,l.onUnmounted)(()=>{console.log('[App] MCæˆ¿å­åº”ç”¨æ­£åœ¨å¸è½½')}),(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{id:'app-container',ref_key:'appContainer',ref:a},[(0,l.createVNode)(Yl,{onError:n,onRetry:o},{default:(0,l.withCtx)(()=>[((0,l.openBlock)(),(0,l.createBlock)(l.Suspense,null,{default:(0,l.withCtx)(()=>[(0,l.createVNode)(Fl)]),fallback:(0,l.withCtx)(()=>[...t[0]||(t[0]=[(0,l.createElementVNode)('div',{class:'loading-container'},[(0,l.createElementVNode)('div',{class:'loading-spinner'}),(0,l.createElementVNode)('p',{class:'loading-text'},'æ­£åœ¨åŠ è½½MCæˆ¿å­...')],-1)])]),_:1}))]),_:1}),(0,l.createCommentVNode)(' å…¨å±€ç¡®è®¤å¯¹è¯æ¡† '),(0,l.createVNode)(ls)],512))}}),rs=(0,E.A)(ss,[['__scopeId','data-v-9c83b896']]),cs=e(),is=(0,l.createApp)(rs);is.use(cs),is.mount('#app');De().initialize(),console.log('[MCæˆ¿å­] åº”ç”¨å·²å¯åŠ¨'),'undefined'!=typeof toastr&&toastr.success('MCæˆ¿å­ç³»ç»ŸåŠ è½½æˆåŠŸ'),window.addEventListener('pagehide',()=>{console.log('[MCæˆ¿å­] åº”ç”¨æ­£åœ¨å¸è½½'),'undefined'!=typeof toastr&&toastr.info('MCæˆ¿å­ç³»ç»Ÿå·²å¸è½½')});</script><style>.top-bar[data-v-8d17daf4]{display:flex;align-items:center;justify-content:space-between;height:56px;padding:0 var(--spacing-md);background:var(--office-header);border-bottom:1px solid var(--border-color);flex-shrink:0;position:relative;z-index:100}.top-bar-left[data-v-8d17daf4]{display:flex;align-items:center;gap:var(--spacing-sm)}.status-item[data-v-8d17daf4]{display:flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:hsla(0,0%,100%,.08);border-radius:var(--radius-sm);border:1px solid hsla(0,0%,100%,.1);transition:all var(--transition-fast)}.status-item[data-v-8d17daf4]:hover{background:hsla(0,0%,100%,.12);border-color:hsla(0,0%,100%,.15)}.status-item .status-icon[data-v-8d17daf4]{font-size:14px;flex-shrink:0}.status-item .status-value[data-v-8d17daf4]{font-size:var(--font-sm);font-weight:500;color:#fff;white-space:nowrap}.date-display[data-v-8d17daf4]{min-width:110px}.period-display[data-v-8d17daf4]{min-width:70px}.period-badge[data-v-8d17daf4]{padding:3px 10px;border-radius:var(--radius-xs);font-size:12px;font-weight:600;letter-spacing:.5px}.period-badge.period-morning[data-v-8d17daf4]{background:rgba(255,193,7,.25);color:#ffc107;box-shadow:inset 0 0 0 1px rgba(255,193,7,.3)}.period-badge.period-noon[data-v-8d17daf4]{background:rgba(255,152,0,.25);color:#ff9800;box-shadow:inset 0 0 0 1px rgba(255,152,0,.3)}.period-badge.period-afternoon[data-v-8d17daf4]{background:rgba(255,87,34,.25);color:#ff7043;box-shadow:inset 0 0 0 1px rgba(255,87,34,.3)}.period-badge.period-evening[data-v-8d17daf4]{background:rgba(156,39,176,.25);color:#ce93d8;box-shadow:inset 0 0 0 1px rgba(156,39,176,.3)}.period-badge.period-night[data-v-8d17daf4]{background:rgba(63,81,181,.25);color:#9fa8da;box-shadow:inset 0 0 0 1px rgba(63,81,181,.3)}.period-badge.period-default[data-v-8d17daf4]{background:rgba(158,158,158,.25);color:#bdbdbd;box-shadow:inset 0 0 0 1px rgba(158,158,158,.3)}.location-display[data-v-8d17daf4]{max-width:180px}.location-display .location-value[data-v-8d17daf4]{overflow:hidden;text-overflow:ellipsis}.connection-status .status-dot[data-v-8d17daf4]{width:8px;height:8px;border-radius:50%;transition:background-color var(--transition-normal)}.connection-status .status-text[data-v-8d17daf4]{font-size:var(--font-xs);color:hsla(0,0%,100%,.8)}.connection-status.connected .status-dot[data-v-8d17daf4]{background:var(--success-color);box-shadow:0 0 6px var(--success-color)}.connection-status.connecting .status-dot[data-v-8d17daf4]{background:var(--warning-color);animation:pulse-8d17daf4 1.5s ease-in-out infinite}.connection-status.disconnected .status-dot[data-v-8d17daf4]{background:var(--error-color)}@keyframes pulse-8d17daf4{0%,100%{opacity:1}50%{opacity:.4}}.top-bar-center[data-v-8d17daf4]{flex:1}.top-bar-right[data-v-8d17daf4]{display:flex;align-items:center;gap:var(--spacing-xs)}.tool-btn[data-v-8d17daf4]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;background:hsla(0,0%,100%,.1);border:1px solid hsla(0,0%,100%,.15);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast)}.tool-btn .btn-icon[data-v-8d17daf4]{font-size:18px}.tool-btn[data-v-8d17daf4]:hover{background:hsla(0,0%,100%,.2);border-color:hsla(0,0%,100%,.25)}.tool-btn[data-v-8d17daf4]:active{transform:scale(0.95)}.tool-btn.theme-btn .btn-icon[data-v-8d17daf4]{font-size:16px}@media (max-width:768px){.top-bar[data-v-8d17daf4]{height:48px;padding:0 var(--spacing-sm)}.top-bar-left[data-v-8d17daf4]{gap:4px}.status-item[data-v-8d17daf4]{padding:4px 8px}.status-item .status-icon[data-v-8d17daf4]{font-size:12px}.status-item .status-value[data-v-8d17daf4]{font-size:var(--font-xs)}.date-display[data-v-8d17daf4]{min-width:auto}.period-display[data-v-8d17daf4]{min-width:auto}.period-badge[data-v-8d17daf4]{font-size:10px;padding:2px 6px}.location-display[data-v-8d17daf4]{max-width:100px}.connection-status[data-v-8d17daf4]{display:none}.tool-btn[data-v-8d17daf4]{width:36px;height:36px}.tool-btn .btn-icon[data-v-8d17daf4]{font-size:16px}}@media (max-width:480px){.top-bar-left[data-v-8d17daf4]{gap:2px}.status-item[data-v-8d17daf4]{padding:3px 6px}.status-item .status-icon[data-v-8d17daf4]{font-size:11px}.status-item .status-value[data-v-8d17daf4]{font-size:11px}.period-badge[data-v-8d17daf4]{font-size:9px;padding:2px 4px}.location-display[data-v-8d17daf4]{max-width:80px;display:none}}
.content-renderer[data-v-17b96b08]{font-size:var(--font-md,15px);line-height:1.8;color:var(--text-color,#1a1a1a)}.content-renderer--dark[data-v-17b96b08]{color:var(--text-color,#e8e8e8)}.content-text[data-v-17b96b08] .block-dialogue{color:#0d47a1;font-weight:500}.content-text[data-v-17b96b08] .block-thought{color:#6b21a8;font-style:italic;opacity:.9}.content-text[data-v-17b96b08] .block-scenery{color:#166534;opacity:.95}.content-text[data-v-17b96b08] .block-system{color:#b91c1c;font-weight:700}.content-renderer--dark .content-text[data-v-17b96b08] .block-dialogue{color:#93c5fd;font-weight:500}.content-renderer--dark .content-text[data-v-17b96b08] .block-thought{color:#c4b5fd;opacity:.95}.content-renderer--dark .content-text[data-v-17b96b08] .block-scenery{color:#6ee7b7;opacity:1}.content-renderer--dark .content-text[data-v-17b96b08] .block-system{color:#fca5a5;font-weight:700}.streaming-cursor[data-v-17b96b08]{display:inline-block;animation:cursorBlink-17b96b08 1s step-end infinite;color:var(--primary-color,#1a5fb4);font-weight:bold}.content-renderer--dark .streaming-cursor[data-v-17b96b08]{color:var(--primary-color,#60a5fa)}@keyframes cursorBlink-17b96b08{0%,50%{opacity:1}51%,100%{opacity:0}}
.main-content[data-v-abcfde7c]{flex:1;display:flex;flex-direction:column;overflow:hidden;min-height:0;background:var(--bg-color)}.game-text-container[data-v-abcfde7c]{flex:1;display:flex;flex-direction:column;overflow:hidden;padding:var(--spacing-md)}.processing-state[data-v-abcfde7c]{flex:1;display:flex;align-items:center;justify-content:center}.thinking-panel[data-v-abcfde7c]{text-align:center;padding:var(--spacing-xl)}.thinking-animation[data-v-abcfde7c]{display:flex;justify-content:center;gap:8px;margin-bottom:var(--spacing-md)}.thinking-animation .thinking-dot[data-v-abcfde7c]{width:12px;height:12px;background:var(--primary-color);border-radius:50%;animation:thinkingPulse-abcfde7c 1.4s ease-in-out infinite}.thinking-animation .thinking-dot[data-v-abcfde7c]:nth-child(1){animation-delay:0s}.thinking-animation .thinking-dot[data-v-abcfde7c]:nth-child(2){animation-delay:.2s}.thinking-animation .thinking-dot[data-v-abcfde7c]:nth-child(3){animation-delay:.4s}@keyframes thinkingPulse-abcfde7c{0%,80%,100%{transform:scale(0.6);opacity:.5}40%{transform:scale(1);opacity:1}}.thinking-text[data-v-abcfde7c]{font-size:var(--font-md);color:var(--text-secondary);margin:0}.content-display[data-v-abcfde7c]{flex:1;display:flex;flex-direction:column;overflow-y:auto;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md)}.content-header[data-v-abcfde7c]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-sm) var(--spacing-md);border-bottom:1px solid var(--border-color);background:var(--bg-tertiary);flex-shrink:0}.content-meta[data-v-abcfde7c]{display:flex;align-items:center;gap:var(--spacing-md)}.content-meta .meta-item[data-v-abcfde7c]{display:flex;align-items:center;gap:var(--spacing-xs);font-size:var(--font-xs);color:var(--text-disabled)}.content-meta .meta-item .meta-icon[data-v-abcfde7c]{font-size:12px}.content-meta .streaming-badge[data-v-abcfde7c]{color:var(--primary-color)}.content-meta .streaming-badge .streaming-dot[data-v-abcfde7c]{display:inline-block;width:6px;height:6px;background:var(--primary-color);border-radius:50%;animation:streamingBlink-abcfde7c 1s ease-in-out infinite}@keyframes streamingBlink-abcfde7c{0%,100%{opacity:1}50%{opacity:.3}}.game-text[data-v-abcfde7c]{flex:1;padding:var(--spacing-lg);overflow-y:auto}.game-text[data-v-abcfde7c] .content-block-renderer{font-size:var(--font-md);line-height:1.8;color:var(--text-color)}.variable-changes[data-v-abcfde7c]{margin-top:auto;border-top:1px solid var(--border-color);background:var(--bg-tertiary)}.changes-header[data-v-abcfde7c]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);cursor:pointer;transition:background var(--transition-fast)}.changes-header[data-v-abcfde7c]:hover{background:var(--bg-hover)}.changes-header .changes-icon[data-v-abcfde7c]{font-size:14px}.changes-header .changes-title[data-v-abcfde7c]{flex:1;font-size:var(--font-sm);font-weight:500;color:var(--text-color)}.changes-header .changes-toggle[data-v-abcfde7c]{font-size:10px;color:var(--text-disabled)}.changes-list[data-v-abcfde7c]{padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-color);border-top:1px solid var(--border-color)}.change-item[data-v-abcfde7c]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-xs) 0;font-size:var(--font-xs)}.change-item .change-path[data-v-abcfde7c]{color:var(--text-secondary);font-family:monospace}.change-item .change-arrow[data-v-abcfde7c]{color:var(--text-disabled)}.change-item .change-value[data-v-abcfde7c]{color:var(--primary-color);font-family:monospace}@media (max-width:768px){.game-text-container[data-v-abcfde7c]{padding:var(--spacing-sm)}.content-header[data-v-abcfde7c]{flex-direction:column;gap:var(--spacing-sm);align-items:flex-start}.game-text[data-v-abcfde7c]{padding:var(--spacing-md)}.text-content[data-v-abcfde7c]{font-size:var(--font-sm)}}
.bottom-bar[data-v-1712b424]{display:flex;flex-direction:column;gap:0;padding:0;background:var(--bg-secondary);border-top:1px solid var(--border-color);flex-shrink:0;position:relative;z-index:50}.history-panel[data-v-1712b424]{background:var(--bg-color);border-bottom:1px solid var(--border-color);max-height:300px;display:flex;flex-direction:column}.history-header[data-v-1712b424]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-secondary);border-bottom:1px solid var(--border-color)}.history-header .history-title[data-v-1712b424]{font-size:var(--font-sm);font-weight:500;color:var(--text-color)}.history-header .history-count[data-v-1712b424]{font-size:var(--font-xs);color:var(--text-secondary);background:var(--bg-tertiary);padding:2px 8px;border-radius:var(--radius-sm)}.history-header .history-actions[data-v-1712b424]{margin-left:auto;display:flex;gap:var(--spacing-xs)}.history-header .history-clear-btn[data-v-1712b424],.history-header .history-close-btn[data-v-1712b424]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;border-radius:var(--radius-xs);cursor:pointer;font-size:12px;color:var(--text-secondary)}.history-header .history-clear-btn[data-v-1712b424]:hover,.history-header .history-close-btn[data-v-1712b424]:hover{background:var(--bg-tertiary);color:var(--text-color)}.history-header .history-clear-btn[data-v-1712b424]:hover{color:var(--error-color)}.history-search[data-v-1712b424]{padding:var(--spacing-xs) var(--spacing-md);border-bottom:1px solid var(--border-color)}.history-search .history-search-input[data-v-1712b424]{width:100%;padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-color);font-size:var(--font-xs);outline:none}.history-search .history-search-input[data-v-1712b424]:focus{border-color:var(--primary-color)}.history-search .history-search-input[data-v-1712b424]::placeholder{color:var(--text-disabled)}.history-list[data-v-1712b424]{flex:1;overflow-y:auto;padding:var(--spacing-xs) 0}.history-item[data-v-1712b424]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-xs) var(--spacing-md);cursor:pointer;transition:background var(--transition-fast)}.history-item[data-v-1712b424]:hover{background:var(--bg-secondary)}.history-item:hover .history-delete-btn[data-v-1712b424]{opacity:1}.history-item.is-active[data-v-1712b424]{background:rgba(var(--primary-color-rgb),0.1);border-left:3px solid var(--primary-color);padding-left:calc(var(--spacing-md) - 3px)}.history-item .history-content[data-v-1712b424]{flex:1;font-size:var(--font-xs);color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.history-item .history-time[data-v-1712b424]{font-size:10px;color:var(--text-disabled);flex-shrink:0}.history-item .history-delete-btn[data-v-1712b424]{width:20px;height:20px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;border-radius:var(--radius-xs);cursor:pointer;font-size:10px;color:var(--text-secondary);opacity:0;transition:all var(--transition-fast)}.history-item .history-delete-btn[data-v-1712b424]:hover{background:rgba(var(--error-color-rgb),0.1);color:var(--error-color)}.history-empty[data-v-1712b424]{padding:var(--spacing-lg);text-align:center;color:var(--text-disabled);font-size:var(--font-xs)}.input-area[data-v-1712b424]{flex:1;min-width:0;display:flex;flex-direction:column;gap:var(--spacing-xs);padding:var(--spacing-sm) var(--spacing-md)}.input-container[data-v-1712b424]{display:flex;align-items:flex-end;gap:var(--spacing-sm);background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-md);padding:var(--spacing-xs);transition:border-color var(--transition-fast),box-shadow var(--transition-fast)}.input-container[data-v-1712b424]:focus-within{border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(var(--primary-color-rgb),0.1)}.input-container.is-loading[data-v-1712b424]{opacity:.7;border-color:var(--border-color)}.input-container.has-error[data-v-1712b424]{border-color:var(--error-color)}.history-toggle-btn[data-v-1712b424]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:1px solid var(--border-color);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast);flex-shrink:0}.history-toggle-btn .history-icon[data-v-1712b424]{font-size:16px}.history-toggle-btn[data-v-1712b424]:hover{background:var(--bg-secondary);border-color:var(--primary-color)}.history-toggle-btn.is-active[data-v-1712b424]{background:rgba(var(--primary-color-rgb),0.1);border-color:var(--primary-color)}.history-toggle-btn[data-v-1712b424]:not(.has-history){opacity:.5}.history-toggle-btn[data-v-1712b424]:not(.has-history):hover{opacity:.7}.message-input[data-v-1712b424]{flex:1;min-height:36px;max-height:120px;padding:var(--spacing-xs) var(--spacing-sm);background:rgba(0,0,0,0);border:none;color:var(--text-color);font-size:var(--font-sm);line-height:1.5;resize:none;outline:none}.message-input[data-v-1712b424]::placeholder{color:var(--text-disabled)}.message-input[data-v-1712b424]:disabled{opacity:.6;cursor:not-allowed}.send-btn[data-v-1712b424]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--primary-color);border:none;border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast);flex-shrink:0}.send-btn .send-icon[data-v-1712b424],.send-btn .loading-icon[data-v-1712b424]{font-size:16px}.send-btn[data-v-1712b424]:hover:not(:disabled){background:var(--primary-hover);transform:scale(1.05)}.send-btn[data-v-1712b424]:active:not(:disabled){transform:scale(0.95)}.send-btn[data-v-1712b424]:disabled{background:var(--bg-tertiary);cursor:not-allowed;opacity:.6}.send-btn.is-loading[data-v-1712b424]{animation:pulse-1712b424 1.5s infinite}@keyframes pulse-1712b424{0%,100%{opacity:1}50%{opacity:.6}}.navigation-hint[data-v-1712b424]{display:flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:rgba(var(--primary-color-rgb),0.1);border-radius:var(--radius-sm);font-size:var(--font-xs);color:var(--primary-color)}.navigation-hint .hint-icon[data-v-1712b424]{font-size:12px}.navigation-hint .hint-text[data-v-1712b424]{flex:1}.navigation-hint .hint-cancel[data-v-1712b424]{width:16px;height:16px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;border-radius:var(--radius-xs);cursor:pointer;font-size:10px;color:var(--primary-color)}.navigation-hint .hint-cancel[data-v-1712b424]:hover{background:rgba(var(--primary-color-rgb),0.2)}.error-message[data-v-1712b424]{display:flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:rgba(var(--error-color-rgb),0.1);border-radius:var(--radius-sm);color:var(--error-color);font-size:var(--font-xs)}.error-message .error-icon[data-v-1712b424]{flex-shrink:0}.error-message .error-text[data-v-1712b424]{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.error-message .error-dismiss[data-v-1712b424]{width:20px;height:20px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--error-color);cursor:pointer;border-radius:var(--radius-xs)}.error-message .error-dismiss[data-v-1712b424]:hover{background:rgba(var(--error-color-rgb),0.2)}.slide-up-enter-active[data-v-1712b424],.slide-up-leave-active[data-v-1712b424]{transition:all .2s ease}.slide-up-enter-from[data-v-1712b424],.slide-up-leave-to[data-v-1712b424]{opacity:0;max-height:0;transform:translateY(10px)}.slide-up-enter-to[data-v-1712b424],.slide-up-leave-from[data-v-1712b424]{opacity:1;max-height:300px;transform:translateY(0)}@media (max-width:768px){.bottom-bar[data-v-1712b424]{flex-direction:column}.input-area[data-v-1712b424]{padding:var(--spacing-sm);padding-bottom:calc(var(--spacing-sm) + env(safe-area-inset-bottom,0px))}.input-container[data-v-1712b424]{padding:var(--spacing-sm)}.message-input[data-v-1712b424]{font-size:16px}.send-btn[data-v-1712b424],.history-toggle-btn[data-v-1712b424]{width:44px;height:44px}.send-btn .send-icon[data-v-1712b424],.send-btn .loading-icon[data-v-1712b424],.send-btn .history-icon[data-v-1712b424],.history-toggle-btn .send-icon[data-v-1712b424],.history-toggle-btn .loading-icon[data-v-1712b424],.history-toggle-btn .history-icon[data-v-1712b424]{font-size:18px}.history-panel[data-v-1712b424]{max-height:250px}}
.sidebar[data-v-71f49f12]{display:flex;flex-direction:column;width:280px;height:100%;background:var(--bg-secondary);border-left:1px solid var(--border-color);transition:width var(--transition-normal),transform var(--transition-normal);flex-shrink:0;position:relative;overflow:hidden}.sidebar.is-collapsed[data-v-71f49f12]{width:60px}.sidebar.is-collapsed .nav-item[data-v-71f49f12]{justify-content:center;padding:var(--spacing-md)}.mobile-close-btn[data-v-71f49f12]{display:none;position:absolute;right:var(--spacing-sm);top:var(--spacing-sm);width:36px;height:36px;align-items:center;justify-content:center;background:var(--bg-hover);border:1px solid var(--border-color);border-radius:var(--radius-sm);cursor:pointer;z-index:11;transition:all var(--transition-fast)}.mobile-close-btn .close-icon[data-v-71f49f12]{font-size:18px;color:var(--text-secondary)}.mobile-close-btn[data-v-71f49f12]:hover{background:var(--bg-tertiary)}.mobile-close-btn:hover .close-icon[data-v-71f49f12]{color:var(--text-color)}.collapse-btn[data-v-71f49f12]{position:absolute;left:-12px;top:50%;transform:translateY(-50%);width:24px;height:48px;display:flex;align-items:center;justify-content:center;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-sm) 0 0 var(--radius-sm);cursor:pointer;z-index:10;transition:all var(--transition-fast)}.collapse-btn .collapse-icon[data-v-71f49f12]{font-size:10px;color:var(--text-secondary)}.collapse-btn[data-v-71f49f12]:hover{background:var(--bg-hover);border-color:var(--border-hover)}.collapse-btn:hover .collapse-icon[data-v-71f49f12]{color:var(--text-color)}.nav-menu[data-v-71f49f12]{padding:var(--spacing-sm);flex-shrink:0}.nav-item[data-v-71f49f12]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);margin-bottom:var(--spacing-xs);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast);position:relative}.nav-item .nav-icon[data-v-71f49f12]{font-size:16px;flex-shrink:0}.nav-item .nav-label[data-v-71f49f12]{font-size:var(--font-sm);color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.nav-item .lite-tag[data-v-71f49f12]{margin-left:auto;padding:1px 4px;font-size:9px;font-weight:500;background:var(--warning-light);color:var(--warning-color);border-radius:3px;opacity:.8}.nav-item[data-v-71f49f12]:hover{background:var(--bg-hover)}.nav-item:hover .nav-label[data-v-71f49f12]{color:var(--text-highlight)}.nav-item.is-active[data-v-71f49f12]{background:var(--primary-light);border-left:3px solid var(--primary-color)}.nav-item.is-active .nav-label[data-v-71f49f12]{color:var(--primary-color);font-weight:600}.nav-item.is-disabled[data-v-71f49f12]{opacity:.5;cursor:not-allowed}.info-panels[data-v-71f49f12]{flex:1;overflow-y:auto;padding:var(--spacing-sm);display:flex;flex-direction:column;gap:var(--spacing-sm)}.info-panel[data-v-71f49f12]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);overflow:hidden}.panel-header[data-v-71f49f12]{display:flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-tertiary);border-bottom:1px solid var(--border-light)}.panel-header .panel-icon[data-v-71f49f12]{font-size:14px}.panel-header .panel-title[data-v-71f49f12]{font-size:var(--font-xs);font-weight:600;color:var(--text-color)}.panel-header .panel-count[data-v-71f49f12]{margin-left:auto;min-width:18px;height:18px;display:flex;align-items:center;justify-content:center;padding:0 5px;background:var(--primary-light);color:var(--primary-color);font-size:10px;font-weight:600;border-radius:9px}.panel-body[data-v-71f49f12]{padding:var(--spacing-xs);max-height:150px;overflow-y:auto}.settings-panel .panel-body[data-v-71f49f12]{padding:var(--spacing-sm)}.setting-item[data-v-71f49f12]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-xs) 0}.setting-label[data-v-71f49f12]{display:flex;align-items:center;gap:var(--spacing-xs)}.setting-label .setting-icon[data-v-71f49f12]{font-size:14px}.setting-label .setting-text[data-v-71f49f12]{font-size:var(--font-sm);color:var(--text-color)}.setting-hint[data-v-71f49f12]{font-size:10px;color:var(--text-muted);margin-top:2px;padding-left:22px}.toggle-switch[data-v-71f49f12]{position:relative;display:inline-block;width:40px;height:20px;cursor:pointer}.toggle-switch input[data-v-71f49f12]{opacity:0;width:0;height:0}.toggle-switch input:checked+.toggle-slider[data-v-71f49f12]{background:var(--primary-color)}.toggle-switch input:checked+.toggle-slider[data-v-71f49f12]::before{transform:translateX(20px)}.toggle-switch .toggle-slider[data-v-71f49f12]{position:absolute;top:0;left:0;right:0;bottom:0;background:var(--bg-tertiary);border-radius:20px;transition:all var(--transition-fast)}.toggle-switch .toggle-slider[data-v-71f49f12]::before{content:"";position:absolute;left:2px;bottom:2px;width:16px;height:16px;background:#fff;border-radius:50%;transition:all var(--transition-fast);box-shadow:0 1px 3px rgba(0,0,0,.2)}.lite-info-panel[data-v-71f49f12]{background:var(--warning-light);border:1px solid var(--warning-color)}.lite-notice[data-v-71f49f12]{text-align:center;padding:var(--spacing-xs)}.lite-notice p[data-v-71f49f12]{margin:0;font-size:var(--font-xs);color:var(--text-color)}.lite-notice p.lite-detail[data-v-71f49f12]{font-size:10px;color:var(--text-secondary);margin-top:2px}.sidebar-footer[data-v-71f49f12]{padding:var(--spacing-sm);border-top:1px solid var(--border-light);flex-shrink:0}.mobile-settings[data-v-71f49f12]{display:none}.divider[data-v-71f49f12]{height:1px;background:var(--border-light);margin:var(--spacing-xs) 0}.footer-item[data-v-71f49f12]{margin-bottom:var(--spacing-xs)}.footer-item[data-v-71f49f12]:last-child{margin-bottom:0}.footer-item .nav-label[data-v-71f49f12]{color:var(--text-secondary)}.footer-item:hover .nav-label[data-v-71f49f12]{color:var(--text-color)}.footer-item.highlight-item[data-v-71f49f12]{background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.2);border-radius:var(--radius-sm);margin-bottom:var(--spacing-xs)}.footer-item.highlight-item .nav-label[data-v-71f49f12]{color:var(--primary-color);font-weight:500}.footer-item.highlight-item[data-v-71f49f12]:hover{background:rgba(99,102,241,.2);border-color:rgba(99,102,241,.4)}.footer-item.highlight-item.secondary[data-v-71f49f12]{background:rgba(59,130,246,.08);border:1px solid rgba(59,130,246,.15)}.footer-item.highlight-item.secondary .nav-label[data-v-71f49f12]{color:#3b82f6;font-weight:500}.footer-item.highlight-item.secondary[data-v-71f49f12]:hover{background:rgba(59,130,246,.15);border-color:rgba(59,130,246,.3)}.footer-item.debug-item[data-v-71f49f12]{border-top:1px dashed var(--border-light);padding-top:var(--spacing-sm);margin-top:var(--spacing-sm)}.footer-item.debug-item .nav-icon[data-v-71f49f12]{opacity:.7}.footer-item.debug-item .nav-label[data-v-71f49f12]{color:var(--text-muted);font-size:11px}.footer-item.debug-item:hover .nav-icon[data-v-71f49f12]{opacity:1}.footer-item.debug-item:hover .nav-label[data-v-71f49f12]{color:var(--text-secondary)}@media (max-width:768px){.sidebar[data-v-71f49f12]{position:fixed;right:8px;top:50%;transform:translateY(-50%) translateX(calc(100% + 16px));bottom:auto;width:auto;min-width:150px;max-width:200px;height:auto;max-height:80vh;z-index:100;box-shadow:var(--shadow-lg);transition:transform var(--transition-normal);border:1px solid var(--border-color);border-radius:var(--radius-md);padding:var(--spacing-xs) 0}.sidebar.is-visible[data-v-71f49f12]{transform:translateY(-50%) translateX(0)}.sidebar.is-collapsed[data-v-71f49f12]{width:auto;min-width:150px;max-width:200px}.sidebar.is-collapsed .nav-item[data-v-71f49f12]{justify-content:flex-start;padding:var(--spacing-xs) var(--spacing-sm)}.sidebar.is-collapsed .nav-label[data-v-71f49f12],.sidebar.is-collapsed .lite-tag[data-v-71f49f12]{display:inline}.desktop-only[data-v-71f49f12]{display:none !important}.mobile-settings[data-v-71f49f12]{display:block;padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-tertiary);border-radius:var(--radius-xs);margin:0 var(--spacing-xs) var(--spacing-xs)}.mobile-setting-item[data-v-71f49f12]{display:flex;align-items:center;gap:var(--spacing-xs)}.mobile-setting-item .setting-icon[data-v-71f49f12]{font-size:12px}.mobile-setting-item .setting-text[data-v-71f49f12]{font-size:11px;color:var(--text-color);flex:1}.toggle-switch.small[data-v-71f49f12]{width:32px;height:16px}.toggle-switch.small .toggle-slider[data-v-71f49f12]::before{width:12px;height:12px;left:2px;bottom:2px}.toggle-switch.small input:checked+.toggle-slider[data-v-71f49f12]::before{transform:translateX(16px)}.mobile-close-btn[data-v-71f49f12]{display:flex;position:relative;right:auto;top:auto;width:28px;height:28px;margin:var(--spacing-xs) auto var(--spacing-xs)}.mobile-close-btn .close-icon[data-v-71f49f12]{font-size:14px}.collapse-btn[data-v-71f49f12]{display:none}.nav-menu[data-v-71f49f12]{padding:var(--spacing-xs);padding-top:0}.nav-item[data-v-71f49f12]{padding:var(--spacing-xs) var(--spacing-sm);margin-bottom:2px}.nav-item .nav-icon[data-v-71f49f12]{font-size:14px}.nav-item .nav-label[data-v-71f49f12]{font-size:var(--font-xs);white-space:nowrap}.nav-item .lite-tag[data-v-71f49f12]{font-size:8px;padding:1px 3px}.sidebar-footer[data-v-71f49f12]{padding:var(--spacing-xs);border-top:none}.footer-item[data-v-71f49f12]{padding:var(--spacing-xs) var(--spacing-sm);margin-bottom:2px}.footer-item .nav-icon[data-v-71f49f12]{font-size:12px}.footer-item .nav-label[data-v-71f49f12]{font-size:11px;white-space:nowrap}.footer-item.highlight-item[data-v-71f49f12]{padding:var(--spacing-xs) var(--spacing-sm)}.footer-item.highlight-item.secondary[data-v-71f49f12]{background:rgba(59,130,246,.12);border-color:rgba(59,130,246,.25)}.footer-item.debug-item[data-v-71f49f12]{padding-top:var(--spacing-xs);margin-top:var(--spacing-xs)}.divider[data-v-71f49f12]{margin:2px 0}}@media (max-width:480px){.sidebar[data-v-71f49f12]{right:4px;min-width:130px;max-width:170px;max-height:75vh;border-radius:var(--radius-sm)}.mobile-settings[data-v-71f49f12]{padding:var(--spacing-xs);margin:0 var(--spacing-xs) var(--spacing-xs)}.mobile-setting-item .setting-icon[data-v-71f49f12]{font-size:11px}.mobile-setting-item .setting-text[data-v-71f49f12]{font-size:10px}.toggle-switch.small[data-v-71f49f12]{width:28px;height:14px}.toggle-switch.small .toggle-slider[data-v-71f49f12]::before{width:10px;height:10px;left:2px;bottom:2px}.toggle-switch.small input:checked+.toggle-slider[data-v-71f49f12]::before{transform:translateX(14px)}.nav-item[data-v-71f49f12]{padding:var(--spacing-xs) var(--spacing-xs)}.nav-item .nav-icon[data-v-71f49f12]{font-size:13px}.nav-item .nav-label[data-v-71f49f12]{font-size:11px}.footer-item .nav-icon[data-v-71f49f12]{font-size:11px}.footer-item .nav-label[data-v-71f49f12]{font-size:10px}.footer-item.highlight-item[data-v-71f49f12]{padding:var(--spacing-xs)}.footer-item.highlight-item.secondary .nav-icon[data-v-71f49f12]{font-size:12px}}
.schema-field[data-v-7e8ff355]{display:flex;flex-direction:column;gap:6px;padding:8px 10px;background:var(--bg-secondary);border-radius:6px;border:1px solid var(--border-color)}.field-label[data-v-7e8ff355]{font-size:11px;font-weight:500;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.3px}.field-value[data-v-7e8ff355]{font-size:14px;color:var(--text-color);line-height:1.4}.value-text[data-v-7e8ff355]{word-break:break-word}.text-content[data-v-7e8ff355]{margin:0;white-space:pre-wrap;line-height:1.6}.enum-badge[data-v-7e8ff355]{display:inline-block;padding:3px 10px;background:var(--primary-light);color:var(--primary-color);border-radius:4px;font-size:12px;font-weight:500}.tags-container[data-v-7e8ff355]{display:flex;flex-wrap:wrap;gap:4px}.tag[data-v-7e8ff355]{display:inline-block;padding:3px 10px;background:var(--bg-tertiary);color:var(--text-color);border-radius:12px;font-size:12px;border:1px solid var(--border-color)}.empty-tags[data-v-7e8ff355]{color:var(--text-disabled);font-style:italic;font-size:13px}.boolean-value[data-v-7e8ff355]{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:4px;font-size:13px;font-weight:500}.boolean-value .boolean-icon[data-v-7e8ff355]{font-size:12px}.boolean-value.is-true[data-v-7e8ff355]{background:var(--success-light);color:var(--success-color)}.boolean-value.is-false[data-v-7e8ff355]{background:var(--bg-tertiary);color:var(--text-secondary)}.field-type-text .field-value[data-v-7e8ff355]{font-size:13px}.field-type-number .value-text[data-v-7e8ff355]{font-family:"SF Mono",Monaco,Consolas,monospace;font-weight:500}
.roster-panel[data-v-1bfc907d]{display:flex;flex-direction:column;height:100%;background:var(--bg-secondary);border-radius:8px;overflow:hidden;color:var(--text-color)}.panel-header[data-v-1bfc907d]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border-color);background:var(--bg-tertiary)}.panel-header .header-left[data-v-1bfc907d]{display:flex;align-items:center;gap:10px}.panel-header .header-left .panel-icon[data-v-1bfc907d]{font-size:20px}.panel-header .header-left h2[data-v-1bfc907d]{margin:0;font-size:18px;font-weight:600;color:var(--text-color)}.panel-header .header-right[data-v-1bfc907d]{display:flex;align-items:center;gap:12px}.panel-header .header-right .entry-count[data-v-1bfc907d]{font-size:14px;color:var(--text-secondary);background:var(--bg-secondary);padding:4px 10px;border-radius:12px}.panel-header .header-right .close-btn[data-v-1bfc907d]{background:none;border:none;font-size:18px;cursor:pointer;padding:4px 8px;color:var(--text-secondary);border-radius:4px;transition:all .2s}.panel-header .header-right .close-btn[data-v-1bfc907d]:hover{background:var(--bg-hover);color:var(--text-color)}.panel-main[data-v-1bfc907d]{display:flex;flex:1;overflow:hidden}.category-sidebar[data-v-1bfc907d]{width:160px;min-width:160px;background:var(--bg-tertiary);border-right:1px solid var(--border-color);display:flex;flex-direction:column}.category-sidebar .sidebar-header[data-v-1bfc907d]{padding:12px;border-bottom:1px solid var(--border-color)}.category-sidebar .sidebar-header .sidebar-title[data-v-1bfc907d]{font-size:13px;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.5px}.category-sidebar .category-list[data-v-1bfc907d]{flex:1;overflow-y:auto;padding:8px}.category-sidebar .category-item[data-v-1bfc907d]{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;margin-bottom:4px;border-radius:6px;cursor:pointer;transition:all .2s;background:rgba(0,0,0,0)}.category-sidebar .category-item .category-name[data-v-1bfc907d]{font-size:13px;color:var(--text-color)}.category-sidebar .category-item .category-count[data-v-1bfc907d]{font-size:12px;color:var(--text-secondary);background:var(--bg-secondary);padding:2px 8px;border-radius:10px}.category-sidebar .category-item[data-v-1bfc907d]:hover{background:var(--bg-hover)}.category-sidebar .category-item.active[data-v-1bfc907d]{background:var(--primary-light)}.category-sidebar .category-item.active .category-name[data-v-1bfc907d]{color:var(--primary-color);font-weight:600}.category-sidebar .category-item.active .category-count[data-v-1bfc907d]{background:var(--primary-color);color:#fff}.panel-body[data-v-1bfc907d]{flex:1;overflow-y:auto;padding:16px;background:var(--bg-color)}.state-container[data-v-1bfc907d]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;height:100%}.state-container .state-icon[data-v-1bfc907d]{font-size:48px;margin-bottom:16px}.state-container p[data-v-1bfc907d]{margin:0 0 8px 0;color:var(--text-secondary);font-size:15px}.state-container .empty-hint[data-v-1bfc907d]{font-size:13px;color:var(--text-disabled)}.state-container .empty-hint code[data-v-1bfc907d]{background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;font-family:monospace;color:var(--text-color)}.state-container .retry-btn[data-v-1bfc907d]{margin-top:16px;padding:8px 20px;background:var(--primary-color);color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:14px;transition:background .2s}.state-container .retry-btn[data-v-1bfc907d]:hover{background:var(--primary-hover)}.content-area[data-v-1bfc907d]{display:flex;flex-direction:column;gap:16px}.group-header[data-v-1bfc907d]{display:flex;align-items:center;justify-content:space-between;padding-bottom:12px;border-bottom:2px solid var(--primary-color)}.group-header .group-title[data-v-1bfc907d]{margin:0;font-size:18px;color:var(--text-color)}.group-header .group-count[data-v-1bfc907d]{font-size:14px;color:var(--text-secondary)}.entry-table[data-v-1bfc907d]{background:var(--bg-secondary);border-radius:8px;border:1px solid var(--border-color);overflow:hidden}.table-header[data-v-1bfc907d]{display:flex;align-items:center;padding:12px 16px;background:var(--bg-tertiary);border-bottom:1px solid var(--border-color);font-size:13px;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.3px}.table-body[data-v-1bfc907d]{max-height:calc(100vh - 320px);overflow-y:auto}.table-row[data-v-1bfc907d]{border-bottom:1px solid var(--border-color)}.table-row[data-v-1bfc907d]:last-child{border-bottom:none}.table-row.is-expanded[data-v-1bfc907d]{background:var(--bg-color)}.row-main[data-v-1bfc907d]{display:flex;align-items:center;padding:12px 16px;cursor:pointer;transition:background .2s}.row-main[data-v-1bfc907d]:hover{background:var(--bg-hover)}.col-name[data-v-1bfc907d]{flex:2;display:flex;align-items:center;gap:12px;min-width:150px}.col-name .person-avatar[data-v-1bfc907d]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--primary-light);color:var(--primary-color);border-radius:50%;font-size:14px;font-weight:600}.col-name .person-name[data-v-1bfc907d]{font-weight:500;color:var(--text-color)}.col-summary[data-v-1bfc907d]{flex:1;min-width:100px}.col-summary .summary-value[data-v-1bfc907d]{font-size:13px;color:var(--text-secondary)}.col-action[data-v-1bfc907d]{width:80px;text-align:right}.col-action .expand-btn[data-v-1bfc907d]{font-size:12px;color:var(--primary-color);cursor:pointer}.col-action .expand-btn[data-v-1bfc907d]:hover{text-decoration:underline}.row-details[data-v-1bfc907d]{padding:0 16px 16px 16px}.details-content[data-v-1bfc907d]{background:var(--bg-tertiary);border-radius:8px;padding:16px}.detail-section[data-v-1bfc907d]{margin-bottom:20px}.detail-section[data-v-1bfc907d]:last-child{margin-bottom:0}.detail-section .section-title[data-v-1bfc907d]{margin:0 0 12px 0;font-size:14px;font-weight:600;color:var(--primary-color);padding-bottom:8px;border-bottom:1px solid var(--border-color)}.field-grid[data-v-1bfc907d]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px 16px}@media (max-width:768px){.panel-main[data-v-1bfc907d]{flex-direction:column}.category-sidebar[data-v-1bfc907d]{width:100%;min-width:auto;flex-direction:row;border-right:none;border-bottom:1px solid var(--border-color)}.category-sidebar .sidebar-header[data-v-1bfc907d]{display:none}.category-sidebar .category-list[data-v-1bfc907d]{display:flex;flex-wrap:nowrap;overflow-x:auto;padding:8px;gap:8px}.category-sidebar .category-item[data-v-1bfc907d]{flex-shrink:0;margin-bottom:0}.table-header[data-v-1bfc907d]{display:none}.row-main[data-v-1bfc907d]{flex-wrap:wrap;gap:8px}.col-name[data-v-1bfc907d]{flex:1 1 100%}.col-summary[data-v-1bfc907d]{flex:0 0 auto}.col-action[data-v-1bfc907d]{flex:0 0 auto;width:auto}.field-grid[data-v-1bfc907d]{grid-template-columns:1fr}}
.tree-node[data-v-644583f3]{margin:8px 0}.node-header[data-v-644583f3]{display:flex;align-items:center;gap:8px;cursor:pointer;padding:4px 8px;border-radius:var(--radius-sm,4px)}.node-header[data-v-644583f3]:hover{background:var(--bg-hover)}.expand-icon[data-v-644583f3],.expand-placeholder[data-v-644583f3]{width:16px;font-size:10px;color:var(--text-secondary);flex-shrink:0}.node-title[data-v-644583f3]{font-weight:600;color:var(--text-color)}.node-content[data-v-644583f3]{margin-top:8px;padding-left:24px;color:var(--text-color);line-height:1.8;text-align:justify;white-space:pre-wrap}.node-children[data-v-644583f3]{margin-left:16px;padding-left:8px;border-left:2px solid var(--border-color)}.depth-0 .node-title[data-v-644583f3]{font-size:20px;color:var(--primary-color)}.depth-1 .node-title[data-v-644583f3]{font-size:17px;color:var(--text-color)}.depth-2 .node-title[data-v-644583f3]{font-size:15px;color:var(--text-color)}.depth-3 .node-title[data-v-644583f3]{font-size:14px;color:var(--text-secondary)}.depth-4 .node-title[data-v-644583f3],.depth-5 .node-title[data-v-644583f3]{font-size:13px;color:var(--text-secondary)}
.document-panel[data-v-40ace65a]{display:flex;flex-direction:column;height:100%;background:var(--bg-secondary);border-radius:8px;overflow:hidden;color:var(--text-color)}.panel-header[data-v-40ace65a]{display:flex;align-items:center;padding:12px 16px;border-bottom:1px solid var(--border-color);background:var(--bg-tertiary)}.panel-header h2[data-v-40ace65a]{margin:0;font-size:18px;flex:1;color:var(--text-color)}.panel-header .doc-count[data-v-40ace65a]{margin-right:16px;font-size:14px;color:var(--text-secondary)}.panel-header .close-btn[data-v-40ace65a]{background:none;border:none;font-size:18px;cursor:pointer;padding:4px 8px;color:var(--text-secondary)}.panel-header .close-btn[data-v-40ace65a]:hover{color:var(--text-color)}.panel-main[data-v-40ace65a]{display:flex;flex:1;overflow:hidden}.document-sidebar[data-v-40ace65a]{width:220px;min-width:220px;background:var(--bg-tertiary);border-right:1px solid var(--border-color);display:flex;flex-direction:column;transition:width .25s ease,min-width .25s ease}.document-sidebar.collapsed[data-v-40ace65a]{width:50px;min-width:50px}.sidebar-header[data-v-40ace65a]{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border-color);background:var(--bg-secondary)}.sidebar-header .sidebar-title[data-v-40ace65a]{font-size:13px;font-weight:600;color:var(--text-color)}.sidebar-header .toggle-btn[data-v-40ace65a]{background:none;border:none;font-size:12px;cursor:pointer;padding:4px 6px;color:var(--text-secondary);border-radius:4px;transition:background .2s}.sidebar-header .toggle-btn[data-v-40ace65a]:hover{background:var(--bg-hover);color:var(--text-color)}.document-list[data-v-40ace65a]{flex:1;overflow-y:auto;padding:8px}.doc-item[data-v-40ace65a]{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;margin-bottom:6px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:6px;cursor:pointer;transition:all .2s ease}.doc-item .doc-icon[data-v-40ace65a]{font-size:16px;flex-shrink:0;margin-top:2px}.doc-item .doc-info[data-v-40ace65a]{flex:1;min-width:0;display:flex;flex-direction:column;gap:4px}.doc-item .doc-title[data-v-40ace65a]{font-size:13px;font-weight:500;color:var(--text-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.doc-item .doc-desc[data-v-40ace65a]{font-size:11px;color:var(--text-secondary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.doc-item[data-v-40ace65a]:hover{background:var(--bg-hover);border-color:var(--primary-color)}.doc-item.active[data-v-40ace65a]{background:var(--primary-light);border-color:var(--primary-color)}.doc-item.active .doc-title[data-v-40ace65a]{color:var(--primary-color);font-weight:600}.sidebar-empty[data-v-40ace65a]{padding:20px;text-align:center;color:var(--text-secondary);font-size:12px}.collapsed-list[data-v-40ace65a]{flex:1;overflow-y:auto;padding:8px 4px;display:flex;flex-direction:column;align-items:center;gap:6px}.collapsed-item[data-v-40ace65a]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:6px;cursor:pointer;font-size:16px;transition:all .2s ease}.collapsed-item[data-v-40ace65a]:hover{background:var(--bg-hover);border-color:var(--primary-color)}.collapsed-item.active[data-v-40ace65a]{background:var(--primary-light);border-color:var(--primary-color)}.panel-body[data-v-40ace65a]{flex:1;overflow-y:auto;padding:16px;background:var(--bg-color)}.loading-state[data-v-40ace65a],.error-state[data-v-40ace65a],.empty-state[data-v-40ace65a]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;color:var(--text-secondary);height:100%}.loading-state button[data-v-40ace65a],.error-state button[data-v-40ace65a],.empty-state button[data-v-40ace65a]{margin-top:16px;padding:8px 16px;background:var(--primary-color);color:#fff;border:none;border-radius:4px;cursor:pointer}.loading-state button[data-v-40ace65a]:hover,.error-state button[data-v-40ace65a]:hover,.empty-state button[data-v-40ace65a]:hover{background:var(--primary-hover)}.loading-state .empty-hint[data-v-40ace65a],.error-state .empty-hint[data-v-40ace65a],.empty-state .empty-hint[data-v-40ace65a]{font-size:12px;margin-top:8px;color:var(--text-disabled)}.loading-state .empty-hint code[data-v-40ace65a],.error-state .empty-hint code[data-v-40ace65a],.empty-state .empty-hint code[data-v-40ace65a]{background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;font-family:monospace;color:var(--text-color)}.document-content[data-v-40ace65a]{padding:8px}.current-doc-header[data-v-40ace65a]{display:flex;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid var(--primary-color)}.current-doc-header .current-doc-title[data-v-40ace65a]{margin:0;font-size:20px;color:var(--text-color);flex:1}.current-doc-header .section-count[data-v-40ace65a]{font-size:14px;color:var(--text-secondary);background:var(--bg-tertiary);padding:4px 10px;border-radius:12px}.document-description[data-v-40ace65a]{margin-bottom:24px;padding:16px;background:var(--bg-tertiary);border-radius:8px;color:var(--text-secondary);line-height:1.6;font-style:italic;border-left:4px solid var(--primary-color)}@media (max-width:768px){.panel-header[data-v-40ace65a]{padding:10px 12px}.panel-header h2[data-v-40ace65a]{font-size:16px}.panel-header .doc-count[data-v-40ace65a]{font-size:12px}.document-sidebar[data-v-40ace65a]{width:180px;min-width:180px}.document-sidebar.collapsed[data-v-40ace65a]{width:44px;min-width:44px}.sidebar-header[data-v-40ace65a]{padding:8px 10px}.sidebar-header .sidebar-title[data-v-40ace65a]{font-size:12px}.doc-item[data-v-40ace65a]{padding:8px 10px}.doc-item .doc-title[data-v-40ace65a]{font-size:12px}.doc-item .doc-desc[data-v-40ace65a]{font-size:10px}.panel-body[data-v-40ace65a]{padding:12px}.current-doc-header .current-doc-title[data-v-40ace65a]{font-size:18px}.current-doc-header .section-count[data-v-40ace65a]{font-size:12px;padding:3px 8px}}@media (max-width:480px){.document-sidebar[data-v-40ace65a]{width:44px;min-width:44px}.document-sidebar[data-v-40ace65a]:not(.collapsed){position:absolute;left:0;top:0;bottom:0;width:200px;min-width:200px;z-index:10;box-shadow:2px 0 8px rgba(0,0,0,.15)}.panel-main[data-v-40ace65a]{position:relative}.collapsed-item[data-v-40ace65a]{width:32px;height:32px;font-size:14px}}
.history-text-panel[data-v-9256f22a]{display:flex;flex-direction:column;width:100%;height:100%;background:var(--bg-secondary);border-radius:var(--radius-md);overflow:hidden}.panel-header[data-v-9256f22a]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:linear-gradient(135deg,#3b82f6 0%,#1d4ed8 100%);color:#fff;flex-shrink:0}.header-left[data-v-9256f22a]{display:flex;align-items:center;gap:10px}.panel-icon[data-v-9256f22a]{font-size:20px}.panel-title[data-v-9256f22a]{margin:0;font-size:16px;font-weight:600}.text-count[data-v-9256f22a]{padding:3px 10px;font-size:11px;font-weight:500;background:hsla(0,0%,100%,.2);border-radius:10px}.header-actions[data-v-9256f22a]{display:flex;align-items:center;gap:8px}.btn-refresh[data-v-9256f22a],.btn-close[data-v-9256f22a]{width:30px;height:30px;display:flex;align-items:center;justify-content:center;background:hsla(0,0%,100%,.1);border:none;color:#fff;font-size:14px;cursor:pointer;border-radius:4px;transition:all .2s ease}.btn-refresh[data-v-9256f22a]:hover:not(:disabled),.btn-close[data-v-9256f22a]:hover:not(:disabled){background:hsla(0,0%,100%,.25)}.btn-refresh[data-v-9256f22a]:disabled,.btn-close[data-v-9256f22a]:disabled{opacity:.4;cursor:not-allowed}.search-bar[data-v-9256f22a]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border-bottom:1px solid var(--border-color);flex-shrink:0}.search-input[data-v-9256f22a]{flex:1;padding:8px 12px;background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:var(--font-sm);color:var(--text-color);outline:none;transition:border-color var(--transition-fast)}.search-input[data-v-9256f22a]:focus{border-color:var(--primary-color)}.search-input[data-v-9256f22a]::placeholder{color:var(--text-muted)}.search-result-count[data-v-9256f22a]{font-size:var(--font-xs);color:var(--text-secondary);white-space:nowrap}.panel-body[data-v-9256f22a]{flex:1;overflow-y:auto;min-height:0}.panel-body[data-v-9256f22a]::-webkit-scrollbar{width:6px}.panel-body[data-v-9256f22a]::-webkit-scrollbar-track{background:var(--bg-tertiary)}.panel-body[data-v-9256f22a]::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:3px}.panel-body[data-v-9256f22a]::-webkit-scrollbar-thumb:hover{background:var(--border-hover)}.state-container[data-v-9256f22a]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 40px;gap:var(--spacing-md)}.state-icon[data-v-9256f22a]{font-size:48px;opacity:.4}.state-text[data-v-9256f22a]{font-size:var(--font-md);color:var(--text-secondary)}.state-hint[data-v-9256f22a]{margin:0;font-size:var(--font-sm);color:var(--text-muted)}.loading-spinner[data-v-9256f22a]{animation:spin-9256f22a 1s linear infinite}@keyframes spin-9256f22a{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.error-icon[data-v-9256f22a]{color:var(--error-color)}.error-state .state-text[data-v-9256f22a]{color:var(--error-color)}.text-list[data-v-9256f22a]{padding:var(--spacing-sm)}.text-item[data-v-9256f22a]{margin-bottom:var(--spacing-sm);background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-sm);overflow:hidden;transition:all var(--transition-fast)}.text-item[data-v-9256f22a]:hover{border-color:var(--border-hover)}.text-item.is-expanded[data-v-9256f22a]{border-color:var(--primary-color);box-shadow:0 2px 8px rgba(59,130,246,.15)}.text-header[data-v-9256f22a]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-sm) var(--spacing-md);cursor:pointer;transition:background var(--transition-fast)}.text-header[data-v-9256f22a]:hover{background:var(--bg-hover)}.text-meta[data-v-9256f22a]{display:flex;align-items:center;gap:var(--spacing-sm);flex:1;min-width:0}.text-number[data-v-9256f22a]{font-size:var(--font-xs);font-weight:600;color:var(--primary-color);padding:2px 6px;background:var(--primary-light);border-radius:var(--radius-xs);flex-shrink:0}.text-preview[data-v-9256f22a]{font-size:var(--font-sm);color:var(--text-secondary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.expand-icon[data-v-9256f22a]{font-size:10px;color:var(--text-muted);flex-shrink:0}.text-content[data-v-9256f22a]{padding:var(--spacing-md);border-top:1px solid var(--border-color);background:var(--bg-tertiary)}.content-body[data-v-9256f22a]{font-size:var(--font-sm);line-height:1.8;color:var(--text-color);white-space:pre-wrap;word-break:break-word}.content-actions[data-v-9256f22a]{display:flex;justify-content:flex-end;margin-top:var(--spacing-md);padding-top:var(--spacing-sm);border-top:1px solid var(--border-light)}.btn-action[data-v-9256f22a]{padding:4px 10px;font-size:var(--font-xs);background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-xs);color:var(--text-secondary);cursor:pointer;transition:all var(--transition-fast)}.btn-action[data-v-9256f22a]:hover{background:var(--bg-hover);border-color:var(--border-hover);color:var(--text-color)}.panel-footer[data-v-9256f22a]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border-top:1px solid var(--border-color);flex-shrink:0}.footer-info .info-text[data-v-9256f22a]{font-size:var(--font-xs);color:var(--text-muted)}.footer-actions[data-v-9256f22a]{display:flex;gap:var(--spacing-xs)}.btn[data-v-9256f22a]{padding:6px 12px;border:none;border-radius:var(--radius-sm);font-size:var(--font-xs);font-weight:500;cursor:pointer;transition:all var(--transition-fast)}.btn[data-v-9256f22a]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[data-v-9256f22a]{background:var(--bg-color);color:var(--text-secondary);border:1px solid var(--border-color)}.btn-secondary[data-v-9256f22a]:hover:not(:disabled){background:var(--bg-hover);border-color:var(--border-hover);color:var(--text-color)}@media (max-width:768px){.history-text-panel[data-v-9256f22a]{border-radius:var(--radius-sm)}.panel-header[data-v-9256f22a]{padding:10px 12px}.header-left[data-v-9256f22a]{gap:6px}.panel-icon[data-v-9256f22a]{font-size:16px}.panel-title[data-v-9256f22a]{font-size:14px}.text-count[data-v-9256f22a]{padding:2px 8px;font-size:10px}.btn-refresh[data-v-9256f22a],.btn-close[data-v-9256f22a]{width:26px;height:26px;font-size:12px}.search-bar[data-v-9256f22a]{padding:var(--spacing-xs) var(--spacing-sm)}.search-input[data-v-9256f22a]{padding:6px 10px;font-size:12px}.search-result-count[data-v-9256f22a]{font-size:10px}.text-list[data-v-9256f22a]{padding:var(--spacing-xs)}.text-item[data-v-9256f22a]{margin-bottom:var(--spacing-xs)}.text-header[data-v-9256f22a]{padding:var(--spacing-xs) var(--spacing-sm)}.text-number[data-v-9256f22a]{font-size:10px;padding:1px 4px}.text-preview[data-v-9256f22a]{font-size:11px}.text-content[data-v-9256f22a]{padding:var(--spacing-sm)}.content-body[data-v-9256f22a]{font-size:12px;line-height:1.6}.panel-footer[data-v-9256f22a]{flex-direction:column;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm)}.footer-actions[data-v-9256f22a]{width:100%;justify-content:center}.btn[data-v-9256f22a]{padding:5px 10px;font-size:11px}.state-container[data-v-9256f22a]{padding:40px 20px}.state-icon[data-v-9256f22a]{font-size:36px}.state-text[data-v-9256f22a]{font-size:13px}}@media (max-width:480px){.panel-header[data-v-9256f22a]{padding:8px 10px}.header-left[data-v-9256f22a]{gap:4px}.panel-icon[data-v-9256f22a]{font-size:14px}.panel-title[data-v-9256f22a]{font-size:13px}.text-count[data-v-9256f22a]{display:none}.header-actions[data-v-9256f22a]{gap:4px}.btn-refresh[data-v-9256f22a],.btn-close[data-v-9256f22a]{width:24px;height:24px;font-size:11px}.search-bar[data-v-9256f22a]{padding:4px 8px}.search-input[data-v-9256f22a]{padding:5px 8px;font-size:11px}.text-list[data-v-9256f22a]{padding:4px}.text-header[data-v-9256f22a]{padding:6px 8px}.text-meta[data-v-9256f22a]{gap:4px}.text-number[data-v-9256f22a]{font-size:9px}.text-preview[data-v-9256f22a]{font-size:10px}.expand-icon[data-v-9256f22a]{font-size:8px}.text-content[data-v-9256f22a]{padding:8px}.content-body[data-v-9256f22a]{font-size:11px;line-height:1.5}.content-actions[data-v-9256f22a]{margin-top:8px;padding-top:6px}.btn-action[data-v-9256f22a]{padding:3px 8px;font-size:10px}.panel-footer[data-v-9256f22a]{padding:6px 8px}.footer-info .info-text[data-v-9256f22a]{font-size:10px}.footer-actions .btn[data-v-9256f22a]{padding:4px 8px;font-size:10px}.state-container[data-v-9256f22a]{padding:30px 15px}.state-icon[data-v-9256f22a]{font-size:32px}.state-text[data-v-9256f22a]{font-size:12px}.state-hint[data-v-9256f22a]{font-size:11px}}
.auto-save-settings[data-v-1d1dfdc8]{padding:var(--spacing-sm)}.settings-title[data-v-1d1dfdc8]{margin:0 0 var(--spacing-md) 0;font-size:var(--font-md);font-weight:600;color:var(--text-color);border-bottom:1px solid var(--border-light);padding-bottom:var(--spacing-sm)}.setting-item[data-v-1d1dfdc8]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:var(--radius-md);margin-bottom:var(--spacing-sm);transition:all var(--transition-fast)}.setting-item[data-v-1d1dfdc8]:hover:not(.disabled){border-color:var(--border-hover)}.setting-item.disabled[data-v-1d1dfdc8]{opacity:.5;background:var(--bg-tertiary)}.setting-info[data-v-1d1dfdc8]{flex:1;margin-right:var(--spacing-md)}.setting-label[data-v-1d1dfdc8]{font-size:var(--font-sm);font-weight:500;color:var(--text-color);margin-bottom:var(--spacing-xs)}.setting-desc[data-v-1d1dfdc8]{font-size:var(--font-xs);color:var(--text-secondary);line-height:1.5}.setting-control[data-v-1d1dfdc8]{display:flex;align-items:center;gap:var(--spacing-sm)}.number-input[data-v-1d1dfdc8],.text-input[data-v-1d1dfdc8]{padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-color);font-size:var(--font-sm);transition:all var(--transition-fast)}.number-input[data-v-1d1dfdc8]:focus,.text-input[data-v-1d1dfdc8]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px var(--primary-light)}.number-input[data-v-1d1dfdc8]:disabled,.text-input[data-v-1d1dfdc8]:disabled{opacity:.5;cursor:not-allowed;background:var(--bg-tertiary)}.number-input[data-v-1d1dfdc8]{width:80px;text-align:center}.text-input[data-v-1d1dfdc8]{width:120px}.unit[data-v-1d1dfdc8]{font-size:var(--font-xs);color:var(--text-secondary)}.toggle-switch[data-v-1d1dfdc8]{position:relative;display:inline-block;width:48px;height:26px}.toggle-switch input[data-v-1d1dfdc8]{opacity:0;width:0;height:0}.toggle-switch input:checked+.toggle-slider[data-v-1d1dfdc8]{background:var(--primary-color)}.toggle-switch input:checked+.toggle-slider[data-v-1d1dfdc8]::before{transform:translateX(22px)}.toggle-switch input:disabled+.toggle-slider[data-v-1d1dfdc8]{opacity:.5;cursor:not-allowed}.toggle-slider[data-v-1d1dfdc8]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:var(--bg-tertiary);border-radius:26px;transition:all var(--transition-normal);border:1px solid var(--border-color)}.toggle-slider[data-v-1d1dfdc8]::before{position:absolute;content:"";height:20px;width:20px;left:2px;bottom:2px;background:#fff;border-radius:50%;transition:all var(--transition-normal);box-shadow:var(--shadow-sm)}.setting-actions[data-v-1d1dfdc8]{display:flex;justify-content:flex-end;margin-top:var(--spacing-md);padding-top:var(--spacing-md);border-top:1px solid var(--border-light)}.status-section[data-v-1d1dfdc8]{margin-top:var(--spacing-lg);padding:var(--spacing-md);background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:var(--radius-md)}.status-title[data-v-1d1dfdc8]{margin:0 0 var(--spacing-sm) 0;font-size:var(--font-sm);font-weight:600;color:var(--text-color)}.status-items[data-v-1d1dfdc8]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.status-item[data-v-1d1dfdc8]{display:flex;align-items:center;gap:var(--spacing-sm);font-size:var(--font-sm)}.status-label[data-v-1d1dfdc8]{color:var(--text-secondary)}.status-value[data-v-1d1dfdc8]{color:var(--text-color);font-weight:500}.status-value.active[data-v-1d1dfdc8]{color:var(--success-color)}.info-section[data-v-1d1dfdc8]{margin-top:var(--spacing-md);padding:var(--spacing-md);background:var(--info-light);border:1px solid var(--info-color);border-radius:var(--radius-md)}.info-title[data-v-1d1dfdc8]{margin:0 0 var(--spacing-sm) 0;font-size:var(--font-sm);font-weight:600;color:var(--info-color)}.info-list[data-v-1d1dfdc8]{margin:0;padding-left:var(--spacing-lg);font-size:var(--font-xs);color:var(--text-secondary);line-height:1.8}.info-list li[data-v-1d1dfdc8]{margin-bottom:var(--spacing-xs)}.btn[data-v-1d1dfdc8]{display:inline-flex;align-items:center;justify-content:center;padding:var(--spacing-sm) var(--spacing-md);border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:var(--font-sm);font-weight:500;transition:all var(--transition-fast)}.btn.btn-secondary[data-v-1d1dfdc8]{background:var(--bg-secondary);color:var(--text-color);border:1px solid var(--border-color)}.btn.btn-secondary[data-v-1d1dfdc8]:hover{background:var(--bg-hover);border-color:var(--border-hover)}@media (max-width:768px){.setting-item[data-v-1d1dfdc8]{flex-direction:column;align-items:flex-start;gap:var(--spacing-sm)}.setting-info[data-v-1d1dfdc8]{margin-right:0}.setting-control[data-v-1d1dfdc8]{width:100%;justify-content:flex-end}}
.save-manager[data-v-63e5f2b9]{display:flex;flex-direction:column;height:100%;background:var(--bg-secondary);color:var(--text-color);border-radius:var(--radius-lg);overflow:hidden}.save-header[data-v-63e5f2b9]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background:var(--bg-tertiary);border-bottom:1px solid var(--border-color)}.save-title[data-v-63e5f2b9]{margin:0;font-size:var(--font-lg);font-weight:600;display:flex;align-items:center;gap:var(--spacing-sm);color:var(--text-color)}.save-title .icon[data-v-63e5f2b9]{font-size:var(--font-xl)}.header-actions[data-v-63e5f2b9]{display:flex;gap:var(--spacing-xs)}.save-stats[data-v-63e5f2b9]{display:flex;gap:var(--spacing-lg);padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-color);border-bottom:1px solid var(--border-light)}.stat-item[data-v-63e5f2b9]{display:flex;flex-direction:column;align-items:center;gap:2px}.stat-item .stat-label[data-v-63e5f2b9]{font-size:var(--font-xs);color:var(--text-secondary)}.stat-item .stat-value[data-v-63e5f2b9]{font-size:var(--font-lg);font-weight:600;color:var(--primary-color)}.tab-bar[data-v-63e5f2b9]{display:flex;background:var(--bg-secondary);border-bottom:1px solid var(--border-color)}.tab-btn[data-v-63e5f2b9]{flex:1;padding:var(--spacing-sm) var(--spacing-md);background:rgba(0,0,0,0);border:none;border-bottom:2px solid rgba(0,0,0,0);color:var(--text-secondary);font-size:var(--font-sm);cursor:pointer;transition:all var(--transition-fast)}.tab-btn[data-v-63e5f2b9]:hover{background:var(--bg-hover);color:var(--text-color)}.tab-btn.active[data-v-63e5f2b9]{color:var(--primary-color);border-bottom-color:var(--primary-color);background:var(--primary-light);font-weight:500}.save-content[data-v-63e5f2b9]{flex:1;overflow-y:auto;padding:var(--spacing-md);background:var(--bg-color)}.save-list-container[data-v-63e5f2b9]{display:flex;flex-direction:column;gap:var(--spacing-md)}.create-save-section[data-v-63e5f2b9]{display:flex;gap:var(--spacing-sm)}.save-name-input[data-v-63e5f2b9]{flex:1;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-color);font-size:var(--font-sm);transition:border-color var(--transition-fast)}.save-name-input[data-v-63e5f2b9]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px var(--primary-light)}.save-name-input[data-v-63e5f2b9]::placeholder{color:var(--text-disabled)}.auto-save-actions[data-v-63e5f2b9]{display:flex;gap:var(--spacing-sm)}.save-list[data-v-63e5f2b9]{display:flex;flex-direction:column;gap:var(--spacing-sm)}.save-item[data-v-63e5f2b9]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:var(--radius-md);transition:all var(--transition-fast)}.save-item[data-v-63e5f2b9]:hover{border-color:var(--primary-color);box-shadow:var(--shadow-sm)}.save-item.active[data-v-63e5f2b9]{border-color:var(--primary-color);background:var(--primary-light)}.save-item.auto-save[data-v-63e5f2b9]{border-left:3px solid var(--warning-color)}.save-info[data-v-63e5f2b9]{flex:1;min-width:0}.save-name[data-v-63e5f2b9]{font-weight:500;font-size:var(--font-sm);margin-bottom:var(--spacing-xs);display:flex;align-items:center;gap:var(--spacing-sm);color:var(--text-color)}.auto-badge[data-v-63e5f2b9]{font-size:10px;padding:2px 6px;background:var(--warning-color);color:var(--text-highlight);border-radius:var(--radius-xs);font-weight:500}.save-time[data-v-63e5f2b9]{font-size:var(--font-xs);color:var(--text-secondary);display:flex;flex-wrap:wrap;gap:var(--spacing-sm)}.save-source[data-v-63e5f2b9]{color:var(--primary-color)}.save-actions[data-v-63e5f2b9]{display:flex;gap:var(--spacing-xs)}.empty-state[data-v-63e5f2b9]{text-align:center;padding:var(--spacing-xxl) var(--spacing-lg);color:var(--text-secondary)}.empty-state p[data-v-63e5f2b9]{margin:0}.empty-state .hint[data-v-63e5f2b9]{font-size:var(--font-xs);margin-top:var(--spacing-sm);color:var(--text-disabled)}.save-footer[data-v-63e5f2b9]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border-top:1px solid var(--border-color)}.footer-left[data-v-63e5f2b9],.footer-right[data-v-63e5f2b9]{display:flex;gap:var(--spacing-sm)}.import-btn[data-v-63e5f2b9]{cursor:pointer}.error-message[data-v-63e5f2b9]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-sm) var(--spacing-md);background:var(--error-light);color:var(--error-color);border-top:1px solid var(--error-color);font-size:var(--font-sm)}.btn-close[data-v-63e5f2b9]{background:none;border:none;color:inherit;font-size:var(--font-lg);cursor:pointer;padding:var(--spacing-xs);border-radius:var(--radius-xs);transition:background var(--transition-fast)}.btn-close[data-v-63e5f2b9]:hover{background:rgba(0,0,0,.1)}.btn[data-v-63e5f2b9]{display:inline-flex;align-items:center;justify-content:center;padding:var(--spacing-sm) var(--spacing-md);border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:var(--font-sm);font-weight:500;transition:all var(--transition-fast)}.btn[data-v-63e5f2b9]:disabled{opacity:.5;cursor:not-allowed}.btn.btn-primary[data-v-63e5f2b9]{background:var(--primary-color);color:#fff}.btn.btn-primary[data-v-63e5f2b9]:hover:not(:disabled){background:var(--primary-hover)}.btn.btn-primary[data-v-63e5f2b9]:active:not(:disabled){background:var(--primary-active)}.btn.btn-secondary[data-v-63e5f2b9]{background:var(--bg-secondary);color:var(--text-color);border:1px solid var(--border-color)}.btn.btn-secondary[data-v-63e5f2b9]:hover:not(:disabled){background:var(--bg-hover);border-color:var(--border-hover)}.btn.btn-danger[data-v-63e5f2b9]{background:var(--error-color);color:#fff}.btn.btn-danger[data-v-63e5f2b9]:hover:not(:disabled){background:var(--error-hover)}.btn.btn-sm[data-v-63e5f2b9]{padding:var(--spacing-xs) var(--spacing-sm);font-size:var(--font-xs)}.btn.btn-icon[data-v-63e5f2b9]{padding:var(--spacing-xs) var(--spacing-sm);background:rgba(0,0,0,0);color:var(--text-secondary)}.btn.btn-icon[data-v-63e5f2b9]:hover:not(:disabled){background:var(--bg-hover);color:var(--text-color)}.spinning[data-v-63e5f2b9]{display:inline-block;animation:spin-63e5f2b9 1s linear infinite}@keyframes spin-63e5f2b9{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.confirm-overlay[data-v-63e5f2b9]{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);backdrop-filter:blur(2px);display:flex;justify-content:center;align-items:center;z-index:var(--z-modal)}.confirm-dialog[data-v-63e5f2b9]{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:var(--spacing-lg);min-width:300px;max-width:400px;box-shadow:var(--shadow-lg)}.confirm-title[data-v-63e5f2b9]{font-size:var(--font-lg);font-weight:600;margin-bottom:var(--spacing-sm);color:var(--text-color)}.confirm-message[data-v-63e5f2b9]{color:var(--text-secondary);margin-bottom:var(--spacing-lg);line-height:1.6;font-size:var(--font-sm)}.confirm-actions[data-v-63e5f2b9]{display:flex;justify-content:flex-end;gap:var(--spacing-sm)}@media (max-width:768px){.save-stats[data-v-63e5f2b9]{justify-content:space-around}.save-item[data-v-63e5f2b9]{flex-direction:column;align-items:flex-start;gap:var(--spacing-sm)}.save-actions[data-v-63e5f2b9]{width:100%;justify-content:flex-end}.save-footer[data-v-63e5f2b9]{flex-direction:column;gap:var(--spacing-sm)}.footer-left[data-v-63e5f2b9],.footer-right[data-v-63e5f2b9]{width:100%;justify-content:center}}
.context-manager-panel[data-v-71562640]{display:flex;flex-direction:column;height:100%;background:var(--bg-secondary);color:var(--text-color)}.panel-header[data-v-71562640]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md) var(--spacing-lg);border-bottom:1px solid var(--border-color);flex-shrink:0}.panel-header h3[data-v-71562640]{margin:0;font-size:var(--font-lg);display:flex;align-items:center;gap:var(--spacing-sm)}.btn-close[data-v-71562640]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--text-secondary);font-size:var(--font-lg);cursor:pointer;border-radius:var(--radius-sm);transition:all var(--transition-fast)}.btn-close[data-v-71562640]:hover{background:var(--bg-hover);color:var(--text-color)}.panel-body[data-v-71562640]{flex:1;overflow-y:auto;padding:var(--spacing-md);display:flex;flex-direction:column;gap:var(--spacing-md)}.section-title[data-v-71562640]{font-size:var(--font-sm);font-weight:600;color:var(--text-color);margin-bottom:var(--spacing-sm);display:flex;align-items:center;gap:var(--spacing-xs)}.stats-section[data-v-71562640]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);padding:var(--spacing-md)}.stats-grid[data-v-71562640]{display:grid;grid-template-columns:repeat(2,1fr);gap:var(--spacing-sm)}.stat-item[data-v-71562640]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-secondary);border-radius:var(--radius-xs)}.stat-item .stat-label[data-v-71562640]{font-size:var(--font-xs);color:var(--text-secondary)}.stat-item .stat-value[data-v-71562640]{font-size:var(--font-sm);font-weight:600;color:var(--primary-color)}.last-update[data-v-71562640]{margin-top:var(--spacing-sm);font-size:10px;color:var(--text-muted);text-align:right}.enable-section[data-v-71562640]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);padding:var(--spacing-md)}.enable-row[data-v-71562640]{display:flex;justify-content:space-between;align-items:center;margin-top:var(--spacing-sm)}.enable-label[data-v-71562640]{font-size:var(--font-sm);color:var(--text-color)}.toggle-switch[data-v-71562640]{position:relative;display:inline-block;width:44px;height:22px}.toggle-switch input[data-v-71562640]{opacity:0;width:0;height:0}.toggle-slider[data-v-71562640]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--bg-tertiary,#555);transition:.3s;border-radius:22px}.toggle-slider[data-v-71562640]:before{position:absolute;content:"";height:16px;width:16px;left:3px;bottom:3px;background-color:#fff;transition:.3s;border-radius:50%}input:checked+.toggle-slider[data-v-71562640]{background-color:var(--success-color,#4ade80)}input:disabled+.toggle-slider[data-v-71562640]{opacity:.5;cursor:not-allowed}input:checked+.toggle-slider[data-v-71562640]:before{transform:translateX(22px)}.enable-status[data-v-71562640]{margin-top:var(--spacing-sm);padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--radius-xs);font-size:var(--font-xs);text-align:center}.enable-status.enabled[data-v-71562640]{background:rgba(74,222,128,.1);color:var(--success-color,#4ade80)}.enable-status.disabled[data-v-71562640]{background:rgba(251,191,36,.1);color:var(--warning-color,#fbbf24)}.mode-section[data-v-71562640]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);padding:var(--spacing-md)}.mode-selector[data-v-71562640]{display:flex;gap:var(--spacing-sm)}.mode-option[data-v-71562640]{flex:1;display:flex;align-items:center;justify-content:center;gap:var(--spacing-xs);padding:var(--spacing-sm);background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--transition-fast);font-size:var(--font-sm)}.mode-option input[data-v-71562640]{display:none}.mode-option[data-v-71562640]:hover:not(.disabled){border-color:var(--primary-color)}.mode-option.active[data-v-71562640]{background:var(--primary-light);border-color:var(--primary-color);color:var(--primary-color);font-weight:500}.mode-option.disabled[data-v-71562640]{opacity:.5;cursor:not-allowed}.config-section[data-v-71562640]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);padding:var(--spacing-md)}.config-item[data-v-71562640]{margin-bottom:var(--spacing-md)}.config-item[data-v-71562640]:last-child{margin-bottom:0}.config-item label[data-v-71562640]{display:block;font-size:var(--font-sm);color:var(--text-color);margin-bottom:var(--spacing-xs)}.config-control[data-v-71562640]{display:flex;gap:var(--spacing-xs)}.config-input[data-v-71562640]{flex:1;padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-color);font-size:var(--font-sm)}.config-input[data-v-71562640]:focus{outline:none;border-color:var(--primary-color)}.btn-apply[data-v-71562640]{padding:var(--spacing-xs) var(--spacing-md);background:var(--primary-color);color:#fff;border:none;border-radius:var(--radius-sm);font-size:var(--font-xs);cursor:pointer;transition:all var(--transition-fast)}.btn-apply[data-v-71562640]:hover:not(:disabled){background:var(--primary-hover)}.btn-apply[data-v-71562640]:disabled{opacity:.5;cursor:not-allowed}.config-hint[data-v-71562640]{display:block;margin-top:4px;font-size:10px;color:var(--text-muted)}.actions-section[data-v-71562640]{background:var(--bg-color);border:1px solid var(--border-light);border-radius:var(--radius-sm);padding:var(--spacing-md)}.action-buttons[data-v-71562640]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.btn[data-v-71562640]{padding:var(--spacing-sm) var(--spacing-md);border:none;border-radius:var(--radius-sm);font-size:var(--font-sm);cursor:pointer;transition:all var(--transition-fast)}.btn[data-v-71562640]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[data-v-71562640]{background:var(--primary-color);color:#fff}.btn-primary[data-v-71562640]:hover:not(:disabled){background:var(--primary-hover)}.btn-secondary[data-v-71562640]{background:var(--bg-secondary);color:var(--text-color);border:1px solid var(--border-color)}.btn-secondary[data-v-71562640]:hover:not(:disabled){background:var(--bg-hover)}.btn-danger[data-v-71562640]{background:var(--error-color);color:#fff}.btn-danger[data-v-71562640]:hover:not(:disabled){opacity:.9}.btn-danger-outline[data-v-71562640]{background:rgba(0,0,0,0);color:var(--error-color);border:1px solid var(--error-color)}.btn-danger-outline[data-v-71562640]:hover:not(:disabled){background:rgba(244,67,54,.1)}.error-message[data-v-71562640]{padding:var(--spacing-sm) var(--spacing-md);background:rgba(244,67,54,.1);border:1px solid var(--error-color);border-radius:var(--radius-sm);color:var(--error-color);font-size:var(--font-sm)}
.placeholder-panel[data-v-4a22a9d8]{flex:1;display:flex;align-items:center;justify-content:center;background:var(--bg-color)}.placeholder-content[data-v-4a22a9d8]{text-align:center;padding:var(--spacing-xl)}.placeholder-content .placeholder-icon[data-v-4a22a9d8]{font-size:48px;margin-bottom:var(--spacing-md)}.placeholder-content h3[data-v-4a22a9d8]{margin:0 0 var(--spacing-sm);color:var(--text-color);font-size:var(--font-lg)}.placeholder-content p[data-v-4a22a9d8]{margin:0 0 var(--spacing-lg);color:var(--text-secondary);font-size:var(--font-sm)}.game-layout[data-v-4a22a9d8]{display:flex;flex-direction:column;width:100%;height:100%;background:var(--bg-color);overflow:hidden}.game-layout.is-fullscreen[data-v-4a22a9d8]{position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999}.main-area[data-v-4a22a9d8]{flex:1;display:flex;overflow:hidden;min-height:0}.modal-overlay[data-v-4a22a9d8]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:var(--z-modal);animation:fadeIn-4a22a9d8 .2s ease}@keyframes fadeIn-4a22a9d8{from{opacity:0}to{opacity:1}}.modal[data-v-4a22a9d8]{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);width:90%;max-width:480px;max-height:80vh;box-shadow:var(--shadow-lg);animation:slideUp-4a22a9d8 .3s ease;display:flex;flex-direction:column}@keyframes slideUp-4a22a9d8{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.modal-header[data-v-4a22a9d8]{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md) var(--spacing-lg);border-bottom:1px solid var(--border-color);flex-shrink:0}.modal-header h3[data-v-4a22a9d8]{margin:0;font-size:var(--font-lg);color:var(--text-color);display:flex;align-items:center;gap:var(--spacing-sm)}.btn-close[data-v-4a22a9d8]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--text-secondary);font-size:var(--font-lg);cursor:pointer;border-radius:var(--radius-sm);transition:all var(--transition-fast)}.btn-close[data-v-4a22a9d8]:hover{background:var(--bg-hover);color:var(--text-color)}.modal-body[data-v-4a22a9d8]{padding:var(--spacing-lg);overflow-y:auto;flex:1}.modal-footer[data-v-4a22a9d8]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-md) var(--spacing-lg);border-top:1px solid var(--border-color);flex-shrink:0}.help-overlay[data-v-4a22a9d8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10004 !important}.help-overlay .help-modal[data-v-4a22a9d8]{width:90%;max-width:480px;max-height:60vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg)}.help-modal[data-v-4a22a9d8]{max-width:480px}.help-steps[data-v-4a22a9d8]{margin:0;padding-left:var(--spacing-lg);counter-reset:step-counter}.help-steps li[data-v-4a22a9d8]{font-size:var(--font-sm);color:var(--text-color);line-height:1.8;margin-bottom:var(--spacing-sm);padding-left:var(--spacing-xs)}.help-steps li[data-v-4a22a9d8]:last-child{margin-bottom:0}.help-steps li strong[data-v-4a22a9d8]{color:var(--primary-color);font-weight:600}.help-section[data-v-4a22a9d8]{margin-bottom:var(--spacing-lg)}.help-section[data-v-4a22a9d8]:last-child{margin-bottom:0}.help-section h4[data-v-4a22a9d8]{margin:0 0 var(--spacing-sm);font-size:var(--font-md);color:var(--text-color);display:flex;align-items:center;gap:var(--spacing-xs)}.help-section p[data-v-4a22a9d8]{margin:0;font-size:var(--font-sm);color:var(--text-secondary);line-height:1.6}.help-section ul[data-v-4a22a9d8]{margin:0;padding-left:var(--spacing-lg)}.help-section ul li[data-v-4a22a9d8]{font-size:var(--font-sm);color:var(--text-secondary);line-height:1.8}.help-section ul li strong[data-v-4a22a9d8]{color:var(--text-color)}.btn[data-v-4a22a9d8]{padding:var(--spacing-sm) var(--spacing-lg);border:none;border-radius:var(--radius-sm);font-size:var(--font-sm);font-weight:500;cursor:pointer;transition:all var(--transition-fast)}.btn[data-v-4a22a9d8]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[data-v-4a22a9d8]{background:var(--primary-color);color:#fff}.btn-primary[data-v-4a22a9d8]:hover:not(:disabled){background:var(--primary-hover)}.btn-primary[data-v-4a22a9d8]:active:not(:disabled){background:var(--primary-active)}.btn-secondary[data-v-4a22a9d8]{background:var(--bg-color);color:var(--text-color);border:1px solid var(--border-color)}.btn-secondary[data-v-4a22a9d8]:hover:not(:disabled){background:var(--bg-hover);border-color:var(--border-hover)}.fullscreen-modal[data-v-4a22a9d8]{padding:var(--spacing-lg);z-index:10000 !important}.fullscreen-modal .ai-filter-modal[data-v-4a22a9d8]{width:100%;max-width:1400px;height:90vh;max-height:none;display:flex;flex-direction:column}.context-manager-overlay[data-v-4a22a9d8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10001 !important}.context-manager-overlay .context-manager-modal[data-v-4a22a9d8]{width:90%;max-width:520px;max-height:85vh;height:auto;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg)}.context-manager-overlay .context-manager-modal .modal-body[data-v-4a22a9d8]{padding:0}.save-manager-overlay[data-v-4a22a9d8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10002 !important}.save-manager-overlay .save-manager-modal[data-v-4a22a9d8]{width:90%;max-width:600px;max-height:85vh;height:80vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);overflow:hidden}.history-text-overlay[data-v-4a22a9d8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10005 !important;padding:var(--spacing-md)}.history-text-overlay .history-text-modal[data-v-4a22a9d8]{width:100%;max-width:700px;max-height:85vh;height:80vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);overflow:hidden}.roster-overlay[data-v-4a22a9d8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10006 !important;padding:var(--spacing-md)}.roster-overlay .roster-modal[data-v-4a22a9d8]{width:100%;max-width:800px;max-height:85vh;height:80vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);overflow:hidden}.document-overlay[data-v-4a22a9d8]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;z-index:10007 !important;padding:var(--spacing-md)}.document-overlay .document-modal[data-v-4a22a9d8]{width:100%;max-width:800px;max-height:85vh;height:80vh;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);overflow:hidden}.auto-save-indicator[data-v-4a22a9d8]{position:fixed;bottom:80px;right:20px;display:flex;align-items:center;gap:8px;padding:10px 16px;background:var(--bg-secondary);border:1px solid var(--success-color,#4caf50);border-radius:var(--radius-md);box-shadow:var(--shadow-md);opacity:0;transform:translateY(20px);transition:all .3s ease;z-index:9998}.auto-save-indicator.visible[data-v-4a22a9d8]{opacity:1;transform:translateY(0)}.auto-save-indicator .icon[data-v-4a22a9d8]{font-size:16px}.auto-save-indicator .text[data-v-4a22a9d8]{font-size:12px;color:var(--text-secondary);max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.sidebar-overlay[data-v-4a22a9d8]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.3);z-index:99;animation:fadeIn-4a22a9d8 .2s ease}.mobile-menu-fab[data-v-4a22a9d8]{position:fixed;right:12px;top:50%;transform:translateY(-50%);width:40px;height:40px;border-radius:var(--radius-sm);background:var(--primary-color);color:#fff;border:none;box-shadow:0 2px 8px rgba(99,102,241,.4);cursor:pointer;z-index:98;display:flex;align-items:center;justify-content:center;transition:all var(--transition-fast)}.mobile-menu-fab .fab-icon[data-v-4a22a9d8]{font-size:18px;line-height:1}.mobile-menu-fab[data-v-4a22a9d8]:hover{transform:translateY(-50%) scale(1.05);box-shadow:0 4px 12px rgba(99,102,241,.5)}.mobile-menu-fab[data-v-4a22a9d8]:active{transform:translateY(-50%) scale(0.95)}@media (max-width:480px){.mobile-menu-fab[data-v-4a22a9d8]{width:36px;height:36px;right:8px}.mobile-menu-fab .fab-icon[data-v-4a22a9d8]{font-size:16px}}@media (max-width:768px){.main-area[data-v-4a22a9d8]{position:relative}.modal[data-v-4a22a9d8]{width:95%;max-height:90vh}.fullscreen-modal[data-v-4a22a9d8]{padding:var(--spacing-sm)}.fullscreen-modal .ai-filter-modal[data-v-4a22a9d8]{height:95vh}.save-manager-overlay .save-manager-modal[data-v-4a22a9d8]{width:95%;height:90vh;max-height:90vh}.history-text-overlay[data-v-4a22a9d8]{padding:var(--spacing-sm)}.history-text-overlay .history-text-modal[data-v-4a22a9d8]{width:100%;height:85vh;max-height:90vh;border-radius:var(--radius-sm)}.auto-save-indicator[data-v-4a22a9d8]{bottom:100px;right:10px;left:10px}.auto-save-indicator .text[data-v-4a22a9d8]{max-width:none}.game-layout.sidebar-open .mobile-menu-fab[data-v-4a22a9d8]{opacity:0;pointer-events:none}}@media (max-width:480px){.history-text-overlay[data-v-4a22a9d8]{padding:var(--spacing-xs)}.history-text-overlay .history-text-modal[data-v-4a22a9d8]{height:90vh;max-height:95vh;border-radius:var(--radius-xs)}.save-manager-overlay[data-v-4a22a9d8]{padding:var(--spacing-xs)}.save-manager-overlay .save-manager-modal[data-v-4a22a9d8]{width:100%;height:92vh;max-height:95vh}.context-manager-overlay[data-v-4a22a9d8]{padding:var(--spacing-xs)}.context-manager-overlay .context-manager-modal[data-v-4a22a9d8]{width:100%;max-height:90vh}.help-overlay[data-v-4a22a9d8]{padding:var(--spacing-xs)}.help-overlay .help-modal[data-v-4a22a9d8]{width:100%;max-height:80vh}}
.error-boundary[data-v-7b143150]{display:flex;align-items:center;justify-content:center;min-height:200px;padding:var(--spacing-lg)}.error-content[data-v-7b143150]{max-width:500px;text-align:center;padding:var(--spacing-xl);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md)}.error-icon[data-v-7b143150]{font-size:48px;margin-bottom:var(--spacing-md)}.error-title[data-v-7b143150]{margin:0 0 var(--spacing-sm);color:var(--text-color);font-size:var(--font-lg);font-weight:600}.error-message[data-v-7b143150]{margin:0 0 var(--spacing-lg);color:var(--text-secondary);font-size:var(--font-sm);line-height:1.5}.error-actions[data-v-7b143150]{display:flex;justify-content:center;gap:var(--spacing-sm);margin-bottom:var(--spacing-md)}.error-details[data-v-7b143150]{text-align:left;margin-top:var(--spacing-md)}.error-details summary[data-v-7b143150]{cursor:pointer;color:var(--text-secondary);font-size:var(--font-xs);padding:var(--spacing-sm)}.error-details summary[data-v-7b143150]:hover{color:var(--text-color)}.error-details pre[data-v-7b143150]{margin-top:var(--spacing-sm);padding:var(--spacing-md);background:var(--bg-tertiary);border-radius:var(--radius-sm);font-size:var(--font-xs);color:var(--text-secondary);overflow-x:auto;white-space:pre-wrap;word-break:break-all;max-height:200px;overflow-y:auto}
.confirm-dialog-overlay[data-v-61be8e67]{position:fixed !important;top:0 !important;left:0 !important;right:0 !important;bottom:0 !important;background:rgba(0,0,0,.5);backdrop-filter:blur(2px);display:flex;align-items:center;justify-content:center;z-index:10010 !important;padding:var(--spacing-md,16px)}.confirm-dialog[data-v-61be8e67]{background:var(--bg-secondary,#ffffff);border-radius:var(--radius-lg,8px);box-shadow:var(--shadow-lg,0 10px 20px rgba(0,0,0,0.12));max-width:420px;width:100%;overflow:hidden;animation:dialog-enter-61be8e67 .2s ease-out}.confirm-dialog.type-info[data-v-61be8e67]{--dialog-accent:var(--info-color,#1c71d8);--dialog-accent-light:var(--info-light,rgba(28,113,216,0.1))}.confirm-dialog.type-warning[data-v-61be8e67]{--dialog-accent:var(--warning-color,#e5a50a);--dialog-accent-light:var(--warning-light,rgba(229,165,10,0.1))}.confirm-dialog.type-danger[data-v-61be8e67]{--dialog-accent:var(--error-color,#c01c28);--dialog-accent-light:var(--error-light,rgba(192,28,40,0.1))}.confirm-dialog.type-success[data-v-61be8e67]{--dialog-accent:var(--success-color,#26a269);--dialog-accent-light:var(--success-light,rgba(38,162,105,0.1))}.dialog-header[data-v-61be8e67]{display:flex;align-items:center;gap:var(--spacing-sm,8px);padding:var(--spacing-lg,24px) var(--spacing-lg,24px) var(--spacing-sm,8px)}.dialog-icon[data-v-61be8e67]{font-size:28px;line-height:1;flex-shrink:0}.dialog-title[data-v-61be8e67]{margin:0;font-size:var(--font-lg,17px);font-weight:600;color:var(--text-color,#2e3436)}.dialog-body[data-v-61be8e67]{padding:var(--spacing-sm,8px) var(--spacing-lg,24px) var(--spacing-lg,24px)}.dialog-message[data-v-61be8e67]{margin:0;font-size:var(--font-md,15px);color:var(--text-secondary,#5e5c64);line-height:1.6;word-break:break-word}.dialog-footer[data-v-61be8e67]{display:flex;justify-content:flex-end;gap:var(--spacing-sm,8px);padding:var(--spacing-md,16px) var(--spacing-lg,24px);background:var(--bg-tertiary,#f6f5f4);border-top:1px solid var(--border-light,#e5e5e5)}.btn[data-v-61be8e67]{display:inline-flex;align-items:center;justify-content:center;gap:var(--spacing-xs,4px);padding:var(--spacing-sm,8px) var(--spacing-lg,24px);font-size:var(--font-sm,13px);font-weight:500;border-radius:var(--radius-md,6px);border:none;cursor:pointer;transition:all var(--transition-fast,0.1s ease);min-width:80px}.btn[data-v-61be8e67]:disabled{opacity:.6;cursor:not-allowed}.btn-cancel[data-v-61be8e67]{background:var(--bg-color,#f6f5f4);color:var(--text-color,#2e3436);border:1px solid var(--border-color,#c0bfbc)}.btn-cancel[data-v-61be8e67]:hover:not(:disabled){background:var(--bg-hover,#f0f0f0);border-color:var(--border-hover,#9a9996)}.btn-cancel[data-v-61be8e67]:active:not(:disabled){background:var(--bg-tertiary,#deddda)}.btn-confirm[data-v-61be8e67]{background:var(--dialog-accent,var(--primary-color,#1a5fb4));color:#fff}.btn-confirm[data-v-61be8e67]:hover:not(:disabled){filter:brightness(1.1)}.btn-confirm[data-v-61be8e67]:active:not(:disabled){filter:brightness(0.95)}.btn-confirm.btn-info[data-v-61be8e67]{background:var(--info-color,#1c71d8)}.btn-confirm.btn-warning[data-v-61be8e67]{background:var(--warning-color,#e5a50a);color:var(--text-highlight,#000)}.btn-confirm.btn-danger[data-v-61be8e67]{background:var(--error-color,#c01c28)}.btn-confirm.btn-success[data-v-61be8e67]{background:var(--success-color,#26a269)}.loading-spinner[data-v-61be8e67]{width:14px;height:14px;border:2px solid hsla(0,0%,100%,.3);border-top-color:#fff;border-radius:50%;animation:spin-61be8e67 .8s linear infinite}@keyframes spin-61be8e67{to{transform:rotate(360deg)}}@keyframes dialog-enter-61be8e67{from{opacity:0;transform:scale(0.95) translateY(-10px)}to{opacity:1;transform:scale(1) translateY(0)}}.confirm-dialog-enter-active[data-v-61be8e67],.confirm-dialog-leave-active[data-v-61be8e67]{transition:opacity .2s ease}.confirm-dialog-enter-from[data-v-61be8e67],.confirm-dialog-leave-to[data-v-61be8e67]{opacity:0}.confirm-dialog-enter-active .confirm-dialog[data-v-61be8e67]{animation:dialog-enter-61be8e67 .2s ease-out}.confirm-dialog-leave-active .confirm-dialog[data-v-61be8e67]{animation:dialog-enter-61be8e67 .15s ease-in reverse}@media (max-width:480px){.confirm-dialog[data-v-61be8e67]{max-width:calc(100vw - 32px)}.dialog-footer[data-v-61be8e67]{flex-direction:column-reverse}.btn[data-v-61be8e67]{width:100%}}:root.dark-theme .confirm-dialog[data-v-61be8e67]{background:var(--bg-secondary,#2d2d2d);box-shadow:0 10px 30px rgba(0,0,0,.4)}:root.dark-theme .dialog-title[data-v-61be8e67]{color:var(--text-color,#f5f5f5)}:root.dark-theme .dialog-message[data-v-61be8e67]{color:var(--text-secondary,#b0b0b0)}:root.dark-theme .dialog-footer[data-v-61be8e67]{background:var(--bg-tertiary,#3d3d3d);border-top-color:var(--border-color,#4d4d4d)}:root.dark-theme .btn-cancel[data-v-61be8e67]{background:var(--bg-color,#1e1e1e);color:var(--text-color,#f5f5f5);border-color:var(--border-color,#4d4d4d)}:root.dark-theme .btn-cancel[data-v-61be8e67]:hover:not(:disabled){background:var(--bg-hover,#3d3d3d)}
#app-container[data-v-9c83b896]{width:100%;height:100%;display:flex;flex-direction:column;overflow:hidden;background:var(--bg-color)}.loading-container[data-v-9c83b896]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:var(--spacing-md);background:var(--bg-color)}.loading-spinner[data-v-9c83b896]{width:48px;height:48px;border:4px solid var(--border-color);border-top-color:var(--primary-color);border-radius:50%;animation:spin-9c83b896 .8s linear infinite}.loading-text[data-v-9c83b896]{color:var(--text-secondary);font-size:var(--font-md)}@keyframes spin-9c83b896{to{transform:rotate(360deg)}}
:root{--primary-color:#1a5fb4;--primary-hover:#3584e4;--primary-active:#154d93;--primary-light:rgba(26,95,180,0.1);--bg-color:#f6f5f4;--bg-secondary:#ffffff;--bg-tertiary:#deddda;--bg-panel:#ffffff;--bg-hover:#f0f0f0;--text-color:#2e3436;--text-secondary:#5e5c64;--text-disabled:#9a9996;--text-highlight:#000000;--border-color:#c0bfbc;--border-hover:#9a9996;--border-active:#77767b;--border-light:#e5e5e5;--success-color:#26a269;--success-hover:#2ec27e;--success-light:rgba(38,162,105,0.1);--warning-color:#e5a50a;--warning-hover:#f5c211;--warning-light:rgba(229,165,10,0.1);--error-color:#c01c28;--error-hover:#e01b24;--error-light:rgba(192,28,40,0.1);--danger-color:#c01c28;--danger-hover:#e01b24;--info-color:#1c71d8;--info-hover:#3584e4;--info-light:rgba(28,113,216,0.1);--office-header:#2c3e50;--office-sidebar:#34495e;--office-accent:#e74c3c;--office-gold:#d4af37;--office-stamp:#c0392b;--office-paper:#fffef5;--office-ink:#1a1a2e;--shadow-sm:0 1px 3px rgba(0,0,0,0.08);--shadow-md:0 4px 6px rgba(0,0,0,0.1);--shadow-lg:0 10px 20px rgba(0,0,0,0.12);--shadow-card:0 2px 8px rgba(0,0,0,0.06);--radius-xs:2px;--radius-sm:4px;--radius-md:6px;--radius-lg:8px;--spacing-xs:4px;--spacing-sm:8px;--spacing-md:16px;--spacing-lg:24px;--spacing-xl:32px;--spacing-xxl:48px;--font-xs:11px;--font-sm:13px;--font-md:15px;--font-lg:17px;--font-xl:20px;--font-2xl:24px;--handbook-bg:#fdfcf8;--handbook-text:#2c2c2c;--handbook-text-secondary:#5a5a5a;--handbook-text-muted:#8a8a8a;--handbook-accent:#1a4a7a;--handbook-divider:#b8b8b8;--handbook-border:#d4d0c8;--handbook-title-xl:22px;--handbook-title-lg:18px;--handbook-title-md:16px;--handbook-body:15px;--handbook-detail:14px;--handbook-sub-detail:13px;--handbook-line-height:2;--transition-fast:0.1s ease;--transition-normal:0.2s ease;--transition-slow:0.3s ease;--z-dropdown:100;--z-modal:200;--z-tooltip:300;--z-notification:400}:root.dark-theme{--primary-color:#3584e4;--primary-hover:#62a0ea;--primary-active:#1c71d8;--primary-light:rgba(53,132,228,0.15);--bg-color:#1e1e1e;--bg-secondary:#2d2d2d;--bg-tertiary:#3d3d3d;--bg-panel:#2d2d2d;--bg-hover:#3d3d3d;--text-color:#f5f5f5;--text-secondary:#b0b0b0;--text-disabled:#707070;--text-highlight:#ffffff;--border-color:#4d4d4d;--border-hover:#5d5d5d;--border-active:#6d6d6d;--border-light:#3d3d3d;--office-header:#1a1a2e;--office-sidebar:#252540;--office-paper:#2d2d3d;--shadow-sm:0 1px 3px rgba(0,0,0,0.3);--shadow-md:0 4px 6px rgba(0,0,0,0.4);--shadow-lg:0 10px 20px rgba(0,0,0,0.5);--shadow-card:0 2px 8px rgba(0,0,0,0.3);--handbook-bg:#1e1e24;--handbook-text:#e8e8e8;--handbook-text-secondary:#b0b0b0;--handbook-text-muted:#808080;--handbook-accent:#6ba3d6;--handbook-divider:#4a4a50;--handbook-border:#3a3a42}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:var(--bg-secondary);border-radius:var(--radius-xs)}::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:var(--radius-xs)}::-webkit-scrollbar-thumb:hover{background:var(--border-hover)}.btn{display:inline-flex;align-items:center;justify-content:center;padding:var(--spacing-sm) var(--spacing-md);border:1px solid rgba(0,0,0,0);border-radius:var(--radius-sm);font-size:var(--font-sm);font-weight:500;cursor:pointer;transition:all var(--transition-fast);gap:var(--spacing-xs);background:var(--bg-tertiary);color:var(--text-color)}.btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:var(--shadow-sm)}.btn:active:not(:disabled){transform:translateY(0)}.btn:disabled{opacity:.5;cursor:not-allowed}.btn:focus{outline:none;box-shadow:0 0 0 2px var(--primary-color)}.btn-primary{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}.btn-primary:hover:not(:disabled){background:var(--primary-hover);border-color:var(--primary-hover)}.btn-secondary{background:var(--bg-tertiary);color:var(--text-color);border-color:var(--border-color)}.btn-secondary:hover:not(:disabled){background:var(--border-color)}.btn-success{background:var(--success-color);color:#fff;border-color:var(--success-color)}.btn-success:hover:not(:disabled){background:var(--success-hover);border-color:var(--success-hover)}.btn-danger{background:var(--danger-color);color:#fff;border-color:var(--danger-color)}.btn-danger:hover:not(:disabled){background:var(--danger-hover);border-color:var(--danger-hover)}.btn-warning{background:var(--warning-color);color:#fff;border-color:var(--warning-color)}.btn-warning:hover:not(:disabled){background:var(--warning-hover);border-color:var(--warning-hover)}.btn-ghost{background:rgba(0,0,0,0);border-color:rgba(0,0,0,0);color:var(--text-secondary)}.btn-ghost:hover:not(:disabled){background:var(--bg-tertiary);color:var(--text-color)}.btn-sm{padding:var(--spacing-xs) var(--spacing-sm);font-size:var(--font-xs)}.btn-lg{padding:var(--spacing-md) var(--spacing-lg);font-size:var(--font-md)}.btn-icon{width:32px;height:32px;padding:0;border-radius:var(--radius-sm)}.input,.select,.textarea{width:100%;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-color);font-size:var(--font-sm);transition:border-color var(--transition-fast),box-shadow var(--transition-fast)}.input:focus,.select:focus,.textarea:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(74,159,74,.2)}.input::placeholder,.select::placeholder,.textarea::placeholder{color:var(--text-disabled)}.input:disabled,.select:disabled,.textarea:disabled{opacity:.5;cursor:not-allowed;background:var(--bg-secondary)}.textarea{min-height:80px;resize:vertical;line-height:1.5}.select{cursor:pointer;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a0a0a0' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:36px}.checkbox,.radio{display:inline-flex;align-items:center;gap:var(--spacing-sm);cursor:pointer;font-size:var(--font-sm);color:var(--text-color)}.checkbox input,.radio input{width:16px;height:16px;margin:0;cursor:pointer;accent-color:var(--primary-color)}.card{background:var(--bg-secondary);border-radius:var(--radius-md);padding:var(--spacing-md);border:1px solid var(--border-color)}.card-header{display:flex;align-items:center;justify-content:space-between;padding-bottom:var(--spacing-md);margin-bottom:var(--spacing-md);border-bottom:1px solid var(--border-color)}.card-header h3,.card-header h4{margin:0;color:var(--text-color);font-weight:600}.card-body{color:var(--text-secondary);line-height:1.6}.card-footer{display:flex;align-items:center;justify-content:flex-end;gap:var(--spacing-sm);padding-top:var(--spacing-md);margin-top:var(--spacing-md);border-top:1px solid var(--border-color)}.panel{background:var(--bg-panel);border:2px solid var(--border-color);border-radius:var(--radius-sm);box-shadow:var(--shadow-md)}.panel-header{background:var(--bg-tertiary);padding:var(--spacing-sm) var(--spacing-md);border-bottom:1px solid var(--border-color);font-weight:600;color:var(--text-color)}.panel-body{padding:var(--spacing-md)}.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:var(--radius-xs);font-size:var(--font-xs);font-weight:500}.badge-primary{background:rgba(74,159,74,.2);color:var(--primary-color)}.badge-success{background:rgba(92,184,92,.2);color:var(--success-color)}.badge-warning{background:rgba(240,173,78,.2);color:var(--warning-color)}.badge-danger{background:rgba(217,83,79,.2);color:var(--danger-color)}.badge-info{background:rgba(91,192,222,.2);color:var(--info-color)}.progress{width:100%;height:8px;background:var(--bg-tertiary);border-radius:var(--radius-xs);overflow:hidden}.progress-bar{height:100%;background:var(--primary-color);transition:width var(--transition-normal)}.progress-bar-success{background:var(--success-color)}.progress-bar-warning{background:var(--warning-color)}.progress-bar-danger{background:var(--danger-color)}.divider{height:1px;background:var(--border-color);margin:var(--spacing-md) 0}.divider-vertical{width:1px;height:100%;background:var(--border-color);margin:0 var(--spacing-md)}.text-center{text-align:center}.text-left{text-align:left}.text-right{text-align:right}.text-primary{color:var(--primary-color)}.text-secondary{color:var(--text-secondary)}.text-success{color:var(--success-color)}.text-warning{color:var(--warning-color)}.text-danger{color:var(--danger-color)}.text-info{color:var(--info-color)}.flex{display:flex}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.items-end{align-items:flex-end}.justify-start{justify-content:flex-start}.justify-center{justify-content:center}.justify-end{justify-content:flex-end}.justify-between{justify-content:space-between}.flex-1{flex:1}.gap-xs{gap:var(--spacing-xs)}.gap-sm{gap:var(--spacing-sm)}.gap-md{gap:var(--spacing-md)}.gap-lg{gap:var(--spacing-lg)}.w-full{width:100%}.h-full{height:100%}.w-auto{width:auto}.h-auto{height:auto}.m-0{margin:0}.p-0{padding:0}.mt-sm{margin-top:var(--spacing-sm)}.mt-md{margin-top:var(--spacing-md)}.mb-sm{margin-bottom:var(--spacing-sm)}.mb-md{margin-bottom:var(--spacing-md)}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{from{opacity:1}to{opacity:0}}@keyframes slideInUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes slideInDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}@keyframes spin{to{transform:rotate(360deg)}}.animate-fadeIn{animation:fadeIn var(--transition-normal)}.animate-slideInUp{animation:slideInUp var(--transition-normal)}.animate-slideInDown{animation:slideInDown var(--transition-normal)}.animate-pulse{animation:pulse 2s infinite}.animate-spin{animation:spin 1s linear infinite}.hidden{display:none !important}.visible{visibility:visible}.invisible{visibility:hidden}.overflow-hidden{overflow:hidden}.overflow-auto{overflow:auto}.overflow-scroll{overflow:scroll}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}:root{--cb-dialogue-color:#1a5fb4;--cb-dialogue-bg:rgba(26,95,180,0.05);--cb-dialogue-border:rgba(26,95,180,0.2);--cb-dialogue-icon:"ğŸ’¬";--cb-thought-color:#8b5cf6;--cb-thought-bg:rgba(139,92,246,0.05);--cb-thought-border:rgba(139,92,246,0.15);--cb-thought-icon:"ğŸ’­";--cb-scenery-color:#059669;--cb-scenery-bg:rgba(5,150,105,0.05);--cb-scenery-border:rgba(5,150,105,0.15);--cb-scenery-icon:"ğŸï¸";--cb-system-color:#dc2626;--cb-system-bg:rgba(220,38,38,0.08);--cb-system-border:#dc2626;--cb-system-icon:"âš ï¸";--cb-text-color:var(--text-color,#2e3436);--cb-transition:0.15s ease;--cb-radius-sm:4px;--cb-radius-md:6px;--cb-radius-lg:8px}:root.dark-theme,.dark-theme{--cb-dialogue-color:#60a5fa;--cb-dialogue-bg:rgba(96,165,250,0.1);--cb-dialogue-border:rgba(96,165,250,0.3);--cb-thought-color:#a78bfa;--cb-thought-bg:rgba(167,139,250,0.1);--cb-thought-border:rgba(167,139,250,0.2);--cb-scenery-color:#34d399;--cb-scenery-bg:rgba(52,211,153,0.1);--cb-scenery-border:rgba(52,211,153,0.2);--cb-system-color:#f87171;--cb-system-bg:rgba(248,113,113,0.15);--cb-system-border:#f87171;--cb-text-color:var(--text-color,#f5f5f5)}.content-block-renderer{font-size:var(--font-md,15px);line-height:1.8;color:var(--cb-text-color);word-wrap:break-word;overflow-wrap:break-word}.content-block{display:inline;transition:all var(--cb-transition)}.content-block__icon{margin-right:4px;font-size:.9em;vertical-align:middle;opacity:.8}.content-block__content{vertical-align:baseline}.content-block--text{color:var(--cb-text-color)}.content-block--dialogue{display:inline-block;position:relative;color:var(--cb-dialogue-color);background:var(--cb-dialogue-bg);border-left:3px solid var(--cb-dialogue-border);border-radius:0 var(--cb-radius-sm) var(--cb-radius-sm) 0;padding:6px 12px;margin:4px 2px}.content-block--dialogue::before{content:"ã€Œ";position:absolute;left:-2px;top:-4px;font-size:1.5em;color:var(--cb-dialogue-border);opacity:.4;font-weight:bold}.content-block--dialogue:hover{background:var(--cb-dialogue-bg);border-left-color:var(--cb-dialogue-color);transform:translateX(2px);box-shadow:-2px 2px 8px rgba(26,95,180,.15)}.content-block--thought{display:inline-block;color:var(--cb-thought-color);background:var(--cb-thought-bg);font-style:italic;padding:4px 10px;margin:2px;border-radius:var(--cb-radius-sm);position:relative}.content-block--thought::after{content:"";position:absolute;bottom:2px;left:10%;right:10%;height:2px;background:linear-gradient(90deg,transparent 0%,var(--cb-thought-border) 20%,var(--cb-thought-color) 50%,var(--cb-thought-border) 80%,transparent 100%);opacity:.3;border-radius:1px}.content-block--thought .content-block__icon{animation:thoughtBubble 2s ease-in-out infinite}.content-block--thought:hover{background:rgba(139,92,246,.1)}.content-block--thought:hover::after{opacity:.5}@keyframes thoughtBubble{0%,100%{transform:translateY(0);opacity:.8}50%{transform:translateY(-2px);opacity:1}}.content-block--scenery{display:block;color:var(--cb-scenery-color);background:var(--cb-scenery-bg);border:1px dashed var(--cb-scenery-border);border-radius:var(--cb-radius-md);padding:12px 16px;margin:10px 0;line-height:1.9;position:relative}.content-block--scenery::before,.content-block--scenery::after{content:"";position:absolute;width:12px;height:12px;border:2px solid var(--cb-scenery-border);opacity:.4}.content-block--scenery::before{top:-1px;left:-1px;border-right:none;border-bottom:none;border-radius:var(--cb-radius-sm) 0 0 0}.content-block--scenery::after{bottom:-1px;right:-1px;border-left:none;border-top:none;border-radius:0 0 var(--cb-radius-sm) 0}.content-block--scenery:hover{border-style:solid;box-shadow:0 4px 12px rgba(5,150,105,.1)}.content-block--scenery:hover::before,.content-block--scenery:hover::after{opacity:.7}.content-block--scenery .content-block__content{display:block;text-indent:2em}.content-block--system{display:block;color:var(--cb-system-color);background:var(--cb-system-bg);border:2px solid var(--cb-system-border);border-radius:var(--cb-radius-lg);padding:14px 20px;margin:12px 0;text-align:center;font-weight:600;position:relative;overflow:hidden}.content-block--system::before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:repeating-linear-gradient(90deg,var(--cb-system-color),var(--cb-system-color) 10px,transparent 10px,transparent 20px);opacity:.3}.content-block--system .content-block__icon{font-size:1.2em;margin-right:8px;animation:systemPulse 1.5s ease-in-out infinite}.content-block--system:hover{transform:scale(1.01);box-shadow:0 4px 16px rgba(220,38,38,.2)}.content-block--system:hover::before{opacity:.5}@keyframes systemPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}.streaming-cursor{display:inline-block;color:var(--primary-color,#1a5fb4);font-weight:bold;animation:cursorBlink 1s step-end infinite;margin-left:2px}@keyframes cursorBlink{0%,50%{opacity:1}51%,100%{opacity:0}}.content-block--animated{animation:blockFadeIn .3s ease-out}@keyframes blockFadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}@media print{.content-block{background:none !important;border:none !important;padding:0 !important;margin:0 !important}.content-block::before,.content-block::after{display:none !important}.content-block--dialogue::before{display:inline !important;content:"ã€Œ" !important;position:static !important}.content-block--dialogue::after{content:"ã€" !important}.content-block--scenery::before{content:"ã€" !important}.content-block--scenery::after{content:"ã€‘" !important}.content-block--system{border:1px solid #000 !important;text-align:center}.streaming-cursor{display:none !important}}@media (max-width:768px){.content-block--dialogue{padding:4px 8px;margin:2px 1px}.content-block--dialogue::before{font-size:1.2em}.content-block--thought{padding:3px 8px}.content-block--scenery{padding:8px 12px;margin:8px 0}.content-block--scenery .content-block__content{text-indent:1em}.content-block--system{padding:10px 14px;margin:8px 0}}@media (prefers-reduced-motion:reduce){.content-block,.content-block--animated,.streaming-cursor,.content-block__icon{animation:none !important;transition:none !important}}@media (prefers-contrast:high){:root{--cb-dialogue-color:#0055cc;--cb-dialogue-bg:rgba(0,85,204,0.15);--cb-dialogue-border:#0055cc;--cb-thought-color:#6b21a8;--cb-thought-bg:rgba(107,33,168,0.15);--cb-scenery-color:#047857;--cb-scenery-bg:rgba(4,120,87,0.15);--cb-scenery-border:#047857;--cb-system-color:#b91c1c;--cb-system-bg:rgba(185,28,28,0.15);--cb-system-border:#b91c1c}.content-block{border-width:2px !important}}*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;font-family:"Microsoft YaHei",-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:var(--bg-color);color:var(--text-color);font-size:var(--font-md);line-height:1.5;overflow:hidden}#app{width:100%;height:100%;display:flex;flex-direction:column}.no-select{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}input,textarea,.selectable{user-select:text;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text}a{color:var(--primary-color);text-decoration:none;transition:color var(--transition-fast)}a:hover{color:var(--primary-hover);text-decoration:underline}ul,ol{list-style:none}img{max-width:100%;height:auto;vertical-align:middle}code,pre{font-family:"Consolas","Monaco","Courier New",monospace;background:var(--bg-tertiary);border-radius:var(--radius-xs)}code{padding:2px 6px;font-size:var(--font-sm)}pre{padding:var(--spacing-md);overflow-x:auto}pre code{padding:0;background:none}table{width:100%;border-collapse:collapse;background:var(--bg-secondary)}table th,table td{padding:var(--spacing-sm) var(--spacing-md);border:1px solid var(--border-color);text-align:left}table th{background:var(--bg-tertiary);font-weight:600;color:var(--text-color)}table tr:hover{background:var(--bg-tertiary)}:focus-visible{outline:2px solid var(--primary-color);outline-offset:2px}.loading-spinner{width:32px;height:32px;border:3px solid var(--border-color);border-top-color:var(--primary-color);border-radius:50%;animation:spin .8s linear infinite}.loading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:var(--spacing-md);min-height:200px}.loading-container p{color:var(--text-secondary);font-size:var(--font-sm)}.pixel-border{border:2px solid var(--border-color);box-shadow:inset 2px 2px 0 hsla(0,0%,100%,.1),inset -2px -2px 0 rgba(0,0,0,.2)}.mc-btn{display:inline-flex;align-items:center;justify-content:center;padding:var(--spacing-sm) var(--spacing-lg);background:linear-gradient(180deg,var(--bg-tertiary) 0%,var(--bg-secondary) 100%);border:2px solid var(--border-color);border-radius:0;color:var(--text-color);font-size:var(--font-sm);font-weight:500;cursor:pointer;transition:all var(--transition-fast);box-shadow:inset 1px 1px 0 hsla(0,0%,100%,.1),inset -1px -1px 0 rgba(0,0,0,.2)}.mc-btn:hover:not(:disabled){background:linear-gradient(180deg,var(--border-color) 0%,var(--bg-tertiary) 100%);border-color:var(--border-hover)}.mc-btn:active:not(:disabled){box-shadow:inset -1px -1px 0 hsla(0,0%,100%,.1),inset 1px 1px 0 rgba(0,0,0,.2)}.mc-btn:disabled{opacity:.5;cursor:not-allowed}.tooltip{position:absolute;padding:var(--spacing-xs) var(--spacing-sm);background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:var(--font-xs);color:var(--text-color);white-space:nowrap;z-index:var(--z-tooltip);box-shadow:var(--shadow-md);pointer-events:none}.overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);z-index:var(--z-modal);display:flex;align-items:center;justify-content:center}.modal{background:var(--bg-secondary);border:2px solid var(--border-color);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);max-width:90vw;max-height:90vh;overflow:auto}.modal-header{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md);border-bottom:1px solid var(--border-color)}.modal-header h3{margin:0;font-weight:600;color:var(--text-color)}.modal-body{padding:var(--spacing-md)}.modal-footer{display:flex;align-items:center;justify-content:flex-end;gap:var(--spacing-sm);padding:var(--spacing-md);border-top:1px solid var(--border-color)}
</style></head><body><div id="app"></div></body></html>