/**
 * MClite - å†…å®¹å—å·®å¼‚åŒ–æ˜¾ç¤ºæ ·å¼
 * 
 * æ ¼å¼å¼ºè°ƒè§„åˆ™ï¼š
 * - ã€Œã€ è§’è‰²è¯­è¨€/å¯¹è¯ - æ·±è“è‰²ï¼Œå¼•ç”¨æ ·å¼
 * - *...* è§’è‰²å¿ƒç†æå†™ - ç´«è‰²ï¼Œæ–œä½“
 * - ã€ã€‘ æ™¯ç‰©æå†™ - ç»¿è‰²ï¼Œè™šçº¿è¾¹æ¡†
 * - ã€ã€...ã€‘ã€‘ ç³»ç»Ÿæç¤º - çº¢è‰²ï¼Œå¼ºè°ƒè¾¹æ¡†
 */

// ============ å†…å®¹å—CSSå˜é‡ ============
:root {
  // === å¯¹è¯æ ·å¼ï¼ˆã€Œã€ï¼‰===
  --cb-dialogue-color: #1a5fb4;
  --cb-dialogue-bg: rgba(26, 95, 180, 0.05);
  --cb-dialogue-border: rgba(26, 95, 180, 0.2);
  --cb-dialogue-icon: 'ğŸ’¬';

  // === å¿ƒç†æå†™æ ·å¼ï¼ˆ*...*ï¼‰===
  --cb-thought-color: #8b5cf6;
  --cb-thought-bg: rgba(139, 92, 246, 0.05);
  --cb-thought-border: rgba(139, 92, 246, 0.15);
  --cb-thought-icon: 'ğŸ’­';

  // === æ™¯ç‰©æå†™æ ·å¼ï¼ˆã€ã€‘ï¼‰===
  --cb-scenery-color: #059669;
  --cb-scenery-bg: rgba(5, 150, 105, 0.05);
  --cb-scenery-border: rgba(5, 150, 105, 0.15);
  --cb-scenery-icon: 'ğŸï¸';

  // === ç³»ç»Ÿæç¤ºæ ·å¼ï¼ˆã€ã€ã€‘ã€‘ï¼‰===
  --cb-system-color: #dc2626;
  --cb-system-bg: rgba(220, 38, 38, 0.08);
  --cb-system-border: #dc2626;
  --cb-system-icon: 'âš ï¸';

  // === é€šç”¨æ ·å¼ ===
  --cb-text-color: var(--text-color, #2e3436);
  --cb-transition: 0.15s ease;
  --cb-radius-sm: 4px;
  --cb-radius-md: 6px;
  --cb-radius-lg: 8px;
}

// ============ æ·±è‰²ä¸»é¢˜å˜é‡ ============
:root.dark-theme,
.dark-theme {
  // === å¯¹è¯æ ·å¼ï¼ˆæ·±è‰²ï¼‰===
  --cb-dialogue-color: #60a5fa;
  --cb-dialogue-bg: rgba(96, 165, 250, 0.1);
  --cb-dialogue-border: rgba(96, 165, 250, 0.3);

  // === å¿ƒç†æå†™æ ·å¼ï¼ˆæ·±è‰²ï¼‰===
  --cb-thought-color: #a78bfa;
  --cb-thought-bg: rgba(167, 139, 250, 0.1);
  --cb-thought-border: rgba(167, 139, 250, 0.2);

  // === æ™¯ç‰©æå†™æ ·å¼ï¼ˆæ·±è‰²ï¼‰===
  --cb-scenery-color: #34d399;
  --cb-scenery-bg: rgba(52, 211, 153, 0.1);
  --cb-scenery-border: rgba(52, 211, 153, 0.2);

  // === ç³»ç»Ÿæç¤ºæ ·å¼ï¼ˆæ·±è‰²ï¼‰===
  --cb-system-color: #f87171;
  --cb-system-bg: rgba(248, 113, 113, 0.15);
  --cb-system-border: #f87171;

  --cb-text-color: var(--text-color, #f5f5f5);
}

// ============ å†…å®¹å—æ¸²æŸ“å™¨å®¹å™¨ ============
.content-block-renderer {
  font-size: var(--font-md, 15px);
  line-height: 1.8;
  color: var(--cb-text-color);
  word-wrap: break-word;
  overflow-wrap: break-word;
}

// ============ å†…å®¹å—åŸºç¡€æ ·å¼ ============
.content-block {
  display: inline;
  transition: all var(--cb-transition);

  &__icon {
    margin-right: 4px;
    font-size: 0.9em;
    vertical-align: middle;
    opacity: 0.8;
  }

  &__content {
    vertical-align: baseline;
  }
}

// ============ æ™®é€šæ–‡æœ¬ ============
.content-block--text {
  color: var(--cb-text-color);
  // æ— ç‰¹æ®Šæ ·å¼
}

// ============ å¯¹è¯æ ·å¼ - ã€Œã€ ============
.content-block--dialogue {
  display: inline-block;
  position: relative;
  color: var(--cb-dialogue-color);
  background: var(--cb-dialogue-bg);
  border-left: 3px solid var(--cb-dialogue-border);
  border-radius: 0 var(--cb-radius-sm) var(--cb-radius-sm) 0;
  padding: 6px 12px;
  margin: 4px 2px;

  // å¯¹è¯å¼•å·æ•ˆæœ
  &::before {
    content: 'ã€Œ';
    position: absolute;
    left: -2px;
    top: -4px;
    font-size: 1.5em;
    color: var(--cb-dialogue-border);
    opacity: 0.4;
    font-weight: bold;
  }

  // æ‚¬åœæ•ˆæœ
  &:hover {
    background: var(--cb-dialogue-bg);
    border-left-color: var(--cb-dialogue-color);
    transform: translateX(2px);
    box-shadow: -2px 2px 8px rgba(26, 95, 180, 0.15);
  }
}

// ============ å¿ƒç†æå†™æ ·å¼ - *...* ============
.content-block--thought {
  display: inline-block;
  color: var(--cb-thought-color);
  background: var(--cb-thought-bg);
  font-style: italic;
  padding: 4px 10px;
  margin: 2px;
  border-radius: var(--cb-radius-sm);
  position: relative;

  // è£…é¥°æ€§æ•ˆæœ - æ³¢æµªåº•çº¿
  &::after {
    content: '';
    position: absolute;
    bottom: 2px;
    left: 10%;
    right: 10%;
    height: 2px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      var(--cb-thought-border) 20%,
      var(--cb-thought-color) 50%,
      var(--cb-thought-border) 80%,
      transparent 100%
    );
    opacity: 0.3;
    border-radius: 1px;
  }

  // æ€è€ƒæ³¡æ³¡å›¾æ ‡æ•ˆæœ
  .content-block__icon {
    animation: thoughtBubble 2s ease-in-out infinite;
  }

  // æ‚¬åœæ•ˆæœ
  &:hover {
    background: rgba(139, 92, 246, 0.1);

    &::after {
      opacity: 0.5;
    }
  }
}

@keyframes thoughtBubble {
  0%,
  100% {
    transform: translateY(0);
    opacity: 0.8;
  }
  50% {
    transform: translateY(-2px);
    opacity: 1;
  }
}

// ============ æ™¯ç‰©æå†™æ ·å¼ - ã€ã€‘ ============
.content-block--scenery {
  display: block;
  color: var(--cb-scenery-color);
  background: var(--cb-scenery-bg);
  border: 1px dashed var(--cb-scenery-border);
  border-radius: var(--cb-radius-md);
  padding: 12px 16px;
  margin: 10px 0;
  line-height: 1.9;
  position: relative;

  // è£…é¥°æ€§è§’è½
  &::before,
  &::after {
    content: '';
    position: absolute;
    width: 12px;
    height: 12px;
    border: 2px solid var(--cb-scenery-border);
    opacity: 0.4;
  }

  &::before {
    top: -1px;
    left: -1px;
    border-right: none;
    border-bottom: none;
    border-radius: var(--cb-radius-sm) 0 0 0;
  }

  &::after {
    bottom: -1px;
    right: -1px;
    border-left: none;
    border-top: none;
    border-radius: 0 0 var(--cb-radius-sm) 0;
  }

  // æ‚¬åœæ•ˆæœ
  &:hover {
    border-style: solid;
    box-shadow: 0 4px 12px rgba(5, 150, 105, 0.1);

    &::before,
    &::after {
      opacity: 0.7;
    }
  }

  // æ™¯ç‰©æå†™å†…çš„æ–‡å­—ç¨å¾®ç¼©è¿›
  .content-block__content {
    display: block;
    text-indent: 2em;
  }
}

// ============ ç³»ç»Ÿæç¤ºæ ·å¼ - ã€ã€ã€‘ã€‘ ============
.content-block--system {
  display: block;
  color: var(--cb-system-color);
  background: var(--cb-system-bg);
  border: 2px solid var(--cb-system-border);
  border-radius: var(--cb-radius-lg);
  padding: 14px 20px;
  margin: 12px 0;
  text-align: center;
  font-weight: 600;
  position: relative;
  overflow: hidden;

  // è­¦ç¤ºæ¡çº¹èƒŒæ™¯
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: repeating-linear-gradient(
      90deg,
      var(--cb-system-color),
      var(--cb-system-color) 10px,
      transparent 10px,
      transparent 20px
    );
    opacity: 0.3;
  }

  // å›¾æ ‡æ”¾å¤§å¹¶æ·»åŠ åŠ¨ç”»
  .content-block__icon {
    font-size: 1.2em;
    margin-right: 8px;
    animation: systemPulse 1.5s ease-in-out infinite;
  }

  // æ‚¬åœæ•ˆæœ
  &:hover {
    transform: scale(1.01);
    box-shadow: 0 4px 16px rgba(220, 38, 38, 0.2);

    &::before {
      opacity: 0.5;
    }
  }
}

@keyframes systemPulse {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

// ============ æµå¼ä¼ è¾“å…‰æ ‡ ============
.streaming-cursor {
  display: inline-block;
  color: var(--primary-color, #1a5fb4);
  font-weight: bold;
  animation: cursorBlink 1s step-end infinite;
  margin-left: 2px;
}

@keyframes cursorBlink {
  0%,
  50% {
    opacity: 1;
  }
  51%,
  100% {
    opacity: 0;
  }
}

// ============ åŠ¨ç”»æ•ˆæœ ============
.content-block--animated {
  animation: blockFadeIn 0.3s ease-out;
}

@keyframes blockFadeIn {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// ============ æ‰“å°æ ·å¼ ============
@media print {
  .content-block {
    // æ‰“å°æ—¶ç®€åŒ–æ ·å¼
    background: none !important;
    border: none !important;
    padding: 0 !important;
    margin: 0 !important;

    &::before,
    &::after {
      display: none !important;
    }
  }

  .content-block--dialogue {
    &::before {
      display: inline !important;
      content: 'ã€Œ' !important;
      position: static !important;
    }
    &::after {
      content: 'ã€' !important;
    }
  }

  .content-block--scenery {
    &::before {
      content: 'ã€' !important;
    }
    &::after {
      content: 'ã€‘' !important;
    }
  }

  .content-block--system {
    border: 1px solid #000 !important;
    text-align: center;
  }

  .streaming-cursor {
    display: none !important;
  }
}

// ============ å“åº”å¼è°ƒæ•´ ============
@media (max-width: 768px) {
  .content-block--dialogue {
    padding: 4px 8px;
    margin: 2px 1px;

    &::before {
      font-size: 1.2em;
    }
  }

  .content-block--thought {
    padding: 3px 8px;
  }

  .content-block--scenery {
    padding: 8px 12px;
    margin: 8px 0;

    .content-block__content {
      text-indent: 1em;
    }
  }

  .content-block--system {
    padding: 10px 14px;
    margin: 8px 0;
  }
}

// ============ æ— éšœç¢ï¼šå‡å°‘åŠ¨ç”» ============
@media (prefers-reduced-motion: reduce) {
  .content-block,
  .content-block--animated,
  .streaming-cursor,
  .content-block__icon {
    animation: none !important;
    transition: none !important;
  }
}

// ============ é«˜å¯¹æ¯”åº¦æ¨¡å¼ ============
@media (prefers-contrast: high) {
  :root {
    --cb-dialogue-color: #0055cc;
    --cb-dialogue-bg: rgba(0, 85, 204, 0.15);
    --cb-dialogue-border: #0055cc;

    --cb-thought-color: #6b21a8;
    --cb-thought-bg: rgba(107, 33, 168, 0.15);

    --cb-scenery-color: #047857;
    --cb-scenery-bg: rgba(4, 120, 87, 0.15);
    --cb-scenery-border: #047857;

    --cb-system-color: #b91c1c;
    --cb-system-bg: rgba(185, 28, 28, 0.15);
    --cb-system-border: #b91c1c;
  }

  .content-block {
    border-width: 2px !important;
  }
}
